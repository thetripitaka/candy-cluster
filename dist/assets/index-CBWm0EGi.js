const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-BoVEXPQ3.js","assets/webworkerAll-qw6PmUCT.js","assets/colorToUniform-BXaCBwVl.js","assets/WebGPURenderer-BDqfH_WG.js","assets/SharedSystems-D92Isodi.js","assets/WebGLRenderer-BRSWVwPE.js"])))=>i.map(i=>d[i]);
var NS=Object.defineProperty;var WS=(s,t,e)=>t in s?NS(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var dn=(s,t,e)=>WS(s,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const DS="modulepreload",GS=function(s){return"/"+s},Em={},mh=function(t,e,n){let i=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),h=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(e.map(d=>{if(d=GS(d),d in Em)return;Em[d]=!0;const _=d.endsWith(".css"),g=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const l=document.createElement("link");if(l.rel=_?"stylesheet":DS,_||(l.as="script"),l.crossOrigin="",l.href=d,h&&l.setAttribute("nonce",h),document.head.appendChild(l),_)return new Promise((m,y)=>{l.addEventListener("load",m),l.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=o,window.dispatchEvent(h),!h.defaultPrevented)throw o}return i.then(o=>{for(const h of o||[])h.status==="rejected"&&r(h.reason);return t().catch(r)})};var kt=(s=>(s.Application="application",s.WebGLPipes="webgl-pipes",s.WebGLPipesAdaptor="webgl-pipes-adaptor",s.WebGLSystem="webgl-system",s.WebGPUPipes="webgpu-pipes",s.WebGPUPipesAdaptor="webgpu-pipes-adaptor",s.WebGPUSystem="webgpu-system",s.CanvasSystem="canvas-system",s.CanvasPipesAdaptor="canvas-pipes-adaptor",s.CanvasPipes="canvas-pipes",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s.MaskEffect="mask-effect",s.BlendMode="blend-mode",s.TextureSource="texture-source",s.Environment="environment",s.ShapeBuilder="shape-builder",s.Batcher="batcher",s))(kt||{});const Od=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Kc=(s,t)=>Od(s).priority??t,us={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(Od).forEach(t=>{t.type.forEach(e=>{var n,i;return(i=(n=this._removeHandlers)[e])==null?void 0:i.call(n,t)})}),this},add(...s){return s.map(Od).forEach(t=>{t.type.forEach(e=>{var r,o;const n=this._addHandlers,i=this._queue;n[e]?(o=n[e])==null||o.call(n,t):(i[e]=i[e]||[],(r=i[e])==null||r.push(t))})}),this},handle(s,t,e){var o;const n=this._addHandlers,i=this._removeHandlers;if(n[s]||i[s])throw new Error(`Extension type ${s} already has a handler`);n[s]=t,i[s]=e;const r=this._queue;return r[s]&&((o=r[s])==null||o.forEach(h=>t(h)),delete r[s]),this},handleByMap(s,t){return this.handle(s,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(s,t,e=-1){return this.handle(s,n=>{t.findIndex(r=>r.name===n.name)>=0||(t.push({name:n.name,value:n.ref}),t.sort((r,o)=>Kc(o.value,e)-Kc(r.value,e)))},n=>{const i=t.findIndex(r=>r.name===n.name);i!==-1&&t.splice(i,1)})},handleByList(s,t,e=-1){return this.handle(s,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((i,r)=>Kc(r,e)-Kc(i,e)))},n=>{const i=t.indexOf(n.ref);i!==-1&&t.splice(i,1)})},mixin(s,...t){for(const e of t)Object.defineProperties(s.prototype,Object.getOwnPropertyDescriptors(e))}},HS={extension:{type:kt.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await mh(()=>import("./browserAll-BoVEXPQ3.js"),__vite__mapDeps([0,1,2]))}},US={extension:{type:kt.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await mh(()=>import("./webworkerAll-qw6PmUCT.js"),__vite__mapDeps([1,2]))}};class hs{constructor(t,e,n){this._x=e||0,this._y=n||0,this._observer=t}clone(t){return new hs(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var Ja=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function z_(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var V_={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function i(d,_,g){this.fn=d,this.context=_,this.once=g||!1}function r(d,_,g,l,m){if(typeof g!="function")throw new TypeError("The listener must be a function");var y=new i(g,l||d,m),w=e?e+_:_;return d._events[w]?d._events[w].fn?d._events[w]=[d._events[w],y]:d._events[w].push(y):(d._events[w]=y,d._eventsCount++),d}function o(d,_){--d._eventsCount===0?d._events=new n:delete d._events[_]}function h(){this._events=new n,this._eventsCount=0}h.prototype.eventNames=function(){var _=[],g,l;if(this._eventsCount===0)return _;for(l in g=this._events)t.call(g,l)&&_.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(g)):_},h.prototype.listeners=function(_){var g=e?e+_:_,l=this._events[g];if(!l)return[];if(l.fn)return[l.fn];for(var m=0,y=l.length,w=new Array(y);m<y;m++)w[m]=l[m].fn;return w},h.prototype.listenerCount=function(_){var g=e?e+_:_,l=this._events[g];return l?l.fn?1:l.length:0},h.prototype.emit=function(_,g,l,m,y,w){var M=e?e+_:_;if(!this._events[M])return!1;var S=this._events[M],A=arguments.length,C,I;if(S.fn){switch(S.once&&this.removeListener(_,S.fn,void 0,!0),A){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,g),!0;case 3:return S.fn.call(S.context,g,l),!0;case 4:return S.fn.call(S.context,g,l,m),!0;case 5:return S.fn.call(S.context,g,l,m,y),!0;case 6:return S.fn.call(S.context,g,l,m,y,w),!0}for(I=1,C=new Array(A-1);I<A;I++)C[I-1]=arguments[I];S.fn.apply(S.context,C)}else{var O=S.length,$;for(I=0;I<O;I++)switch(S[I].once&&this.removeListener(_,S[I].fn,void 0,!0),A){case 1:S[I].fn.call(S[I].context);break;case 2:S[I].fn.call(S[I].context,g);break;case 3:S[I].fn.call(S[I].context,g,l);break;case 4:S[I].fn.call(S[I].context,g,l,m);break;default:if(!C)for($=1,C=new Array(A-1);$<A;$++)C[$-1]=arguments[$];S[I].fn.apply(S[I].context,C)}}return!0},h.prototype.on=function(_,g,l){return r(this,_,g,l,!1)},h.prototype.once=function(_,g,l){return r(this,_,g,l,!0)},h.prototype.removeListener=function(_,g,l,m){var y=e?e+_:_;if(!this._events[y])return this;if(!g)return o(this,y),this;var w=this._events[y];if(w.fn)w.fn===g&&(!m||w.once)&&(!l||w.context===l)&&o(this,y);else{for(var M=0,S=[],A=w.length;M<A;M++)(w[M].fn!==g||m&&!w[M].once||l&&w[M].context!==l)&&S.push(w[M]);S.length?this._events[y]=S.length===1?S[0]:S:o(this,y)}return this},h.prototype.removeAllListeners=function(_){var g;return _?(g=e?e+_:_,this._events[g]&&o(this,g)):(this._events=new n,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,s.exports=h})(V_);var YS=V_.exports;const Sr=z_(YS),XS=Math.PI*2,zS=180/Math.PI,VS=Math.PI/180;class ms{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ms(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return ed.x=0,ed.y=0,ed}}const ed=new ms;class fe{constructor(t=1,e=0,n=0,i=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,i,r,o){return this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new ms;const n=t.x,i=t.y;return e.x=this.a*n+this.c*i+this.tx,e.y=this.b*n+this.d*i+this.ty,e}applyInverse(t,e){e=e||new ms;const n=this.a,i=this.b,r=this.c,o=this.d,h=this.tx,d=this.ty,_=1/(n*o+r*-i),g=t.x,l=t.y;return e.x=o*_*g+-r*_*l+(d*r-h*o)*_,e.y=n*_*l+-i*_*g+(-d*n+h*i)*_,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.a,r=this.c,o=this.tx;return this.a=i*e-this.b*n,this.b=i*n+this.b*e,this.c=r*e-this.d*n,this.d=r*n+this.d*e,this.tx=o*e-this.ty*n,this.ty=o*n+this.ty*e,this}append(t){const e=this.a,n=this.b,i=this.c,r=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*n+t.b*r,this.c=t.c*e+t.d*i,this.d=t.c*n+t.d*r,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*r+this.ty,this}appendFrom(t,e){const n=t.a,i=t.b,r=t.c,o=t.d,h=t.tx,d=t.ty,_=e.a,g=e.b,l=e.c,m=e.d;return this.a=n*_+i*l,this.b=n*g+i*m,this.c=r*_+o*l,this.d=r*g+o*m,this.tx=h*_+d*l+e.tx,this.ty=h*g+d*m+e.ty,this}setTransform(t,e,n,i,r,o,h,d,_){return this.a=Math.cos(h+_)*r,this.b=Math.sin(h+_)*r,this.c=-Math.sin(h-d)*o,this.d=Math.cos(h-d)*o,this.tx=t-(n*this.a+i*this.c),this.ty=e-(n*this.b+i*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,i=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,i=this.c,r=this.d,o=t.pivot,h=-Math.atan2(-i,r),d=Math.atan2(n,e),_=Math.abs(h+d);return _<1e-5||Math.abs(XS-_)<1e-5?(t.rotation=d,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=d),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(i*i+r*r),t.position.x=this.tx+(o.x*e+o.y*i),t.position.y=this.ty+(o.x*n+o.y*r),t}invert(){const t=this.a,e=this.b,n=this.c,i=this.d,r=this.tx,o=t*i-e*n;return this.a=i/o,this.b=-e/o,this.c=-n/o,this.d=t/o,this.tx=(n*this.ty-i*r)/o,this.ty=-(t*this.ty-e*r)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new fe;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return jS.identity()}static get shared(){return $S.identity()}}const $S=new fe,jS=new fe,ho=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uo=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],fo=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],po=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Rd=[],$_=[],Zc=Math.sign;function qS(){for(let s=0;s<16;s++){const t=[];Rd.push(t);for(let e=0;e<16;e++){const n=Zc(ho[s]*ho[e]+fo[s]*uo[e]),i=Zc(uo[s]*ho[e]+po[s]*uo[e]),r=Zc(ho[s]*fo[e]+fo[s]*po[e]),o=Zc(uo[s]*fo[e]+po[s]*po[e]);for(let h=0;h<16;h++)if(ho[h]===n&&uo[h]===i&&fo[h]===r&&po[h]===o){t.push(h);break}}}for(let s=0;s<16;s++){const t=new fe;t.set(ho[s],uo[s],fo[s],po[s],0,0),$_.push(t)}}qS();const He={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>ho[s],uY:s=>uo[s],vX:s=>fo[s],vY:s=>po[s],inv:s=>s&8?s&15:-s&7,add:(s,t)=>Rd[s][t],sub:(s,t)=>Rd[s][He.inv(t)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,t)=>Math.abs(s)*2<=Math.abs(t)?t>=0?He.S:He.N:Math.abs(t)*2<=Math.abs(s)?s>0?He.E:He.W:t>0?s>0?He.SE:He.SW:s>0?He.NE:He.NW,matrixAppendRotationInv:(s,t,e=0,n=0)=>{const i=$_[He.inv(t)];i.tx=e,i.ty=n,s.append(i)},transformRectCoords:(s,t,e,n)=>{const{x:i,y:r,width:o,height:h}=s,{x:d,y:_,width:g,height:l}=t;return e===He.E?(n.set(i+d,r+_,o,h),n):e===He.S?n.set(g-r-h+d,i+_,h,o):e===He.W?n.set(g-i-o+d,l-r-h+_,o,h):e===He.N?n.set(r+d,l-i-o+_,h,o):n.set(i+d,r+_,o,h)}},Qc=[new ms,new ms,new ms,new ms];class $t{constructor(t=0,e=0,n=0,i=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new $t(0,0,0,0)}clone(){return new $t(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,n,i=.5){const{width:r,height:o}=this;if(r<=0||o<=0)return!1;const h=this.x,d=this.y,_=n*(1-i),g=n-_,l=h-_,m=h+r+_,y=d-_,w=d+o+_,M=h+g,S=h+r-g,A=d+g,C=d+o-g;return t>=l&&t<=m&&e>=y&&e<=w&&!(t>M&&t<S&&e>A&&e<C)}intersects(t,e){if(!e){const lt=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=lt)return!1;const st=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>st}const n=this.left,i=this.right,r=this.top,o=this.bottom;if(i<=n||o<=r)return!1;const h=Qc[0].set(t.left,t.top),d=Qc[1].set(t.left,t.bottom),_=Qc[2].set(t.right,t.top),g=Qc[3].set(t.right,t.bottom);if(_.x<=h.x||d.y<=h.y)return!1;const l=Math.sign(e.a*e.d-e.b*e.c);if(l===0||(e.apply(h,h),e.apply(d,d),e.apply(_,_),e.apply(g,g),Math.max(h.x,d.x,_.x,g.x)<=n||Math.min(h.x,d.x,_.x,g.x)>=i||Math.max(h.y,d.y,_.y,g.y)<=r||Math.min(h.y,d.y,_.y,g.y)>=o))return!1;const m=l*(d.y-h.y),y=l*(h.x-d.x),w=m*n+y*r,M=m*i+y*r,S=m*n+y*o,A=m*i+y*o;if(Math.max(w,M,S,A)<=m*h.x+y*h.y||Math.min(w,M,S,A)>=m*g.x+y*g.y)return!1;const C=l*(h.y-_.y),I=l*(_.x-h.x),O=C*n+I*r,$=C*i+I*r,W=C*n+I*o,G=C*i+I*o;return!(Math.max(O,$,W,G)<=C*h.x+I*h.y||Math.min(O,$,W,G)>=C*g.x+I*g.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=i,this.height=Math.max(r-i,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=i-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=i,this.height=r-i,this}getBounds(t){return t||(t=new $t),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,n=t.y,i=t.x+t.width,r=t.y+t.height;return e>=this.x&&e<this.x+this.width&&n>=this.y&&n<this.y+this.height&&i>=this.x&&i<this.x+this.width&&r>=this.y&&r<this.y+this.height}set(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const nd={default:-1};function vn(s="default"){return nd[s]===void 0&&(nd[s]=-1),++nd[s]}const Pm=new Set,Pe="8.0.0",KS="8.3.4",ta={quiet:!1,noColor:!1},jt=(s,t,e=3)=>{if(ta.quiet||Pm.has(t))return;let n=new Error().stack;const i=`${t}
Deprecated since v${s}`,r=typeof console.groupCollapsed=="function"&&!ta.noColor;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",i):(n=n.split(`
`).splice(e).join(`
`),r?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",i),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",i),console.warn(n))),Pm.add(t)};Object.defineProperties(jt,{quiet:{get:()=>ta.quiet,set:s=>{ta.quiet=s},enumerable:!0,configurable:!1},noColor:{get:()=>ta.noColor,set:s=>{ta.noColor=s},enumerable:!0,configurable:!1}});const j_=()=>{};function sa(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Im(s){return!(s&s-1)&&!!s}function q_(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const km=Object.create(null);function ZS(s){const t=km[s];return t===void 0&&(km[s]=vn("resource")),t}const K_=class Z_ extends Sr{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Z_.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){jt(Pe,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=ZS(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};K_.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ra=K_;const Q_=class J_ extends Sr{constructor(t={}){super(),this.options=t,this.uid=vn("textureSource"),this._resourceType="textureSource",this._resourceId=vn("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...J_.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new ra(q_(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,n;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(n=this._style)==null||n.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=vn("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,n){n||(n=this._resolution),t||(t=this.width),e||(e=this.height);const i=Math.round(t*n),r=Math.round(e*n);return this.width=i/n,this.height=r/n,this._resolution=n,this.pixelWidth===i&&this.pixelHeight===r?!1:(this._refreshPOT(),this.pixelWidth=i,this.pixelHeight=r,this.emit("resize",this),this._resourceId=vn("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Im(this.pixelWidth)&&Im(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Q_.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Mr=Q_;class tf extends Mr{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let n=t.format;n||(e instanceof Float32Array?n="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?n="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?n="rgba16uint":(e instanceof Int8Array,n="bgra8unorm")),super({...t,resource:e,format:n}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}tf.extension=kt.TextureSource;const Lm=new fe;class QS{constructor(t,e){this.mapCoord=new fe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const n=this.mapCoord;for(let i=0;i<t.length;i+=2){const r=t[i],o=t[i+1];e[i]=r*n.a+o*n.c+n.tx,e[i+1]=r*n.b+o*n.d+n.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const n=t.orig,i=t.trim;i&&(Lm.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Lm));const r=t.source,o=this.uClampFrame,h=this.clampMargin/r._resolution,d=this.clampOffset/r._resolution;return o[0]=(t.frame.x+h+d)/r.width,o[1]=(t.frame.y+h+d)/r.height,o[2]=(t.frame.x+t.frame.width-h+d)/r.width,o[3]=(t.frame.y+t.frame.height-h+d)/r.height,this.uClampOffset[0]=this.clampOffset/r.pixelWidth,this.uClampOffset[1]=this.clampOffset/r.pixelHeight,this.isSimple=t.frame.width===r.width&&t.frame.height===r.height&&t.rotate===0,!0}}class Xt extends Sr{constructor({source:t,label:e,frame:n,orig:i,trim:r,defaultAnchor:o,defaultBorders:h,rotate:d,dynamic:_}={}){if(super(),this.uid=vn("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new $t,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(t==null?void 0:t.source)??new Mr,this.noFrame=!n,n)this.frame.copyFrom(n);else{const{width:g,height:l}=this._source;this.frame.width=g,this.frame.height=l}this.orig=i||this.frame,this.trim=r,this.rotate=d??0,this.defaultAnchor=o,this.defaultBorders=h,this.destroyed=!1,this.dynamic=_||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new QS(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:n,height:i}=this._source,r=e.x/n,o=e.y/i,h=e.width/n,d=e.height/i;let _=this.rotate;if(_){const g=h/2,l=d/2,m=r+g,y=o+l;_=He.add(_,He.NW),t.x0=m+g*He.uX(_),t.y0=y+l*He.uY(_),_=He.add(_,2),t.x1=m+g*He.uX(_),t.y1=y+l*He.uY(_),_=He.add(_,2),t.x2=m+g*He.uX(_),t.y2=y+l*He.uY(_),_=He.add(_,2),t.x3=m+g*He.uX(_),t.y3=y+l*He.uY(_)}else t.x0=r,t.y0=o,t.x1=r+h,t.y1=o,t.x2=r+h,t.y2=o+d,t.x3=r,t.y3=o+d}destroy(t=!1){this._source&&(this._source.off("resize",this.update,this),t&&(this._source.destroy(),this._source=null)),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return jt(Pe,"Texture.baseTexture is now Texture.source"),this._source}}Xt.EMPTY=new Xt({label:"EMPTY",source:new Mr({label:"EMPTY"})});Xt.EMPTY.destroy=j_;Xt.WHITE=new Xt({source:new tf({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});Xt.WHITE.destroy=j_;function JS(s,t,e){const{width:n,height:i}=e.orig,r=e.trim;if(r){const o=r.width,h=r.height;s.minX=r.x-t._x*n,s.maxX=s.minX+o,s.minY=r.y-t._y*i,s.maxY=s.minY+h}else s.minX=-t._x*n,s.maxX=s.minX+n,s.minY=-t._y*i,s.maxY=s.minY+i}const Fm=new fe;class wr{constructor(t=1/0,e=1/0,n=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Fm,this.minX=t,this.minY=e,this.maxX=n,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new $t);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Fm,this}set(t,e,n,i){this.minX=t,this.minY=e,this.maxX=n,this.maxY=i}addFrame(t,e,n,i,r){r||(r=this.matrix);const o=r.a,h=r.b,d=r.c,_=r.d,g=r.tx,l=r.ty;let m=this.minX,y=this.minY,w=this.maxX,M=this.maxY,S=o*t+d*e+g,A=h*t+_*e+l;S<m&&(m=S),A<y&&(y=A),S>w&&(w=S),A>M&&(M=A),S=o*n+d*e+g,A=h*n+_*e+l,S<m&&(m=S),A<y&&(y=A),S>w&&(w=S),A>M&&(M=A),S=o*t+d*i+g,A=h*t+_*i+l,S<m&&(m=S),A<y&&(y=A),S>w&&(w=S),A>M&&(M=A),S=o*n+d*i+g,A=h*n+_*i+l,S<m&&(m=S),A<y&&(y=A),S>w&&(w=S),A>M&&(M=A),this.minX=m,this.minY=y,this.maxX=w,this.maxY=M}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,n=this.minY,i=this.maxX,r=this.maxY,{a:o,b:h,c:d,d:_,tx:g,ty:l}=t;let m=o*e+d*n+g,y=h*e+_*n+l;this.minX=m,this.minY=y,this.maxX=m,this.maxY=y,m=o*i+d*n+g,y=h*i+_*n+l,this.minX=m<this.minX?m:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=m>this.maxX?m:this.maxX,this.maxY=y>this.maxY?y:this.maxY,m=o*e+d*r+g,y=h*e+_*r+l,this.minX=m<this.minX?m:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=m>this.maxX?m:this.maxX,this.maxY=y>this.maxY?y:this.maxY,m=o*i+d*r+g,y=h*i+_*r+l,this.minX=m<this.minX?m:this.minX,this.minY=y<this.minY?y:this.minY,this.maxX=m>this.maxX?m:this.maxX,this.maxY=y>this.maxY?y:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,n,i){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<n&&(this.minY=n),this.maxY>i&&(this.maxY=i),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new wr(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,n,i){let r=this.minX,o=this.minY,h=this.maxX,d=this.maxY;i||(i=this.matrix);const _=i.a,g=i.b,l=i.c,m=i.d,y=i.tx,w=i.ty;for(let M=e;M<n;M+=2){const S=t[M],A=t[M+1],C=_*S+l*A+y,I=g*S+m*A+w;r=C<r?C:r,o=I<o?I:o,h=C>h?C:h,d=I>d?I:d}this.minX=r,this.minY=o,this.maxX=h,this.maxY=d}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var tM={grad:.9,turn:360,rad:360/(2*Math.PI)},ui=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},ss=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*s)/e+0},cr=function(s,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),s>e?e:s>t?s:t},tg=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},Om=function(s){return{r:cr(s.r,0,255),g:cr(s.g,0,255),b:cr(s.b,0,255),a:cr(s.a)}},sd=function(s){return{r:ss(s.r),g:ss(s.g),b:ss(s.b),a:ss(s.a,3)}},eM=/^#([0-9a-f]{3,8})$/i,Jc=function(s){var t=s.toString(16);return t.length<2?"0"+t:t},eg=function(s){var t=s.r,e=s.g,n=s.b,i=s.a,r=Math.max(t,e,n),o=r-Math.min(t,e,n),h=o?r===t?(e-n)/o:r===e?2+(n-t)/o:4+(t-e)/o:0;return{h:60*(h<0?h+6:h),s:r?o/r*100:0,v:r/255*100,a:i}},ng=function(s){var t=s.h,e=s.s,n=s.v,i=s.a;t=t/360*6,e/=100,n/=100;var r=Math.floor(t),o=n*(1-e),h=n*(1-(t-r)*e),d=n*(1-(1-t+r)*e),_=r%6;return{r:255*[n,h,o,o,d,n][_],g:255*[d,n,n,h,o,o][_],b:255*[o,o,d,n,n,h][_],a:i}},Rm=function(s){return{h:tg(s.h),s:cr(s.s,0,100),l:cr(s.l,0,100),a:cr(s.a)}},Bm=function(s){return{h:ss(s.h),s:ss(s.s),l:ss(s.l),a:ss(s.a,3)}},Nm=function(s){return ng((e=(t=s).s,{h:t.h,s:(e*=((n=t.l)<50?n:100-n)/100)>0?2*e/(n+e)*100:0,v:n+e,a:t.a}));var t,e,n},dl=function(s){return{h:(t=eg(s)).h,s:(i=(200-(e=t.s))*(n=t.v)/100)>0&&i<200?e*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:t.a};var t,e,n,i},nM=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sM=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,rM=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,iM=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Bd={string:[[function(s){var t=eM.exec(s);return t?(s=t[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?ss(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?ss(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var t=rM.exec(s)||iM.exec(s);return t?t[2]!==t[4]||t[4]!==t[6]?null:Om({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(s){var t=nM.exec(s)||sM.exec(s);if(!t)return null;var e,n,i=Rm({h:(e=t[1],n=t[2],n===void 0&&(n="deg"),Number(e)*(tM[n]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Nm(i)},"hsl"]],object:[[function(s){var t=s.r,e=s.g,n=s.b,i=s.a,r=i===void 0?1:i;return ui(t)&&ui(e)&&ui(n)?Om({r:Number(t),g:Number(e),b:Number(n),a:Number(r)}):null},"rgb"],[function(s){var t=s.h,e=s.s,n=s.l,i=s.a,r=i===void 0?1:i;if(!ui(t)||!ui(e)||!ui(n))return null;var o=Rm({h:Number(t),s:Number(e),l:Number(n),a:Number(r)});return Nm(o)},"hsl"],[function(s){var t=s.h,e=s.s,n=s.v,i=s.a,r=i===void 0?1:i;if(!ui(t)||!ui(e)||!ui(n))return null;var o=function(h){return{h:tg(h.h),s:cr(h.s,0,100),v:cr(h.v,0,100),a:cr(h.a)}}({h:Number(t),s:Number(e),v:Number(n),a:Number(r)});return ng(o)},"hsv"]]},Wm=function(s,t){for(var e=0;e<t.length;e++){var n=t[e][0](s);if(n)return[n,t[e][1]]}return[null,void 0]},oM=function(s){return typeof s=="string"?Wm(s.trim(),Bd.string):typeof s=="object"&&s!==null?Wm(s,Bd.object):[null,void 0]},rd=function(s,t){var e=dl(s);return{h:e.h,s:cr(e.s+100*t,0,100),l:e.l,a:e.a}},id=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Dm=function(s,t){var e=dl(s);return{h:e.h,s:e.s,l:cr(e.l+100*t,0,100),a:e.a}},Nd=function(){function s(t){this.parsed=oM(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return ss(id(this.rgba),2)},s.prototype.isDark=function(){return id(this.rgba)<.5},s.prototype.isLight=function(){return id(this.rgba)>=.5},s.prototype.toHex=function(){return t=sd(this.rgba),e=t.r,n=t.g,i=t.b,o=(r=t.a)<1?Jc(ss(255*r)):"","#"+Jc(e)+Jc(n)+Jc(i)+o;var t,e,n,i,r,o},s.prototype.toRgb=function(){return sd(this.rgba)},s.prototype.toRgbString=function(){return t=sd(this.rgba),e=t.r,n=t.g,i=t.b,(r=t.a)<1?"rgba("+e+", "+n+", "+i+", "+r+")":"rgb("+e+", "+n+", "+i+")";var t,e,n,i,r},s.prototype.toHsl=function(){return Bm(dl(this.rgba))},s.prototype.toHslString=function(){return t=Bm(dl(this.rgba)),e=t.h,n=t.s,i=t.l,(r=t.a)<1?"hsla("+e+", "+n+"%, "+i+"%, "+r+")":"hsl("+e+", "+n+"%, "+i+"%)";var t,e,n,i,r},s.prototype.toHsv=function(){return t=eg(this.rgba),{h:ss(t.h),s:ss(t.s),v:ss(t.v),a:ss(t.a,3)};var t},s.prototype.invert=function(){return Wr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},s.prototype.saturate=function(t){return t===void 0&&(t=.1),Wr(rd(this.rgba,t))},s.prototype.desaturate=function(t){return t===void 0&&(t=.1),Wr(rd(this.rgba,-t))},s.prototype.grayscale=function(){return Wr(rd(this.rgba,-1))},s.prototype.lighten=function(t){return t===void 0&&(t=.1),Wr(Dm(this.rgba,t))},s.prototype.darken=function(t){return t===void 0&&(t=.1),Wr(Dm(this.rgba,-t))},s.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},s.prototype.alpha=function(t){return typeof t=="number"?Wr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ss(this.rgba.a,3);var e},s.prototype.hue=function(t){var e=dl(this.rgba);return typeof t=="number"?Wr({h:t,s:e.s,l:e.l,a:e.a}):ss(e.h)},s.prototype.isEqual=function(t){return this.toHex()===Wr(t).toHex()},s}(),Wr=function(s){return s instanceof Nd?s:new Nd(s)},Gm=[],aM=function(s){s.forEach(function(t){Gm.indexOf(t)<0&&(t(Nd,Bd),Gm.push(t))})};function lM(s,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in e)n[e[i]]=i;var r={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var h,d,_=n[this.toHex()];if(_)return _;if(o!=null&&o.closest){var g=this.toRgb(),l=1/0,m="black";if(!r.length)for(var y in e)r[y]=new s(e[y]).toRgb();for(var w in e){var M=(h=g,d=r[w],Math.pow(h.r-d.r,2)+Math.pow(h.g-d.g,2)+Math.pow(h.b-d.b,2));M<l&&(l=M,m=w)}return m}},t.string.push([function(o){var h=o.toLowerCase(),d=h==="transparent"?"#0000":e[h];return d?new s(d).toRgb():null},"name"])}aM([lM]);const ia=class ll{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof ll)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const n=typeof t;if(n!==typeof e)return!1;if(n==="number"||n==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((r,o)=>r===e[o]);if(t!==null&&e!==null){const r=Object.keys(t),o=Object.keys(e);return r.length!==o.length?!1:r.every(h=>t[h]===e[h])}return t===e}toRgba(){const[t,e,n,i]=this._components;return{r:t,g:e,b:n,a:i}}toRgb(){const[t,e,n]=this._components;return{r:t,g:e,b:n}}toRgbaString(){const[t,e,n]=this.toUint8RgbArray();return`rgba(${t},${e},${n},${this.alpha})`}toUint8RgbArray(t){const[e,n,i]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(n*255),t[2]=Math.round(i*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,n,i,r]=this._components;return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,n,i]=this._components;return t[0]=e,t[1]=n,t[2]=i,t}toNumber(){return this._int}toBgrNumber(){const[t,e,n]=this.toUint8RgbArray();return(n<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,n,i,r]=ll._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=n,this._components[2]*=i,this._components[3]*=r,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let n=this._int>>16&255,i=this._int>>8&255,r=this._int&255;return e&&(n=n*t+.5|0,i=i*t+.5|0,r=r*t+.5|0),(t*255<<24)+(n<<16)+(i<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,n,i,r;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,n=(o>>8&255)/255,i=(o&255)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,n,i,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,n,i,r=255]=t,e/=255,n/=255,i/=255,r/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const h=ll.HEX_PATTERN.exec(t);h&&(t=`#${h[2]}`)}const o=Wr(t);o.isValid()&&({r:e,g:n,b:i,a:r}=o.rgba,e/=255,n/=255,i/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=n,this._components[2]=i,this._components[3]=r,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,n]=this._components;this._int=(t*255<<16)+(e*255<<8)+(n*255|0)}_clamp(t,e=0,n=1){return typeof t=="number"?Math.min(Math.max(t,e),n):(t.forEach((i,r)=>{t[r]=Math.min(Math.max(i,e),n)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof ll||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};ia.shared=new ia;ia._temp=new ia;ia.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Dn=ia;const cM={cullArea:null,cullable:!1,cullableChildren:!0};let od=0;const Hm=500;function an(...s){od!==Hm&&(od++,od===Hm?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...s))}const vl={_registeredResources:new Set,register(s){this._registeredResources.add(s)},unregister(s){this._registeredResources.delete(s)},release(){this._registeredResources.forEach(s=>s.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(s){return this._registeredResources.has(s)},reset(){this._registeredResources.clear()}};class hM{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var n;let e;return this._index>0?e=this._pool[--this._index]:(e=new this._classType,this._count++),(n=e.init)==null||n.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class uM{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new hM(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const n=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[n]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const hr=new uM;vl.register(hr);const dM={get isCachedAsTexture(){var s;return!!((s=this.renderGroup)!=null&&s.isCachedAsTexture)},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){var s;(s=this.renderGroup)==null||s.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){jt("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}};function fM(s,t,e){const n=s.length;let i;if(t>=n||e===0)return;e=t+e>n?n-t:e;const r=n-e;for(i=t;i<r;++i)s[i]=s[i+e];s.length=r}const pM={allowChildren:!0,removeChildren(s=0,t){var r;const e=t??this.children.length,n=e-s,i=[];if(n>0&&n<=e){for(let h=e-1;h>=s;h--){const d=this.children[h];d&&(i.push(d),d.parent=null)}fM(this.children,s,e);const o=this.renderGroup||this.parentRenderGroup;o&&o.removeChildren(i);for(let h=0;h<i.length;++h){const d=i[h];(r=d.parentRenderLayer)==null||r.detach(d),this.emit("childRemoved",d,this,h),i[h].emit("removed",this)}return i.length>0&&this._didViewChangeTick++,i}else if(n===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||jt(Pe,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const i=s.parent.children.indexOf(s);if(s.parent===this&&i===t)return s;i!==-1&&s.parent.children.splice(i,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const n=this.renderGroup||this.parentRenderGroup;return n&&n.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),n=this.getChildIndex(t);this.children[e]=t,this.children[n]=s;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var s;(s=this.parent)==null||s.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const n=this.worldTransform.clone();return n.invert(),e.prepend(n),s.setFromMatrix(e),s},replaceChild(s,t){s.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(s)),t.setFromMatrix(s.localTransform),t.updateLocalTransform(),this.removeChild(s)}},mM={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const n=this.children,i=n.length;for(let r=0;r<i;r++)n[r].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:n}=t;for(let i=0;i<this.effects.length;i++){const r=this.effects[i];n[r.pipe].push(r,this,s)}this.collectRenderablesSimple(s,t,e);for(let i=this.effects.length-1;i>=0;i--){const r=this.effects[i];n[r.pipe].pop(r,this,s)}}};class Um{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class _M{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const n=this._tests[e];if(n.test(t))return hr.get(n.maskClass,t)}return t}returnMaskEffect(t){hr.return(t)}}const Wd=new _M;us.handleByList(kt.MaskEffect,Wd._effectClasses);const gM={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,n)=>e.priority-n.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;(t==null?void 0:t.mask)!==s&&(t&&(this.removeEffect(t),Wd.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=Wd.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){var s;return(s=this._maskEffect)==null?void 0:s.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){var r;!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Um);s=s;const e=(s==null?void 0:s.length)>0,n=((r=t.filters)==null?void 0:r.length)>0,i=e!==n;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),i&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){var s;return(s=this._filterEffect)==null?void 0:s.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Um),this._filterEffect.filterArea=s},get filterArea(){var s;return(s=this._filterEffect)==null?void 0:s.filterArea}},yM={label:null,get name(){return jt(Pe,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){jt(Pe,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let n=0;n<e.length;n++){const i=e[n];if(i.label===s||s instanceof RegExp&&s.test(i.label))return i}if(t)for(let n=0;n<e.length;n++){const r=e[n].getChildByLabel(s,!0);if(r)return r}return null},getChildrenByLabel(s,t=!1,e=[]){const n=this.children;for(let i=0;i<n.length;i++){const r=n[i];(r.label===s||s instanceof RegExp&&s.test(r.label))&&e.push(r)}if(t)for(let i=0;i<n.length;i++)n[i].getChildrenByLabel(s,!0,e);return e}},vs=hr.getPool(fe),fi=hr.getPool(wr),xM=new fe,bM={getFastGlobalBounds(s,t){t||(t=new wr),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let n=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const i=!!this.effects.length;if((this.renderGroup||i)&&(n=fi.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;n.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const r=this.children;for(let o=0;o<r.length;o++)r[o]._getGlobalBoundsRecursive(s,n,e)}if(i){let r=!1;const o=this.renderGroup||this.parentRenderGroup;for(let h=0;h<this.effects.length;h++)this.effects[h].addBounds&&(r||(r=!0,n.applyMatrix(o.worldTransform)),this.effects[h].addBounds(n,!0));r&&n.applyMatrix(o.worldTransform.copyTo(xM).invert()),t.addBounds(n),fi.return(n)}else this.renderGroup&&(t.addBounds(n,this.relativeGroupTransform),fi.return(n))}};function sg(s,t,e){e.clear();let n,i;return s.parent?t?n=s.parent.worldTransform:(i=vs.get().identity(),n=ef(s,i)):n=fe.IDENTITY,rg(s,e,n,t),i&&vs.return(i),e.isValid||e.set(0,0,0,0),e}function rg(s,t,e,n){var h,d;if(!s.visible||!s.measurable)return;let i;n?i=s.worldTransform:(s.updateLocalTransform(),i=vs.get(),i.appendFrom(s.localTransform,e));const r=t,o=!!s.effects.length;if(o&&(t=fi.get().clear()),s.boundsArea)t.addRect(s.boundsArea,i);else{const _=s.bounds;_&&!_.isEmpty()&&(t.matrix=i,t.addBounds(_));for(let g=0;g<s.children.length;g++)rg(s.children[g],t,i,n)}if(o){for(let _=0;_<s.effects.length;_++)(d=(h=s.effects[_]).addBounds)==null||d.call(h,t);r.addBounds(t,fe.IDENTITY),fi.return(t)}n||vs.return(i)}function ef(s,t){const e=s.parent;return e&&(ef(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function ig(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,n=s>>8&255,i=s&255,r=t>>16&255,o=t>>8&255,h=t&255,d=e*r/255|0,_=n*o/255|0,g=i*h/255|0;return(d<<16)+(_<<8)+g}const Ym=16777215;function Xm(s,t){return s===Ym?t:t===Ym?s:ig(s,t)}function uh(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const wM={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s=new fe,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=ef(this,vs.get().identity());return s.appendFrom(this.localTransform,e),vs.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?uh(this.renderGroup.worldColor):this.parentRenderGroup?uh(Xm(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Xm(t,e.localColor),e=e.parent;return uh(t)}};function og(s,t,e){return t.clear(),e||(e=fe.IDENTITY),ag(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function ag(s,t,e,n,i){var d,_;let r;if(i)r=vs.get(),r=e.copyTo(r);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const g=s.localTransform;r=vs.get(),r.appendFrom(g,e)}const o=t,h=!!s.effects.length;if(h&&(t=fi.get().clear()),s.boundsArea)t.addRect(s.boundsArea,r);else{s.renderPipeId&&(t.matrix=r,t.addBounds(s.bounds));const g=s.children;for(let l=0;l<g.length;l++)ag(g[l],t,r,n,!1)}if(h){for(let g=0;g<s.effects.length;g++)(_=(d=s.effects[g]).addLocalBounds)==null||_.call(d,t,n);o.addBounds(t,fe.IDENTITY),fi.return(t)}vs.return(r)}function lg(s,t){const e=s.children;for(let n=0;n<e.length;n++){const i=e[n],r=i.uid,o=(i._didViewChangeTick&65535)<<16|i._didContainerChangeTick&65535,h=t.index;(t.data[h]!==r||t.data[h+1]!==o)&&(t.data[t.index]=r,t.data[t.index+1]=o,t.didChange=!0),t.index=h+2,i.children.length&&lg(i,t)}return t.didChange}const SM=new fe,MM={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new wr});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),lg(this,s),s.didChange&&og(this,s.localBounds,SM),s.localBounds},getBounds(s,t){return sg(this,s,t||new wr)}},AM={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},vM={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(TM))}};function TM(s,t){return s._zIndex-t._zIndex}const CM={getGlobalPosition(s=new ms,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const n=this.getGlobalTransform(vs.get(),e);return t=n.apply(s,t),vs.return(n),t},toLocal(s,t,e,n){t&&(s=t.toGlobal(s,e,n));const i=this.getGlobalTransform(vs.get(),n);return e=i.applyInverse(s,e),vs.return(i),e}};class cg{constructor(){this.uid=vn("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let EM=0;class PM{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new ra(this.textureOptions)}createTexture(t,e,n){const i=new Mr({...this.textureOptions,width:t,height:e,resolution:1,antialias:n,autoGarbageCollect:!1});return new Xt({source:i,label:`texturePool_${EM++}`})}getOptimalTexture(t,e,n=1,i){let r=Math.ceil(t*n-1e-6),o=Math.ceil(e*n-1e-6);r=sa(r),o=sa(o);const h=(r<<17)+(o<<1)+(i?1:0);this._texturePool[h]||(this._texturePool[h]=[]);let d=this._texturePool[h].pop();return d||(d=this.createTexture(r,o,i)),d.source._resolution=n,d.source.width=r/n,d.source.height=o/n,d.source.pixelWidth=r,d.source.pixelHeight=o,d.frame.x=0,d.frame.y=0,d.frame.width=t,d.frame.height=e,d.updateUvs(),this._poolKeyHash[d.uid]=h,d}getSameSizeTexture(t,e=!1){const n=t.source;return this.getOptimalTexture(t.width,t.height,n._resolution,e)}returnTexture(t,e=!1){const n=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[n].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const n=this._texturePool[e];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0)}this._texturePool={}}}const oa=new PM;vl.register(oa);class IM{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new fe,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new cg,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let n=0;n<e.length;n++){const i=e[n];i._updateFlags=15,this.addChild(i)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(oa.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let n=0;n<e.length;n++)this.addChild(e[n])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let n=0;n<e.length;n++)this.removeChild(e[n])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let n=0;n<e.length;n++)this._getChildren(e[n],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const n=t.children;for(let i=0;i<n.length;i++)this._getChildren(n[i],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new fe),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new fe),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new fe),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function kM(s,t,e={}){for(const n in t)!e[n]&&t[n]!==void 0&&(s[n]=t[n])}const ad=new hs(null),th=new hs(null),ld=new hs(null,1,1),eh=new hs(null),zm=1,LM=2,cd=4;class et extends Sr{constructor(t={}){var e,n;super(),this.uid=vn("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new fe,this.relativeGroupTransform=new fe,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new hs(this,0,0),this._scale=ld,this._pivot=th,this._origin=eh,this._skew=ad,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],kM(this,t,{children:!0,parent:!0,effects:!0}),(e=t.children)==null||e.forEach(i=>this.addChild(i)),(n=t.parent)==null||n.addChild(this)}static mixin(t){jt("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),us.mixin(et,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||jt(Pe,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let i=0;i<t.length;i++)this.addChild(t[i]);return t[0]}const e=t[0],n=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),n&&(n.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,n&&n.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let i=0;i<t.length;i++)this.removeChild(t[i]);return t[0]}const e=t[0],n=this.children.indexOf(e);return n>-1&&(this._didViewChangeTick++,this.children.splice(n,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,n),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=hr.get(IM,this),this.groupTransform=fe.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),hr.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new fe),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*zS}set angle(t){this.rotation=t*VS}get pivot(){return this._pivot===th&&(this._pivot=new hs(this,0,0)),this._pivot}set pivot(t){this._pivot===th&&(this._pivot=new hs(this,0,0),this._origin!==eh&&an("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===ad&&(this._skew=new hs(this,0,0)),this._skew}set skew(t){this._skew===ad&&(this._skew=new hs(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===ld&&(this._scale=new hs(this,1,1)),this._scale}set scale(t){this._scale===ld&&(this._scale=new hs(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===eh&&(this._origin=new hs(this,0,0)),this._origin}set origin(t){this._origin===eh&&(this._origin=new hs(this,0,0),this._pivot!==th&&an("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const n=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,n.width),e!==void 0&&this._setHeight(e,n.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,n=this._scale,i=this._pivot,r=this._origin,o=this._position,h=n._x,d=n._y,_=i._x,g=i._y,l=-r._x,m=-r._y;e.a=this._cx*h,e.b=this._sx*h,e.c=this._cy*d,e.d=this._sy*d,e.tx=o._x-(_*e.a+g*e.c)+(l*e.a+m*e.c)-l,e.ty=o._y-(_*e.b+g*e.d)+(l*e.b+m*e.d)-m}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=zm,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const n=Dn.shared.setValue(t??16777215).toBgrNumber();n!==this.localColor&&(this.localColor=n,this._updateFlags|=zm,this._onUpdate())}get tint(){return uh(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=LM,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=cd,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=cd,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=cd,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var i;if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);(i=this.renderGroup)==null||i.destroy(),this.renderGroup=null}}us.mixin(et,pM,bM,CM,AM,MM,gM,yM,vM,cM,dM,wM,mM);class nf extends et{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new wr(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:n,y:i}=t;return n>=e.minX&&n<=e.maxX&&i>=e.minY&&i<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,n;super.destroy(t),this._bounds=null;for(const i in this._gpuData)(n=(e=this._gpuData[i]).destroy)==null||n.call(e);this._gpuData=null}collectRenderablesSimple(t,e,n){const{renderPipes:i}=e;i.blendMode.pushBlendMode(this,this.groupBlendMode,t),i[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,h=o.length;for(let d=0;d<h;d++)o[d].collectRenderables(t,e,n);i.blendMode.popBlendMode(t)}}class ce extends nf{constructor(t=Xt.EMPTY){t instanceof Xt&&(t={texture:t});const{texture:e=Xt.EMPTY,anchor:n,roundPixels:i,width:r,height:o,...h}=t;super({label:"Sprite",...h}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new hs({_onUpdate:()=>{this.onViewUpdate()}}),n?this.anchor=n:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=i??!1,r!==void 0&&(this.width=r),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof Xt?new ce(t):new ce(Xt.from(t,e))}set texture(t){t||(t=Xt.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return JS(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return jt("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,n=this._bounds,{width:i,height:r}=e.orig;n.minX=-t._x*i,n.maxX=n.minX+i,n.minY=-t._y*r,n.maxY=n.minY+r}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(n)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const FM=new wr;function hg(s,t,e){const n=FM;s.measurable=!0,sg(s,e,n),t.addBoundsMask(n),s.measurable=!1}function ug(s,t,e){const n=fi.get();s.measurable=!0;const i=vs.get().identity(),r=dg(s,e,i);og(s,n,r),s.measurable=!1,t.addBoundsMask(n),vs.return(i),fi.return(n)}function dg(s,t,e){return s?(s!==t&&(dg(s.parent,t,e),s.updateLocalTransform(),e.append(s.localTransform)),e):(an("Mask bounds, renderable is not inside the root container"),e)}class fg{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof ce),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||hg(this.mask,t,e)}addLocalBounds(t,e){ug(this.mask,t,e)}containsPoint(t,e){const n=this.mask;return e(n,t)}destroy(){this.reset()}static test(t){return t instanceof ce}}fg.extension=kt.MaskEffect;class pg{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}pg.extension=kt.MaskEffect;class mg{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){hg(this.mask,t,e)}addLocalBounds(t,e){ug(this.mask,t,e)}containsPoint(t,e){const n=this.mask;return e(n,t)}destroy(){this.reset()}static test(t){return t instanceof et}}mg.extension=kt.MaskEffect;const OM={createCanvas:(s,t)=>{const e=document.createElement("canvas");return e.width=s,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,t)=>fetch(s,t),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")};let Vm=OM;const en={get(){return Vm},set(s){Vm=s}};class _g extends Mr{constructor(t){t.resource||(t.resource=en.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,n=this._resolution){const i=super.resize(t,e,n);return i&&this.resizeCanvas(),i}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}_g.extension=kt.TextureSource;class yo extends Mr{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}yo.extension=kt.TextureSource;var _h=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(_h||{});class hd{constructor(t,e=null,n=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=n,this._once=i}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const gg=class Vs{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new hd(null,null,1/0),this.deltaMS=1/Vs.targetFPMS,this.elapsedMS=1/Vs.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=_h.NORMAL){return this._addListener(new hd(t,e,n))}addOnce(t,e,n=_h.NORMAL){return this._addListener(new hd(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(!e)t.connect(n);else{for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n.match(t,e)?n=n.destroy():n=n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Vs.targetFPMS;const n=this._head;let i=n.next;for(;i;)i=i.emit(this);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,Vs.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Vs._shared){const t=Vs._shared=new Vs;t.autoStart=!0,t._protected=!0}return Vs._shared}static get system(){if(!Vs._system){const t=Vs._system=new Vs;t.autoStart=!0,t._protected=!0}return Vs._system}};gg.targetFPMS=.06;let Gi=gg,ud;async function yg(){return ud??(ud=(async()=>{var o;const t=en.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(h=>{const d=document.createElement("video");d.onloadeddata=()=>h(d),d.onerror=()=>h(null),d.autoplay=!1,d.crossOrigin="anonymous",d.preload="auto",d.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",d.load()});if(!e)return"premultiply-alpha-on-upload";const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const r=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,r),t.deleteFramebuffer(i),t.deleteTexture(n),(o=t.getExtension("WEBGL_lose_context"))==null||o.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),ud}const Mh=class xg extends Mr{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...xg.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Gi.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await yg(),this._load=new Promise((n,i)=>{this.isValid?n(this):(this._resolve=n,this._reject=i,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Gi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Gi.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Gi.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Mh.extension=kt.TextureSource;Mh.defaultOptions={...Mr.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Mh.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let fl=Mh;const br=(s,t,e=!1)=>(Array.isArray(s)||(s=[s]),t?s.map(n=>typeof n=="string"||e?t(n):n):s);class RM{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||an(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const n=br(t);let i;for(let d=0;d<this.parsers.length;d++){const _=this.parsers[d];if(_.test(e)){i=_.getCacheableAssets(n,e);break}}const r=new Map(Object.entries(i||{}));i||n.forEach(d=>{r.set(d,e)});const o=[...r.keys()],h={cacheKeys:o,keys:n};n.forEach(d=>{this._cacheMap.set(d,h)}),o.forEach(d=>{const _=i?i[d]:e;this._cache.has(d)&&this._cache.get(d)!==_&&an("[Cache] already has key:",d),this._cache.set(d,r.get(d))})}remove(t){if(!this._cacheMap.has(t)){an(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(i=>{this._cache.delete(i)}),e.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const on=new RM,Dd=[];us.handleByList(kt.TextureSource,Dd);function bg(s={}){const t=s&&s.resource,e=t?s.resource:s,n=t?s:{resource:s};for(let i=0;i<Dd.length;i++){const r=Dd[i];if(r.test(e))return new r(n)}throw new Error(`Could not find a source type for resource: ${n.resource}`)}function BM(s={},t=!1){const e=s&&s.resource,n=e?s.resource:s,i=e?s:{resource:s};if(!t&&on.has(n))return on.get(n);const r=new Xt({source:bg(i)});return r.on("destroy",()=>{on.has(n)&&on.remove(n)}),t||on.set(n,r),r}function NM(s,t=!1){return typeof s=="string"?on.get(s):s instanceof Mr?new Xt({source:s}):BM(s,t)}Xt.from=NM;Mr.from=bg;us.add(fg,pg,mg,fl,yo,_g,tf);var Ui=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(Ui||{});function yr(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function tl(s){return s.split("?")[0].split("#")[0]}function WM(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function DM(s,t,e){return s.replace(new RegExp(WM(t),"g"),e)}function GM(s,t){let e="",n=0,i=-1,r=0,o=-1;for(let h=0;h<=s.length;++h){if(h<s.length)o=s.charCodeAt(h);else{if(o===47)break;o=47}if(o===47){if(!(i===h-1||r===1))if(i!==h-1&&r===2){if(e.length<2||n!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const d=e.lastIndexOf("/");if(d!==e.length-1){d===-1?(e="",n=0):(e=e.slice(0,d),n=e.length-1-e.lastIndexOf("/")),i=h,r=0;continue}}else if(e.length===2||e.length===1){e="",n=0,i=h,r=0;continue}}}else e.length>0?e+=`/${s.slice(i+1,h)}`:e=s.slice(i+1,h),n=h-i-1;i=h,r=0}else o===46&&r!==-1?++r:r=-1}return e}const $s={toPosix(s){return DM(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){yr(s),s=this.toPosix(s);const t=/^file:\/\/\//.exec(s);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(s);return e?e[0]:""},toAbsolute(s,t,e){if(yr(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const n=tl(this.toPosix(t??en.get().getBaseUrl())),i=tl(this.toPosix(e??this.rootname(n)));return s=this.toPosix(s),s.startsWith("/")?$s.join(i,s.slice(1)):this.isAbsolute(s)?s:this.join(n,s)},normalize(s){if(yr(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let t="";const e=s.startsWith("/");this.hasProtocol(s)&&(t=this.rootname(s),s=s.slice(t.length));const n=s.endsWith("/");return s=GM(s),s.length>0&&n&&(s+="/"),e?`/${s}`:t+s},isAbsolute(s){return yr(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let t;for(let e=0;e<s.length;++e){const n=s[e];if(yr(n),n.length>0)if(t===void 0)t=n;else{const i=s[e-1]??"";this.joinExtensions.includes(this.extname(i).toLowerCase())?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(s){if(yr(s),s.length===0)return".";s=this.toPosix(s);let t=s.charCodeAt(0);const e=t===47;let n=-1,i=!0;const r=this.getProtocol(s),o=s;s=s.slice(r.length);for(let h=s.length-1;h>=1;--h)if(t=s.charCodeAt(h),t===47){if(!i){n=h;break}}else i=!1;return n===-1?e?"/":this.isUrl(o)?r+s:r:e&&n===1?"//":r+s.slice(0,n)},rootname(s){yr(s),s=this.toPosix(s);let t="";if(s.startsWith("/")?t="/":t=this.getProtocol(s),this.isUrl(s)){const e=s.indexOf("/",t.length);e!==-1?t=s.slice(0,e):t=s,t.endsWith("/")||(t+="/")}return t},basename(s,t){yr(s),t&&yr(t),s=tl(this.toPosix(s));let e=0,n=-1,i=!0,r;if(t!==void 0&&t.length>0&&t.length<=s.length){if(t.length===s.length&&t===s)return"";let o=t.length-1,h=-1;for(r=s.length-1;r>=0;--r){const d=s.charCodeAt(r);if(d===47){if(!i){e=r+1;break}}else h===-1&&(i=!1,h=r+1),o>=0&&(d===t.charCodeAt(o)?--o===-1&&(n=r):(o=-1,n=h))}return e===n?n=h:n===-1&&(n=s.length),s.slice(e,n)}for(r=s.length-1;r>=0;--r)if(s.charCodeAt(r)===47){if(!i){e=r+1;break}}else n===-1&&(i=!1,n=r+1);return n===-1?"":s.slice(e,n)},extname(s){yr(s),s=tl(this.toPosix(s));let t=-1,e=0,n=-1,i=!0,r=0;for(let o=s.length-1;o>=0;--o){const h=s.charCodeAt(o);if(h===47){if(!i){e=o+1;break}continue}n===-1&&(i=!1,n=o+1),h===46?t===-1?t=o:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||n===-1||r===0||r===1&&t===n-1&&t===e+1?"":s.slice(t,n)},parse(s){yr(s);const t={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return t;s=tl(this.toPosix(s));let e=s.charCodeAt(0);const n=this.isAbsolute(s);let i;t.root=this.rootname(s),n||this.hasProtocol(s)?i=1:i=0;let r=-1,o=0,h=-1,d=!0,_=s.length-1,g=0;for(;_>=i;--_){if(e=s.charCodeAt(_),e===47){if(!d){o=_+1;break}continue}h===-1&&(d=!1,h=_+1),e===46?r===-1?r=_:g!==1&&(g=1):r!==-1&&(g=-1)}return r===-1||h===-1||g===0||g===1&&r===h-1&&r===o+1?h!==-1&&(o===0&&n?t.base=t.name=s.slice(1,h):t.base=t.name=s.slice(o,h)):(o===0&&n?(t.name=s.slice(1,r),t.base=s.slice(1,h)):(t.name=s.slice(o,r),t.base=s.slice(o,h)),t.ext=s.slice(r,h)),t.dir=this.dirname(s),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function wg(s,t,e,n,i){const r=t[e];for(let o=0;o<r.length;o++){const h=r[o];e<t.length-1?wg(s.replace(n[e],h),t,e+1,n,i):i.push(s.replace(n[e],h))}}function HM(s){const t=/\{(.*?)\}/g,e=s.match(t),n=[];if(e){const i=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");i.push(o)}),wg(s,i,0,e,n)}else n.push(s);return n}const gh=s=>!Array.isArray(s);class la{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`).join("&")}}getAlias(t){const{alias:e,src:n}=t;return br(e||n,r=>typeof r=="string"?r:Array.isArray(r)?r.map(o=>(o==null?void 0:o.src)??o):r!=null&&r.src?r.src:r,!0)}addManifest(t){this._manifest&&an("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const n=[];let i=e;Array.isArray(e)||(i=Object.entries(e).map(([r,o])=>typeof o=="string"||Array.isArray(o)?{alias:r,src:o}:{alias:r,...o})),i.forEach(r=>{const o=r.src,h=r.alias;let d;if(typeof h=="string"){const _=this._createBundleAssetId(t,h);n.push(_),d=[h,_]}else{const _=h.map(g=>this._createBundleAssetId(t,g));n.push(..._),d=[...h,..._]}this.add({...r,alias:d,src:o})}),this._bundles[t]=n}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let n;n=r=>{this.hasKey(r)&&an(`[Resolver] already has key: ${r} overwriting`)},br(e).forEach(r=>{const{src:o}=r;let{data:h,format:d,loadParser:_,parser:g}=r;const l=br(o).map(M=>typeof M=="string"?HM(M):Array.isArray(M)?M:[M]),m=this.getAlias(r);Array.isArray(m)?m.forEach(n):n(m);const y=[],w=M=>{const S=this._parsers.find(A=>A.test(M));return{...S==null?void 0:S.parse(M),src:M}};l.forEach(M=>{M.forEach(S=>{let A={};if(typeof S!="object"?A=w(S):(h=S.data??h,d=S.format??d,(S.loadParser||S.parser)&&(_=S.loadParser??_,g=S.parser??g),A={...w(S.src),...S}),!m)throw new Error(`[Resolver] alias is undefined for this asset: ${A.src}`);A=this._buildResolvedAsset(A,{aliases:m,data:h,format:d,loadParser:_,parser:g,progressSize:r.progressSize}),y.push(A)})}),m.forEach(M=>{this._assetMap[M]=y})})}resolveBundle(t){const e=gh(t);t=br(t);const n={};return t.forEach(i=>{const r=this._bundles[i];if(r){const o=this.resolve(r),h={};for(const d in o){const _=o[d];h[this._extractAssetIdFromBundle(i,d)]=_}n[i]=h}}),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const n={};for(const i in e)n[i]=e[i].src;return n}return e.src}resolve(t){const e=gh(t);t=br(t);const n={};return t.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let r=this._assetMap[i];const o=this._getPreferredOrder(r);o==null||o.priority.forEach(h=>{o.params[h].forEach(d=>{const _=r.filter(g=>g[h]?g[h]===d:!1);_.length&&(r=_)})}),this._resolverHash[i]=r[0]}else this._resolverHash[i]=this._buildResolvedAsset({alias:[i],src:i},{});n[i]=this._resolverHash[i]}),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const n=t[e],i=this._preferredOrder.find(r=>r.params.format.includes(n.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:n,data:i,loadParser:r,parser:o,format:h,progressSize:d}=e;return(this._basePath||this._rootPath)&&(t.src=$s.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=n??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...i||{},...t.data},t.loadParser=r??t.loadParser,t.parser=o??t.parser,t.format=h??t.format??UM(t.src),d!==void 0&&(t.progressSize=d),t}}la.RETINA_PREFIX=/@([0-9\.]+)x/;function UM(s){return s.split(".").pop().split("?").shift().split("#").shift()}const Gd=(s,t)=>{const e=t.split("?")[1];return e&&(s+=`?${e}`),s},Sg=class cl{constructor(t,e){this.linkedSheets=[];let n=t;(t==null?void 0:t.source)instanceof Mr&&(n={texture:t,data:e});const{texture:i,data:r,cachePrefix:o=""}=n;this.cachePrefix=o,this._texture=i instanceof Xt?i:null,this.textureSource=i.source,this.textures={},this.animations={},this.data=r;const h=parseFloat(r.meta.scale);h?(this.resolution=h,i.source.resolution=this.resolution):this.resolution=i.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=cl.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const n=cl.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const i=this._frameKeys[e],r=this._frames[i],o=r.frame;if(o){let h=null,d=null;const _=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,g=new $t(0,0,Math.floor(_.w)/this.resolution,Math.floor(_.h)/this.resolution);r.rotated?h=new $t(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):h=new $t(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(d=new $t(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[i]=new Xt({source:this.textureSource,frame:h,orig:g,trim:d,rotate:r.rotated?2:0,defaultAnchor:r.anchor,defaultBorders:r.borders,label:i.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const i=t[e][n];this.animations[e].push(this.textures[i])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*cl.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*cl.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};Sg.BATCH_SIZE=1e3;let $m=Sg;const YM=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Mg(s,t,e){const n={};if(s.forEach(i=>{n[i]=t}),Object.keys(t.textures).forEach(i=>{n[`${t.cachePrefix}${i}`]=t.textures[i]}),!e){const i=$s.dirname(s[0]);t.linkedSheets.forEach((r,o)=>{const h=Mg([`${i}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(n,h)})}return n}const XM={extension:kt.Asset,cache:{test:s=>s instanceof $m,getCacheableAssets:(s,t)=>Mg(s,t,!1)},resolver:{extension:{type:kt.ResolveParser,name:"resolveSpritesheet"},test:s=>{const e=s.split("?")[0].split("."),n=e.pop(),i=e.pop();return n==="json"&&YM.includes(i)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=la.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:kt.LoadParser,priority:Ui.Normal,name:"spritesheetLoader"},async testParse(s,t){return $s.extname(t.src).toLowerCase()===".json"&&!!s.frames},async parse(s,t,e){var l,m;const{texture:n,imageFilename:i,textureOptions:r,cachePrefix:o}=(t==null?void 0:t.data)??{};let h=$s.dirname(t.src);h&&h.lastIndexOf("/")!==h.length-1&&(h+="/");let d;if(n instanceof Xt)d=n;else{const y=Gd(h+(i??s.meta.image),t.src);d=(await e.load([{src:y,data:r}]))[y]}const _=new $m({texture:d.source,data:s,cachePrefix:o});await _.parse();const g=(l=s==null?void 0:s.meta)==null?void 0:l.related_multi_packs;if(Array.isArray(g)){const y=[];for(const M of g){if(typeof M!="string")continue;let S=h+M;(m=t.data)!=null&&m.ignoreMultiPack||(S=Gd(S,t.src),y.push(e.load({src:S,data:{textureOptions:r,ignoreMultiPack:!0}})))}const w=await Promise.all(y);_.linkedSheets=w,w.forEach(M=>{M.linkedSheets=[_].concat(_.linkedSheets.filter(S=>S!==M))})}return _},async unload(s,t,e){await e.unload(s.textureSource._sourceOrigin),s.destroy(!1)}}};us.add(XM);const dd=Object.create(null),jm=Object.create(null);function sf(s,t){let e=jm[s];return e===void 0&&(dd[t]===void 0&&(dd[t]=1),jm[s]=e=dd[t]++),e}let Ko;function Ag(){return(!Ko||Ko!=null&&Ko.isContextLost())&&(Ko=en.get().createCanvas().getContext("webgl",{})),Ko}let nh;function zM(){if(!nh){nh="mediump";const s=Ag();s&&s.getShaderPrecisionFormat&&(nh=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision?"highp":"mediump")}return nh}function VM(s,t,e){return t?s:e?(s=s.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${s}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${s}
        `}function $M(s,t,e){const n=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(s.substring(0,9)!=="precision"){let i=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return i==="highp"&&n!=="highp"&&(i="mediump"),`precision ${i} float;
${s}`}else if(n!=="highp"&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}function jM(s,t){return t?`#version 300 es
${s}`:s}const qM={},KM={};function ZM(s,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const n=e?qM:KM;return n[t]?(n[t]++,t+=`-${n[t]}`):n[t]=1,s.indexOf("#define SHADER_NAME")!==-1?s:`${`#define SHADER_NAME ${t}`}
${s}`}function QM(s,t){return t?s.replace("#version 300 es",""):s}const fd={stripVersion:QM,ensurePrecision:$M,addProgramDefines:VM,setProgramName:ZM,insertVersion:jM},el=Object.create(null),vg=class Hd{constructor(t){t={...Hd.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,n={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:zM()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let i=t.fragment,r=t.vertex;Object.keys(fd).forEach(o=>{const h=n[o];i=fd[o](i,h,!0),r=fd[o](r,h,!1)}),this.fragment=i,this.vertex=r,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=sf(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,el[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return el[e]||(el[e]=new Hd(t),el[e]._cacheKey=e),el[e]}};vg.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Ah=vg;const qm={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function JM(s){return qm[s]??qm.float32}const tA={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function eA({source:s,entryPoint:t}){const e={},n=s.indexOf(`fn ${t}`);if(n!==-1){const i=s.indexOf("->",n);if(i!==-1){const r=s.substring(n,i),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let h;for(;(h=o.exec(r))!==null;){const d=tA[h[3]]??"float32";e[h[2]]={location:parseInt(h[1],10),format:d,stride:JM(d).stride,offset:0,instance:!1,start:0}}}}return e}function pd(s){var l,m;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,n=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,r=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,h=/(\w+)\s*:\s*([\w\<\>]+)/g,d=/struct\s+(\w+)/,_=(l=s.match(t))==null?void 0:l.map(y=>({group:parseInt(y.match(e)[1],10),binding:parseInt(y.match(n)[1],10),name:y.match(i)[2],isUniform:y.match(i)[1]==="<uniform>",type:y.match(r)[1]}));if(!_)return{groups:[],structs:[]};const g=((m=s.match(o))==null?void 0:m.map(y=>{const w=y.match(d)[1],M=y.match(h).reduce((S,A)=>{const[C,I]=A.split(":");return S[C.trim()]=I.trim(),S},{});return M?{name:w,members:M}:null}).filter(({name:y})=>_.some(w=>w.type===y)))??[];return{groups:_,structs:g}}var hl=(s=>(s[s.VERTEX=1]="VERTEX",s[s.FRAGMENT=2]="FRAGMENT",s[s.COMPUTE=4]="COMPUTE",s))(hl||{});function nA({groups:s}){const t=[];for(let e=0;e<s.length;e++){const n=s[e];t[n.group]||(t[n.group]=[]),n.isUniform?t[n.group].push({binding:n.binding,visibility:hl.VERTEX|hl.FRAGMENT,buffer:{type:"uniform"}}):n.type==="sampler"?t[n.group].push({binding:n.binding,visibility:hl.FRAGMENT,sampler:{type:"filtering"}}):n.type==="texture_2d"&&t[n.group].push({binding:n.binding,visibility:hl.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function sA({groups:s}){const t=[];for(let e=0;e<s.length;e++){const n=s[e];t[n.group]||(t[n.group]={}),t[n.group][n.name]=n.binding}return t}function rA(s,t){const e=new Set,n=new Set,i=[...s.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),r=[...s.groups,...t.groups].filter(o=>{const h=`${o.name}-${o.binding}`;return n.has(h)?!1:(n.add(h),!0)});return{structs:i,groups:r}}const nl=Object.create(null);class ca{constructor(t){var h,d;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:n,layout:i,gpuLayout:r,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=n,e.source===n.source){const _=pd(e.source);this.structsAndGroups=_}else{const _=pd(n.source),g=pd(e.source);this.structsAndGroups=rA(_,g)}this.layout=i??sA(this.structsAndGroups),this.gpuLayout=r??nA(this.structsAndGroups),this.autoAssignGlobalUniforms=((h=this.layout[0])==null?void 0:h.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((d=this.layout[1])==null?void 0:d.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,n=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=sf(n,"program")}get attributeData(){return this._attributeData??(this._attributeData=eA(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,nl[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return nl[e]||(nl[e]=new ca(t),nl[e]._cacheKey=e),nl[e]}}const Tg=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],iA=Tg.reduce((s,t)=>(s[t]=!0,s),{});function oA(s,t){switch(s){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Cg=class Eg{constructor(t,e){this._touched=0,this.uid=vn("uniform"),this._resourceType="uniformGroup",this._resourceId=vn("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...Eg.defaultOptions,...e},this.uniformStructures=t;const n={};for(const i in t){const r=t[i];if(r.name=i,r.size=r.size??1,!iA[r.type]){const o=r.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,h,d]=o;throw new Error(`Uniform type ${r.type} is not supported. Use type: '${h}', size: ${d} instead.`)}throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${Tg.join(", ")}`)}r.value??(r.value=oA(r.type,r.size)),n[i]=r.value}this.uniforms=n,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=sf(Object.keys(n).map(i=>`${i}-${t[i].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Cg.defaultOptions={ubo:!1,isStatic:!1};let Pg=Cg;class dh{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const n in t){const i=t[n];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const n in this.resources)t[e++]=this.resources[n]._resourceId;this._key=t.join("|")}setResource(t,e){var i,r;const n=this.resources[e];t!==n&&(n&&((i=t.off)==null||i.call(t,"change",this.onResourceChange,this)),(r=t.on)==null||r.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const n in e)e[n]._touched=t}destroy(){var e;const t=this.resources;for(const n in t){const i=t[n];(e=i==null?void 0:i.off)==null||e.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const n in e)e[n]===t&&(e[n]=null)}else this._updateKey()}}var gl=(s=>(s[s.WEBGL=1]="WEBGL",s[s.WEBGPU=2]="WEBGPU",s[s.BOTH=3]="BOTH",s))(gl||{});class vh extends Sr{constructor(t){super(),this.uid=vn("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[],this._destroyed=!1;let{gpuProgram:e,glProgram:n,groups:i,resources:r,compatibleRenderers:o,groupMap:h}=t;this.gpuProgram=e,this.glProgram=n,o===void 0&&(o=0,e&&(o|=gl.WEBGPU),n&&(o|=gl.WEBGL)),this.compatibleRenderers=o;const d={};if(!r&&!i&&(r={}),r&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!h)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&h)for(const _ in h)for(const g in h[_]){const l=h[_][g];d[l]={group:_,binding:g,name:l}}else if(e&&i&&!h){const _=e.structsAndGroups.groups;h={},_.forEach(g=>{h[g.group]=h[g.group]||{},h[g.group][g.binding]=g.name,d[g.name]=g})}else if(r){i={},h={},e&&e.structsAndGroups.groups.forEach(l=>{h[l.group]=h[l.group]||{},h[l.group][l.binding]=l.name,d[l.name]=l});let _=0;for(const g in r)d[g]||(i[99]||(i[99]=new dh,this._ownedBindGroups.push(i[99])),d[g]={group:99,binding:_,name:g},h[99]=h[99]||{},h[99][_]=g,_++);for(const g in r){const l=g;let m=r[g];!m.source&&!m._resourceType&&(m=new Pg(m));const y=d[l];y&&(i[y.group]||(i[y.group]=new dh,this._ownedBindGroups.push(i[y.group])),i[y.group].setResource(m,y.binding))}}this.groups=i,this._uniformBindMap=h,this.resources=this._buildResourceAccessor(i,d)}addResource(t,e,n){var i,r;(i=this._uniformBindMap)[e]||(i[e]={}),(r=this._uniformBindMap[e])[n]||(r[n]=t),this.groups[e]||(this.groups[e]=new dh,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const n={};for(const i in e){const r=e[i];Object.defineProperty(n,r.name,{get(){return t[r.group].getResource(r.binding)},set(o){t[r.group].setResource(o,r.binding)}})}return n}destroy(t=!1){var e,n;this._destroyed||(this._destroyed=!0,this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(n=this.glProgram)==null||n.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(i=>{i.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null)}static from(t){const{gpu:e,gl:n,...i}=t;let r,o;return e&&(r=ca.from(e)),n&&(o=Ah.from(n)),new vh({gpuProgram:r,glProgram:o,...i})}}const aA={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},md=0,_d=1,gd=2,yd=3,xd=4,bd=5,Ud=class Ig{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<md)}set blend(t){!!(this.data&1<<md)!==t&&(this.data^=1<<md)}get offsets(){return!!(this.data&1<<_d)}set offsets(t){!!(this.data&1<<_d)!==t&&(this.data^=1<<_d)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<gd)}set culling(t){!!(this.data&1<<gd)!==t&&(this.data^=1<<gd)}get depthTest(){return!!(this.data&1<<yd)}set depthTest(t){!!(this.data&1<<yd)!==t&&(this.data^=1<<yd)}get depthMask(){return!!(this.data&1<<bd)}set depthMask(t){!!(this.data&1<<bd)!==t&&(this.data^=1<<bd)}get clockwiseFrontFace(){return!!(this.data&1<<xd)}set clockwiseFrontFace(t){!!(this.data&1<<xd)!==t&&(this.data^=1<<xd)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=aA[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Ig;return t.depthTest=!1,t.blend=!0,t}};Ud.default2d=Ud.for2d();let lA=Ud;const kg=class Yd extends vh{constructor(t){t={...Yd.defaultOptions,...t},super(t),this.enabled=!0,this._state=lA.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1),t.blendRequired&&this.addResource("uBackTexture",0,3)}apply(t,e,n,i){t.applyFilter(this,e,n,i)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:e,gl:n,...i}=t;let r,o;return e&&(r=ca.from(e)),n&&(o=Ah.from(n)),new Yd({gpuProgram:r,glProgram:o,...i})}};kg.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Lg=kg;const Xd=[];us.handleByNamedList(kt.Environment,Xd);async function cA(s){if(!s)for(let t=0;t<Xd.length;t++){const e=Xd[t];if(e.value.test()){await e.value.load();return}}}let sl;function hA(){if(typeof sl=="boolean")return sl;try{sl=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{sl=!1}return sl}function Km(s,t,e=2){const n=t&&t.length,i=n?t[0]*e:s.length;let r=Fg(s,0,i,e,!0);const o=[];if(!r||r.next===r.prev)return o;let h,d,_;if(n&&(r=mA(s,t,r,e)),s.length>80*e){h=s[0],d=s[1];let g=h,l=d;for(let m=e;m<i;m+=e){const y=s[m],w=s[m+1];y<h&&(h=y),w<d&&(d=w),y>g&&(g=y),w>l&&(l=w)}_=Math.max(g-h,l-d),_=_!==0?32767/_:0}return yl(r,o,e,h,d,_,0),o}function Fg(s,t,e,n,i){let r;if(i===TA(s,t,e,n)>0)for(let o=t;o<e;o+=n)r=Zm(o/n|0,s[o],s[o+1],r);else for(let o=e-n;o>=t;o-=n)r=Zm(o/n|0,s[o],s[o+1],r);return r&&aa(r,r.next)&&(bl(r),r=r.next),r}function xo(s,t){if(!s)return s;t||(t=s);let e=s,n;do if(n=!1,!e.steiner&&(aa(e,e.next)||wn(e.prev,e,e.next)===0)){if(bl(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function yl(s,t,e,n,i,r,o){if(!s)return;!o&&r&&bA(s,n,i,r);let h=s;for(;s.prev!==s.next;){const d=s.prev,_=s.next;if(r?dA(s,n,i,r):uA(s)){t.push(d.i,s.i,_.i),bl(s),s=_.next,h=_.next;continue}if(s=_,s===h){o?o===1?(s=fA(xo(s),t),yl(s,t,e,n,i,r,2)):o===2&&pA(s,t,e,n,i,r):yl(xo(s),t,e,n,i,r,1);break}}}function uA(s){const t=s.prev,e=s,n=s.next;if(wn(t,e,n)>=0)return!1;const i=t.x,r=e.x,o=n.x,h=t.y,d=e.y,_=n.y,g=Math.min(i,r,o),l=Math.min(h,d,_),m=Math.max(i,r,o),y=Math.max(h,d,_);let w=n.next;for(;w!==t;){if(w.x>=g&&w.x<=m&&w.y>=l&&w.y<=y&&ul(i,h,r,d,o,_,w.x,w.y)&&wn(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function dA(s,t,e,n){const i=s.prev,r=s,o=s.next;if(wn(i,r,o)>=0)return!1;const h=i.x,d=r.x,_=o.x,g=i.y,l=r.y,m=o.y,y=Math.min(h,d,_),w=Math.min(g,l,m),M=Math.max(h,d,_),S=Math.max(g,l,m),A=zd(y,w,t,e,n),C=zd(M,S,t,e,n);let I=s.prevZ,O=s.nextZ;for(;I&&I.z>=A&&O&&O.z<=C;){if(I.x>=y&&I.x<=M&&I.y>=w&&I.y<=S&&I!==i&&I!==o&&ul(h,g,d,l,_,m,I.x,I.y)&&wn(I.prev,I,I.next)>=0||(I=I.prevZ,O.x>=y&&O.x<=M&&O.y>=w&&O.y<=S&&O!==i&&O!==o&&ul(h,g,d,l,_,m,O.x,O.y)&&wn(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;I&&I.z>=A;){if(I.x>=y&&I.x<=M&&I.y>=w&&I.y<=S&&I!==i&&I!==o&&ul(h,g,d,l,_,m,I.x,I.y)&&wn(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;O&&O.z<=C;){if(O.x>=y&&O.x<=M&&O.y>=w&&O.y<=S&&O!==i&&O!==o&&ul(h,g,d,l,_,m,O.x,O.y)&&wn(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function fA(s,t){let e=s;do{const n=e.prev,i=e.next.next;!aa(n,i)&&Rg(n,e,e.next,i)&&xl(n,i)&&xl(i,n)&&(t.push(n.i,e.i,i.i),bl(e),bl(e.next),e=s=i),e=e.next}while(e!==s);return xo(e)}function pA(s,t,e,n,i,r){let o=s;do{let h=o.next.next;for(;h!==o.prev;){if(o.i!==h.i&&MA(o,h)){let d=Bg(o,h);o=xo(o,o.next),d=xo(d,d.next),yl(o,t,e,n,i,r,0),yl(d,t,e,n,i,r,0);return}h=h.next}o=o.next}while(o!==s)}function mA(s,t,e,n){const i=[];for(let r=0,o=t.length;r<o;r++){const h=t[r]*n,d=r<o-1?t[r+1]*n:s.length,_=Fg(s,h,d,n,!1);_===_.next&&(_.steiner=!0),i.push(SA(_))}i.sort(_A);for(let r=0;r<i.length;r++)e=gA(i[r],e);return e}function _A(s,t){let e=s.x-t.x;if(e===0&&(e=s.y-t.y,e===0)){const n=(s.next.y-s.y)/(s.next.x-s.x),i=(t.next.y-t.y)/(t.next.x-t.x);e=n-i}return e}function gA(s,t){const e=yA(s,t);if(!e)return t;const n=Bg(e,s);return xo(n,n.next),xo(e,e.next)}function yA(s,t){let e=t;const n=s.x,i=s.y;let r=-1/0,o;if(aa(s,e))return e;do{if(aa(s,e.next))return e.next;if(i<=e.y&&i>=e.next.y&&e.next.y!==e.y){const l=e.x+(i-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(l<=n&&l>r&&(r=l,o=e.x<e.next.x?e:e.next,l===n))return o}e=e.next}while(e!==t);if(!o)return null;const h=o,d=o.x,_=o.y;let g=1/0;e=o;do{if(n>=e.x&&e.x>=d&&n!==e.x&&Og(i<_?n:r,i,d,_,i<_?r:n,i,e.x,e.y)){const l=Math.abs(i-e.y)/(n-e.x);xl(e,s)&&(l<g||l===g&&(e.x>o.x||e.x===o.x&&xA(o,e)))&&(o=e,g=l)}e=e.next}while(e!==h);return o}function xA(s,t){return wn(s.prev,s,t.prev)<0&&wn(t.next,s,s.next)<0}function bA(s,t,e,n){let i=s;do i.z===0&&(i.z=zd(i.x,i.y,t,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,wA(i)}function wA(s){let t,e=1;do{let n=s,i;s=null;let r=null;for(t=0;n;){t++;let o=n,h=0;for(let _=0;_<e&&(h++,o=o.nextZ,!!o);_++);let d=e;for(;h>0||d>0&&o;)h!==0&&(d===0||!o||n.z<=o.z)?(i=n,n=n.nextZ,h--):(i=o,o=o.nextZ,d--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;n=o}r.nextZ=null,e*=2}while(t>1);return s}function zd(s,t,e,n,i){return s=(s-e)*i|0,t=(t-n)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function SA(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function Og(s,t,e,n,i,r,o,h){return(i-o)*(t-h)>=(s-o)*(r-h)&&(s-o)*(n-h)>=(e-o)*(t-h)&&(e-o)*(r-h)>=(i-o)*(n-h)}function ul(s,t,e,n,i,r,o,h){return!(s===o&&t===h)&&Og(s,t,e,n,i,r,o,h)}function MA(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!AA(s,t)&&(xl(s,t)&&xl(t,s)&&vA(s,t)&&(wn(s.prev,s,t.prev)||wn(s,t.prev,t))||aa(s,t)&&wn(s.prev,s,s.next)>0&&wn(t.prev,t,t.next)>0)}function wn(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function aa(s,t){return s.x===t.x&&s.y===t.y}function Rg(s,t,e,n){const i=rh(wn(s,t,e)),r=rh(wn(s,t,n)),o=rh(wn(e,n,s)),h=rh(wn(e,n,t));return!!(i!==r&&o!==h||i===0&&sh(s,e,t)||r===0&&sh(s,n,t)||o===0&&sh(e,s,n)||h===0&&sh(e,t,n))}function sh(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function rh(s){return s>0?1:s<0?-1:0}function AA(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&Rg(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function xl(s,t){return wn(s.prev,s,s.next)<0?wn(s,t,s.next)>=0&&wn(s,s.prev,t)>=0:wn(s,t,s.prev)<0||wn(s,s.next,t)<0}function vA(s,t){let e=s,n=!1;const i=(s.x+t.x)/2,r=(s.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&i<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==s);return n}function Bg(s,t){const e=Vd(s.i,s.x,s.y),n=Vd(t.i,t.x,t.y),i=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=i,i.prev=e,n.next=e,e.prev=n,r.next=n,n.prev=r,n}function Zm(s,t,e,n){const i=Vd(s,t,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function bl(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Vd(s,t,e){return{i:s,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function TA(s,t,e,n){let i=0;for(let r=t,o=e-n;r<e;r+=n)i+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return i}const CA=Km.default||Km;var Ng=(s=>(s[s.NONE=0]="NONE",s[s.COLOR=16384]="COLOR",s[s.STENCIL=1024]="STENCIL",s[s.DEPTH=256]="DEPTH",s[s.COLOR_DEPTH=16640]="COLOR_DEPTH",s[s.COLOR_STENCIL=17408]="COLOR_STENCIL",s[s.DEPTH_STENCIL=1280]="DEPTH_STENCIL",s[s.ALL=17664]="ALL",s))(Ng||{});class EA{constructor(t){this.items=[],this._name=t}emit(t,e,n,i,r,o,h,d){const{name:_,items:g}=this;for(let l=0,m=g.length;l<m;l++)g[l][_](t,e,n,i,r,o,h,d);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const PA=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Wg=class Dg extends Sr{constructor(t){super(),this.uid=vn("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...PA,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await cA(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const n in this._systemsHash)t={...this._systemsHash[n].constructor.defaultOptions,...t};t={...Dg.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let n=0;n<this.runners.init.items.length;n++)await this.runners.init.items[n].init(t);this._initOptions=t}render(t,e){let n=t;if(n instanceof et&&(n={container:n},e&&(jt(Pe,"passing a second argument is deprecated, please use render options instead"),n.target=e.renderTexture)),n.target||(n.target=this.view.renderTarget),n.target===this.view.renderTarget&&(this._lastObjectRendered=n.container,n.clearColor??(n.clearColor=this.background.colorRgba),n.clear??(n.clear=this.background.clearBeforeRender)),n.clearColor){const i=Array.isArray(n.clearColor)&&n.clearColor.length===4;n.clearColor=i?n.clearColor:Dn.shared.setValue(n.clearColor).toArray()}n.transform||(n.container.updateLocalTransform(),n.transform=n.container.localTransform),n.container.visible&&(n.container.enableRenderGroup(),this.runners.prerender.emit(n),this.runners.renderStart.emit(n),this.runners.render.emit(n),this.runners.renderEnd.emit(n),this.runners.postrender.emit(n))}resize(t,e,n){const i=this.view.resolution;this.view.resize(t,e,n),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),n!==void 0&&n!==i&&this.runners.resolutionChange.emit(n)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=Ng.ALL);const{clear:n,clearColor:i,target:r}=t;Dn.shared.setValue(i??this.background.colorRgba),e.renderTarget.clear(r,n,Dn.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new EA(e)})}_addSystems(t){let e;for(e in t){const n=t[e];this._addSystem(n.value,n.name)}}_addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const i in this.runners)this.runners[i].add(n);return this}_addPipes(t,e){const n=e.reduce((i,r)=>(i[r.name]=r.value,i),{});t.forEach(i=>{const r=i.value,o=i.name,h=n[o];this.renderPipes[o]=new r(this,h?new h:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&vl.release(),Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!hA())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Wg.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Gg=Wg,ih;function IA(s){return ih!==void 0||(ih=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:s??Gg.defaultOptions.failIfMajorPerformanceCaveat};try{if(!en.get().getWebGLRenderingContext())return!1;let i=en.get().createCanvas().getContext("webgl",t);const r=!!((e=i==null?void 0:i.getContextAttributes())!=null&&e.stencil);if(i){const o=i.getExtension("WEBGL_lose_context");o&&o.loseContext()}return i=null,r}catch{return!1}})()),ih}let oh;async function kA(s={}){return oh!==void 0||(oh=await(async()=>{const t=en.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(s)).requestDevice(),!0}catch{return!1}})()),oh}const Qm=["webgl","webgpu","canvas"];async function LA(s){let t=[];s.preference?(t.push(s.preference),Qm.forEach(r=>{r!==s.preference&&t.push(r)})):t=Qm.slice();let e,n={};for(let r=0;r<t.length;r++){const o=t[r];if(o==="webgpu"&&await kA()){const{WebGPURenderer:h}=await mh(async()=>{const{WebGPURenderer:d}=await import("./WebGPURenderer-BDqfH_WG.js");return{WebGPURenderer:d}},__vite__mapDeps([3,2,4]));e=h,n={...s,...s.webgpu};break}else if(o==="webgl"&&IA(s.failIfMajorPerformanceCaveat??Gg.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:h}=await mh(async()=>{const{WebGLRenderer:d}=await import("./WebGLRenderer-BRSWVwPE.js");return{WebGLRenderer:d}},__vite__mapDeps([5,2,4]));e=h,n={...s,...s.webgl};break}else if(o==="canvas")throw n={...s},new Error("CanvasRenderer is not yet implemented")}if(delete n.webgpu,delete n.webgl,!e)throw new Error("No available renderer for the current environment");const i=new e;return await i.init(n),i}const Hg="8.14.3";class Ug{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,Hg)}static destroy(){}}Ug.extension=kt.Application;class FA{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,Hg)}destroy(){this._renderer=null}}FA.extension={type:[kt.WebGLSystem,kt.WebGPUSystem],name:"initHook",priority:-10};const Yg=class $d{constructor(...t){this.stage=new et,t[0]!==void 0&&jt(Pe,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.stage||(this.stage=new et),this.renderer=await LA(t),$d._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return jt(Pe,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const n=$d._plugins.slice(0);n.reverse(),n.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Yg._plugins=[];let Xg=Yg;us.handleByList(kt.Application,Xg._plugins);us.add(Ug);class zg extends Sr{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return jt(Pe,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return jt(Pe,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return jt(Pe,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return jt(Pe,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return jt(Pe,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const n in this.chars)(e=this.chars[n].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(n=>n.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class OA{constructor(t=0,e=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=n,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,n=this.resetTtl){let i=null;if(this.has(t))this.set(t,e,!0,n);else{this.max>0&&this.size===this.max&&(i={...this.first},this.evict(!0));let r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=r:this.last.next=r,this.last=r}return i}set(t,e,n=!1,i=this.resetTtl){let r=this.items[t];return n||r!==void 0?(r.value=e,n===!1&&i&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(r)):(this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=r:this.last.next=r,this.last=r),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Vg(s=1e3,t=0,e=!1){if(isNaN(s)||s<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new OA(s,t,e)}const RA=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function yh(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let i=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!RA.includes(i)&&(i=`"${i}"`),e[n]=i}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const wd={willReadFrequently:!0},Ar=class At{static get experimentalLetterSpacingSupported(){let t=At._experimentalLetterSpacingSupported;if(t===void 0){const e=en.get().getCanvasRenderingContext2D().prototype;t=At._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,i,r,o,h,d,_){this.text=t,this.style=e,this.width=n,this.height=i,this.lines=r,this.lineWidths=o,this.lineHeight=h,this.maxLineWidth=d,this.fontProperties=_}static measureText(t=" ",e,n=At._canvas,i=e.wordWrap){var C;const r=`${t}-${e.styleKey}-wordWrap-${i}`;if(At._measurementCache.has(r))return At._measurementCache.get(r);const o=yh(e),h=At.measureFont(o);h.fontSize===0&&(h.fontSize=e.fontSize,h.ascent=e.fontSize);const d=At.__context;d.font=o;const g=(i?At._wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),l=new Array(g.length);let m=0;for(let I=0;I<g.length;I++){const O=At._measureText(g[I],e.letterSpacing,d);l[I]=O,m=Math.max(m,O)}const y=((C=e._stroke)==null?void 0:C.width)||0;let w=m+y;e.dropShadow&&(w+=e.dropShadow.distance);const M=e.lineHeight||h.fontSize;let S=Math.max(M,h.fontSize+y)+(g.length-1)*(M+e.leading);e.dropShadow&&(S+=e.dropShadow.distance);const A=new At(t,e,w,S,g,l,M+e.leading,m,h);return At._measurementCache.set(r,A),A}static _measureText(t,e,n){let i=!1;At.experimentalLetterSpacingSupported&&(At.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,i=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));const r=n.measureText(t);let o=r.width;const h=-r.actualBoundingBoxLeft;let _=r.actualBoundingBoxRight-h;if(o>0)if(i)o-=e,_-=e;else{const g=(At.graphemeSegmenter(t).length-1)*e;o+=g,_+=g}return Math.max(o,_)}static _wordWrap(t,e,n=At._canvas){const i=n.getContext("2d",wd);let r=0,o="",h="";const d=Object.create(null),{letterSpacing:_,whiteSpace:g}=e,l=At._collapseSpaces(g),m=At._collapseNewlines(g);let y=!l;const w=e.wordWrapWidth+_,M=At._tokenize(t);for(let S=0;S<M.length;S++){let A=M[S];if(At._isNewline(A)){if(!m){h+=At._addLine(o),y=!l,o="",r=0;continue}A=" "}if(l){const I=At.isBreakingSpace(A),O=At.isBreakingSpace(o[o.length-1]);if(I&&O)continue}const C=At._getFromCache(A,_,d,i);if(C>w)if(o!==""&&(h+=At._addLine(o),o="",r=0),At.canBreakWords(A,e.breakWords)){const I=At.wordWrapSplit(A);for(let O=0;O<I.length;O++){let $=I[O],W=$,G=1;for(;I[O+G];){const J=I[O+G];if(!At.canBreakChars(W,J,A,O,e.breakWords))$+=J;else break;W=J,G++}O+=G-1;const lt=At._getFromCache($,_,d,i);lt+r>w&&(h+=At._addLine(o),y=!1,o="",r=0),o+=$,r+=lt}}else{o.length>0&&(h+=At._addLine(o),o="",r=0);const I=S===M.length-1;h+=At._addLine(A,!I),y=!1,o="",r=0}else C+r>w&&(y=!1,h+=At._addLine(o),o="",r=0),(o.length>0||!At.isBreakingSpace(A)||y)&&(o+=A,r+=C)}return h+=At._addLine(o,!1),h}static _addLine(t,e=!0){return t=At._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,n,i){let r=n[t];return typeof r!="number"&&(r=At._measureText(t,e,i)+e,n[t]=r),r}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const n=t[e];if(!At.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:At._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:At._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let n="";if(typeof t!="string")return e;for(let i=0;i<t.length;i++){const r=t[i],o=t[i+1];if(At.isBreakingSpace(r,o)||At._isNewline(r)){n!==""&&(e.push(n),n=""),r==="\r"&&o===`
`?(e.push(`\r
`),i++):e.push(r);continue}n+=r}return n!==""&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,i,r){return!0}static wordWrapSplit(t){return At.graphemeSegmenter(t)}static measureFont(t){if(At._fonts[t])return At._fonts[t];const e=At._context;e.font=t;const n=e.measureText(At.METRICS_STRING+At.BASELINE_SYMBOL),i={ascent:n.actualBoundingBoxAscent,descent:n.actualBoundingBoxDescent,fontSize:n.actualBoundingBoxAscent+n.actualBoundingBoxDescent};return At._fonts[t]=i,i}static clearMetrics(t=""){t?delete At._fonts[t]:At._fonts={}}static get _canvas(){if(!At.__canvas){let t;try{const e=new OffscreenCanvas(0,0),n=e.getContext("2d",wd);if(n!=null&&n.measureText)return At.__canvas=e,e;t=en.get().createCanvas()}catch{t=en.get().createCanvas()}t.width=t.height=10,At.__canvas=t}return At.__canvas}static get _context(){return At.__context||(At.__context=At._canvas.getContext("2d",wd)),At.__context}};Ar.METRICS_STRING="|q";Ar.BASELINE_SYMBOL="M";Ar.BASELINE_MULTIPLIER=1.4;Ar.HEIGHT_MULTIPLIER=2;Ar.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),n=[];let i=0;for(const r of e)n[i++]=r.segment;return n}}return s=>[...s]})();Ar.experimentalLetterSpacing=!1;Ar._fonts={};Ar._newlines=[10,13];Ar._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];Ar._measurementCache=Vg(1e3);let Gr=Ar;const Jm=[{offset:0,color:"white"},{offset:1,color:"black"}],rf=class jd{constructor(...t){this.uid=vn("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=BA(t);e={...e.type==="radial"?jd.defaultRadialOptions:jd.defaultLinearOptions,...q_(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(i=>{this.addColorStop(i.offset,i.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:Dn.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:n,y:i}=this.end,r=n-t,o=i-e;const h=r<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(r<0){const S=t;t=n,n=S,r*=-1}if(o<0){const S=e;e=i,i=S,o*=-1}}const d=this.colorStops.length?this.colorStops:Jm,_=this._textureSize,{canvas:g,context:l}=e_(_,1),m=h?l.createLinearGradient(this._textureSize,0,0,0):l.createLinearGradient(0,0,this._textureSize,0);t_(m,d),l.fillStyle=m,l.fillRect(0,0,_,1),this.texture=new Xt({source:new yo({resource:g,addressMode:this._wrapMode})});const y=Math.sqrt(r*r+o*o),w=Math.atan2(o,r),M=new fe;M.scale(y/_,1),M.rotate(w),M.translate(t,e),this.textureSpace==="local"&&M.scale(_,_),this.transform=M}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Jm,e=this._textureSize,{canvas:n,context:i}=e_(e,e),{x:r,y:o}=this.center,{x:h,y:d}=this.outerCenter,_=this.innerRadius,g=this.outerRadius,l=h-g,m=d-g,y=e/(g*2),w=(r-l)*y,M=(o-m)*y,S=i.createRadialGradient(w,M,_*y,(h-l)*y,(d-m)*y,g*y);t_(S,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=S,i.translate(w,M),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-w,-M),i.fillRect(0,0,e,e),this.texture=new Xt({source:new yo({resource:n,addressMode:this._wrapMode})});const A=new fe;A.scale(1/y,1/y),A.translate(l,m),this.textureSpace==="local"&&A.scale(e,e),this.transform=A}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};rf.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};rf.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let mi=rf;function t_(s,t){for(let e=0;e<t.length;e++){const n=t[e];s.addColorStop(n.offset,n.color)}}function e_(s,t){const e=en.get().createCanvas(s,t),n=e.getContext("2d");return{canvas:e,context:n}}function BA(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(jt("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??mi.defaultLinearOptions.textureSize}),t}const n_={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class Th{constructor(t,e){this.uid=vn("fillPattern"),this._tick=0,this.transform=new fe,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=n_[e].addressModeU,t.source.style.addressModeV=n_[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var NA=DA,Sd={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},WA=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function DA(s){var t=[];return s.replace(WA,function(e,n,i){var r=n.toLowerCase();for(i=HA(i),r=="m"&&i.length>2&&(t.push([n].concat(i.splice(0,2))),r="l",n=n=="m"?"l":"L");;){if(i.length==Sd[r])return i.unshift(n),t.push(i);if(i.length<Sd[r])throw new Error("malformed path data");t.push([n].concat(i.splice(0,Sd[r])))}}),t}var GA=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function HA(s){var t=s.match(GA);return t?t.map(Number):[]}const UA=z_(NA);function YA(s,t){const e=UA(s),n=[];let i=null,r=0,o=0;for(let h=0;h<e.length;h++){const d=e[h],_=d[0],g=d;switch(_){case"M":r=g[1],o=g[2],t.moveTo(r,o);break;case"m":r+=g[1],o+=g[2],t.moveTo(r,o);break;case"H":r=g[1],t.lineTo(r,o);break;case"h":r+=g[1],t.lineTo(r,o);break;case"V":o=g[1],t.lineTo(r,o);break;case"v":o+=g[1],t.lineTo(r,o);break;case"L":r=g[1],o=g[2],t.lineTo(r,o);break;case"l":r+=g[1],o+=g[2],t.lineTo(r,o);break;case"C":r=g[5],o=g[6],t.bezierCurveTo(g[1],g[2],g[3],g[4],r,o);break;case"c":t.bezierCurveTo(r+g[1],o+g[2],r+g[3],o+g[4],r+g[5],o+g[6]),r+=g[5],o+=g[6];break;case"S":r=g[3],o=g[4],t.bezierCurveToShort(g[1],g[2],r,o);break;case"s":t.bezierCurveToShort(r+g[1],o+g[2],r+g[3],o+g[4]),r+=g[3],o+=g[4];break;case"Q":r=g[3],o=g[4],t.quadraticCurveTo(g[1],g[2],r,o);break;case"q":t.quadraticCurveTo(r+g[1],o+g[2],r+g[3],o+g[4]),r+=g[3],o+=g[4];break;case"T":r=g[1],o=g[2],t.quadraticCurveToShort(r,o);break;case"t":r+=g[1],o+=g[2],t.quadraticCurveToShort(r,o);break;case"A":r=g[6],o=g[7],t.arcToSvg(g[1],g[2],g[3],g[4],g[5],r,o);break;case"a":r+=g[6],o+=g[7],t.arcToSvg(g[1],g[2],g[3],g[4],g[5],r,o);break;case"Z":case"z":t.closePath(),n.length>0&&(i=n.pop(),i?(r=i.startX,o=i.startY):(r=0,o=0)),i=null;break;default:an(`Unknown SVG path command: ${_}`)}_!=="Z"&&_!=="z"&&i===null&&(i={startX:r,startY:o},n.push(i))}return t}class of{constructor(t=0,e=0,n=0){this.type="circle",this.x=t,this.y=e,this.radius=n}clone(){return new of(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let i=this.x-t,r=this.y-e;return i*=i,r*=r,i+r<=n}strokeContains(t,e,n,i=.5){if(this.radius===0)return!1;const r=this.x-t,o=this.y-e,h=this.radius,d=(1-i)*n,_=Math.sqrt(r*r+o*o);return _<=h+d&&_>h-(n-d)}getBounds(t){return t||(t=new $t),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class af{constructor(t=0,e=0,n=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=n,this.halfHeight=i}clone(){return new af(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let n=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return n*=n,i*=i,n+i<=1}strokeContains(t,e,n,i=.5){const{halfWidth:r,halfHeight:o}=this;if(r<=0||o<=0)return!1;const h=n*(1-i),d=n-h,_=r-d,g=o-d,l=r+h,m=o+h,y=t-this.x,w=e-this.y,M=y*y/(_*_)+w*w/(g*g),S=y*y/(l*l)+w*w/(m*m);return M>1&&S<=1}getBounds(t){return t||(t=new $t),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function XA(s,t,e,n,i,r){const o=s-e,h=t-n,d=i-e,_=r-n,g=o*d+h*_,l=d*d+_*_;let m=-1;l!==0&&(m=g/l);let y,w;m<0?(y=e,w=n):m>1?(y=i,w=r):(y=e+m*d,w=n+m*_);const M=s-y,S=t-w;return M*M+S*S}let zA,VA;class pl{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const n=[];for(let i=0,r=e.length;i<r;i++)n.push(e[i].x,e[i].y);e=n}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,n=e.length;for(let i=0;i<n;i+=2){const r=e[i],o=e[i+1],h=e[(i+2)%n],d=e[(i+3)%n];t+=(h-r)*(d+o)}return t<0}containsPolygon(t){const e=this.getBounds(zA),n=t.getBounds(VA);if(!e.containsRect(n))return!1;const i=t.points;for(let r=0;r<i.length;r+=2){const o=i[r],h=i[r+1];if(!this.contains(o,h))return!1}return!0}clone(){const t=this.points.slice(),e=new pl(t);return e.closePath=this.closePath,e}contains(t,e){let n=!1;const i=this.points.length/2;for(let r=0,o=i-1;r<i;o=r++){const h=this.points[r*2],d=this.points[r*2+1],_=this.points[o*2],g=this.points[o*2+1];d>e!=g>e&&t<(_-h)*((e-d)/(g-d))+h&&(n=!n)}return n}strokeContains(t,e,n,i=.5){const r=n*n,o=r*(1-i),h=r-o,{points:d}=this,_=d.length-(this.closePath?0:2);for(let g=0;g<_;g+=2){const l=d[g],m=d[g+1],y=d[(g+2)%d.length],w=d[(g+3)%d.length],M=XA(t,e,l,m,y,w),S=Math.sign((y-l)*(e-m)-(w-m)*(t-l));if(M<=(S<0?h:o))return!0}return!1}getBounds(t){t||(t=new $t);const e=this.points;let n=1/0,i=-1/0,r=1/0,o=-1/0;for(let h=0,d=e.length;h<d;h+=2){const _=e[h],g=e[h+1];n=_<n?_:n,i=_>i?_:i,r=g<r?g:r,o=g>o?g:o}return t.x=n,t.width=i-n,t.y=r,t.height=o-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return jt("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return jt("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const ah=(s,t,e,n,i,r,o)=>{const h=s-e,d=t-n,_=Math.sqrt(h*h+d*d);return _>=i-r&&_<=i+o};class lf{constructor(t=0,e=0,n=0,i=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=n,this.height=i,this.radius=r}getBounds(t){return t||(t=new $t),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new lf(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let i=t-(this.x+n),r=e-(this.y+n);const o=n*n;if(i*i+r*r<=o||(i=t-(this.x+this.width-n),i*i+r*r<=o)||(r=e-(this.y+this.height-n),i*i+r*r<=o)||(i=t-(this.x+n),i*i+r*r<=o))return!0}return!1}strokeContains(t,e,n,i=.5){const{x:r,y:o,width:h,height:d,radius:_}=this,g=n*(1-i),l=n-g,m=r+_,y=o+_,w=h-_*2,M=d-_*2,S=r+h,A=o+d;return(t>=r-g&&t<=r+l||t>=S-l&&t<=S+g)&&e>=y&&e<=y+M||(e>=o-g&&e<=o+l||e>=A-l&&e<=A+g)&&t>=m&&t<=m+w?!0:t<m&&e<y&&ah(t,e,m,y,_,l,g)||t>S-_&&e<y&&ah(t,e,S-_,y,_,l,g)||t>S-_&&e>A-_&&ah(t,e,S-_,A-_,_,l,g)||t<m&&e>A-_&&ah(t,e,m,A-_,_,l,g)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const $g={};function $A(s,t,e){let n=2166136261;for(let i=0;i<t;i++)n^=s[i].uid,n=Math.imul(n,16777619),n>>>=0;return $g[n]||jA(s,t,n,e)}function jA(s,t,e,n){const i={};let r=0;for(let h=0;h<n;h++){const d=h<t?s[h]:Xt.EMPTY.source;i[r++]=d.source,i[r++]=d.style}const o=new dh(i);return $g[e]=o,o}class s_{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this.uint32View=null,this.float32View=null,this.uint16View=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._int32View=null,this._float64Array=null,this._bigUint64Array=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function r_(s,t){const e=s.byteLength/8|0,n=new Float64Array(s,0,e);new Float64Array(t,0,e).set(n);const r=s.byteLength-e*8;if(r>0){const o=new Uint8Array(s,e*8,r);new Uint8Array(t,e*8,r).set(o)}}const qA={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var KA=(s=>(s[s.DISABLED=0]="DISABLED",s[s.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",s[s.MASK_ACTIVE=2]="MASK_ACTIVE",s[s.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",s[s.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",s[s.NONE=5]="NONE",s))(KA||{});function i_(s,t){return t.alphaMode==="no-premultiply-alpha"&&qA[s]||s}const ZA=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function QA(s){let t="";for(let e=0;e<s;++e)e>0&&(t+=`
else `),e<s-1&&(t+=`if(test == ${e}.0){}`);return t}function JA(s,t){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const n=ZA.replace(/%forloop%/gi,QA(s));if(t.shaderSource(e,n),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))s=s/2|0;else break}}finally{t.deleteShader(e)}return s}let Zo=null;function tv(){var t;if(Zo)return Zo;const s=Ag();return Zo=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),Zo=JA(Zo,s),(t=s.getExtension("WEBGL_lose_context"))==null||t.loseContext(),Zo}class ev{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class nv{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new ev,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ml=[];let xh=0;vl.register({clear:()=>{if(ml.length>0)for(const s of ml)s&&s.destroy();ml.length=0,xh=0}});function o_(){return xh>0?ml[--xh]:new nv}function a_(s){ml[xh++]=s}let rl=0;const jg=class qg{constructor(t){this.uid=vn("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...qg.defaultOptions,...t},t.maxTextures||(jt("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=tv());const{maxTextures:e,attributesInitialSize:n,indicesInitialSize:i}=t;this.attributeBuffer=new s_(n*4),this.indexBuffer=new Uint16Array(i),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)a_(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const n=t._batch.textures.ids[e._source.uid];return!n&&n!==0?!1:(t._textureId=n,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let n=o_(),i=n.textures;i.clear();const r=e[this.elementStart];let o=i_(r.blendMode,r.texture._source),h=r.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const d=this.attributeBuffer.float32View,_=this.attributeBuffer.uint32View,g=this.indexBuffer;let l=this._batchIndexSize,m=this._batchIndexStart,y="startBatch";const w=this.maxTextures;for(let M=this.elementStart;M<this.elementSize;++M){const S=e[M];e[M]=null;const C=S.texture._source,I=i_(S.blendMode,C),O=o!==I||h!==S.topology;if(C._batchTick===rl&&!O){S._textureId=C._textureBindLocation,l+=S.indexSize,S.packAsQuad?(this.packQuadAttributes(S,d,_,S._attributeStart,S._textureId),this.packQuadIndex(g,S._indexStart,S._attributeStart/this.vertexSize)):(this.packAttributes(S,d,_,S._attributeStart,S._textureId),this.packIndex(S,g,S._indexStart,S._attributeStart/this.vertexSize)),S._batch=n;continue}C._batchTick=rl,(i.count>=w||O)&&(this._finishBatch(n,m,l-m,i,o,h,t,y),y="renderBatch",m=l,o=I,h=S.topology,n=o_(),i=n.textures,i.clear(),++rl),S._textureId=C._textureBindLocation=i.count,i.ids[C.uid]=i.count,i.textures[i.count++]=C,S._batch=n,l+=S.indexSize,S.packAsQuad?(this.packQuadAttributes(S,d,_,S._attributeStart,S._textureId),this.packQuadIndex(g,S._indexStart,S._attributeStart/this.vertexSize)):(this.packAttributes(S,d,_,S._attributeStart,S._textureId),this.packIndex(S,g,S._indexStart,S._attributeStart/this.vertexSize))}i.count>0&&(this._finishBatch(n,m,l-m,i,o,h,t,y),m=l,++rl),this.elementStart=this.elementSize,this._batchIndexStart=m,this._batchIndexSize=l}_finishBatch(t,e,n,i,r,o,h,d){t.gpuBindGroup=null,t.bindGroup=null,t.action=d,t.batcher=this,t.textures=i,t.blendMode=r,t.topology=o,t.start=e,t.size=n,++rl,this.batches[this.batchIndex++]=t,h.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),n=new s_(e);r_(this.attributeBuffer.rawBinaryData,n.rawBinaryData),this.attributeBuffer=n}_resizeIndexBuffer(t){const e=this.indexBuffer;let n=Math.max(t,e.length*1.5);n+=n%2;const i=n>65535?new Uint32Array(n):new Uint16Array(n);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let r=0;r<e.length;r++)i[r]=e[r];else r_(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,n){t[e]=n+0,t[e+1]=n+1,t[e+2]=n+2,t[e+3]=n+0,t[e+4]=n+2,t[e+5]=n+3}packIndex(t,e,n,i){const r=t.indices,o=t.indexSize,h=t.indexOffset,d=t.attributeOffset;for(let _=0;_<o;_++)e[n++]=i+r[_+h]-d}destroy(t={}){var e;if(this.batches!==null){for(let n=0;n<this.batches.length;n++)a_(this.batches[n]);this.batches=null,this.geometry.destroy(!0),this.geometry=null,t.shader&&((e=this.shader)==null||e.destroy(),this.shader=null);for(let n=0;n<this._elements.length;n++)this._elements[n]&&(this._elements[n]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};jg.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let sv=jg;var Ns=(s=>(s[s.MAP_READ=1]="MAP_READ",s[s.MAP_WRITE=2]="MAP_WRITE",s[s.COPY_SRC=4]="COPY_SRC",s[s.COPY_DST=8]="COPY_DST",s[s.INDEX=16]="INDEX",s[s.VERTEX=32]="VERTEX",s[s.UNIFORM=64]="UNIFORM",s[s.STORAGE=128]="STORAGE",s[s.INDIRECT=256]="INDIRECT",s[s.QUERY_RESOLVE=512]="QUERY_RESOLVE",s[s.STATIC=1024]="STATIC",s))(Ns||{});class wl extends Sr{constructor(t){let{data:e,size:n}=t;const{usage:i,label:r,shrinkToFit:o}=t;super(),this.uid=vn("buffer"),this._resourceType="buffer",this._resourceId=vn("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,n??(n=e==null?void 0:e.byteLength);const h=!!e;this.descriptor={size:n,usage:i,mappedAtCreation:h,label:r},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Ns.STATIC)}set static(t){t?this.descriptor.usage|=Ns.STATIC:this.descriptor.usage&=~Ns.STATIC}setDataWithSize(t,e,n){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){n&&this.emit("update",this);return}const i=this._data;if(this._data=t,this._dataInt32=null,!i||i.length!==t.length){!this.shrinkToFit&&i&&t.byteLength<i.byteLength?n&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=vn("resource"),this.emit("change",this));return}n&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Kg(s,t){if(!(s instanceof wl)){let e=t?Ns.INDEX:Ns.VERTEX;s instanceof Array&&(t?(s=new Uint32Array(s),e=Ns.INDEX|Ns.COPY_DST):(s=new Float32Array(s),e=Ns.VERTEX|Ns.COPY_DST)),s=new wl({data:s,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return s}function rv(s,t,e){const n=s.getAttribute(t);if(!n)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const i=n.buffer.data;let r=1/0,o=1/0,h=-1/0,d=-1/0;const _=i.BYTES_PER_ELEMENT,g=(n.offset||0)/_,l=(n.stride||2*4)/_;for(let m=g;m<i.length;m+=l){const y=i[m],w=i[m+1];y>h&&(h=y),w>d&&(d=w),y<r&&(r=y),w<o&&(o=w)}return e.minX=r,e.minY=o,e.maxX=h,e.maxY=d,e}function iv(s){return(s instanceof wl||Array.isArray(s)||s.BYTES_PER_ELEMENT)&&(s={buffer:s}),s.buffer=Kg(s.buffer,!1),s}class ov extends Sr{constructor(t={}){super(),this.uid=vn("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new wr,this._boundsDirty=!0;const{attributes:e,indexBuffer:n,topology:i}=t;if(this.buffers=[],this.attributes={},e)for(const r in e)this.addAttribute(r,e[r]);this.instanceCount=t.instanceCount??1,n&&this.addIndex(n),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const n=iv(e);this.buffers.indexOf(n.buffer)===-1&&(this.buffers.push(n.buffer),n.buffer.on("update",this.onBufferUpdate,this),n.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=n}addIndex(t){this.indexBuffer=Kg(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,rv(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(n=>n.destroy()),(e=this.indexBuffer)==null||e.destroy(),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const av=new Float32Array(1),lv=new Uint32Array(1);class cv extends ov{constructor(){const e=new wl({data:av,label:"attribute-batch-buffer",usage:Ns.VERTEX|Ns.COPY_DST,shrinkToFit:!1}),n=new wl({data:lv,label:"index-batch-buffer",usage:Ns.INDEX|Ns.COPY_DST,shrinkToFit:!1}),i=6*4;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:i,offset:0},aUV:{buffer:e,format:"float32x2",stride:i,offset:2*4},aColor:{buffer:e,format:"unorm8x4",stride:i,offset:4*4},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:i,offset:5*4}},indexBuffer:n})}}function l_(s,t,e){if(s)for(const n in s){const i=n.toLocaleLowerCase(),r=t[i];if(r){let o=s[n];n==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&r.push(`//----${e}----//`),r.push(o)}else an(`${n} placement hook does not exist in shader`)}}const hv=/\{\{(.*?)\}\}/g;function c_(s){var n;const t={};return(((n=s.match(hv))==null?void 0:n.map(i=>i.replace(/[{()}]/g,"")))??[]).forEach(i=>{t[i]=[]}),t}function h_(s,t){let e;const n=/@in\s+([^;]+);/g;for(;(e=n.exec(s))!==null;)t.push(e[1])}function u_(s,t,e=!1){const n=[];h_(t,n),s.forEach(h=>{h.header&&h_(h.header,n)});const i=n;e&&i.sort();const r=i.map((h,d)=>`       @location(${d}) ${h},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${r}
`),o}function d_(s,t){let e;const n=/@out\s+([^;]+);/g;for(;(e=n.exec(s))!==null;)t.push(e[1])}function uv(s){const e=/\b(\w+)\s*:/g.exec(s);return e?e[1]:""}function dv(s){const t=/@.*?\s+/g;return s.replace(t,"")}function fv(s,t){const e=[];d_(t,e),s.forEach(d=>{d.header&&d_(d.header,e)});let n=0;const i=e.sort().map(d=>d.indexOf("builtin")>-1?d:`@location(${n++}) ${d}`).join(`,
`),r=e.sort().map(d=>`       var ${dv(d)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(d=>` ${uv(d)}`).join(`,
`)});`;let h=t.replace(/@out\s+[^;]+;\s*/g,"");return h=h.replace("{{struct}}",`
${i}
`),h=h.replace("{{start}}",`
${r}
`),h=h.replace("{{return}}",`
${o}
`),h}function f_(s,t){let e=s;for(const n in t){const i=t[n];i.join(`
`).length?e=e.replace(`{{${n}}}`,`//-----${n} START-----//
${i.join(`
`)}
//----${n} FINISH----//`):e=e.replace(`{{${n}}}`,"")}return e}const Hi=Object.create(null),Md=new Map;let pv=0;function mv({template:s,bits:t}){const e=Zg(s,t);if(Hi[e])return Hi[e];const{vertex:n,fragment:i}=gv(s,t);return Hi[e]=Qg(n,i,t),Hi[e]}function _v({template:s,bits:t}){const e=Zg(s,t);return Hi[e]||(Hi[e]=Qg(s.vertex,s.fragment,t)),Hi[e]}function gv(s,t){const e=t.map(o=>o.vertex).filter(o=>!!o),n=t.map(o=>o.fragment).filter(o=>!!o);let i=u_(e,s.vertex,!0);i=fv(e,i);const r=u_(n,s.fragment,!0);return{vertex:i,fragment:r}}function Zg(s,t){return t.map(e=>(Md.has(e)||Md.set(e,pv++),Md.get(e))).sort((e,n)=>e-n).join("-")+s.vertex+s.fragment}function Qg(s,t,e){const n=c_(s),i=c_(t);return e.forEach(r=>{l_(r.vertex,n,r.name),l_(r.fragment,i,r.name)}),{vertex:f_(s,n),fragment:f_(t,i)}}const yv=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,xv=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,bv=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,wv=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Sv={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Mv={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Av({bits:s,name:t}){const e=mv({template:{fragment:xv,vertex:yv},bits:[Sv,...s]});return ca.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function vv({bits:s,name:t}){return new Ah({name:t,..._v({template:{vertex:bv,fragment:wv},bits:[Mv,...s]})})}const Tv={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Cv={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},Ad={};function Ev(s){const t=[];if(s===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let n=0;n<s;n++)t.push(`@group(1) @binding(${e++}) var textureSource${n+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${n+1}: sampler;`)}return t.join(`
`)}function Pv(s){const t=[];if(s===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<s;e++)e===s-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Iv(s){return Ad[s]||(Ad[s]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${Ev(s)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${Pv(s)}
            `}}),Ad[s]}const vd={};function kv(s){const t=[];for(let e=0;e<s;e++)e>0&&t.push("else"),e<s-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function Lv(s){return vd[s]||(vd[s]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${s}];

            `,main:`

                ${kv(s)}
            `}}),vd[s]}const Fv={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Ov={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},p_={};function Rv(s){let t=p_[s];if(t)return t;const e=new Int32Array(s);for(let n=0;n<s;n++)e[n]=n;return t=p_[s]=new Pg({uTextures:{value:e,type:"i32",size:s}},{isStatic:!0}),t}class m_ extends vh{constructor(t){const e=vv({name:"batch",bits:[Cv,Lv(t),Ov]}),n=Av({name:"batch",bits:[Tv,Iv(t),Fv]});super({glProgram:e,gpuProgram:n,resources:{batchSamplers:Rv(t)}}),this.maxTextures=t}}let il=null;const Jg=class ty extends sv{constructor(t){super(t),this.geometry=new cv,this.name=ty.extension.name,this.vertexSize=6,il??(il=new m_(t.maxTextures)),this.shader=il}packAttributes(t,e,n,i,r){const o=r<<16|t.roundPixels&65535,h=t.transform,d=h.a,_=h.b,g=h.c,l=h.d,m=h.tx,y=h.ty,{positions:w,uvs:M}=t,S=t.color,A=t.attributeOffset,C=A+t.attributeSize;for(let I=A;I<C;I++){const O=I*2,$=w[O],W=w[O+1];e[i++]=d*$+g*W+m,e[i++]=l*W+_*$+y,e[i++]=M[O],e[i++]=M[O+1],n[i++]=S,n[i++]=o}}packQuadAttributes(t,e,n,i,r){const o=t.texture,h=t.transform,d=h.a,_=h.b,g=h.c,l=h.d,m=h.tx,y=h.ty,w=t.bounds,M=w.maxX,S=w.minX,A=w.maxY,C=w.minY,I=o.uvs,O=t.color,$=r<<16|t.roundPixels&65535;e[i+0]=d*S+g*C+m,e[i+1]=l*C+_*S+y,e[i+2]=I.x0,e[i+3]=I.y0,n[i+4]=O,n[i+5]=$,e[i+6]=d*M+g*C+m,e[i+7]=l*C+_*M+y,e[i+8]=I.x1,e[i+9]=I.y1,n[i+10]=O,n[i+11]=$,e[i+12]=d*M+g*A+m,e[i+13]=l*A+_*M+y,e[i+14]=I.x2,e[i+15]=I.y2,n[i+16]=O,n[i+17]=$,e[i+18]=d*S+g*A+m,e[i+19]=l*A+_*S+y,e[i+20]=I.x3,e[i+21]=I.y3,n[i+22]=O,n[i+23]=$}_updateMaxTextures(t){this.shader.maxTextures!==t&&(il=new m_(t),this.shader=il)}destroy(){this.shader=null,super.destroy()}};Jg.extension={type:[kt.Batcher],name:"default"};let Bv=Jg;function Nv(s,t,e,n,i,r,o,h=null){let d=0;e*=t,i*=r;const _=h.a,g=h.b,l=h.c,m=h.d,y=h.tx,w=h.ty;for(;d<o;){const M=s[e],S=s[e+1];n[i]=_*M+l*S+y,n[i+1]=g*M+m*S+w,i+=r,e+=t,d++}}function Wv(s,t,e,n){let i=0;for(t*=e;i<n;)s[t]=0,s[t+1]=0,t+=e,i++}function ey(s,t,e,n,i){const r=t.a,o=t.b,h=t.c,d=t.d,_=t.tx,g=t.ty;e||(e=0),n||(n=2),i||(i=s.length/n-e);let l=e*n;for(let m=0;m<i;m++){const y=s[l],w=s[l+1];s[l]=r*y+h*w+_,s[l+1]=o*y+d*w+g,l+=n}}const Dv=new fe;class ny{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,n=this.renderable;return n?ig(e,n.groupColor)+(this.alpha*n.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||Dv}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Sl={extension:{type:kt.ShapeBuilder,name:"circle"},build(s,t){let e,n,i,r,o,h;if(s.type==="circle"){const O=s;if(o=h=O.radius,o<=0)return!1;e=O.x,n=O.y,i=r=0}else if(s.type==="ellipse"){const O=s;if(o=O.halfWidth,h=O.halfHeight,o<=0||h<=0)return!1;e=O.x,n=O.y,i=r=0}else{const O=s,$=O.width/2,W=O.height/2;e=O.x+$,n=O.y+W,o=h=Math.max(0,Math.min(O.radius,Math.min($,W))),i=$-o,r=W-h}if(i<0||r<0)return!1;const d=Math.ceil(2.3*Math.sqrt(o+h)),_=d*8+(i?4:0)+(r?4:0);if(_===0)return!1;if(d===0)return t[0]=t[6]=e+i,t[1]=t[3]=n+r,t[2]=t[4]=e-i,t[5]=t[7]=n-r,!0;let g=0,l=d*4+(i?2:0)+2,m=l,y=_,w=i+o,M=r,S=e+w,A=e-w,C=n+M;if(t[g++]=S,t[g++]=C,t[--l]=C,t[--l]=A,r){const O=n-M;t[m++]=A,t[m++]=O,t[--y]=O,t[--y]=S}for(let O=1;O<d;O++){const $=Math.PI/2*(O/d),W=i+Math.cos($)*o,G=r+Math.sin($)*h,lt=e+W,J=e-W,st=n+G,tt=n-G;t[g++]=lt,t[g++]=st,t[--l]=st,t[--l]=J,t[m++]=J,t[m++]=tt,t[--y]=tt,t[--y]=lt}w=i,M=r+h,S=e+w,A=e-w,C=n+M;const I=n-M;return t[g++]=S,t[g++]=C,t[--y]=I,t[--y]=S,i&&(t[g++]=A,t[g++]=C,t[--y]=I,t[--y]=A),!0},triangulate(s,t,e,n,i,r){if(s.length===0)return;let o=0,h=0;for(let g=0;g<s.length;g+=2)o+=s[g],h+=s[g+1];o/=s.length/2,h/=s.length/2;let d=n;t[d*e]=o,t[d*e+1]=h;const _=d++;for(let g=0;g<s.length;g+=2)t[d*e]=s[g],t[d*e+1]=s[g+1],g>0&&(i[r++]=d,i[r++]=_,i[r++]=d-1),d++;i[r++]=_+1,i[r++]=_,i[r++]=d-1}},Gv={...Sl,extension:{...Sl.extension,name:"ellipse"}},Hv={...Sl,extension:{...Sl.extension,name:"roundedRectangle"}},sy=1e-4,__=1e-4;function Uv(s){const t=s.length;if(t<6)return 1;let e=0;for(let n=0,i=s[t-2],r=s[t-1];n<t;n+=2){const o=s[n],h=s[n+1];e+=(o-i)*(h+r),i=o,r=h}return e<0?-1:1}function g_(s,t,e,n,i,r,o,h){const d=s-e*i,_=t-n*i,g=s+e*r,l=t+n*r;let m,y;o?(m=n,y=-e):(m=-n,y=e);const w=d+m,M=_+y,S=g+m,A=l+y;return h.push(w,M),h.push(S,A),2}function lo(s,t,e,n,i,r,o,h){const d=e-s,_=n-t;let g=Math.atan2(d,_),l=Math.atan2(i-s,r-t);h&&g<l?g+=Math.PI*2:!h&&g>l&&(l+=Math.PI*2);let m=g;const y=l-g,w=Math.abs(y),M=Math.sqrt(d*d+_*_),S=(15*w*Math.sqrt(M)/Math.PI>>0)+1,A=y/S;if(m+=A,h){o.push(s,t),o.push(e,n);for(let C=1,I=m;C<S;C++,I+=A)o.push(s,t),o.push(s+Math.sin(I)*M,t+Math.cos(I)*M);o.push(s,t),o.push(i,r)}else{o.push(e,n),o.push(s,t);for(let C=1,I=m;C<S;C++,I+=A)o.push(s+Math.sin(I)*M,t+Math.cos(I)*M),o.push(s,t);o.push(i,r),o.push(s,t)}return S*2}function Yv(s,t,e,n,i,r){const o=sy;if(s.length===0)return;const h=t;let d=h.alignment;if(t.alignment!==.5){let pt=Uv(s);d=(d-.5)*pt+.5}const _=new ms(s[0],s[1]),g=new ms(s[s.length-2],s[s.length-1]),l=n,m=Math.abs(_.x-g.x)<o&&Math.abs(_.y-g.y)<o;if(l){s=s.slice(),m&&(s.pop(),s.pop(),g.set(s[s.length-2],s[s.length-1]));const pt=(_.x+g.x)*.5,ae=(g.y+_.y)*.5;s.unshift(pt,ae),s.push(pt,ae)}const y=i,w=s.length/2;let M=s.length;const S=y.length/2,A=h.width/2,C=A*A,I=h.miterLimit*h.miterLimit;let O=s[0],$=s[1],W=s[2],G=s[3],lt=0,J=0,st=-($-G),tt=O-W,P=0,wt=0,vt=Math.sqrt(st*st+tt*tt);st/=vt,tt/=vt,st*=A,tt*=A;const ut=d,z=(1-ut)*2,B=ut*2;l||(h.cap==="round"?M+=lo(O-st*(z-B)*.5,$-tt*(z-B)*.5,O-st*z,$-tt*z,O+st*B,$+tt*B,y,!0)+2:h.cap==="square"&&(M+=g_(O,$,st,tt,z,B,!0,y))),y.push(O-st*z,$-tt*z),y.push(O+st*B,$+tt*B);for(let pt=1;pt<w-1;++pt){O=s[(pt-1)*2],$=s[(pt-1)*2+1],W=s[pt*2],G=s[pt*2+1],lt=s[(pt+1)*2],J=s[(pt+1)*2+1],st=-($-G),tt=O-W,vt=Math.sqrt(st*st+tt*tt),st/=vt,tt/=vt,st*=A,tt*=A,P=-(G-J),wt=W-lt,vt=Math.sqrt(P*P+wt*wt),P/=vt,wt/=vt,P*=A,wt*=A;const ae=W-O,Dt=$-G,Yt=W-lt,fn=J-G,Ie=ae*Yt+Dt*fn,Tn=Dt*Yt-fn*ae,se=Tn<0;if(Math.abs(Tn)<.001*Math.abs(Ie)){y.push(W-st*z,G-tt*z),y.push(W+st*B,G+tt*B),Ie>=0&&(h.join==="round"?M+=lo(W,G,W-st*z,G-tt*z,W-P*z,G-wt*z,y,!1)+4:M+=2,y.push(W-P*B,G-wt*B),y.push(W+P*z,G+wt*z));continue}const pn=(-st+O)*(-tt+G)-(-st+W)*(-tt+$),_e=(-P+lt)*(-wt+G)-(-P+W)*(-wt+J),mn=(ae*_e-Yt*pn)/Tn,Ae=(fn*pn-Dt*_e)/Tn,jn=(mn-W)*(mn-W)+(Ae-G)*(Ae-G),Wt=W+(mn-W)*z,Re=G+(Ae-G)*z,Ln=W-(mn-W)*B,ge=G-(Ae-G)*B,ke=Math.min(ae*ae+Dt*Dt,Yt*Yt+fn*fn),pe=se?z:B,de=ke+pe*pe*C;jn<=de?h.join==="bevel"||jn/C>I?(se?(y.push(Wt,Re),y.push(W+st*B,G+tt*B),y.push(Wt,Re),y.push(W+P*B,G+wt*B)):(y.push(W-st*z,G-tt*z),y.push(Ln,ge),y.push(W-P*z,G-wt*z),y.push(Ln,ge)),M+=2):h.join==="round"?se?(y.push(Wt,Re),y.push(W+st*B,G+tt*B),M+=lo(W,G,W+st*B,G+tt*B,W+P*B,G+wt*B,y,!0)+4,y.push(Wt,Re),y.push(W+P*B,G+wt*B)):(y.push(W-st*z,G-tt*z),y.push(Ln,ge),M+=lo(W,G,W-st*z,G-tt*z,W-P*z,G-wt*z,y,!1)+4,y.push(W-P*z,G-wt*z),y.push(Ln,ge)):(y.push(Wt,Re),y.push(Ln,ge)):(y.push(W-st*z,G-tt*z),y.push(W+st*B,G+tt*B),h.join==="round"?se?M+=lo(W,G,W+st*B,G+tt*B,W+P*B,G+wt*B,y,!0)+2:M+=lo(W,G,W-st*z,G-tt*z,W-P*z,G-wt*z,y,!1)+2:h.join==="miter"&&jn/C<=I&&(se?(y.push(Ln,ge),y.push(Ln,ge)):(y.push(Wt,Re),y.push(Wt,Re)),M+=2),y.push(W-P*z,G-wt*z),y.push(W+P*B,G+wt*B),M+=2)}O=s[(w-2)*2],$=s[(w-2)*2+1],W=s[(w-1)*2],G=s[(w-1)*2+1],st=-($-G),tt=O-W,vt=Math.sqrt(st*st+tt*tt),st/=vt,tt/=vt,st*=A,tt*=A,y.push(W-st*z,G-tt*z),y.push(W+st*B,G+tt*B),l||(h.cap==="round"?M+=lo(W-st*(z-B)*.5,G-tt*(z-B)*.5,W-st*z,G-tt*z,W+st*B,G+tt*B,y,!1)+2:h.cap==="square"&&(M+=g_(W,G,st,tt,z,B,!1,y)));const St=__*__;for(let pt=S;pt<M+S-2;++pt)O=y[pt*2],$=y[pt*2+1],W=y[(pt+1)*2],G=y[(pt+1)*2+1],lt=y[(pt+2)*2],J=y[(pt+2)*2+1],!(Math.abs(O*(G-J)+W*(J-$)+lt*($-G))<St)&&r.push(pt,pt+1,pt+2)}function Xv(s,t,e,n){const i=sy;if(s.length===0)return;const r=s[0],o=s[1],h=s[s.length-2],d=s[s.length-1],_=t||Math.abs(r-h)<i&&Math.abs(o-d)<i,g=e,l=s.length/2,m=g.length/2;for(let y=0;y<l;y++)g.push(s[y*2]),g.push(s[y*2+1]);for(let y=0;y<l-1;y++)n.push(m+y,m+y+1);_&&n.push(m+l-1,m)}function ry(s,t,e,n,i,r,o){const h=CA(s,t,2);if(!h)return;for(let _=0;_<h.length;_+=3)r[o++]=h[_]+i,r[o++]=h[_+1]+i,r[o++]=h[_+2]+i;let d=i*n;for(let _=0;_<s.length;_+=2)e[d]=s[_],e[d+1]=s[_+1],d+=n}const zv=[],Vv={extension:{type:kt.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,n,i,r){ry(s,zv,t,e,n,i,r)}},$v={extension:{type:kt.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,n=e.x,i=e.y,r=e.width,o=e.height;return r>0&&o>0?(t[0]=n,t[1]=i,t[2]=n+r,t[3]=i,t[4]=n+r,t[5]=i+o,t[6]=n,t[7]=i+o,!0):!1},triangulate(s,t,e,n,i,r){let o=0;n*=e,t[n+o]=s[0],t[n+o+1]=s[1],o+=e,t[n+o]=s[2],t[n+o+1]=s[3],o+=e,t[n+o]=s[6],t[n+o+1]=s[7],o+=e,t[n+o]=s[4],t[n+o+1]=s[5],o+=e;const h=n/e;i[r++]=h,i[r++]=h+1,i[r++]=h+2,i[r++]=h+1,i[r++]=h+3,i[r++]=h+2}},jv={extension:{type:kt.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,n,i,r){let o=0;n*=e,t[n+o]=s[0],t[n+o+1]=s[1],o+=e,t[n+o]=s[2],t[n+o+1]=s[3],o+=e,t[n+o]=s[4],t[n+o+1]=s[5];const h=n/e;i[r++]=h,i[r++]=h+1,i[r++]=h+2}},qv=new fe,Kv=new $t;function Zv(s,t,e,n){const i=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const o=e.getBounds(Kv);t.width&&o.pad(t.width);const{x:h,y:d}=o,_=1/o.width,g=1/o.height,l=-h*_,m=-d*g,y=i.a,w=i.b,M=i.c,S=i.d;i.a*=_,i.b*=_,i.c*=g,i.d*=g,i.tx=l*y+m*M+i.tx,i.ty=l*w+m*S+i.ty}else i.translate(t.texture.frame.x,t.texture.frame.y),i.scale(1/t.texture.source.width,1/t.texture.source.height);const r=t.texture.source.style;return!(t.fill instanceof mi)&&r.addressMode==="clamp-to-edge"&&(r.addressMode="repeat",r.update()),n&&i.append(qv.copyFrom(n).invert()),i}const Ch={};us.handleByMap(kt.ShapeBuilder,Ch);us.add($v,Vv,jv,Sl,Gv,Hv);const Qv=new $t,Jv=new fe;function tT(s,t){const{geometryData:e,batches:n}=t;n.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let i=0;i<s.instructions.length;i++){const r=s.instructions[i];if(r.action==="texture")eT(r.data,n,e);else if(r.action==="fill"||r.action==="stroke"){const o=r.action==="stroke",h=r.data.path.shapePath,d=r.data.style,_=r.data.hole;o&&_&&y_(_.shapePath,d,!0,n,e),_&&(h.shapePrimitives[h.shapePrimitives.length-1].holes=_.shapePath.shapePrimitives),y_(h,d,o,n,e)}}}function eT(s,t,e){const n=[],i=Ch.rectangle,r=Qv;r.x=s.dx,r.y=s.dy,r.width=s.dw,r.height=s.dh;const o=s.transform;if(!i.build(r,n))return;const{vertices:h,uvs:d,indices:_}=e,g=_.length,l=h.length/2;o&&ey(n,o),i.triangulate(n,h,2,l,_,g);const m=s.image,y=m.uvs;d.push(y.x0,y.y0,y.x1,y.y1,y.x3,y.y3,y.x2,y.y2);const w=hr.get(ny);w.indexOffset=g,w.indexSize=_.length-g,w.attributeOffset=l,w.attributeSize=h.length/2-l,w.baseColor=s.style,w.alpha=s.alpha,w.texture=m,w.geometryData=e,t.push(w)}function y_(s,t,e,n,i){const{vertices:r,uvs:o,indices:h}=i;s.shapePrimitives.forEach(({shape:d,transform:_,holes:g})=>{const l=[],m=Ch[d.type];if(!m.build(d,l))return;const y=h.length,w=r.length/2;let M="triangle-list";if(_&&ey(l,_),e){const I=d.closePath??!0,O=t;O.pixelLine?(Xv(l,I,r,h),M="line-list"):Yv(l,O,!1,I,r,h)}else if(g){const I=[],O=l.slice();nT(g).forEach(W=>{I.push(O.length/2),O.push(...W)}),ry(O,I,r,2,w,h,y)}else m.triangulate(l,r,2,w,h,y);const S=o.length/2,A=t.texture;if(A!==Xt.WHITE){const I=Zv(Jv,t,d,_);Nv(r,2,w,o,S,2,r.length/2-w,I)}else Wv(o,S,2,r.length/2-w);const C=hr.get(ny);C.indexOffset=y,C.indexSize=h.length-y,C.attributeOffset=w,C.attributeSize=r.length/2-w,C.baseColor=t.color,C.alpha=t.alpha,C.texture=A,C.geometryData=i,C.topology=M,n.push(C)})}function nT(s){const t=[];for(let e=0;e<s.length;e++){const n=s[e].shape,i=[];Ch[n.type].build(n,i)&&t.push(i)}return t}class sT{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class rT{constructor(){this.instructions=new cg}init(t){const e=t.maxTextures;this.batcher?this.batcher._updateMaxTextures(e):this.batcher=new Bv({maxTextures:e}),this.instructions.reset()}get geometry(){return jt(KS,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const cf=class qd{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){qd.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??qd.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),tT(t,e);const n=t.batchMode;t.customShader||n==="no-batch"?e.isBatchable=!1:n==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=hr.get(rT,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:n,geometryData:i}=this._gpuContextHash[t.uid],r=i.vertices.length,o=i.indices.length;for(let g=0;g<n.length;g++)n[g].applyTransform=!1;const h=e.batcher;h.ensureAttributeBuffer(r),h.ensureIndexBuffer(o),h.begin();for(let g=0;g<n.length;g++){const l=n[g];h.add(l)}h.finish(e.instructions);const d=h.geometry;d.indexBuffer.setDataWithSize(h.indexBuffer,h.indexSize,!0),d.buffers[0].setDataWithSize(h.attributeBuffer.float32View,h.attributeSize,!0);const _=h.batches;for(let g=0;g<_.length;g++){const l=_[g];l.bindGroup=$A(l.textures.textures,l.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new sT;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(hr.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(n=>{hr.return(n)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context);this._gpuContextHash={},this._graphicsDataContextHash={},this._renderer=null}};cf.extension={type:[kt.WebGLSystem,kt.WebGPUSystem,kt.CanvasSystem],name:"graphicsContext"};cf.defaultOptions={bezierSmoothness:.5};let iy=cf;const iT=8,lh=11920929e-14,oT=1;function oy(s,t,e,n,i,r,o,h,d,_){const l=Math.min(.99,Math.max(0,_??iy.defaultOptions.bezierSmoothness));let m=(oT-l)/1;return m*=m,aT(t,e,n,i,r,o,h,d,s,m),s}function aT(s,t,e,n,i,r,o,h,d,_){Kd(s,t,e,n,i,r,o,h,d,_,0),d.push(o,h)}function Kd(s,t,e,n,i,r,o,h,d,_,g){if(g>iT)return;const l=(s+e)/2,m=(t+n)/2,y=(e+i)/2,w=(n+r)/2,M=(i+o)/2,S=(r+h)/2,A=(l+y)/2,C=(m+w)/2,I=(y+M)/2,O=(w+S)/2,$=(A+I)/2,W=(C+O)/2;if(g>0){let G=o-s,lt=h-t;const J=Math.abs((e-o)*lt-(n-h)*G),st=Math.abs((i-o)*lt-(r-h)*G);if(J>lh&&st>lh){if((J+st)*(J+st)<=_*(G*G+lt*lt)){d.push($,W);return}}else if(J>lh){if(J*J<=_*(G*G+lt*lt)){d.push($,W);return}}else if(st>lh){if(st*st<=_*(G*G+lt*lt)){d.push($,W);return}}else if(G=$-(s+o)/2,lt=W-(t+h)/2,G*G+lt*lt<=_){d.push($,W);return}}Kd(s,t,l,m,A,C,$,W,d,_,g+1),Kd($,W,I,O,M,S,o,h,d,_,g+1)}const lT=8,cT=11920929e-14,hT=1;function uT(s,t,e,n,i,r,o,h){const _=Math.min(.99,Math.max(0,h??iy.defaultOptions.bezierSmoothness));let g=(hT-_)/1;return g*=g,dT(t,e,n,i,r,o,s,g),s}function dT(s,t,e,n,i,r,o,h){Zd(o,s,t,e,n,i,r,h,0),o.push(i,r)}function Zd(s,t,e,n,i,r,o,h,d){if(d>lT)return;const _=(t+n)/2,g=(e+i)/2,l=(n+r)/2,m=(i+o)/2,y=(_+l)/2,w=(g+m)/2;let M=r-t,S=o-e;const A=Math.abs((n-r)*S-(i-o)*M);if(A>cT){if(A*A<=h*(M*M+S*S)){s.push(y,w);return}}else if(M=y-(t+r)/2,S=w-(e+o)/2,M*M+S*S<=h){s.push(y,w);return}Zd(s,t,e,_,g,y,w,h,d+1),Zd(s,y,w,l,m,r,o,h,d+1)}function ay(s,t,e,n,i,r,o,h){let d=Math.abs(i-r);(!o&&i>r||o&&r>i)&&(d=2*Math.PI-d),h||(h=Math.max(6,Math.floor(6*Math.pow(n,1/3)*(d/Math.PI)))),h=Math.max(h,3);let _=d/h,g=i;_*=o?-1:1;for(let l=0;l<h+1;l++){const m=Math.cos(g),y=Math.sin(g),w=t+m*n,M=e+y*n;s.push(w,M),g+=_}}function fT(s,t,e,n,i,r){const o=s[s.length-2],d=s[s.length-1]-e,_=o-t,g=i-e,l=n-t,m=Math.abs(d*l-_*g);if(m<1e-8||r===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const y=d*d+_*_,w=g*g+l*l,M=d*g+_*l,S=r*Math.sqrt(y)/m,A=r*Math.sqrt(w)/m,C=S*M/y,I=A*M/w,O=S*l+A*_,$=S*g+A*d,W=_*(A+C),G=d*(A+C),lt=l*(S+I),J=g*(S+I),st=Math.atan2(G-$,W-O),tt=Math.atan2(J-$,lt-O);ay(s,O+t,$+e,r,st,tt,_*g>l*d)}const _l=Math.PI*2,Td={centerX:0,centerY:0,ang1:0,ang2:0},Cd=({x:s,y:t},e,n,i,r,o,h,d)=>{s*=e,t*=n;const _=i*s-r*t,g=r*s+i*t;return d.x=_+o,d.y=g+h,d};function pT(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),n=t===1.5707963267948966?.551915024494:e,i=Math.cos(s),r=Math.sin(s),o=Math.cos(s+t),h=Math.sin(s+t);return[{x:i-r*n,y:r+i*n},{x:o+h*n,y:h-o*n},{x:o,y:h}]}const x_=(s,t,e,n)=>{const i=s*n-t*e<0?-1:1;let r=s*e+t*n;return r>1&&(r=1),r<-1&&(r=-1),i*Math.acos(r)},mT=(s,t,e,n,i,r,o,h,d,_,g,l,m)=>{const y=Math.pow(i,2),w=Math.pow(r,2),M=Math.pow(g,2),S=Math.pow(l,2);let A=y*w-y*S-w*M;A<0&&(A=0),A/=y*S+w*M,A=Math.sqrt(A)*(o===h?-1:1);const C=A*i/r*l,I=A*-r/i*g,O=_*C-d*I+(s+e)/2,$=d*C+_*I+(t+n)/2,W=(g-C)/i,G=(l-I)/r,lt=(-g-C)/i,J=(-l-I)/r,st=x_(1,0,W,G);let tt=x_(W,G,lt,J);h===0&&tt>0&&(tt-=_l),h===1&&tt<0&&(tt+=_l),m.centerX=O,m.centerY=$,m.ang1=st,m.ang2=tt};function _T(s,t,e,n,i,r,o,h=0,d=0,_=0){if(r===0||o===0)return;const g=Math.sin(h*_l/360),l=Math.cos(h*_l/360),m=l*(t-n)/2+g*(e-i)/2,y=-g*(t-n)/2+l*(e-i)/2;if(m===0&&y===0)return;r=Math.abs(r),o=Math.abs(o);const w=Math.pow(m,2)/Math.pow(r,2)+Math.pow(y,2)/Math.pow(o,2);w>1&&(r*=Math.sqrt(w),o*=Math.sqrt(w)),mT(t,e,n,i,r,o,d,_,g,l,m,y,Td);let{ang1:M,ang2:S}=Td;const{centerX:A,centerY:C}=Td;let I=Math.abs(S)/(_l/4);Math.abs(1-I)<1e-7&&(I=1);const O=Math.max(Math.ceil(I),1);S/=O;let $=s[s.length-2],W=s[s.length-1];const G={x:0,y:0};for(let lt=0;lt<O;lt++){const J=pT(M,S),{x:st,y:tt}=Cd(J[0],r,o,l,g,A,C,G),{x:P,y:wt}=Cd(J[1],r,o,l,g,A,C,G),{x:vt,y:ut}=Cd(J[2],r,o,l,g,A,C,G);oy(s,$,W,st,tt,P,wt,vt,ut),$=vt,W=ut,M+=S}}function gT(s,t,e){const n=(o,h)=>{const d=h.x-o.x,_=h.y-o.y,g=Math.sqrt(d*d+_*_),l=d/g,m=_/g;return{len:g,nx:l,ny:m}},i=(o,h)=>{o===0?s.moveTo(h.x,h.y):s.lineTo(h.x,h.y)};let r=t[t.length-1];for(let o=0;o<t.length;o++){const h=t[o%t.length],d=h.radius??e;if(d<=0){i(o,h),r=h;continue}const _=t[(o+1)%t.length],g=n(h,r),l=n(h,_);if(g.len<1e-4||l.len<1e-4){i(o,h),r=h;continue}let m=Math.asin(g.nx*l.ny-g.ny*l.nx),y=1,w=!1;g.nx*l.nx-g.ny*-l.ny<0?m<0?m=Math.PI+m:(m=Math.PI-m,y=-1,w=!0):m>0&&(y=-1,w=!0);const M=m/2;let S,A=Math.abs(Math.cos(M)*d/Math.sin(M));A>Math.min(g.len/2,l.len/2)?(A=Math.min(g.len/2,l.len/2),S=Math.abs(A*Math.sin(M)/Math.cos(M))):S=d;const C=h.x+l.nx*A+-l.ny*S*y,I=h.y+l.ny*A+l.nx*S*y,O=Math.atan2(g.ny,g.nx)+Math.PI/2*y,$=Math.atan2(l.ny,l.nx)-Math.PI/2*y;o===0&&s.moveTo(C+Math.cos(O)*S,I+Math.sin(O)*S),s.arc(C,I,S,O,$,w),r=h}}function yT(s,t,e,n){const i=(h,d)=>Math.sqrt((h.x-d.x)**2+(h.y-d.y)**2),r=(h,d,_)=>({x:h.x+(d.x-h.x)*_,y:h.y+(d.y-h.y)*_}),o=t.length;for(let h=0;h<o;h++){const d=t[(h+1)%o],_=d.radius??e;if(_<=0){h===0?s.moveTo(d.x,d.y):s.lineTo(d.x,d.y);continue}const g=t[h],l=t[(h+2)%o],m=i(g,d);let y;if(m<1e-4)y=d;else{const S=Math.min(m/2,_);y=r(d,g,S/m)}const w=i(l,d);let M;if(w<1e-4)M=d;else{const S=Math.min(w/2,_);M=r(d,l,S/w)}h===0?s.moveTo(y.x,y.y):s.lineTo(y.x,y.y),s.quadraticCurveTo(d.x,d.y,M.x,M.y,n)}}const xT=new $t;class bT{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new wr,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const n=this._currentPoly.points,i=n[n.length-2],r=n[n.length-1];return(i!==t||r!==e)&&n.push(t,e),this}arc(t,e,n,i,r,o){this._ensurePoly(!1);const h=this._currentPoly.points;return ay(h,t,e,n,i,r,o),this}arcTo(t,e,n,i,r){this._ensurePoly();const o=this._currentPoly.points;return fT(o,t,e,n,i,r),this}arcToSvg(t,e,n,i,r,o,h){const d=this._currentPoly.points;return _T(d,this._currentPoly.lastX,this._currentPoly.lastY,o,h,t,e,n,i,r),this}bezierCurveTo(t,e,n,i,r,o,h){this._ensurePoly();const d=this._currentPoly;return oy(this._currentPoly.points,d.lastX,d.lastY,t,e,n,i,r,o,h),this}quadraticCurveTo(t,e,n,i,r){this._ensurePoly();const o=this._currentPoly;return uT(this._currentPoly.points,o.lastX,o.lastY,t,e,n,i,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const n=this.shapePrimitives,i=n.length;for(let r=0;r<t.instructions.length;r++){const o=t.instructions[r];this[o.action](...o.data)}if(t.checkForHoles&&n.length-i>1){let r=null;for(let o=i;o<n.length;o++){const h=n[o];if(h.shape.type==="polygon"){const d=h.shape,_=r==null?void 0:r.shape;_&&_.containsPolygon(d)?(r.holes||(r.holes=[]),r.holes.push(h),n.copyWithin(o,o+1),n.length--,o--):r=h}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,n,i,r){return this.drawShape(new $t(t,e,n,i),r),this}circle(t,e,n,i){return this.drawShape(new of(t,e,n),i),this}poly(t,e,n){const i=new pl(t);return i.closePath=e,this.drawShape(i,n),this}regularPoly(t,e,n,i,r=0,o){i=Math.max(i|0,3);const h=-1*Math.PI/2+r,d=Math.PI*2/i,_=[];for(let g=0;g<i;g++){const l=h-g*d;_.push(t+n*Math.cos(l),e+n*Math.sin(l))}return this.poly(_,!0,o),this}roundPoly(t,e,n,i,r,o=0,h){if(i=Math.max(i|0,3),r<=0)return this.regularPoly(t,e,n,i,o);const d=n*Math.sin(Math.PI/i)-.001;r=Math.min(r,d);const _=-1*Math.PI/2+o,g=Math.PI*2/i,l=(i-2)*Math.PI/i/2;for(let m=0;m<i;m++){const y=m*g+_,w=t+n*Math.cos(y),M=e+n*Math.sin(y),S=y+Math.PI+l,A=y-Math.PI-l,C=w+r*Math.cos(S),I=M+r*Math.sin(S),O=w+r*Math.cos(A),$=M+r*Math.sin(A);m===0?this.moveTo(C,I):this.lineTo(C,I),this.quadraticCurveTo(w,M,O,$,h)}return this.closePath()}roundShape(t,e,n=!1,i){return t.length<3?this:(n?yT(this,t,e,i):gT(this,t,e),this.closePath())}filletRect(t,e,n,i,r){if(r===0)return this.rect(t,e,n,i);const o=Math.min(n,i)/2,h=Math.min(o,Math.max(-o,r)),d=t+n,_=e+i,g=h<0?-h:0,l=Math.abs(h);return this.moveTo(t,e+l).arcTo(t+g,e+g,t+l,e,l).lineTo(d-l,e).arcTo(d-g,e+g,d,e+l,l).lineTo(d,_-l).arcTo(d-g,_-g,t+n-l,_,l).lineTo(t+l,_).arcTo(t+g,_-g,t,_-l,l).closePath()}chamferRect(t,e,n,i,r,o){if(r<=0)return this.rect(t,e,n,i);const h=Math.min(r,Math.min(n,i)/2),d=t+n,_=e+i,g=[t+h,e,d-h,e,d,e+h,d,_-h,d-h,_,t+h,_,t,_-h,t,e+h];for(let l=g.length-1;l>=2;l-=2)g[l]===g[l-2]&&g[l-1]===g[l-3]&&g.splice(l-1,2);return this.poly(g,!0,o)}ellipse(t,e,n,i,r){return this.drawShape(new af(t,e,n,i),r),this}roundRect(t,e,n,i,r,o){return this.drawShape(new lf(t,e,n,i,r),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let n=this._currentPoly;return n&&this.endPoly(),n=new pl,n.points.push(t,e),this._currentPoly=n,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new pl,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let n=e.shape.x,i=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const r=e.transform,o=n;n=r.a*n+r.c*i+r.tx,i=r.b*o+r.d*i+r.ty}this._currentPoly.points.push(n,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const n=t.instructions[e];this[n.action](...n.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let n=0;n<e.length;n++){const i=e[n],r=i.shape.getBounds(xT);i.transform?t.addRect(r,i.transform):t.addRect(r)}return t}}class pi{constructor(t,e=!1){this.instructions=[],this.uid=vn("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?YA(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new bT(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,n,i,r){const o=this.instructions[this.instructions.length-1],h=this.getLastPoint(ms.shared);let d=0,_=0;if(!o||o.action!=="bezierCurveTo")d=h.x,_=h.y;else{d=o.data[2],_=o.data[3];const g=h.x,l=h.y;d=g+(g-d),_=l+(l-_)}return this.instructions.push({action:"bezierCurveTo",data:[d,_,t,e,n,i,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,n){const i=this.instructions[this.instructions.length-1],r=this.getLastPoint(ms.shared);let o=0,h=0;if(!i||i.action!=="quadraticCurveTo")o=r.x,h=r.y;else{o=i.data[0],h=i.data[1];const d=r.x,_=r.y;o=d+(d-o),h=_+(_-h)}return this.instructions.push({action:"quadraticCurveTo",data:[o,h,t,e,n]}),this._dirty=!0,this}rect(t,e,n,i,r){return this.instructions.push({action:"rect",data:[t,e,n,i,r]}),this._dirty=!0,this}circle(t,e,n,i){return this.instructions.push({action:"circle",data:[t,e,n,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,n,i,r,o,h){r||(r=i/2);const d=-1*Math.PI/2+o,_=n*2,g=Math.PI*2/_,l=[];for(let m=0;m<_;m++){const y=m%2?r:i,w=m*g+d;l.push(t+y*Math.cos(w),e+y*Math.sin(w))}return this.poly(l,!0,h),this}clone(t=!1){const e=new pi;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let n=0;n<this.instructions.length;n++){const i=this.instructions[n];e.instructions.push({action:i.action,data:i.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,n=t.b,i=t.c,r=t.d,o=t.tx,h=t.ty;let d=0,_=0,g=0,l=0,m=0,y=0,w=0,M=0;for(let S=0;S<this.instructions.length;S++){const A=this.instructions[S],C=A.data;switch(A.action){case"moveTo":case"lineTo":d=C[0],_=C[1],C[0]=e*d+i*_+o,C[1]=n*d+r*_+h;break;case"bezierCurveTo":g=C[0],l=C[1],m=C[2],y=C[3],d=C[4],_=C[5],C[0]=e*g+i*l+o,C[1]=n*g+r*l+h,C[2]=e*m+i*y+o,C[3]=n*m+r*y+h,C[4]=e*d+i*_+o,C[5]=n*d+r*_+h;break;case"quadraticCurveTo":g=C[0],l=C[1],d=C[2],_=C[3],C[0]=e*g+i*l+o,C[1]=n*g+r*l+h,C[2]=e*d+i*_+o,C[3]=n*d+r*_+h;break;case"arcToSvg":d=C[5],_=C[6],w=C[0],M=C[1],C[0]=e*w+i*M,C[1]=n*w+r*M,C[5]=e*d+i*_+o,C[6]=n*d+r*_+h;break;case"circle":C[4]=ol(C[3],t);break;case"rect":C[4]=ol(C[4],t);break;case"ellipse":C[8]=ol(C[8],t);break;case"roundRect":C[5]=ol(C[5],t);break;case"addPath":C[0].transform(t);break;case"poly":C[2]=ol(C[2],t);break;default:an("unknown transform action",A.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,n=this.instructions[e];if(!n)return t.x=0,t.y=0,t;for(;n.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;n=this.instructions[e]}switch(n.action){case"moveTo":case"lineTo":t.x=n.data[0],t.y=n.data[1];break;case"quadraticCurveTo":t.x=n.data[2],t.y=n.data[3];break;case"bezierCurveTo":t.x=n.data[4],t.y=n.data[5];break;case"arc":case"arcToSvg":t.x=n.data[5],t.y=n.data[6];break;case"addPath":n.data[0].getLastPoint(t);break}return t}}function ol(s,t){return s?s.prepend(t):t.clone()}function Mn(s,t,e){const n=s.getAttribute(t);return n?Number(n):e}function wT(s,t){const e=s.querySelectorAll("defs");for(let n=0;n<e.length;n++){const i=e[n];for(let r=0;r<i.children.length;r++){const o=i.children[r];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=ST(o);break;case"radialgradient":t.defs[o.id]=MT();break}}}}function ST(s){const t=Mn(s,"x1",0),e=Mn(s,"y1",0),n=Mn(s,"x2",1),i=Mn(s,"y2",0),r=s.getAttribute("gradientUnits")||"objectBoundingBox",o=new mi(t,e,n,i,r==="objectBoundingBox"?"local":"global");for(let h=0;h<s.children.length;h++){const d=s.children[h],_=Mn(d,"offset",0),g=Dn.shared.setValue(d.getAttribute("stop-color")).toNumber();o.addColorStop(_,g)}return o}function MT(s){return an("[SVG Parser] Radial gradients are not yet supported"),new mi(0,0,1,0)}function b_(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const w_={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function ly(s,t){const e=s.getAttribute("style"),n={},i={},r={strokeStyle:n,fillStyle:i,useFill:!1,useStroke:!1};for(const o in w_){const h=s.getAttribute(o);h&&S_(t,r,o,h.trim())}if(e){const o=e.split(";");for(let h=0;h<o.length;h++){const d=o[h].trim(),[_,g]=d.split(":");w_[_]&&S_(t,r,_,g.trim())}}return{strokeStyle:r.useStroke?n:null,fillStyle:r.useFill?i:null,useFill:r.useFill,useStroke:r.useStroke}}function S_(s,t,e,n){switch(e){case"stroke":if(n!=="none"){if(n.startsWith("url(")){const i=b_(n);t.strokeStyle.fill=s.defs[i]}else t.strokeStyle.color=Dn.shared.setValue(n).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(n);break;case"fill":if(n!=="none"){if(n.startsWith("url(")){const i=b_(n);t.fillStyle.fill=s.defs[i]}else t.fillStyle.color=Dn.shared.setValue(n).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(n);break;case"stroke-opacity":t.strokeStyle.alpha=Number(n);break;case"opacity":t.fillStyle.alpha=Number(n),t.strokeStyle.alpha=Number(n);break}}function AT(s){if(s.length<=2)return!0;const t=s.map(h=>h.area).sort((h,d)=>d-h),[e,n]=t,i=t[t.length-1],r=e/n,o=n/i;return!(r>3&&o<2)}function vT(s){return s.split(/(?=[Mm])/).filter(n=>n.trim().length>0)}function TT(s){const t=s.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),n=[],i=[];for(let g=0;g<e.length;g+=2)g+1<e.length&&(n.push(e[g]),i.push(e[g+1]));if(n.length===0||i.length===0)return 0;const r=Math.min(...n),o=Math.max(...n),h=Math.min(...i),d=Math.max(...i);return(o-r)*(d-h)}function M_(s,t){const e=new pi(s,!1);for(const n of e.instructions)t.instructions.push(n)}function CT(s,t){if(typeof s=="string"){const o=document.createElement("div");o.innerHTML=s.trim(),s=o.querySelector("svg")}const e={context:t,defs:{},path:new pi};wT(s,e);const n=s.children,{fillStyle:i,strokeStyle:r}=ly(s,e);for(let o=0;o<n.length;o++){const h=n[o];h.nodeName.toLowerCase()!=="defs"&&cy(h,e,i,r)}return t}function cy(s,t,e,n){const i=s.children,{fillStyle:r,strokeStyle:o}=ly(s,t);r&&e?e={...e,...r}:r&&(e=r),o&&n?n={...n,...o}:o&&(n=o);const h=!e&&!n;h&&(e={color:0});let d,_,g,l,m,y,w,M,S,A,C,I,O,$,W,G,lt;switch(s.nodeName.toLowerCase()){case"path":{$=s.getAttribute("d");const J=s.getAttribute("fill-rule"),st=vT($),tt=J==="evenodd",P=st.length>1;if(tt&&P){const vt=st.map(z=>({path:z,area:TT(z)}));if(vt.sort((z,B)=>B.area-z.area),st.length>3||!AT(vt))for(let z=0;z<vt.length;z++){const B=vt[z],St=z===0;t.context.beginPath();const pt=new pi(void 0,!0);M_(B.path,pt),t.context.path(pt),St?(e&&t.context.fill(e),n&&t.context.stroke(n)):t.context.cut()}else for(let z=0;z<vt.length;z++){const B=vt[z],St=z%2===1;t.context.beginPath();const pt=new pi(void 0,!0);M_(B.path,pt),t.context.path(pt),St?t.context.cut():(e&&t.context.fill(e),n&&t.context.stroke(n))}}else{const vt=J?J==="evenodd":!0;W=new pi($,vt),t.context.path(W),e&&t.context.fill(e),n&&t.context.stroke(n)}break}case"circle":w=Mn(s,"cx",0),M=Mn(s,"cy",0),S=Mn(s,"r",0),t.context.ellipse(w,M,S,S),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"rect":d=Mn(s,"x",0),_=Mn(s,"y",0),G=Mn(s,"width",0),lt=Mn(s,"height",0),A=Mn(s,"rx",0),C=Mn(s,"ry",0),A||C?t.context.roundRect(d,_,G,lt,A||C):t.context.rect(d,_,G,lt),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"ellipse":w=Mn(s,"cx",0),M=Mn(s,"cy",0),A=Mn(s,"rx",0),C=Mn(s,"ry",0),t.context.beginPath(),t.context.ellipse(w,M,A,C),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"line":g=Mn(s,"x1",0),l=Mn(s,"y1",0),m=Mn(s,"x2",0),y=Mn(s,"y2",0),t.context.beginPath(),t.context.moveTo(g,l),t.context.lineTo(m,y),n&&t.context.stroke(n);break;case"polygon":O=s.getAttribute("points"),I=O.match(/\d+/g).map(J=>parseInt(J,10)),t.context.poly(I,!0),e&&t.context.fill(e),n&&t.context.stroke(n);break;case"polyline":O=s.getAttribute("points"),I=O.match(/\d+/g).map(J=>parseInt(J,10)),t.context.poly(I,!1),n&&t.context.stroke(n);break;case"g":case"svg":break;default:{an(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}h&&(e=null);for(let J=0;J<i.length;J++)cy(i[J],t,e,n)}function ET(s){return Dn.isColorLike(s)}function A_(s){return s instanceof Th}function v_(s){return s instanceof mi}function PT(s){return s instanceof Xt}function IT(s,t,e){const n=Dn.shared.setValue(t??0);return s.color=n.toNumber(),s.alpha=n.alpha===1?e.alpha:n.alpha,s.texture=Xt.WHITE,{...e,...s}}function kT(s,t,e){return s.texture=t,{...e,...s}}function T_(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function C_(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function LT(s,t){const e={...t,...s},n=Dn.shared.setValue(e.color);return e.alpha*=n.alpha,e.color=n.toNumber(),e}function go(s,t){if(s==null)return null;const e={},n=s;return ET(s)?IT(e,s,t):PT(s)?kT(e,s,t):A_(s)?T_(e,s,t):v_(s)?C_(e,s,t):n.fill&&A_(n.fill)?T_(n,n.fill,t):n.fill&&v_(n.fill)?C_(n,n.fill,t):LT(n,t)}function bh(s,t){const{width:e,alignment:n,miterLimit:i,cap:r,join:o,pixelLine:h,...d}=t,_=go(s,d);return _?{width:e,alignment:n,miterLimit:i,cap:r,join:o,pixelLine:h,..._}:null}const FT=new ms,E_=new fe,hf=class Dr extends Sr{constructor(){super(...arguments),this.uid=vn("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new pi,this._transform=new fe,this._fillStyle={...Dr.defaultFillStyle},this._strokeStyle={...Dr.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new wr,this._boundsDirty=!0}clone(){const t=new Dr;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=go(t,Dr.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=bh(t,Dr.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=go(t,Dr.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=go(t,Dr.defaultStrokeStyle),this}texture(t,e,n,i,r,o){return this.instructions.push({action:"texture",data:{image:t,dx:n||0,dy:i||0,dw:r||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Dn.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new pi,this}fill(t,e){let n;const i=this.instructions[this.instructions.length-1];return this._tick===0&&(i==null?void 0:i.action)==="stroke"?n=i.data.path:n=this._activePath.clone(),n?(t!=null&&(e!==void 0&&typeof t=="number"&&(jt(Pe,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=go(t,Dr.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:n}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(ms.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const n=this.instructions[this.instructions.length-1];return this._tick===0&&(n==null?void 0:n.action)==="fill"?e=n.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=bh(t,Dr.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],n=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(n);else{e.data.hole=n;break}}return this._initNextPathLocation(),this}arc(t,e,n,i,r,o){this._tick++;const h=this._transform;return this._activePath.arc(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,n,i,r,o),this}arcTo(t,e,n,i,r){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*n+o.c*i+o.tx,o.b*n+o.d*i+o.ty,r),this}arcToSvg(t,e,n,i,r,o,h){this._tick++;const d=this._transform;return this._activePath.arcToSvg(t,e,n,i,r,d.a*o+d.c*h+d.tx,d.b*o+d.d*h+d.ty),this}bezierCurveTo(t,e,n,i,r,o,h){this._tick++;const d=this._transform;return this._activePath.bezierCurveTo(d.a*t+d.c*e+d.tx,d.b*t+d.d*e+d.ty,d.a*n+d.c*i+d.tx,d.b*n+d.d*i+d.ty,d.a*r+d.c*o+d.tx,d.b*r+d.d*o+d.ty,h),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,n,i){return this._tick++,this._activePath.ellipse(t,e,n,i,this._transform.clone()),this}circle(t,e,n){return this._tick++,this._activePath.circle(t,e,n,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const n=this._transform;return this._activePath.lineTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty),this}moveTo(t,e){this._tick++;const n=this._transform,i=this._activePath.instructions,r=n.a*t+n.c*e+n.tx,o=n.b*t+n.d*e+n.ty;return i.length===1&&i[0].action==="moveTo"?(i[0].data[0]=r,i[0].data[1]=o,this):(this._activePath.moveTo(r,o),this)}quadraticCurveTo(t,e,n,i,r){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*n+o.c*i+o.tx,o.b*n+o.d*i+o.ty,r),this}rect(t,e,n,i){return this._tick++,this._activePath.rect(t,e,n,i,this._transform.clone()),this}roundRect(t,e,n,i,r){return this._tick++,this._activePath.roundRect(t,e,n,i,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,n,i,r=0,o){return this._tick++,this._activePath.regularPoly(t,e,n,i,r,o),this}roundPoly(t,e,n,i,r,o){return this._tick++,this._activePath.roundPoly(t,e,n,i,r,o),this}roundShape(t,e,n,i){return this._tick++,this._activePath.roundShape(t,e,n,i),this}filletRect(t,e,n,i,r){return this._tick++,this._activePath.filletRect(t,e,n,i,r),this}chamferRect(t,e,n,i,r,o){return this._tick++,this._activePath.chamferRect(t,e,n,i,r,o),this}star(t,e,n,i,r=0,o=0){return this._tick++,this._activePath.star(t,e,n,i,r,o,this._transform.clone()),this}svg(t){return this._tick++,CT(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,n,i,r,o){return t instanceof fe?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,n,i,r,o),this)}transform(t,e,n,i,r,o){return t instanceof fe?(this._transform.append(t),this):(E_.set(t,e,n,i,r,o),this._transform.append(E_),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const n=this.instructions[e],i=n.action;if(i==="fill"){const r=n.data;t.addBounds(r.path.bounds)}else if(i==="texture"){const r=n.data;t.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh,r.transform)}if(i==="stroke"){const r=n.data,o=r.style.alignment,h=r.style.width*(1-o),d=r.path.bounds;t.addFrame(d.minX-h,d.minY-h,d.maxX+h,d.maxY+h)}}return t}containsPoint(t){var i;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let n=!1;for(let r=0;r<e.length;r++){const o=e[r],h=o.data,d=h.path;if(!o.action||!d)continue;const _=h.style,g=d.shapePath.shapePrimitives;for(let l=0;l<g.length;l++){const m=g[l].shape;if(!_||!m)continue;const y=g[l].transform,w=y?y.applyInverse(t,FT):t;if(o.action==="fill")n=m.contains(w.x,w.y);else{const S=_;n=m.strokeContains(w.x,w.y,S.width,S.alignment)}const M=h.hole;if(M){const S=(i=M.shapePath)==null?void 0:i.shapePrimitives;if(S)for(let A=0;A<S.length;A++)S[A].shape.contains(w.x,w.y)&&(n=!1)}if(n)return!0}}return n}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(n)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(n))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};hf.defaultFillStyle={color:16777215,alpha:1,texture:Xt.WHITE,matrix:null,fill:null,textureSpace:"local"};hf.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:Xt.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let lr=hf;const uf=class Jo extends Sr{constructor(t={}){super(),this.uid=vn("textStyle"),this._tick=0,OT(t);const e={...Jo.defaultTextStyle,...t};for(const n in e){const i=n;this[i]=e[n]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...Jo.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...Jo.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...lr.defaultFillStyle,...t},()=>{this._fill=go({...this._originalFill},lr.defaultFillStyle)})),this._fill=go(t===0?"black":t,lr.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...lr.defaultStrokeStyle,...t},()=>{this._stroke=bh({...this._originalStroke},lr.defaultStrokeStyle)})),this._stroke=bh(t,lr.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=Jo.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new Jo({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var n,i,r,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const h=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(n=this._fill)!=null&&n.texture&&this._fill.texture.destroy(h),(i=this._originalFill)!=null&&i.texture&&this._originalFill.texture.destroy(h),(r=this._stroke)!=null&&r.texture&&this._stroke.texture.destroy(h),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(h)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(n,i,r)=>(n[i]===r||(n[i]=r,e==null||e(i,r),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(Dn.isColorLike(t)||t instanceof mi||t instanceof Th)}};uf.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};uf.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let An=uf;function OT(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=An.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){jt(Pe,"strokeThickness is now a part of stroke");const e=t.stroke;let n={};if(Dn.isColorLike(e))n.color=e;else if(e instanceof mi||e instanceof Th)n.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))n=e;else throw new Error("Invalid stroke value.");s.stroke={...n,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(jt(Pe,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&an("The number of fill colors must match the number of fill gradient stops.");const e=new mi({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),n=t.fillGradientStops.slice(),i=t.fill.map(r=>Dn.shared.setValue(r).toNumber());n.forEach((r,o)=>{e.addColorStop(r,i[o])}),s.fill={fill:e}}}class RT{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const n=en.get().createCanvas();n.width=t,n.height=e;const i=n.getContext("2d");return{canvas:n,context:i}}getOptimalCanvasAndContext(t,e,n=1){t=Math.ceil(t*n-1e-6),e=Math.ceil(e*n-1e-6),t=sa(t),e=sa(e);const i=(t<<17)+(e<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let r=this._canvasPool[i].pop();return r||(r=this._createCanvasAndContext(t,e)),r}returnCanvasAndContext(t){const e=t.canvas,{width:n,height:i}=e,r=(n<<17)+(i<<1);t.context.resetTransform(),t.context.clearRect(0,0,n,i),this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}const Ml=new RT;vl.register(Ml);const P_=1e5;function wh(s,t,e,n=0){if(s.texture===Xt.WHITE&&!s.fill)return Dn.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof Th){const i=s.fill,r=t.createPattern(i.texture.source.resource,"repeat"),o=i.transform.copyTo(fe.shared);return o.scale(i.texture.frame.width,i.texture.frame.height),r.setTransform(o),r}else if(s.fill instanceof mi){const i=s.fill,r=i.type==="linear",o=i.textureSpace==="local";let h=1,d=1;o&&e&&(h=e.width+n,d=e.height+n);let _,g=!1;if(r){const{start:l,end:m}=i;_=t.createLinearGradient(l.x*h,l.y*d,m.x*h,m.y*d),g=Math.abs(m.x-l.x)<Math.abs((m.y-l.y)*.1)}else{const{center:l,innerRadius:m,outerCenter:y,outerRadius:w}=i;_=t.createRadialGradient(l.x*h,l.y*d,m*h,y.x*h,y.y*d,w*h)}if(g&&o&&e){const l=e.lineHeight/d;for(let m=0;m<e.lines.length;m++){const y=(m*e.lineHeight+n/2)/d;i.colorStops.forEach(w=>{const M=y+w.offset*l;_.addColorStop(Math.floor(M*P_)/P_,Dn.shared.setValue(w.color).toHex())})}}else i.colorStops.forEach(l=>{_.addColorStop(l.offset,Dn.shared.setValue(l.color).toHex())});return _}}else{const i=t.createPattern(s.texture.source.resource,"repeat"),r=s.matrix.copyTo(fe.shared);return r.scale(s.texture.frame.width,s.texture.frame.height),i.setTransform(r),i}return an("FillStyle not recognised",s),"red"}const hy=class uy extends zg{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...uy.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const n=e.style.clone();e.overrideFill&&(n._fill.color=16777215,n._fill.alpha=1,n._fill.texture=Xt.WHITE,n._fill.fill=null),this.applyFillAsTint=e.overrideFill;const i=n.fontSize;n.fontSize=this.baseMeasurementFontSize;const r=yh(n);e.overrideSize?n._stroke&&(n._stroke.width*=this.baseRenderedFontSize/i):n.fontSize=this.baseRenderedFontSize=i,this._style=n,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof ra?e.textureStyle:new ra(e.textureStyle)),this.fontMetrics=Gr.measureFont(r),this.lineHeight=n.lineHeight||this.fontMetrics.fontSize||n.fontSize}ensureCharacters(t){var S,A;const e=Gr.graphemeSegmenter(t).filter(C=>!this._currentChars.includes(C)).filter((C,I,O)=>O.indexOf(C)===I);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let n;this._currentPageIndex===-1?n=this._nextPage():n=this.pages[this._currentPageIndex];let{canvas:i,context:r}=n.canvasAndContext,o=n.texture.source;const h=this._style;let d=this._currentX,_=this._currentY,g=this._currentMaxCharHeight;const l=this.baseRenderedFontSize/this.baseMeasurementFontSize,m=this._padding*l;let y=!1;const w=i.width/this.resolution,M=i.height/this.resolution;for(let C=0;C<e.length;C++){const I=e[C],O=Gr.measureText(I,h,i,!1);O.lineHeight=O.height;const $=O.width*l,W=Math.ceil((h.fontStyle==="italic"?2:1)*$),G=O.height*l,lt=W+m*2,J=G+m*2;if(y=!1,I!==`
`&&I!=="\r"&&I!=="	"&&I!==" "&&(y=!0,g=Math.ceil(Math.max(J,g))),d+lt>w&&(_+=g,g=J,d=0,_+g>M)){o.update();const tt=this._nextPage();i=tt.canvasAndContext.canvas,r=tt.canvasAndContext.context,o=tt.texture.source,d=0,_=0,g=0}const st=$/l-(((S=h.dropShadow)==null?void 0:S.distance)??0)-(((A=h._stroke)==null?void 0:A.width)??0);if(this.chars[I]={id:I.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:st,kerning:{}},y){this._drawGlyph(r,O,d+m,_+m,l,h);const tt=o.width*l,P=o.height*l,wt=new $t(d/tt*o.width,_/P*o.height,lt/tt*o.width,J/P*o.height);this.chars[I].texture=new Xt({source:o,frame:wt}),d+=Math.ceil(lt)}}o.update(),this._currentX=d,this._currentY=_,this._currentMaxCharHeight=g,this._skipKerning&&this._applyKerning(e,r)}get pageTextures(){return jt(Pe,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const n=this._measureCache;for(let i=0;i<t.length;i++){const r=t[i];for(let o=0;o<this._currentChars.length;o++){const h=this._currentChars[o];let d=n[r];d||(d=n[r]=e.measureText(r).width);let _=n[h];_||(_=n[h]=e.measureText(h).width);let g=e.measureText(r+h).width,l=g-(d+_);l&&(this.chars[r].kerning[h]=l),g=e.measureText(r+h).width,l=g-(d+_),l&&(this.chars[h].kerning[r]=l)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=Ml.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const n=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new Xt({source:new yo({resource:e.canvas,resolution:n,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);const r={canvasAndContext:e,texture:i};return this.pages[this._currentPageIndex]=r,r}_setupContext(t,e,n){e.fontSize=this.baseRenderedFontSize,t.scale(n,n),t.font=yh(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const i=e._stroke,r=(i==null?void 0:i.width)??0;if(i&&(t.lineWidth=r,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=wh(i,t)),e._fill&&(t.fillStyle=wh(e._fill,t)),e.dropShadow){const o=e.dropShadow,h=Dn.shared.setValue(o.color).toArray(),d=o.blur*n,_=o.distance*n;t.shadowColor=`rgba(${h[0]*255},${h[1]*255},${h[2]*255},${o.alpha})`,t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.angle)*_,t.shadowOffsetY=Math.sin(o.angle)*_}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,n,i,r,o){const h=e.text,d=e.fontProperties,_=o._stroke,g=((_==null?void 0:_.width)??0)*r,l=n+g/2,m=i-g/2,y=d.descent*r,w=e.lineHeight*r;let M=!1;o.stroke&&g&&(M=!0,t.strokeText(h,l,m+w-y));const{shadowBlur:S,shadowOffsetX:A,shadowOffsetY:C}=t;o._fill&&(M&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(h,l,m+w-y)),M&&(t.shadowBlur=S,t.shadowOffsetX=A,t.shadowOffsetY=C)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:n}=this.pages[t];Ml.returnCanvasAndContext(e),n.destroy(!0)}this.pages=null}};hy.defaultOptions={textureSize:512,style:new An,mipmap:!0};let I_=hy;function BT(s,t,e,n){const i={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=e.baseLineOffset;let r=i.lines[0],o=null,h=!0;const d={width:0,start:0,index:0,positions:[],chars:[]},_=e.baseMeasurementFontSize/t.fontSize,g=t.letterSpacing*_,l=t.wordWrapWidth*_,m=t.lineHeight?t.lineHeight*_:e.lineHeight,y=t.wordWrap&&t.breakWords,w=A=>{const C=r.width;for(let I=0;I<d.index;I++){const O=A.positions[I];r.chars.push(A.chars[I]),r.charPositions.push(O+C)}r.width+=A.width,h=!1,d.width=0,d.index=0,d.chars.length=0},M=()=>{let A=r.chars.length-1;if(n){let C=r.chars[A];for(;C===" ";)r.width-=e.chars[C].xAdvance,C=r.chars[--A]}i.width=Math.max(i.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},h=!0,i.lines.push(r),i.height+=m},S=A=>A-g>l;for(let A=0;A<s.length+1;A++){let C;const I=A===s.length;I||(C=s[A]);const O=e.chars[C]||e.chars[" "];if(/(?:\s)/.test(C)||C==="\r"||C===`
`||I){if(!h&&t.wordWrap&&S(r.width+d.width)?(M(),w(d),I||r.charPositions.push(0)):(d.start=r.width,w(d),I||r.charPositions.push(0)),C==="\r"||C===`
`)M();else if(!I){const lt=O.xAdvance+(O.kerning[o]||0)+g;r.width+=lt,r.spaceWidth=lt,r.spacesIndex.push(r.charPositions.length),r.chars.push(C)}}else{const G=O.kerning[o]||0,lt=O.xAdvance+G+g;y&&S(r.width+d.width+lt)&&(w(d),M()),d.positions[d.index++]=d.width+G,d.chars.push(C),d.width+=lt}o=C}return M(),t.align==="center"?NT(i):t.align==="right"?WT(i):t.align==="justify"&&DT(i),i}function NT(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],n=s.width/2-e.width/2;for(let i=0;i<e.charPositions.length;i++)e.charPositions[i]+=n}}function WT(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],n=s.width-e.width;for(let i=0;i<e.charPositions.length;i++)e.charPositions[i]+=n}}function DT(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const n=s.lines[e];let i=0,r=n.spacesIndex[i++],o=0;const h=n.spacesIndex.length,_=(t-n.width)/h;for(let g=0;g<n.charPositions.length;g++)g===r&&(r=n.spacesIndex[i++],o+=_),n.charPositions[g]+=o}}function GT(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,n=s.length;e<n;e++){const i=s[e];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(i[0].length===0||i[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const r=i[0].charCodeAt(0),o=i[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let h=r,d=o;h<=d;h++)t.push(String.fromCharCode(h))}else t.push(...Array.from(i))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let ch=0;class HT{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Vg(1e3)}getFont(t,e){var o;let n=`${e.fontFamily}-bitmap`,i=!0;if(e._fill.fill&&!e._stroke?(n+=e._fill.fill.styleKey,i=!1):(e._stroke||e.dropShadow)&&(n=`${e.styleKey}-bitmap`,i=!1),!on.has(n)){const h=Object.create(e);h.lineHeight=0;const d=new I_({style:h,overrideFill:i,overrideSize:!0,...this.defaultOptions});ch++,ch>50&&an("BitmapText",`You have dynamically created ${ch} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),d.once("destroy",()=>{ch--,on.remove(n)}),on.set(n,d)}const r=on.get(n);return(o=r.ensureCharacters)==null||o.call(r,t),r}getLayout(t,e,n=!0){const i=this.getFont(t,e),r=`${t}-${e.styleKey}-${n}`;if(this.measureCache.has(r))return this.measureCache.get(r);const o=Gr.graphemeSegmenter(t),h=BT(o,e,i,n);return this.measureCache.set(r,h),h}measureText(t,e,n=!0){return this.getLayout(t,e,n)}install(...t){var _,g,l,m;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(_=t[2])==null?void 0:_.chars,resolution:(g=t[2])==null?void 0:g.resolution,padding:(l=t[2])==null?void 0:l.padding,skipKerning:(m=t[2])==null?void 0:m.skipKerning},jt(Pe,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const n=e==null?void 0:e.name;if(!n)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const i=e.style,r=i instanceof An?i:new An(i),o=e.dynamicFill??this._canUseTintForStyle(r),h=new I_({style:r,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),d=GT(e.chars);return h.ensureCharacters(d.join("")),on.set(`${n}-bitmap`,h),h.once("destroy",()=>on.remove(`${n}-bitmap`)),h}uninstall(t){const e=`${t}-bitmap`,n=on.get(e);n&&n.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const k_=new HT;class dy extends zg{constructor(t,e){super();const{textures:n,data:i}=t;Object.keys(i.pages).forEach(r=>{const o=i.pages[parseInt(r,10)],h=n[o.id];this.pages.push({texture:h})}),Object.keys(i.chars).forEach(r=>{const o=i.chars[r],{frame:h,source:d,rotate:_}=n[o.page],g=He.transformRectCoords(o,h,_,new $t),l=new Xt({frame:g,orig:new $t(0,0,o.width,o.height),source:d,rotate:_});this.chars[r]={id:r.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:l}}),this.baseRenderedFontSize=i.fontSize,this.baseMeasurementFontSize=i.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontFamily=i.fontFamily,this.distanceField=i.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){k_.install(t)}static uninstall(t){k_.uninstall(t)}}const Ed={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const l in t){const m=t[l].match(/^[a-z]+/gm)[0],y=t[l].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),w={};for(const M in y){const S=y[M].split("="),A=S[0],C=S[1].replace(/"/gm,""),I=parseFloat(C),O=isNaN(I)?C:I;w[A]=O}e[m].push(w)}const n={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[i]=e.info,[r]=e.common,[o]=e.distanceField??[];o&&(n.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),n.fontSize=parseInt(i.size,10),n.fontFamily=i.face,n.lineHeight=parseInt(r.lineHeight,10);const h=e.page;for(let l=0;l<h.length;l++)n.pages.push({id:parseInt(h[l].id,10)||0,file:h[l].file});const d={};n.baseLineOffset=n.lineHeight-parseInt(r.base,10);const _=e.char;for(let l=0;l<_.length;l++){const m=_[l],y=parseInt(m.id,10);let w=m.letter??m.char??String.fromCharCode(y);w==="space"&&(w=" "),d[y]=w,n.chars[w]={id:y,page:parseInt(m.page,10)||0,x:parseInt(m.x,10),y:parseInt(m.y,10),width:parseInt(m.width,10),height:parseInt(m.height,10),xOffset:parseInt(m.xoffset,10),yOffset:parseInt(m.yoffset,10),xAdvance:parseInt(m.xadvance,10),kerning:{}}}const g=e.kerning||[];for(let l=0;l<g.length;l++){const m=parseInt(g[l].first,10),y=parseInt(g[l].second,10),w=parseInt(g[l].amount,10);n.chars[d[y]].kerning[d[m]]=w}return n}},L_={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],n=s.getElementsByTagName("common")[0],i=s.getElementsByTagName("distanceField")[0];i&&(t.distanceField={type:i.getAttribute("fieldType"),range:parseInt(i.getAttribute("distanceRange"),10)});const r=s.getElementsByTagName("page"),o=s.getElementsByTagName("char"),h=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(n.getAttribute("lineHeight"),10);for(let _=0;_<r.length;_++)t.pages.push({id:parseInt(r[_].getAttribute("id"),10)||0,file:r[_].getAttribute("file")});const d={};t.baseLineOffset=t.lineHeight-parseInt(n.getAttribute("base"),10);for(let _=0;_<o.length;_++){const g=o[_],l=parseInt(g.getAttribute("id"),10);let m=g.getAttribute("letter")??g.getAttribute("char")??String.fromCharCode(l);m==="space"&&(m=" "),d[l]=m,t.chars[m]={id:l,page:parseInt(g.getAttribute("page"),10)||0,x:parseInt(g.getAttribute("x"),10),y:parseInt(g.getAttribute("y"),10),width:parseInt(g.getAttribute("width"),10),height:parseInt(g.getAttribute("height"),10),xOffset:parseInt(g.getAttribute("xoffset"),10),yOffset:parseInt(g.getAttribute("yoffset"),10),xAdvance:parseInt(g.getAttribute("xadvance"),10),kerning:{}}}for(let _=0;_<h.length;_++){const g=parseInt(h[_].getAttribute("first"),10),l=parseInt(h[_].getAttribute("second"),10),m=parseInt(h[_].getAttribute("amount"),10);t.chars[d[l]].kerning[d[g]]=m}return t}},F_={test(s){return typeof s=="string"&&s.match(/<font(\s|>)/)?L_.test(en.get().parseXML(s)):!1},parse(s){return L_.parse(en.get().parseXML(s))}},UT=[".xml",".fnt"],YT={extension:{type:kt.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof dy,getCacheableAssets(s,t){const e={};return s.forEach(n=>{e[n]=t,e[`${n}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},XT={extension:{type:kt.LoadParser,priority:Ui.Normal},name:"loadBitmapFont",id:"bitmap-font",test(s){return UT.includes($s.extname(s).toLowerCase())},async testParse(s){return Ed.test(s)||F_.test(s)},async parse(s,t,e){const n=Ed.test(s)?Ed.parse(s):F_.parse(s),{src:i}=t,{pages:r}=n,o=[],h=n.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let l=0;l<r.length;++l){const m=r[l].file;let y=$s.join($s.dirname(i),m);y=Gd(y,i),o.push({src:y,data:h})}const d=await e.load(o),_=o.map(l=>d[l.src]);return new dy({data:n,textures:_},i)},async load(s,t){return await(await en.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(n=>e.unload(n.texture.source._sourceOrigin))),s.destroy()}};class zT{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const VT={extension:{type:kt.CacheParser,name:"cacheTextureArray"},test:s=>Array.isArray(s)&&s.every(t=>t instanceof Xt),getCacheableAssets:(s,t)=>{const e={};return s.forEach(n=>{t.forEach((i,r)=>{e[n+(r===0?"":r+1)]=i})}),e}};async function fy(s){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(s)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const $T={extension:{type:kt.DetectionParser,priority:1},test:async()=>fy("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(t=>t!=="avif")},O_=["png","jpg","jpeg"],jT={extension:{type:kt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...O_],remove:async s=>s.filter(t=>!O_.includes(t))},qT="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Eh(s){return qT?!1:document.createElement("video").canPlayType(s)!==""}const KT={extension:{type:kt.DetectionParser,priority:0},test:async()=>Eh("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(t=>t!=="mp4"&&t!=="m4v")},ZT={extension:{type:kt.DetectionParser,priority:0},test:async()=>Eh("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(t=>t!=="ogv")},QT={extension:{type:kt.DetectionParser,priority:0},test:async()=>Eh("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(t=>t!=="webm")},JT={extension:{type:kt.DetectionParser,priority:0},test:async()=>fy("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(t=>t!=="webp")},py=class fh{constructor(){this.loadOptions={...fh.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,n)=>(this._parsersValidated=!1,t[e]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var o,h;let i=null,r=null;if((e.parser||e.loadParser)&&(r=this._parserHash[e.parser||e.loadParser],e.loadParser&&an(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),r||an(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!r){for(let d=0;d<this.parsers.length;d++){const _=this.parsers[d];if(_.load&&((o=_.test)!=null&&o.call(_,t,e,this))){r=_;break}}if(!r)return an(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await r.load(t,e,this),n.parser=r;for(let d=0;d<this.parsers.length;d++){const _=this.parsers[d];_.parse&&_.parse&&await((h=_.testParse)==null?void 0:h.call(_,i,e,this))&&(i=await _.parse(i,e,this)||i,n.parser=_)}return i})(),n}async load(t,e){this._parsersValidated||this._validateParsers();const n=typeof e=="function"?{...fh.defaultOptions,...this.loadOptions,onProgress:e}:{...fh.defaultOptions,...this.loadOptions,...e||{}},{onProgress:i,onError:r,strategy:o,retryCount:h,retryDelay:d}=n;let _=0;const g={},l=gh(t),m=br(t,M=>({alias:[M],src:M,data:{}})),y=m.reduce((M,S)=>M+(S.progressSize||1),0),w=m.map(async M=>{const S=$s.toAbsolute(M.src);g[M.src]||(await this._loadAssetWithRetry(S,M,{onProgress:i,onError:r,strategy:o,retryCount:h,retryDelay:d},g),_+=M.progressSize||1,i&&i(_/y))});return await Promise.all(w),l?g[m[0].src]:g}async unload(t){const n=br(t,i=>({alias:[i],src:i})).map(async i=>{var h,d;const r=$s.toAbsolute(i.src),o=this.promiseCache[r];if(o){const _=await o.promise;delete this.promiseCache[r],await((d=(h=o.parser)==null?void 0:h.unload)==null?void 0:d.call(h,_,i,this))}});await Promise.all(n)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?an("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&an(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,n,i){let r=0;const{onError:o,strategy:h,retryCount:d,retryDelay:_}=n,g=l=>new Promise(m=>setTimeout(m,l));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),i[e.src]=await this.promiseCache[t].promise;return}catch(l){delete this.promiseCache[t],delete i[e.src],r++;const m=h!=="retry"||r>d;if(h==="retry"&&!m){o&&o(l,e),await g(_);continue}if(h==="skip"){o&&o(l,e);return}throw o&&o(l,e),new Error(`[Loader.load] Failed to load ${t}.
${l}`)}}};py.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let t2=py;function ha(s,t){if(Array.isArray(t)){for(const e of t)if(s.startsWith(`data:${e}`))return!0;return!1}return s.startsWith(`data:${t}`)}function ua(s,t){const e=s.split("?")[0],n=$s.extname(e).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const e2=".json",n2="application/json",s2={extension:{type:kt.LoadParser,priority:Ui.Low},name:"loadJson",id:"json",test(s){return ha(s,n2)||ua(s,e2)},async load(s){return await(await en.get().fetch(s)).json()}},r2=".txt",i2="text/plain",o2={name:"loadTxt",id:"text",extension:{type:kt.LoadParser,priority:Ui.Low,name:"loadTxt"},test(s){return ha(s,i2)||ua(s,r2)},async load(s){return await(await en.get().fetch(s)).text()}},a2=["normal","bold","100","200","300","400","500","600","700","800","900"],l2=[".ttf",".otf",".woff",".woff2"],c2=["font/ttf","font/otf","font/woff","font/woff2"],h2=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function u2(s){const t=$s.extname(s),i=$s.basename(s,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(h=>h.charAt(0).toUpperCase()+h.slice(1));let r=i.length>0;for(const h of i)if(!h.match(h2)){r=!1;break}let o=i.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const d2=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function f2(s){return d2.test(s)?s:encodeURI(s)}const p2={extension:{type:kt.LoadParser,priority:Ui.Low},name:"loadWebFont",id:"web-font",test(s){return ha(s,c2)||ua(s,l2)},async load(s,t){var n,i,r;const e=en.get().getFontFaceSet();if(e){const o=[],h=((n=t.data)==null?void 0:n.family)??u2(s),d=((r=(i=t.data)==null?void 0:i.weights)==null?void 0:r.filter(g=>a2.includes(g)))??["normal"],_=t.data??{};for(let g=0;g<d.length;g++){const l=d[g],m=new FontFace(h,`url(${f2(s)})`,{..._,weight:l});await m.load(),e.add(m),o.push(m)}return on.has(`${h}-and-url`)?on.get(`${h}-and-url`).entries.push({url:s,faces:o}):on.set(`${h}-and-url`,{entries:[{url:s,faces:o}]}),o.length===1?o[0]:o}return an("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){const t=Array.isArray(s)?s:[s],e=t[0].family,n=on.get(`${e}-and-url`),i=n.entries.find(r=>r.faces.some(o=>t.indexOf(o)!==-1));i.faces=i.faces.filter(r=>t.indexOf(r)===-1),i.faces.length===0&&(n.entries=n.entries.filter(r=>r!==i)),t.forEach(r=>{en.get().getFontFaceSet().delete(r)}),n.entries.length===0&&on.remove(`${e}-and-url`)}};function df(s,t=1){var n;const e=(n=la.RETINA_PREFIX)==null?void 0:n.exec(s);return e?parseFloat(e[1]):t}function ff(s,t,e){s.label=e,s._sourceOrigin=e;const n=new Xt({source:s,label:e}),i=()=>{delete t.promiseCache[e],on.has(e)&&on.remove(e)};return n.source.once("destroy",()=>{t.promiseCache[e]&&(an("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),i())}),n.once("destroy",()=>{s.destroyed||(an("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),i())}),n}const m2=".svg",_2="image/svg+xml",g2={extension:{type:kt.LoadParser,priority:Ui.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(s){return ha(s,_2)||ua(s,m2)},async load(s,t,e){var n;return((n=t.data)==null?void 0:n.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?x2(s):y2(s,t,e,this.config.crossOrigin)},unload(s){s.destroy(!0)}};async function y2(s,t,e,n){var S,A,C;const i=await en.get().fetch(s),r=en.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await i.text())}`,r.crossOrigin=n,await r.decode();const o=((S=t.data)==null?void 0:S.width)??r.width,h=((A=t.data)==null?void 0:A.height)??r.height,d=((C=t.data)==null?void 0:C.resolution)||df(s),_=Math.ceil(o*d),g=Math.ceil(h*d),l=en.get().createCanvas(_,g),m=l.getContext("2d");m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(r,0,0,o*d,h*d);const{parseAsGraphicsContext:y,...w}=t.data??{},M=new yo({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:d,...w});return ff(M,e,s)}async function x2(s){const e=await(await en.get().fetch(s)).text(),n=new lr;return n.svg(e),n}const b2=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let ea=null,Qd=class{constructor(){ea||(ea=URL.createObjectURL(new Blob([b2],{type:"application/javascript"}))),this.worker=new Worker(ea)}};Qd.revokeObjectURL=function(){ea&&(URL.revokeObjectURL(ea),ea=null)};const w2=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let na=null;class my{constructor(){na||(na=URL.createObjectURL(new Blob([w2],{type:"application/javascript"}))),this.worker=new Worker(na)}}my.revokeObjectURL=function(){na&&(URL.revokeObjectURL(na),na=null)};let R_=0,Pd;class S2{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new Qd;e.addEventListener("message",n=>{e.terminate(),Qd.revokeObjectURL(),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){var n;return this._run("loadImageBitmap",[t,(n=e==null?void 0:e.data)==null?void 0:n.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Pd===void 0&&(Pd=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<Pd&&(this._createdWorkers++,t=new my().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const n=new Promise((i,r)=>{this._queue.push({id:t,arguments:e,resolve:i,reject:r})});return this._next(),n}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),n=e.id;this._resolveHash[R_]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:R_++,id:n})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t==null||t(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const B_=new S2,M2=[".jpeg",".jpg",".png",".webp",".avif"],A2=["image/jpeg","image/png","image/webp","image/avif"];async function v2(s,t){var i;const e=await en.get().fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const n=await e.blob();return((i=t==null?void 0:t.data)==null?void 0:i.alphaMode)==="premultiplied-alpha"?createImageBitmap(n,{premultiplyAlpha:"none"}):createImageBitmap(n)}const _y={name:"loadTextures",id:"texture",extension:{type:kt.LoadParser,priority:Ui.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return ha(s,A2)||ua(s,M2)},async load(s,t,e){var r;let n=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await B_.isImageBitmapSupported()?n=await B_.loadImageBitmap(s,t):n=await v2(s,t):n=await new Promise((o,h)=>{n=en.get().createImage(),n.crossOrigin=this.config.crossOrigin,n.src=s,n.complete?o(n):(n.onload=()=>{o(n)},n.onerror=h)});const i=new yo({resource:n,alphaMode:"premultiply-alpha-on-upload",resolution:((r=t.data)==null?void 0:r.resolution)||df(s),...t.data});return ff(i,e,s)},unload(s){s.destroy(!0)}},T2=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let Id,kd;function C2(s,t,e){e===void 0&&!t.startsWith("data:")?s.crossOrigin=P2(t):e!==!1&&(s.crossOrigin=typeof e=="string"?e:"anonymous")}function E2(s){return new Promise((t,e)=>{s.addEventListener("canplaythrough",n),s.addEventListener("error",i),s.load();function n(){r(),t()}function i(o){r(),e(o)}function r(){s.removeEventListener("canplaythrough",n),s.removeEventListener("error",i)}})}function P2(s,t=globalThis.location){if(s.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(s,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function I2(){const s=[],t=[];for(const e of T2){const n=fl.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Eh(n)&&(s.push(e),t.includes(n)||t.push(n))}return{validVideoExtensions:s,validVideoMime:t}}const k2={name:"loadVideo",id:"video",extension:{type:kt.LoadParser,name:"loadVideo"},test(s){if(!Id||!kd){const{validVideoExtensions:n,validVideoMime:i}=I2();Id=n,kd=i}const t=ha(s,kd),e=ua(s,Id);return t||e},async load(s,t,e){var d,_;const n={...fl.defaultOptions,resolution:((d=t.data)==null?void 0:d.resolution)||df(s),alphaMode:((_=t.data)==null?void 0:_.alphaMode)||await yg(),...t.data},i=document.createElement("video"),r={preload:n.autoLoad!==!1?"auto":void 0,"webkit-playsinline":n.playsinline!==!1?"":void 0,playsinline:n.playsinline!==!1?"":void 0,muted:n.muted===!0?"":void 0,loop:n.loop===!0?"":void 0,autoplay:n.autoPlay!==!1?"":void 0};Object.keys(r).forEach(g=>{const l=r[g];l!==void 0&&i.setAttribute(g,l)}),n.muted===!0&&(i.muted=!0),C2(i,s,n.crossorigin);const o=document.createElement("source");let h;if(n.mime)h=n.mime;else if(s.startsWith("data:"))h=s.slice(5,s.indexOf(";"));else if(!s.startsWith("blob:")){const g=s.split("?")[0].slice(s.lastIndexOf(".")+1).toLowerCase();h=fl.MIME_TYPES[g]||`video/${g}`}return o.src=s,h&&(o.type=h),new Promise(g=>{const l=async()=>{const m=new fl({...n,resource:i});i.removeEventListener("canplay",l),t.data.preload&&await E2(i),g(ff(m,e,s))};n.preload&&!n.autoPlay&&i.load(),i.addEventListener("canplay",l),i.appendChild(o)})},unload(s){s.destroy(!0)}},gy={extension:{type:kt.ResolveParser,name:"resolveTexture"},test:_y.test,parse:s=>{var t;return{resolution:parseFloat(((t=la.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:s.split(".").pop(),src:s}}},L2={extension:{type:kt.ResolveParser,priority:-2,name:"resolveJson"},test:s=>la.RETINA_PREFIX.test(s)&&s.endsWith(".json"),parse:gy.parse};class F2{constructor(){this._detections=[],this._initialized=!1,this.resolver=new la,this.loader=new t2,this.cache=on,this._backgroundLoader=new zT(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var r,o;if(this._initialized){an("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=((r=t.texturePreference)==null?void 0:r.resolution)??1,n=typeof e=="number"?[e]:e,i=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:i,resolution:n}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const n=gh(t),i=br(t).map(h=>{if(typeof h!="string"){const d=this.resolver.getAlias(h);return d.some(_=>!this.resolver.hasKey(_))&&this.add(h),Array.isArray(d)?d[0]:d}return this.resolver.hasKey(h)||this.add({alias:h,src:h}),h}),r=this.resolver.resolve(i),o=await this._mapLoadToResolve(r,e);return n?o[i[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const i=this.resolver.resolveBundle(t),r={},o=Object.keys(i);let h=0;const d=[],_=()=>{e==null||e(d.reduce((l,m)=>l+m,0)/h)},g=o.map((l,m)=>{const y=i[l],w=Object.values(y),S=[...new Set(w.flat())].reduce((A,C)=>A+(C.progressSize||1),0);return d.push(0),h+=S,this._mapLoadToResolve(y,A=>{d[m]=A*S,_()}).then(A=>{r[l]=A})});return await Promise.all(g),n?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return on.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=on.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const i=await this.loader.load(n,e);this._backgroundLoader.active=!0;const r={};return n.forEach(o=>{const h=i[o.src],d=[o.src];o.alias&&d.push(...o.alias),d.forEach(_=>{r[_]=h}),on.set(d,h)}),r}async unload(t){this._initialized||await this.init();const e=br(t).map(i=>typeof i!="string"?i.src:i),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=br(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map(i=>this._unloadFromResolved(e[i]));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(n=>{on.remove(n.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const n of t.detections)t.skipDetections||await n.test()?e=await n.add(e):t.skipDetections||(e=await n.remove(e));return e=e.filter((n,i)=>e.indexOf(n)===i),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(n=>n in t).forEach(n=>{e.config[n]=t[n]})})}}const ns=new F2;us.handleByList(kt.LoadParser,ns.loader.parsers).handleByList(kt.ResolveParser,ns.resolver.parsers).handleByList(kt.CacheParser,ns.cache.parsers).handleByList(kt.DetectionParser,ns.detections);us.add(VT,jT,$T,JT,KT,ZT,QT,s2,o2,p2,g2,_y,k2,XT,YT,gy,L2);const N_={loader:kt.LoadParser,resolver:kt.ResolveParser,cache:kt.CacheParser,detection:kt.DetectionParser};us.handle(kt.Asset,s=>{const t=s.ref;Object.entries(N_).filter(([e])=>!!t[e]).forEach(([e,n])=>us.add(Object.assign(t[e],{extension:t[e].extension??n})))},s=>{const t=s.ref;Object.keys(N_).filter(e=>!!t[e]).forEach(e=>us.remove(t[e]))});const yy={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},O2=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join(`
`);function R2(s){const t=yy[s],e=t.length;let n=O2,i="";const r="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;";let o;for(let h=0;h<s;h++){let d=r.replace("%index%",h.toString());o=h,h>=e&&(o=s-h-1),d=d.replace("%value%",t[o].toString()),i+=d,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",s.toString()),n}const B2=`
    in vec2 aPosition;

    uniform float uStrength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 uInputSize;
    uniform vec4 uOutputFrame;
    uniform vec4 uOutputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;

    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (uOutputFrame.zw * uInputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = uInputSize.%dimension% * uStrength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function N2(s,t){const e=Math.ceil(s/2);let n=B2,i="",r;t?r="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":r="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let o=0;o<s;o++){let h=r.replace("%index%",o.toString());h=h.replace("%sampleIndex%",`${o-(e-1)}.0`),i+=h,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",s.toString()),n=n.replace("%dimension%",t?"z":"w"),n}function W2(s,t){const e=N2(t,s),n=R2(t);return Ah.from({vertex:e,fragment:n,name:`blur-${s?"horizontal":"vertical"}-pass-filter`})}var D2=`

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct BlurUniforms {
  uStrength:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    %blur-struct%
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}


@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {

  let filteredCord = filterTextureCoord(aPosition);

  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;

  return VSOutput(
   filterVertexPosition(aPosition),
    %blur-vertex-out%
  );
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  %blur-fragment-in%
) -> @location(0) vec4<f32> {

    var   finalColor = vec4(0.0);

    %blur-sampling%

    return finalColor;
}`;function G2(s,t){const e=yy[t],n=e.length,i=[],r=[],o=[];for(let l=0;l<t;l++){i[l]=`@location(${l}) offset${l}: vec2<f32>,`,s?r[l]=`filteredCord + vec2(${l-n+1} * pixelStrength, 0.0),`:r[l]=`filteredCord + vec2(0.0, ${l-n+1} * pixelStrength),`;const m=l<n?l:t-l-1,y=e[m].toString();o[l]=`finalColor += textureSample(uTexture, uSampler, offset${l}) * ${y};`}const h=i.join(`
`),d=r.join(`
`),_=o.join(`
`),g=D2.replace("%blur-struct%",h).replace("%blur-vertex-out%",d).replace("%blur-fragment-in%",h).replace("%blur-sampling%",_).replace("%dimension%",s?"z":"w");return ca.from({vertex:{source:g,entryPoint:"mainVertex"},fragment:{source:g,entryPoint:"mainFragment"}})}const xy=class by extends Lg{constructor(t){t={...by.defaultOptions,...t};const e=W2(t.horizontal,t.kernelSize),n=G2(t.horizontal,t.kernelSize);super({glProgram:e,gpuProgram:n,resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...t}),this.horizontal=t.horizontal,this._quality=0,this.quality=t.quality,this.blur=t.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(t,e,n,i){if(this._uniforms.uStrength=this.strength/this.passes,this.passes===1)t.applyFilter(this,e,n,i);else{const r=oa.getSameSizeTexture(e);let o=e,h=r;this._state.blend=!1;const d=t.renderer.type===gl.WEBGPU;for(let _=0;_<this.passes-1;_++){t.applyFilter(this,o,h,_===0?!0:d);const g=h;h=o,o=g}this._state.blend=!0,t.applyFilter(this,o,n,i),oa.returnTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};xy.defaultOptions={strength:8,quality:4,kernelSize:5};let Ld=xy;class mo extends Lg{constructor(...t){let e=t[0]??{};typeof e=="number"&&(jt(Pe,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),e={strength:e},t[1]!==void 0&&(e.quality=t[1]),t[2]!==void 0&&(e.resolution=t[2]||"inherit"),t[3]!==void 0&&(e.kernelSize=t[3])),e={...Ld.defaultOptions,...e};const{strength:n,strengthX:i,strengthY:r,quality:o,...h}=e;super({...h,compatibleRenderers:gl.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new Ld({horizontal:!0,...e}),this.blurYFilter=new Ld({horizontal:!1,...e}),this.quality=o,this.strengthX=i??n,this.strengthY=r??n,this.repeatEdgePixels=!1}apply(t,e,n,i){const r=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(r&&o){const h=oa.getSameSizeTexture(e);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(t,e,h,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,h,n,i),oa.returnTexture(h)}else o?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,e,n,i)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(t,e,n,i))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))*2}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get strengthX(){return this.blurXFilter.blur}set strengthX(t){this.blurXFilter.blur=t,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(t){this.blurYFilter.blur=t,this.updatePadding()}get blur(){return jt("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength}set blur(t){jt("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength=t}get blurX(){return jt("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX}set blurX(t){jt("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX=t}get blurY(){return jt("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY}set blurY(t){jt("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}mo.defaultOptions={strength:8,quality:4,kernelSize:5};class ht extends nf{constructor(t){t instanceof lr&&(t={context:t});const{context:e,roundPixels:n,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new lr,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=n??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new ht(this._context.clone()):(this._ownedContext=null,new ht(this._context))}lineStyle(t,e,n){jt(Pe,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),n&&(i.alpha=n),this.context.strokeStyle=i,this}beginFill(t,e){jt(Pe,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const n={};return t!==void 0&&(n.color=t),e!==void 0&&(n.alpha=e),this.context.fillStyle=n,this}endFill(){jt(Pe,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==lr.defaultStrokeStyle.width||t.color!==lr.defaultStrokeStyle.color||t.alpha!==lr.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return jt(Pe,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return jt(Pe,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return jt(Pe,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return jt(Pe,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return jt(Pe,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return jt(Pe,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class Al extends ce{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const{animationSpeed:n=1,autoPlay:i=!1,autoUpdate:r=!0,loop:o=!0,onComplete:h=null,onFrameChange:d=null,onLoop:_=null,textures:g,updateAnchor:l=!1,...m}=e,[y]=g;super({...m,texture:y instanceof Xt?y:y.texture}),this._textures=null,this._durations=null,this._autoUpdate=r,this._isConnectedToTicker=!1,this.animationSpeed=n,this.loop=o,this.updateAnchor=l,this.onComplete=h,this.onFrameChange=d,this.onLoop=_,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=g,i&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Gi.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Gi.shared.add(this.update,this,_h.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,n=this.animationSpeed*e,i=this.currentFrame;if(this._durations!==null){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=n/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const o=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t=!1){if(typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._textures.forEach(i=>{this.texture!==i&&i.destroy(n)})}this._textures=[],this._durations=null,this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let n=0;n<t.length;++n)e.push(Xt.from(t[n]));return new Al(e)}static fromImages(t){const e=[];for(let n=0;n<t.length;++n)e.push(Xt.from(t[n]));return new Al(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Xt)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Gi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Gi.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class H2 extends nf{constructor(t,e){const{text:n,resolution:i,style:r,anchor:o,width:h,height:d,roundPixels:_,...g}=t;super({...g}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=n??"",this.style=r,this.resolution=i??null,this.allowChildren=!1,this._anchor=new hs({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=_??!1,h!==void 0&&(this.width=h),d!==void 0&&(this.height=d)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),(e=this._style)==null||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,n=this.bounds.height,i=-e*this.anchor.x;let r=0;return t.x>=i&&t.x<=i+e&&(r=-n*this.anchor.y,t.y>=r&&t.y<=r+n)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t!=null&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function U2(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(jt(Pe,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}let co=null,di=null;function Y2(s,t){co||(co=en.get().createCanvas(256,128),di=co.getContext("2d",{willReadFrequently:!0}),di.globalCompositeOperation="copy",di.globalAlpha=1),(co.width<s||co.height<t)&&(co.width=sa(s),co.height=sa(t))}function W_(s,t,e){for(let n=0,i=4*e*t;n<t;++n,i+=4)if(s[i+3]!==0)return!1;return!0}function D_(s,t,e,n,i){const r=4*t;for(let o=n,h=n*r+4*e;o<=i;++o,h+=r)if(s[h+3]!==0)return!1;return!0}function X2(...s){let t=s[0];t.canvas||(t={canvas:s[0],resolution:s[1]});const{canvas:e}=t,n=Math.min(t.resolution??1,1),i=t.width??e.width,r=t.height??e.height;let o=t.output;if(Y2(i,r),!di)throw new TypeError("Failed to get canvas 2D context");di.drawImage(e,0,0,i,r,0,0,i*n,r*n);const d=di.getImageData(0,0,i,r).data;let _=0,g=0,l=i-1,m=r-1;for(;g<r&&W_(d,i,g);)++g;if(g===r)return $t.EMPTY;for(;W_(d,i,m);)--m;for(;D_(d,i,_,g,m);)++_;for(;D_(d,i,l,g,m);)--l;return++l,++m,di.globalCompositeOperation="source-over",di.strokeRect(_,g,l-_,m-g),di.globalCompositeOperation="copy",o??(o=new $t),o.set(_/n,g/n,(l-_)/n,(m-g)/n),o}const G_=new $t;class z2{getCanvasAndContext(t){const{text:e,style:n,resolution:i=1}=t,r=n._getFinalPadding(),o=Gr.measureText(e||" ",n),h=Math.ceil(Math.ceil(Math.max(1,o.width)+r*2)*i),d=Math.ceil(Math.ceil(Math.max(1,o.height)+r*2)*i),_=Ml.getOptimalCanvasAndContext(h,d);this._renderTextToCanvas(e,n,r,i,_);const g=n.trim?X2({canvas:_.canvas,width:h,height:d,resolution:1,output:G_}):G_.set(0,0,h,d);return{canvasAndContext:_,frame:g}}returnCanvasAndContext(t){Ml.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,n,i,r){var I,O,$,W;const{canvas:o,context:h}=r,d=yh(e),_=Gr.measureText(t||" ",e),g=_.lines,l=_.lineHeight,m=_.lineWidths,y=_.maxLineWidth,w=_.fontProperties,M=o.height;if(h.resetTransform(),h.scale(i,i),h.textBaseline=e.textBaseline,(I=e._stroke)!=null&&I.width){const G=e._stroke;h.lineWidth=G.width,h.miterLimit=G.miterLimit,h.lineJoin=G.join,h.lineCap=G.cap}h.font=d;let S,A;const C=e.dropShadow?2:1;for(let G=0;G<C;++G){const lt=e.dropShadow&&G===0,J=lt?Math.ceil(Math.max(1,M)+n*2):0,st=J*i;if(lt){h.fillStyle="black",h.strokeStyle="black";const wt=e.dropShadow,vt=wt.color,ut=wt.alpha;h.shadowColor=Dn.shared.setValue(vt).setAlpha(ut).toRgbaString();const z=wt.blur*i,B=wt.distance*i;h.shadowBlur=z,h.shadowOffsetX=Math.cos(wt.angle)*B,h.shadowOffsetY=Math.sin(wt.angle)*B+st}else{if(h.fillStyle=e._fill?wh(e._fill,h,_,n*2):null,(O=e._stroke)!=null&&O.width){const wt=e._stroke.width*.5+n*2;h.strokeStyle=wh(e._stroke,h,_,wt)}h.shadowColor="black"}let tt=(l-w.fontSize)/2;l-w.fontSize<0&&(tt=0);const P=(($=e._stroke)==null?void 0:$.width)??0;for(let wt=0;wt<g.length;wt++)S=P/2,A=P/2+wt*l+w.ascent+tt,e.align==="right"?S+=y-m[wt]:e.align==="center"&&(S+=(y-m[wt])/2),(W=e._stroke)!=null&&W.width&&this._drawLetterSpacing(g[wt],e,r,S+n,A+n-J,!0),e._fill!==void 0&&this._drawLetterSpacing(g[wt],e,r,S+n,A+n-J)}}_drawLetterSpacing(t,e,n,i,r,o=!1){const{context:h}=n,d=e.letterSpacing;let _=!1;if(Gr.experimentalLetterSpacingSupported&&(Gr.experimentalLetterSpacing?(h.letterSpacing=`${d}px`,h.textLetterSpacing=`${d}px`,_=!0):(h.letterSpacing="0px",h.textLetterSpacing="0px")),d===0||_){o?h.strokeText(t,i,r):h.fillText(t,i,r);return}let g=i;const l=Gr.graphemeSegmenter(t);let m=h.measureText(t).width,y=0;for(let w=0;w<l.length;++w){const M=l[w];o?h.strokeText(M,g,r):h.fillText(M,g,r);let S="";for(let A=w+1;A<l.length;++A)S+=l[A];y=h.measureText(S).width,g+=m-y+d,m=y}}}const H_=new z2;class ft extends H2{constructor(...t){const e=U2(t,"Text");super(e,An),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof ra?e.textureStyle:new ra(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let n=0,i=0;if(this._style.trim){const{frame:r,canvasAndContext:o}=H_.getCanvasAndContext({text:this.text,style:this._style,resolution:1});H_.returnCanvasAndContext(o),n=r.width,i=r.height}else{const r=Gr.measureText(this._text,this._style);n=r.width,i=r.height}t.minX=-e._x*n,t.maxX=t.minX+n,t.minY=-e._y*i,t.maxY=t.minY+i}}us.add(HS,US);function Wn(s){return new Promise(t=>setTimeout(t,s))}function V2(s,t=.18){s=Math.max(0,Math.min(1,s));const e=s*s*(3-2*s);return s+(e-s)*t}function As(s){return 1-Math.pow(1-s,3)}function Qo(s){return s*s*s}function es(s,t=1.18){const e=t;return 1+(e+1)*Math.pow(s-1,3)+e*Math.pow(s-1,2)}function ie(s,t,e,n=As){const i=performance.now();function r(o){const h=Math.min(1,(o-i)/s),d=n(h);t(d),h<1?requestAnimationFrame(r):e==null||e()}requestAnimationFrame(r)}function me(s,t){return new Promise(e=>{const n=performance.now(),i=r=>{const o=(r-n)/s,h=Math.max(0,Math.min(1,o));t(h),h<1?requestAnimationFrame(i):e()};requestAnimationFrame(i)})}const Jd=[];let U_=!1;function Je(s){return Jd.push(s),s}function $2(s){U_||(U_=!0,s.ticker.add(()=>{const t=Math.min(.05,s.ticker.deltaMS/1e3);for(let e=0;e<Jd.length;e++)Jd[e](t)}))}let j2=1,q2=1;function K2(s){return Math.random}function wy(s,t){return{x:s%t,y:Math.floor(s/t)}}function Sh(s,t,e){return t*e+s}function Sy(s,t,e,n){return s>=0&&s<e&&t>=0&&t<n}function My(s,t){let e=0;for(const r in s)e+=s[r];const n=t()*e;let i=0;for(const r in s)if(i+=s[r],n<=i)return r;return Object.keys(s)[0]}function Z2(s,t,e){let n=0;for(let r=0;r<t.length;r++)n+=t[r];if(n<=0)return s[Math.floor(e()*s.length)];let i=e()*n;for(let r=0;r<s.length;r++)if(i-=t[r],i<=0)return s[r];return s[s.length-1]}function Fd(s){let t=0;for(let e=0;e<s.length;e++)s[e].id==="S1"&&t++;return t}function Q2(s,t,e){if(s==="S1"||s==="W1")return 0;const n=s.startsWith("L"),i=Number(s.slice(1))-1,r=e.find(o=>t>=o.min&&t<=o.max)??e[0];return n?r.L[i]??0:r.H[i]??0}function J2(s,t,e,n){const i=t*e,r=new Array(i).fill(!1),o=[],h=l=>s[l].id,d=["L1","L2","L3","L4","H1","H2","H3","H4","H5"];for(const l of d){r.fill(!1);for(let m=0;m<i;m++){if(r[m])continue;const y=h(m);if(!(y===l||y==="W1")){r[m]=!0;continue}const M=[m],S=[];for(r[m]=!0;M.length;){const A=M.pop();S.push(A);const{x:C,y:I}=wy(A,t),O=[{x:C+1,y:I},{x:C-1,y:I},{x:C,y:I+1},{x:C,y:I-1}];for(const $ of O){if(!Sy($.x,$.y,t,e))continue;const W=Sh($.x,$.y,t);if(r[W])continue;const G=h(W);(G===l||G==="W1")&&(r[W]=!0,M.push(W))}}S.length>=5&&o.push({id:l,positions:S,size:S.length,payoutX:Q2(l,S.length,n)})}}o.sort((l,m)=>m.payoutX-l.payoutX||m.size-l.size);const _=new Set,g=[];for(const l of o)l.positions.some(m=>_.has(m))||(l.positions.forEach(m=>_.add(m)),g.push(l));return g}function tC(s,t,e,n,i,r){const o=n*i,h=new Array(o).fill(null);for(let d=0;d<n;d++){const _=[];for(let g=i-1;g>=0;g--){const l=Sh(d,g,n);t.has(l)||_.push({id:s[l].id})}for(;_.length<i;)_.push({id:My(e,r)});for(let g=i-1;g>=0;g--)h[Sh(d,g,n)]=_[i-1-g]}return h}function eC(s,t,e,n){const i=t*e;return Array.from({length:i},()=>({id:My(s,n)}))}function nC(s,t,e,n,i){var pt;const r=K2(),o=!0,h=1;let d=0;globalThis.__SIM_VER__||(globalThis.__SIM_VER__=!0,console.log("[SIM] simulateSpin running "));const _=s.COLS,g=s.ROWS,l=s.LADDER,m=s.MAX_TUMBLES,y=s.TOTAL_WINX_CAP,w=s.SCATTER_THRESHOLD,M=s.FS_AWARD_BASE??10,S=s.FS_AWARD_FS??5,A=s.FS_TOTAL_CAP??20,C=2,I=1.6,O=1,$=t==="FREE_SPINS"?s.WEIGHTS_FS:s.WEIGHTS_BASE;let W=eC($,_,g,r);const G=W.map(ae=>({id:ae.id}));let lt=0;const J=Fd(W);let st=J;J>=w&&(lt+=t==="BASE"?M:S);const tt=[];let P=t==="FREE_SPINS"?n:0,wt=0,vt=!1,ut=!1;for(let ae=0;ae<m;ae++){const Dt=J2(W,_,g,s.PAY_BANDS);if(Dt.length&&(vt=!0),!Dt.length){if(vt&&o&&d<h){const ge=W.map(pe=>({id:pe.id})),ke=W.map((pe,de)=>de).filter(pe=>W[pe].id!=="W1"&&W[pe].id!=="S1");if(ke.length>0){const pe=[];for(const Be of ke){const{x:Fn,y:_n}=wy(Be,_),Ts=[{x:Fn+1,y:_n},{x:Fn-1,y:_n},{x:Fn,y:_n+1},{x:Fn,y:_n-1}];let qn=0,Cn=0;for(const le of Ts){if(!Sy(le.x,le.y,_,g))continue;const Ft=Sh(le.x,le.y,_),te=W[Ft].id;te.startsWith("H")?qn++:te==="W1"&&Cn++}const ve=1+qn*6+Cn*1;pe.push(ve)}const de=Z2(ke,pe,r);W[de]={id:"W1"},d++;const Kt=W.map(Be=>({id:Be.id}));tt.push({grid:ge,nextGrid:Kt,clusters:[],explodePositions:[],multiplier:1,stepWinX:0,aftershockWildSpawned:!0,aftershockWildIndex:de});continue}}break}let Yt=0;for(const ge of Dt){let ke=0;for(const pe of ge.positions)((pt=W[pe])==null?void 0:pt.id)==="W1"&&ke++;ke>=C&&(ge.payoutX*=I,Yt++)}const fn=t==="FREE_SPINS"?q2:j2;globalThis.__RTP_SCALE_ONCE__||(globalThis.__RTP_SCALE_ONCE__=!0);for(const ge of Dt)ge.payoutX*=fn;let Ie=P,Tn=!1;const se=Fd(W);let pn=0;ut||Dt.length>0&&se===2&&(Ie=P+O,ut=!0,Tn=!0,pn=se);const _e=l[Math.min(Ie,l.length-1)]??1,Ae=Dt.reduce((ge,ke)=>ge+ke.payoutX,0)*_e,jn=new Set;for(const ge of Dt)for(const ke of ge.positions)jn.add(ke);const Wt=Array.from(new Set(Dt.flatMap(ge=>ge.positions))),Re=tC(W,jn,$,_,g,r),Ln=Fd(Re);Ln>=w&&st<w&&(lt+=t==="BASE"?M:S),st=Ln,tt.push({grid:W,nextGrid:Re,clusters:Dt,explodePositions:Wt,multiplier:_e,stepWinX:Ae,scatterInfusionUsed:Tn,infusedScatters:pn,enchantedClusters:Yt,enchantedWildUsed:Yt>0}),wt+=Ae,W=Re,P++}wt=Math.min(wt,y);const B=Math.max(0,e-(t==="FREE_SPINS"?1:0))+lt,St=Math.min(A,B);return{mode:t,initialGrid:G,steps:tt,totalWinX:wt,fsAwarded:lt,fsRemainingAfter:St,ladderIndexAfter:P}}const tn=[1,2,3,5,8,12,20],pf={L1:22,L2:20,L3:18,L4:16,H1:8,H2:7,H3:6,H4:5,H5:2,W1:4,S1:2},sC={...pf,W1:6},ph={L1:"symbol_low_L1_gummy.png",L2:"symbol_low_L2_gummy.png",L3:"symbol_low_L3_gummy.png",L4:"symbol_low_L4_gummy.png",H1:"symbol_high_H1_choco.png",H2:"symbol_high_H2_choco.png",H3:"symbol_high_H3_hard.png",H4:"symbol_high_H4_hard.png",H5:"symbol_high_H5_hard.png",W1:"symbol_wild_W1_gummy.png",S1:"symbol_scatter_S1_gold.png"},rC=[{min:5,max:6,L:[.3,.4,.55,.75],H:[.32,.42,.58,.75,.95]},{min:7,max:8,L:[.6,.8,1.1,1.5],H:[.55,.75,1.05,1.4,1.8]},{min:9,max:10,L:[.95,1.25,1.8,2.4],H:[.95,1.4,2,2.8,3.6]},{min:11,max:12,L:[1.7,2.3,3.2,4.2],H:[2,3.1,4.6,6.8,8.8]},{min:13,max:15,L:[3.2,4.2,6,7.8],H:[4.2,6.8,10.5,15,19]},{min:16,max:19,L:[6.2,8.2,11.8,15.2],H:[9,15,24,36,46]},{min:20,max:999,L:[12,16.5,24,32],H:[18,30,55,95,120]}];function iC(s){const{COLS:t,ROWS:e,fsTotalCap:n}=s;return{COLS:t,ROWS:e,LADDER:tn,WEIGHTS_BASE:pf,WEIGHTS_FS:sC,PAY_BANDS:rC,SYMBOL_FRAMES:ph,MAX_TUMBLES:25,TOTAL_WINX_CAP:1e4,SCATTER_THRESHOLD:3,FS_AWARD_BASE:10,FS_AWARD_FS:5,FS_TOTAL_CAP:n}}function oC(s){var qs,_i,gi,ur,dr,Yi;const{app:t,root:e,state:n,uiDimmer:i,settingsBtnPixi:r,onClosed:o,texUI:h,setScaleToHeight:d,makePngButton:_,ICON_INFO:g,ICON_SFX_ON:l,ICON_SFX_OFF:m,ICON_MUSIC_ON:y,ICON_MUSIC_OFF:w,CLOSE_UP:M,CLOSE_HOVER:S,CLOSE_DOWN:A,getSfxMuted:C,setSfxMuted:I,getMusicMuted:O,setMusicMuted:$,applyAudioUI:W,makeSlider:G,getSfxValue01:lt,getMusicValue01:J,setSfxValue01:st,setMusicValue01:tt}=s,P=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||((_i=(qs=window.matchMedia)==null?void 0:qs.call(window,"(pointer: coarse)"))==null?void 0:_i.matches);function wt(){const mt=t.screen.width,Tt=t.screen.height,oe=mt/Tt;return(!!P||mt<820||oe<.9)&&mt>Tt}const vt=new et;vt.zIndex=9e3,e.addChild(vt),vt.visible=!1,vt.eventMode="static",vt.cursor="default";const ut=new et;ut.zIndex=9500,ut.visible=!1,ut.eventMode="static",vt.addChild(ut);const z=new ht;z.eventMode="static",z.cursor="default",z.on("pointertap",()=>Ln()),ut.addChild(z);const B=new ht;ut.addChild(B);const St=new ft("BLOCKY FARM  GAME INFO",new An({fontFamily:"Micro5",fontSize:38,fill:16765802,letterSpacing:2,stroke:{color:0,width:4}}));St.anchor.set(.5,0),ut.addChild(St);const pt=`
GAME RULES
Blocky Farm is a tumbling slot game using cluster pays.
A win is formed when 5 or more identical symbols connect anywhere on the grid.

Winning symbols explode and are removed. New symbols fall into place and may create
additional wins in the same spin. This continues until no further wins occur.

WAYS TO WIN
 Land 5 or more matching symbols to win
 Winning symbols tumble and can trigger multiple wins per spin
 Wilds substitute for all regular symbols except bonus symbols

GLOBAL MULTIPLIER
 Starts at 1 on every spin
 Increases by +1 after each winning tumble
 Applies to all wins during the spin
 Resets at the end of the spin

ENCHANTED WILDS
 Substitute for regular symbols
 May persist across tumbles
 Help extend winning sequences

INFUSED SCATTERS
 Contribute to triggering the Bonus Game
 Charge additional effects when collected
 Enhance the Bonus Game when activated

BONUS GAME
 Triggered by Scatter symbols
 Awards Free Spins
 Uses the same tumbling mechanics
 Features remain active during the bonus

PAYTABLE
Payouts depend on symbol type, cluster size, and multiplier.
Exact values are shown in the Paytable section.

GENERAL TERMS
 All wins are paid according to the paytable
 Malfunctions void all pays
 Incomplete games may be resumed
`,ae=new ft(pt,new An({fontFamily:"Arial",fontSize:20,fill:16777215,align:"center",wordWrap:!0,wordWrapWidth:760,lineHeight:30}));ae.anchor.set(.5,0);const Dt=new et;ut.addChild(Dt);const Yt=new ht;ut.addChild(Yt),Dt.addChild(ae),Dt.mask=Yt;let fn=0,Ie=0,Tn=0,se=0,pn=0,_e=!1,mn=0,Ae=0;B.eventMode="static",B.on("pointerdown",mt=>{_e=!0,mn=mt.global.y,Ae=fn}),B.on("pointerup",()=>_e=!1),B.on("pointerupoutside",()=>_e=!1),B.on("pointermove",mt=>{if(!_e)return;const Tt=mt.global.y-mn;jn(Ae+Tt)});function jn(mt){const Tt=ae.height,oe=Math.min(0,pn-Tt);mt<oe&&(mt=oe),mt>0&&(mt=0),fn=mt,Dt.y=Math.round(Tn+fn)}window.addEventListener("wheel",mt=>{ut.visible&&jn(fn-mt.deltaY)},{passive:!0});const Wt=new ht;Wt.eventMode="static",Wt.cursor="pointer",Wt.on("pointertap",()=>Ln()),ut.addChild(Wt);function Re(){ut.visible=!0,ge()}function Ln(){ut.visible=!1}function ge(){const mt=t.screen.width,Tt=t.screen.height;z.clear(),z.rect(0,0,mt,Tt).fill({color:0,alpha:.7});const oe=Math.min(900,Math.round(mt*.9)),ln=Math.min(700,Math.round(Tt*.85)),Ve=(mt-oe)/2,$e=(Tt-ln)/2;B.clear(),B.roundRect(Ve,$e,oe,ln,16).fill({color:723723,alpha:.95}).stroke({width:2,color:11579568,alpha:.35}),St.x=mt/2,St.y=$e+20;const ds=30,Gn=90;Ie=Ve+ds,Tn=$e+Gn,se=oe-ds*2,pn=ln-Gn-ds,Dt.x=Ie,ae.style.wordWrapWidth=se,ae.x=Math.round(se/2),ae.y=0,Yt.clear(),Yt.rect(Ie,Tn,se,pn).fill({color:16777215,alpha:1}),jn(fn);const On=Ve+oe-30,gs=$e+30;Wt.clear(),Wt.circle(On,gs,16).fill({color:0,alpha:.4}).stroke({width:2,color:16777215,alpha:.8}).moveTo(On-6,gs-6).lineTo(On+6,gs+6).moveTo(On+6,gs-6).lineTo(On-6,gs+6).stroke({width:3,color:16777215})}let ke=new $t;const pe=new ht;vt.addChild(pe);const de=new ht;vt.addChild(de),de.eventMode="static",de.cursor="default",de.on("pointerdown",mt=>{var Tt;return(Tt=mt.stopPropagation)==null?void 0:Tt.call(mt)}),de.on("pointertap",mt=>{var Tt;return(Tt=mt.stopPropagation)==null?void 0:Tt.call(mt)});const Kt=new et;vt.addChild(Kt);const Be=new ht;Kt.addChild(Be),Be.alpha=0;const Fn=new ce(h(g));Fn.anchor.set(.5),Fn.eventMode="none";const _n=new ft({text:"INFO",style:{fontFamily:"Micro5",fill:16765802,fontSize:35,fontWeight:"100",letterSpacing:2,stroke:{color:0,width:4}}});_n.anchor.set(0,.5),_n.eventMode="none",Kt.addChild(Fn,_n),Kt.eventMode="static",Kt.cursor="pointer",Kt.on("pointertap",mt=>{var Tt;(Tt=mt.stopPropagation)==null||Tt.call(mt),Re()}),Kt.on("pointerover",()=>{Be.alpha=.35}),Kt.on("pointerout",()=>{Be.alpha=0});function Ts(mt,Tt,oe){const ln=Math.round(oe*.86),Ve=wt()?56:70,$e=18,ds=-ln/2+48,Gn=ds+34;Kt.x=mt-12,Kt.y=Tt,Be.clear(),Be.roundRect(-ln/2,-Ve/2,ln,Ve,$e).fill(0),Kt.hitArea=new $t(-ln/2,-Ve/2,ln,Ve),Fn.x=ds,Fn.y=0,_n.x=Gn,_n.y=0}const qn=_(M,S,A,()=>vr());vt.addChild(qn);const Cn=200;qn.hitArea=new $t(-Cn/2,-Cn/2,Cn,Cn);const Ee=G(l,m,lt(),mt=>{var oe;st(mt);const Tt=mt<=.001;I(Tt),(oe=Ee.setMuted)==null||oe.call(Ee,C()),W()}),ve=G(y,w,J(),mt=>{var oe;tt(mt);const Tt=mt<=.001;$(Tt),(oe=ve.setMuted)==null||oe.call(ve,O()),W()});(gi=Ee.bindIconTap)==null||gi.call(Ee,()=>{var mt;I(!C()),(mt=Ee.setMuted)==null||mt.call(Ee,C()),W()}),(ur=ve.bindIconTap)==null||ur.call(ve,()=>{var mt;$(!O()),(mt=ve.setMuted)==null||mt.call(ve,O()),W()});function le(){const mt=new et,Tt=new ht;return mt.addChild(Tt),Tt.visible=!0,Tt.alpha=0,mt.eventMode="static",mt.cursor="pointer",mt.on("pointerover",()=>{Tt.alpha=.35}),mt.on("pointerout",()=>{Tt.alpha=0}),mt.on("pointertap",oe=>{var ln;return(ln=oe.stopPropagation)==null?void 0:ln.call(oe)}),mt._bg=Tt,mt}const Ft=le(),te=le();Ft.addChild(Ee),te.addChild(ve),vt.addChild(Ft,te);function _s(){var yi;const mt=wt();pe.clear(),pe.rect(0,0,t.screen.width,t.screen.height).fill({color:0,alpha:.001}),pe.eventMode="static",pe.cursor="default",(yi=pe.removeAllListeners)==null||yi.call(pe,"pointertap"),pe.on("pointertap",()=>vr());const Tt=t.screen.width,oe=t.screen.height,ln=(Tt<820||Tt/oe<.9)&&oe>=Tt,Ve=mt?Math.min(980,Math.round(Tt*.88)):ln?Math.min(900,Math.round(Tt*.72)):Math.min(520,Math.round(Tt*.55)),$e=mt?Math.min(280,Math.round(oe*.6)):ln?Math.min(520,Math.round(oe*.52)):Math.min(420,Math.round(oe*.35)),ds=0,Gn=Math.round(t.screen.width/2),On=Math.round(t.screen.height/2)-20;de.clear(),de.roundRect(Gn-Ve/2,On-$e/2,Ve,$e,ds).fill({color:723723,alpha:.75}).stroke({width:2,color:11579568,alpha:.35}),ke.x=Gn-Ve/2,ke.y=On-$e/2,ke.width=Ve,ke.height=$e;let gs,En,Hr;if(mt)gs=Math.round(On-$e/2+56),En=Math.round(gs+66),Hr=Math.round(En+66);else{const Cs=ln?90:110,fs=ln?60:80,Qs=On-$e/2+Cs,Sn=(On+$e/2-fs-Qs)/2;gs=Math.round(Qs+Sn*0),En=Math.round(Qs+Sn*1),Hr=Math.round(Qs+Sn*2)}Ts(Gn,gs,Ve),Ft.x=Gn,Ft.y=En,te.x=Gn,te.y=Hr,Ft.x=Gn,Ft.y=En,te.x=Gn,te.y=Hr;const rs=Math.round(Ve*.86),Ks=mt?56:70,Zs=mt?74:40,Xi=mt?34:40,fr=rs-Zs-Xi-60;function zi(Cs){const fs=Cs._bg;fs.clear(),fs.roundRect(-rs/2,-Ks/2,rs,Ks,18).fill(0),Cs.hitArea=new $t(-rs/2,-Ks/2,rs,Ks)}zi(Ft),zi(te);const Vi=-rs/2+Zs;Ee.layout(Vi,0,fr),ve.layout(Vi,0,fr),qn.x=Gn+Ve/2-36,qn.y=On-$e/2+36,d(qn,$e*.07)}function Ne(){vt.visible=!0,_s()}function js(){vt.visible=!1}function vr(){Ln(),n.ui.settingsOpen&&(n.ui.settingsOpen=!1,r.setOn(!1),js(),i.visible=!1,o())}return window.addEventListener("resize",_s),_s(),(dr=Ee.setMuted)==null||dr.call(Ee,C()),(Yi=ve.setMuted)==null||Yi.call(ve,O()),W(),{layer:vt,layout:_s,open:Ne,close:js,closeFromOutside:vr}}function aC(s){var Tl,Cl;let t=!1,e=0;const{app:n,root:i,state:r,audio:o,texExtra:h,setScaleToHeight:d,makePngButton:_,fmtMoney:g,updateBetUI:l,refreshSpinAffordability:m,enterFreeSpins:y,CLOSE_UP:w,CLOSE_HOVER:M,CLOSE_DOWN:S,BET_DOWN_UP:A,BET_DOWN_HOVER:C,BET_DOWN_DOWN:I,BET_UP_UP:O,BET_UP_HOVER:$,BET_UP_DOWN:W,waitMs:G,animateMs:lt,tween:J,easeOutCubic:st,easeOutBack:tt,easeInCubic:P}=s;function wt(H=.9){var Y,gt;(Y=o==null?void 0:o.initFromUserGesture)==null||Y.call(o),(gt=o==null?void 0:o.playSfx)==null||gt.call(o,"ui_click",H)}const vt=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||((Cl=(Tl=window.matchMedia)==null?void 0:Tl.call(window,"(pointer: coarse)"))==null?void 0:Cl.matches);function ut(){const H=n.screen.width,Y=n.screen.height;return(H<820||H/Y<.9)&&Y>=H}function z(){const H=n.screen.width,Y=n.screen.height,gt=H/Y;return(!!vt||H<820||gt<.9)&&H>Y}const B=s.onBalanceUpdated,St=new et;St.zIndex=9e3,St.visible=!1,St.eventMode="static",St.cursor="default",i.addChild(St),i.sortChildren();const pt=new ht;pt.eventMode="static",pt.cursor="default",St.addChild(pt);const ae=new ft({text:"BUY BONUS",style:{fontFamily:"Micro5",fill:16777215,fontSize:50,fontWeight:"100",letterSpacing:1,align:"center",stroke:{color:0,width:6}}});ae.anchor.set(.5),St.addChild(ae);const Dt=new ht;St.addChild(Dt);let Yt=0,fn=0;const Ie=_(w,M,S,()=>Ur());Ie.eventMode="static",Ie.cursor="pointer",St.addChild(Ie);const Tn=72;Ie.hitArea=new $t(-Tn/2,-Tn/2,Tn,Tn);const se=new et;se.eventMode="static",se.cursor="default",St.addChild(se);const pn=new ht;se.addChild(pn);const _e=new et;se.addChild(_e),_e.mask=pn;const mn=new et;mn.eventMode="none",mn.zIndex=99999,i.addChild(mn),i.sortChildren();const Ae=new ft({text:"",style:{fontFamily:"Micro5",stroke:{color:0,width:6},fill:16769248,fontSize:30,align:"center",letterSpacing:1}});Ae.anchor.set(.5),Ae.visible=!1,Ae.alpha=0,mn.addChild(Ae);let jn=null;function Wt(){const H=n.screen.width,Y=n.screen.height;Ae.x=Math.round(H/2),Ae.y=Math.round(Y-120)}function Re(H){Wt(),Ae.text=H,Ae.visible=!0,Ae.alpha=1,jn&&clearTimeout(jn),jn=setTimeout(()=>{const Y=performance.now(),gt=250,_t=()=>{const Ot=(performance.now()-Y)/gt;Ae.alpha=Math.max(0,1-Ot),Ot<1?requestAnimationFrame(_t):Ae.visible=!1};requestAnimationFrame(_t)},900)}const Ln="OOPS, NOT ENOUGH BALANCE",ge="OOPS  NOT ENOUGH BALANCE or CHANGE BET AMOUNT";function ke(){return ut()?Ln:ge}function pe(){var H,Y;Re(ke()),requestAnimationFrame(()=>{Wt(),de()}),r.ui.auto=!1,(Y=(H=s.autoBtnPixi)==null?void 0:H.setOn)==null||Y.call(H,!1)}function de(){if(!Ae.visible)return;const H=Ae.x,Y=12,gt=260,_t=performance.now();function Ot(ee){const Bt=Math.min(1,(ee-_t)/gt),Nt=1-Bt*Bt*(3-2*Bt),Zt=Math.sin(Bt*Math.PI*12)*Nt;Ae.x=Math.round(H+Zt*Y),Bt<1?requestAnimationFrame(Ot):Ae.x=H}requestAnimationFrame(Ot)}const Kt=new et;let Be=!1;Kt.eventMode="static",Kt.cursor="default",St.addChild(Kt);const Fn=new ht;Kt.addChild(Fn);const _n=new ht;Kt.addChild(_n);const Ts=new An({fontFamily:"Micro5",fill:11635967,fontSize:24,letterSpacing:2}),qn=new An({fontFamily:"Micro5",fill:16777215,fontSize:40,letterSpacing:1,stroke:{color:0,width:4}}),Cn=new ft({text:"BALANCE",style:Ts}),Ee=new ft({text:g(r.bank.balance),style:qn}),ve=new ft({text:"BET",style:Ts}),le=new ft({text:g(r.bank.betLevels[r.bank.betIndex]),style:qn});Kt.addChild(Cn,Ee,ve,le);const Ft=_(A,C,I,()=>{var H;(H=Ft.resetVisual)==null||H.call(Ft),r.bank.betIndex>0&&(r.bank.betIndex--,l(),m(),_s(),Ks(),Tr())}),te=_(O,$,W,()=>{var H;(H=te.resetVisual)==null||H.call(te),r.bank.betIndex<r.bank.betLevels.length-1&&(r.bank.betIndex++,l(),m(),_s(),Ks(),Tr())});Kt.addChild(Ft,te);function _s(){var H,Y;Ee.text=g(r.bank.balance),le.text=g(r.bank.betLevels[r.bank.betIndex]),(H=Ft.setEnabled)==null||H.call(Ft,r.bank.betIndex>0),(Y=te.setEnabled)==null||Y.call(te,r.bank.betIndex<r.bank.betLevels.length-1)}const Ne=new et;Ne.sortableChildren=!0,Ne.zIndex=99999,Ne.visible=!1,Ne.eventMode="none",i.addChild(Ne),i.sortChildren();const js=new ht;js.eventMode="static",js.cursor="default",Ne.addChild(js);const vr=new ht;Ne.addChild(vr);const qs=new ht;Ne.addChild(qs);let _i=1,gi=0;const ur=new ft({text:"",style:{fontFamily:"pixeldown",fill:16777215,fontSize:38,fontWeight:"100",align:"center",letterSpacing:2,dropShadow:!0,dropShadowAlpha:.6,dropShadowDistance:2,dropShadowBlur:0,dropShadowAngle:-Math.PI/4}});ur.anchor.set(.5),Ne.addChild(ur);const dr=new ft({text:"",style:{fontFamily:"Micro5",fill:16765802,fontSize:42,fontWeight:"100",align:"center",letterSpacing:2,dropShadow:!0,dropShadowAlpha:.65,dropShadowDistance:2,dropShadowBlur:0,dropShadowAngle:-Math.PI/4}});dr.anchor.set(.5),Ne.addChild(dr);function Yi(H,Y,gt="ui_click",_t=.9){const Ot=new et,ee=new ht,Bt=new ft({text:H,style:{fontFamily:"Micro5",fill:16777215,fontSize:45,fontWeight:"100",letterSpacing:2,align:"center",stroke:{color:0,width:4}}});Bt.anchor.set(.5),Bt.position.set(110,22),Ot.addChild(ee,Bt);function Nt(){ee.clear().rect(0,0,220,56).fill({color:1624420})}function Zt(){ee.clear().rect(0,0,220,56).fill({color:13840175}),Bt.style.fill=16777215}return Nt(),Ot.eventMode="static",Ot.cursor="pointer",Ot.on("pointertap",Le=>{var je,Rn,gn;(je=Le==null?void 0:Le.stopPropagation)==null||je.call(Le),(Rn=o==null?void 0:o.initFromUserGesture)==null||Rn.call(o),(gn=o==null?void 0:o.playSfx)==null||gn.call(o,gt,_t),Y()}),Ot.setLabel=Le=>Bt.text=Le,Ot.setRed=()=>Zt(),Ot.setGreen=()=>Nt(),Ot}let mt=null;const Tt=Yi("CONFIRM",()=>{const H=mt;Gn(),H==null||H()},"ui_click");Ne.addChild(Tt);let oe=0;function ln(){oe++;const H=oe,Y=6,gt=140,_t=220,Ot=1800,ee=()=>Tt._baseY??Tt.y;(async()=>{for(;H===oe&&Ne.visible;){const Bt=ee();Tt.y=Bt,await lt(gt,Nt=>{if(H!==oe)return;const Zt=tt(Nt,1.05);Tt.y=Bt-Y*Zt}),await lt(_t,Nt=>{if(H!==oe)return;const Zt=Nt*Nt*(3-2*Nt);Tt.y=Bt-Y+Y*Zt}),Tt.y=Bt,await G(Ot)}})()}function Ve(){oe++;const H=Tt._baseY??Tt.y;Tt.y=H}function $e(){const H=n.screen.width,Y=n.screen.height;js.clear().rect(0,0,H,Y).fill({color:0,alpha:.72});const gt=Math.min(460,H*.72),_t=210,Ot=(H-gt)/2,ee=(Y-_t)/2;vr.clear().rect(Ot,ee,gt,_t).fill(2829099).stroke({width:2,color:11579568,alpha:.35});const Bt=Math.round(H/2),Nt=50;ur.position.set(Bt,Math.round(Y/2-64)),dr.position.set(Bt,Math.round(ur.y+Nt));const Zt=Math.min(260,gt*.65),Le=Math.round((ur.y+dr.y)*.5),je=Zt*_i*.5;qs.clear(),qs.moveTo(H/2-je,Le),qs.lineTo(H/2+je,Le),qs.stroke({width:3,color:16777215,alpha:.85}),Tt.position.set(H/2-110,Y/2+20),Tt._baseY=Tt.y,i.sortChildren()}function ds(H,Y,gt){mt=gt,ur.text=H,dr.text=g(Y),$e(),_i=0,gi++;const _t=gi,Ot=400,ee=performance.now();function Bt(Nt){if(_t!==gi)return;const Zt=Math.min(1,(Nt-ee)/Ot);_i=Math.min(1,st(Zt)),$e(),Zt<1&&requestAnimationFrame(Bt)}requestAnimationFrame(Bt),Ne.visible=!0,Ne.eventMode="static",Ve(),ln()}function Gn(){Ve(),Ne.visible=!1,Ne.eventMode="none",mt=null}js.on("pointertap",()=>Gn());function On(H,Y){const gt=new et,_t=new ht,Ot=new ft({text:H,style:{fontFamily:"Micro5",fill:16777215,fontSize:45,fontWeight:"100",letterSpacing:2,align:"center",stroke:{color:0,width:4}}});Ot.anchor.set(.5),Ot.position.set(110,22),gt.addChild(_t,Ot);function ee(){_t.clear().rect(0,0,220,56).fill({color:1624420})}function Bt(){_t.clear().rect(0,0,220,56).fill({color:13840175})}return ee(),gt.eventMode="static",gt.cursor="pointer",gt.on("pointertap",Nt=>{var Zt;(Zt=Nt==null?void 0:Nt.stopPropagation)==null||Zt.call(Nt),wt(.9),Y()}),gt.setLabel=Nt=>Ot.text=Nt,gt.setRed=()=>Bt(),gt.setGreen=()=>ee(),gt}const gs=[{title:"PICK & MIX",body:`ENTRY BONUS
STARTS AT 1 MULTIPLIER`,priceMult:50,startMult:1,fsCount:10,artFrame:"buy_art_pick.png"},{title:"GIGA",body:`HIGHER VOLATILITY
STARTS AT 2 MULTIPLIER`,priceMult:75,startMult:2,fsCount:10,artFrame:"buy_art_giga.png"},{title:"SUPER",body:`STRONG FEATURE
STARTS AT 3 MULTIPLIER`,priceMult:100,startMult:3,fsCount:10,artFrame:"buy_art_super.png"},{title:"ULTRA",body:`MAXIMUM INTENSITY
STARTS AT 5 MULTIPLIER`,priceMult:150,startMult:5,fsCount:10,artFrame:"buy_art_ultra.png"}],En=[];function Hr(){const H=r.bank.betLevels[r.bank.betIndex];return typeof H=="number"?H:Number(H)}function rs(H){const Y=new et;Y.eventMode="static",Y.cursor="default";const gt=new ht;Y.addChild(gt);const _t=new ft({text:H.title,style:{fontFamily:"pixeldown",fill:16765802,fontSize:31,align:"center",letterSpacing:1,stroke:{color:0,width:5},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.85,dropShadowDistance:3,dropShadowBlur:0,dropShadowAngle:-Math.PI/4}});_t.anchor.set(.5,0),Y.addChild(_t);const Ot=new ce(h(H.artFrame));Ot.anchor.set(.5),Ot.roundPixels=!0,Ot.eventMode="none",Y.addChild(Ot),Y._art=Ot;const ee=new ft({text:H.body,style:{fontFamily:"Micro5",fill:16777215,fontSize:30,lineHeight:24,align:"center",letterSpacing:1}});ee.anchor.set(.5,0),Y.addChild(ee);const Bt=new ft({text:"",style:{fontFamily:"Micro5",fill:16777215,fontSize:37,align:"center",letterSpacing:2,stroke:{color:0,width:5},dropShadow:!1}});Bt.anchor.set(.5,0),Y.addChild(Bt);const Nt=On("BUY",()=>{const Te=Hr()*H.priceMult;if(r.bank.balance<Te){pe(),de(),window.open("https://stake.com/wallet","_blank","noopener,noreferrer");return}ds(H.title,Te,()=>{var We;r.bank.balance-=Te,(We=s.onBalanceUpdated)==null||We.call(s),m(),_s(),B==null||B(),Ur(),y(H.fsCount,H.startMult)})});Y.addChild(Nt),Nt.on("pointerdown",Te=>{var We;return(We=Te.stopPropagation)==null?void 0:We.call(Te)}),Nt.on("pointertap",Te=>{var We;return(We=Te.stopPropagation)==null?void 0:We.call(Te)});const Zt=12,Le=120,je=160;let Rn=0;Y._baseY=0;function gn(Te,We){Rn++;const ys=Rn,is=Y.y;J(We,It=>{if(ys!==Rn)return;const Lt=It*It*(3-2*It);Y.y=is+(Te-is)*Lt})}return Y.on("pointerover",()=>{var We,ys,is;(We=o==null?void 0:o.initFromUserGesture)==null||We.call(o),((ys=o==null?void 0:o.playSfxThrottled)==null?void 0:ys.call(o,"multiplier",120,.35,1))??((is=o==null?void 0:o.playSfx)==null||is.call(o,"multiplier",.35,1));const Te=Y._baseY??Y.y;gn(Te-Zt,Le),Y.canAfford||setTimeout(()=>{St.visible&&(Y.canAfford||(Re(ke()),requestAnimationFrame(()=>{Wt(),de()})))},250)}),Y.on("pointerout",()=>{const Te=Y._baseY??Y.y;gn(Te,je)}),Y._bg=gt,Y._title=_t,Y._body=ee,Y._price=Bt,Y._buyBtn=Nt,Y.canAfford=!1,Y}for(const H of gs){const Y=rs(H);_e.addChild(Y),En.push(Y)}function Ks(){for(let H=0;H<En.length;H++){const Y=gs[H],gt=Hr()*Y.priceMult,_t=En[H],Ot=_t._price,ee=_t._buyBtn,Bt=r.bank.balance>=gt;_t.canAfford=Bt,Ot.text=`${g(gt)}  (${Y.priceMult}x)`,Bt?(ee.setGreen(),ee.setLabel("BUY")):(ee.setRed(),ee.setLabel("TOP UP"));for(const Nt of _t.children)Nt===ee?Nt.alpha=1:Nt.alpha=Bt?1:.45}}let Zs=0,Xi=0,fr=!1,zi=0,Vi=0;function yi(H,Y,gt){return Math.max(Y,Math.min(gt,H))}se.on("pointerdown",H=>{var Y;ut()&&(fr=!0,zi=H.global.y,Vi=Zs,(Y=H.stopPropagation)==null||Y.call(H))}),se.on("pointerup",()=>{fr=!1}),se.on("pointerupoutside",()=>{fr=!1}),se.on("pointermove",H=>{var gt;if(!ut()||!fr)return;const Y=H.global.y-zi;Zs=yi(Vi+Y,-Xi,0),_e.y=Math.round(Zs),(gt=H.stopPropagation)==null||gt.call(H)});let Cs=0;function fs(){Cs++;const H=Cs,Y=En[3];if(!Y)return;const gt=Y._buyBtn;if(!gt)return;const _t=6,Ot=140,ee=220,Bt=1600,Nt=()=>gt._baseY??gt.y;(async()=>{for(;H===Cs&&St.visible;){if(Ne.visible){await G(120);continue}const Le=Nt();gt.y=Le,await lt(Ot,je=>{if(H!==Cs)return;const Rn=tt(je,1.05);gt.y=Le-_t*Rn}),await lt(ee,je=>{if(H!==Cs)return;const Rn=je*je*(3-2*je);gt.y=Le-_t+_t*Rn}),gt.y=Le,await G(Bt)}const Zt=Nt();gt.y=Zt})()}function Qs(){Cs++;const H=En[3],Y=H?H._buyBtn:null;Y&&(Y.y=Y._baseY??Y.y)}function Tr(){var Kn,Pl,Il,kl;const H=n.screen.width,Y=n.screen.height;pt.clear(),pt.rect(0,0,H,Y).fill({color:0,alpha:.85});const ee=ut()?.11:z()?.07:.27;ae.x=Math.round(H/2),ae.y=Math.round(Y*ee);const Bt=Math.min(340,H*.55),Nt=Math.round(ae.y+(z()?26:34)),Zt=Bt*Yt*.5;Dt.clear(),Dt.moveTo(Math.round(H/2-Zt),Nt),Dt.lineTo(Math.round(H/2+Zt),Nt),Dt.stroke({width:3,color:16777215,alpha:.85});const Le=26;if(Ie.x=Math.round(H-Le),Ie.y=Math.round(Le),d(Ie,Y*.045),!ut()){se.visible=!0,se.eventMode="passive",se.cursor="default",se.x=0,se.y=0,_e.mask=null,pn.clear(),Zs=0,_e.visible=!0,_e.alpha=1;const bs=320,Es=420,Js=22,Yr=4*bs+3*Js,pr=Math.min(1,H*.92/Yr);_e.scale.set(pr);const pa=-30;_e.scale.set(pr),_e.x=Math.round(H/2),_e.y=Math.round(Y*.55)+(z()?pa:0);for(let mr=0;mr<En.length;mr++){const Zn=En[mr],Pn=-Yr/2+bs/2+mr*(bs+Js);Zn.x=Pn,Zn.y=0,Zn._baseY=Zn.y,Zn._bg.clear().rect(-bs/2,-Es/2,bs,Es).fill(2829099).stroke({width:2,color:11579568,alpha:.35});const ma=Zn._title,ji=Zn._body,Xr=Zn._price,qi=Zn._art,zr=Zn._buyBtn;ma.x=0,ma.y=-Es/2+26,qi.x=0,qi.y=-Es/2+155;const bi=160,nn=Math.max(1,qi.texture.width);qi.scale.set(bi/nn),ji.x=0,ji.y=-Es/2+240,Xr.x=0,Xr.y=Es/2-120,zr.x=-110,zr.y=Es/2-70,zr._baseY=zr.y}}if(ut()){Kt.visible=!0,se.visible=!0,se.eventMode="static",_e.mask=pn,Kt.sortableChildren=!0,Cn.anchor.set(.5),Ee.anchor.set(.5),ve.anchor.set(.5),le.anchor.set(.5),d(te,30),d(Ft,30);const bs=22,Es=18,Js=54,Yr=Ee.width;(Kn=te.resetVisual)==null||Kn.call(te),(Pl=Ft.resetVisual)==null||Pl.call(Ft);const pr=((Il=te.btnWidth)==null?void 0:Il.call(te))??te.getLocalBounds().width,pa=((kl=Ft.btnWidth)==null?void 0:kl.call(Ft))??Ft.getLocalBounds().width,mr=Math.max(pr,pa);if(!t){const Ws=r.bank.betLevels[r.bank.betLevels.length-1]??0,Is=g(Number(Ws)),Nl=le.text;le.text=Is,e=le.width,le.text=Nl,t=!0}const Zn=e||le.width,Pn=0;ve.x=Pn,le.x=Pn;const ji=z()?10:36;ve.y=Math.round(-ji*.5),le.y=Math.round(ji*.5),Ft.x=Pn-Zn*.5-mr*.5-Es,Ft.y=le.y,te.x=Pn+Zn*.5+mr*.5+Es,te.y=le.y;const Xr=Pn+Math.max(Zn,140)*.5+Js+Math.max(Yr,160)*.5;if(Cn.x=Xr,Cn.y=-26,Ee.x=Xr,Ee.y=10,!Be){const Ws=Kt.getLocalBounds();Kt.pivot.set(Math.round(Ws.x+Ws.width*.5),Math.round(Ws.y+Ws.height*.5)),Be=!0}Kt.x=Math.round(H*.5);const zr=Kt.getLocalBounds().height+28;Kt.y=Math.round(Y-bs-zr*.5),Fn.clear();const bi=Kt.getLocalBounds();Fn.rect(bi.x-18,bi.y-14,bi.width+36,bi.height+28).fill({color:0,alpha:.25}),Fn.zIndex=-1;const nn=14,Fl=18,Ol=Math.round(ae.y+52),Ph=bs+zr,_a=nn,Ih=Ol,ga=Math.round(H-nn*2),Rl=Math.round(Y-Ph-Ol);se.x=_a,se.y=Ih,pn.clear(),pn.rect(0,0,ga,Rl).fill({color:16777215,alpha:1}),_e.x=Math.round(ga/2);const Vr=Math.min(520,Math.max(320,Math.floor(ga))),Ps=440;let ya=Math.round(Ps/2);for(let Ws=0;Ws<En.length;Ws++){const Is=En[Ws];Is.x=0,Is.y=ya,Is._baseY=Is.y,ya+=Ps+Fl,Is._bg.clear().rect(-Vr/2,-Ps/2,Vr,Ps).fill(2829099).stroke({width:2,color:11579568,alpha:.35});const Wl=Is._title,Dl=Is._body,So=Is._price,ks=Is._art,$r=Is._buyBtn;Wl.x=0,Wl.y=Math.round(-Ps*.5+22),ks.x=0;const Mo=28,Ao=28;ks.y=Math.round(-Ps*.5+135+Mo),Dl.y=Math.round(-Ps*.5+205+Ao);const xa=Math.round(Vr*.42),Gl=Math.max(1,ks.texture.width);ks.scale.set(xa/Gl),Dl.x=0,So.x=0,So.y=Math.round(Ps*.5-120),$r.x=-110,$r.y=Math.round(Ps*.5-76),$r._baseY=$r.y}const Bl=En.length*Ps+(En.length-1)*Fl;Xi=Math.max(0,Bl-Rl),Zs=yi(Zs,-Xi,0),_e.y=Math.round(Zs),Wt(),Ne.visible&&$e();return}const gn=z()?26:32,Te=2;Cn.y=Math.round(Te-gn*.5),Ee.y=Math.round(Te+gn*.5),ve.y=Math.round(Te-gn*.5),le.y=Math.round(Te+gn*.5);const We=Math.min(520,Math.round(H*.55)),ys=Math.round(Y*.9);Kt.x=Math.round(H/2),Kt.y=ys,Cn.anchor.set(0,.5),Ee.anchor.set(0,.5),Cn.x=-We/2+26,Ee.x=-We/2+26,ve.anchor.set(.5,.5),le.anchor.set(.5,.5),ve.x=0,le.x=0;const Lt=z()?26:32,Cr=2;ve.y=Math.round(Cr-Lt*.5),le.y=Math.round(Cr+Lt*.5);const bo=-2,$i=90;Ft.x=$i,te.x=$i;const wo=-10,Er=1,xi=z()?17:20,El=z()?wo:0,xs=le.y+bo+El;if(te.y=Math.round(xs-xi),Ft.y=Math.round(xs+xi),d(Ft,24),d(te,24),z()&&(Ft.scale.set(Ft.scale.x*Er,Ft.scale.y*Er),te.scale.set(te.scale.x*Er,te.scale.y*Er)),!ut()){const Js=Yr=>{const pr=Yr.getLocalBounds();Yr.hitArea=new $t(pr.x-26,pr.y-22,pr.width+52,pr.height+44)};Js(te),Js(Ft)}if(_s(),!ut()){_n.clear().roundRect(-130/2,-72/2,130,72,0).fill({color:7237230,alpha:.8});const Js=-6;_n.x=Math.round(le.x),_n.y=Math.round(le.y+Js)}if(Kt.sortableChildren=!0,_n.zIndex=0,ve.zIndex=1,le.zIndex=1,te.zIndex=1,Ft.zIndex=1,!ut()){const bs=Kt.getLocalBounds();Kt.x=Math.round(H*.5-(bs.x+bs.width*.5)),Kt.y=ys}Wt(),Ne.visible&&$e()}window.addEventListener("resize",()=>{t=!1,e=0,Be=!1,Tr()});function Sn(){var Ot,ee,Bt,Nt,Zt,Le,je,Rn,gn,Te,We,ys,is,It;t=!1,e=0,Be=!1,Be=!1,r.ui.buyMenuOpen=!0,St.visible=!0,St.eventMode="static",Yt=0,fn++;const H=fn,Y=400,gt=performance.now();function _t(Lt){if(H!==fn)return;const Cr=Math.min(1,(Lt-gt)/Y);Yt=Math.min(1,st(Cr)),Tr(),Cr<1&&requestAnimationFrame(_t)}requestAnimationFrame(_t),(ee=(Ot=s.spinBtnPixi)==null?void 0:Ot.setEnabled)==null||ee.call(Ot,!1),(Nt=(Bt=s.settingsBtnPixi)==null?void 0:Bt.setEnabled)==null||Nt.call(Bt,!1),(Le=(Zt=s.buyBtnPixi)==null?void 0:Zt.setEnabled)==null||Le.call(Zt,!1),(Rn=(je=s.autoBtnPixi)==null?void 0:je.setEnabled)==null||Rn.call(je,!1),(Te=(gn=s.turboBtnPixi)==null?void 0:gn.setEnabled)==null||Te.call(gn,!1),(ys=(We=s.betDownBtnPixi)==null?void 0:We.setEnabled)==null||ys.call(We,!1),(It=(is=s.betUpBtnPixi)==null?void 0:is.setEnabled)==null||It.call(is,!1),Tr(),Ks(),_s(),Qs(),fs(),i.sortChildren()}function Ur(){var H,Y,gt,_t,Ot,ee,Bt,Nt,Zt,Le,je,Rn,gn,Te,We,ys,is;r.ui.buyMenuOpen=!1,St.visible=!1,St.eventMode="none",(Y=(H=s.spinBtnPixi)==null?void 0:H.setEnabled)==null||Y.call(H,!r.ui.spinning),(_t=(gt=s.settingsBtnPixi)==null?void 0:gt.setEnabled)==null||_t.call(gt,!0),(ee=(Ot=s.buyBtnPixi)==null?void 0:Ot.setEnabled)==null||ee.call(Ot,!0),(Nt=(Bt=s.autoBtnPixi)==null?void 0:Bt.setEnabled)==null||Nt.call(Bt,!0),(Le=(Zt=s.turboBtnPixi)==null?void 0:Zt.setEnabled)==null||Le.call(Zt,!0),(Rn=(je=s.betDownBtnPixi)==null?void 0:je.setEnabled)==null||Rn.call(je,!0),(Te=(gn=s.betUpBtnPixi)==null?void 0:gn.setEnabled)==null||Te.call(gn,!0),(ys=(We=s.buyBtnPixi)==null?void 0:We.resetVisual)==null||ys.call(We),(is=Ie==null?void 0:Ie.resetVisual)==null||is.call(Ie),Qs()}return pt.on("pointertap",H=>{const Y=H.global,gt=se.getBounds(),_t=Kt.getBounds(),Ot=Y.x>=gt.x&&Y.x<=gt.x+gt.width&&Y.y>=gt.y&&Y.y<=gt.y+gt.height,ee=Y.x>=_t.x&&Y.x<=_t.x+_t.width&&Y.y>=_t.y&&Y.y<=_t.y+_t.height;Ot||ee||Ur()}),Tr(),{openBuy:Sn,closeBuy:Ur,layoutBuy:Tr,buyLayer:St,showToast:Re,showInsufficientToast:pe}}function lC(s){var vt;const{app:t,root:e,onPick:n,audio:i}=s,r=new et;r.visible=!1,r.eventMode="none",e.addChild(r),r.zIndex=7500,(vt=e.sortChildren)==null||vt.call(e);const o=s.uiDimmer??(()=>{const ut=new ht;return ut.eventMode="static",ut.cursor="pointer",r.addChild(ut),ut})();s.uiDimmer&&(o.parent||r.addChild(o),o.eventMode="static",o.cursor="pointer");const h=new et;r.addChild(h),h.scale.set(.6);const d=new ht;h.addChild(d);const _=new An({fontFamily:"Micro5, monospace",fontSize:54,fill:16761856,letterSpacing:2}),g=new An({fontFamily:"Micro5, monospace",fontSize:44,fill:16777215,letterSpacing:2}),l=new et;h.addChild(l),l.scale.set(1.12);const m=new ft({text:"AUTO PLAY",style:_}),y=new ft({text:"NUMBER OF ROUNDS",style:g});m.anchor.set(.5,0),y.anchor.set(.5,0),m.y=0,y.y=m.height+10,l.addChild(m,y);const w=new et;h.addChild(w);const M=[-1,10,25,50,75,100,500,1e3],S=[],A=new An({fontFamily:"Micro5, monospace",fontSize:60,fill:2829099,letterSpacing:1});let C=s.initialSelectedRounds??-999;const I=-10,O="btn_submenu_auto_up.png",$="btn_submenu_auto_down.png",W="btn_submenu_auto_on.png";function G(ut){C=ut;for(const z of S){const B=z.rounds===C;z.btn.texture=s.texAutoMenu(B?W:O),z.label.style=new An({...A,fill:2829099,fontSize:z.label.style.fontSize}),lt(z.btn,z.label,z.pressed?2:0)}}function lt(ut,z,B=0){const St=ut.getLocalBounds(),pt=St.x+St.width*.5,ae=St.y+St.height*.5;z.position.set(Math.round(pt),Math.round(ae+I+B))}function J(ut){const z=new et;z.eventMode="static",z.cursor="pointer";const B=new ce(s.texAutoMenu(O));B.anchor.set(.5),B.roundPixels=!0;const St=new ft({text:ut===-1?"":String(ut),style:A});St.anchor.set(.5),St.roundPixels=!0,z.addChild(B,St);const pt={rounds:ut,wrap:z,btn:B,label:St,pressed:!1};z.on("pointerdown",Dt=>{var Yt;(Yt=Dt.stopPropagation)==null||Yt.call(Dt),pt.pressed=!0,pt.btn.texture=s.texAutoMenu($),pt.btn.y=2,lt(pt.btn,pt.label,2)});const ae=()=>{pt.pressed=!1,pt.btn.y=0,pt.btn.texture=s.texAutoMenu(pt.rounds===C?W:O),lt(pt.btn,pt.label,0)};return z.on("pointerup",Dt=>{var Yt;(Yt=Dt.stopPropagation)==null||Yt.call(Dt),ae()}),z.on("pointerupoutside",ae),z.on("pointerout",()=>{pt.pressed&&ae()}),z.on("pointertap",Dt=>{var Yt;(Yt=Dt.stopPropagation)==null||Yt.call(Dt),i==null||i.playSfx("ui_click",.85),G(ut),n(ut)}),z.hitArea=new $t(-90,-90,180,180),pt}for(const ut of M){const z=J(ut);S.push(z),w.addChild(z.wrap)}o.on("pointertap",()=>tt()),h.eventMode="static",h.on("pointertap",ut=>ut.stopPropagation());function st(){var ut;r.visible=!0,r.eventMode="static",(ut=e.sortChildren)==null||ut.call(e),wt()}function tt(){var ut;i==null||i.playSfx("ui_toggle",.9),r.visible=!1,r.eventMode="none",(ut=s.onClosed)==null||ut.call(s)}function P(){return r.visible}function wt(){const ut=t.renderer.width,z=t.renderer.height;o.clear(),o.beginFill(0,.65),o.drawRect(0,0,ut,z),o.endFill();const B=z>=ut,St=Math.min(ut*(B?.86:.55),640),pt=Math.min(z*(B?.95:.82),B?1100:980),ae=h.scale.x,Dt=B?window.innerWidth:ut,Yt=B?window.innerHeight:z;h.x=Math.round((Dt-St*ae)*.5),h.y=Math.round((Yt-pt*ae)*.5),B&&(h.y-=80),d.clear(),d.beginFill(2039583,.92),d.drawRoundedRect(0,0,St,pt,36),d.endFill(),d.beginFill(16777215,.06),d.drawRoundedRect(10,10,St-20,120,30),d.endFill();const fn=10,Ie=10,Tn=St-20,se=120;y.y=Math.round(m.height+10);const pn=l.getLocalBounds();l.pivot.set(pn.x+pn.width*.5,pn.y+pn.height*.5),l.x=Math.round(fn+Tn*.5),l.y=Math.round(Ie+se*.5),l.y+=-6;const _e=2,mn=4,Ae=200,jn=44,Wt=24,Re=pt-Ae-jn,Ln=(mn-1)*Wt,ge=Math.max(1,Re-Ln),ke=St/_e,pe=ge/mn,de=Math.min(ke,pe)*.28,Kt=Math.max(44,Math.min(62,de)),Be=Kt*2,Fn=s.texAutoMenu(O),_n=s.texAutoMenu($),Ts=s.texAutoMenu(W),qn=Math.max(Fn.width||1,_n.width||1,Ts.width||1),Cn=Math.max(Fn.height||1,_n.height||1,Ts.height||1),ve=Math.min(Be/qn,Be/Cn)*2;for(let le=0;le<S.length;le++){const Ft=S[le],te=le%_e,_s=Math.floor(le/_e),Ne=Math.round(te*ke+ke*.5),js=Math.round(Ae+_s*(pe+Wt)+pe*.5);Ft.wrap.x=Ne,Ft.wrap.y=js;const vr=Ft.rounds===C?W:O;Ft.btn.texture=s.texAutoMenu(vr),Ft.btn.scale.set(ve);const qs=Math.round(Math.max(34,Math.min(60,Kt*.95)));Ft.label.style=new An({...A,fontSize:qs}),lt(Ft.btn,Ft.label,Ft.pressed?2:0)}G(C===-999?-1:C)}return G(C),{layer:r,open:st,close:tt,layout:wt,isOpen:P,setSelected:G}}var _o={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var t=function(){this.init()};t.prototype={init:function(){var l=this||e;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var m=this||e;if(l=parseFloat(l),m.ctx||g(),typeof l<"u"&&l>=0&&l<=1){if(m._volume=l,m._muted)return m;m.usingWebAudio&&m.masterGain.gain.setValueAtTime(l,e.ctx.currentTime);for(var y=0;y<m._howls.length;y++)if(!m._howls[y]._webAudio)for(var w=m._howls[y]._getSoundIds(),M=0;M<w.length;M++){var S=m._howls[y]._soundById(w[M]);S&&S._node&&(S._node.volume=S._volume*l)}return m}return m._volume},mute:function(l){var m=this||e;m.ctx||g(),m._muted=l,m.usingWebAudio&&m.masterGain.gain.setValueAtTime(l?0:m._volume,e.ctx.currentTime);for(var y=0;y<m._howls.length;y++)if(!m._howls[y]._webAudio)for(var w=m._howls[y]._getSoundIds(),M=0;M<w.length;M++){var S=m._howls[y]._soundById(w[M]);S&&S._node&&(S._node.muted=l?!0:S._muted)}return m},stop:function(){for(var l=this||e,m=0;m<l._howls.length;m++)l._howls[m].stop();return l},unload:function(){for(var l=this||e,m=l._howls.length-1;m>=0;m--)l._howls[m].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close<"u"&&(l.ctx.close(),l.ctx=null,g()),l},codecs:function(l){return(this||e)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||e;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var m=new Audio;typeof m.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var m=new Audio;m.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||e,m=null;try{m=typeof Audio<"u"?new Audio:null}catch{return l}if(!m||typeof m.canPlayType!="function")return l;var y=m.canPlayType("audio/mpeg;").replace(/^no$/,""),w=l._navigator?l._navigator.userAgent:"",M=w.match(/OPR\/(\d+)/g),S=M&&parseInt(M[0].split("/")[1],10)<33,A=w.indexOf("Safari")!==-1&&w.indexOf("Chrome")===-1,C=w.match(/Version\/(.*?) /),I=A&&C&&parseInt(C[1],10)<15;return l._codecs={mp3:!!(!S&&(y||m.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!y,opus:!!m.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!m.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!m.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(m.canPlayType('audio/wav; codecs="1"')||m.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!m.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!m.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(m.canPlayType("audio/x-m4a;")||m.canPlayType("audio/m4a;")||m.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(m.canPlayType("audio/x-m4b;")||m.canPlayType("audio/m4b;")||m.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(m.canPlayType("audio/x-mp4;")||m.canPlayType("audio/mp4;")||m.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!I&&m.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!I&&m.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!m.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(m.canPlayType("audio/x-flac;")||m.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||e;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var m=function(y){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var w=new Audio;w._unlocked=!0,l._releaseHtml5Audio(w)}catch{l.noAudio=!0;break}for(var M=0;M<l._howls.length;M++)if(!l._howls[M]._webAudio)for(var S=l._howls[M]._getSoundIds(),A=0;A<S.length;A++){var C=l._howls[M]._soundById(S[A]);C&&C._node&&!C._node._unlocked&&(C._node._unlocked=!0,C._node.load())}l._autoResume();var I=l.ctx.createBufferSource();I.buffer=l._scratchBuffer,I.connect(l.ctx.destination),typeof I.start>"u"?I.noteOn(0):I.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),I.onended=function(){I.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",m,!0),document.removeEventListener("touchend",m,!0),document.removeEventListener("click",m,!0),document.removeEventListener("keydown",m,!0);for(var O=0;O<l._howls.length;O++)l._howls[O]._emit("unlock")}};return document.addEventListener("touchstart",m,!0),document.addEventListener("touchend",m,!0),document.addEventListener("click",m,!0),document.addEventListener("keydown",m,!0),l}},_obtainHtml5Audio:function(){var l=this||e;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var m=new Audio().play();return m&&typeof Promise<"u"&&(m instanceof Promise||typeof m.then=="function")&&m.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var m=this||e;return l._unlocked&&m._html5AudioPool.push(l),m},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!e.usingWebAudio)){for(var m=0;m<l._howls.length;m++)if(l._howls[m]._webAudio){for(var y=0;y<l._howls[m]._sounds.length;y++)if(!l._howls[m]._sounds[y]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var w=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(w,w)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!e.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var m=0;m<l._howls.length;m++)l._howls[m]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var e=new t,n=function(l){var m=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}m.init(l)};n.prototype={init:function(l){var m=this;return e.ctx||g(),m._autoplay=l.autoplay||!1,m._format=typeof l.format!="string"?l.format:[l.format],m._html5=l.html5||!1,m._muted=l.mute||!1,m._loop=l.loop||!1,m._pool=l.pool||5,m._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,m._rate=l.rate||1,m._sprite=l.sprite||{},m._src=typeof l.src!="string"?l.src:[l.src],m._volume=l.volume!==void 0?l.volume:1,m._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},m._duration=0,m._state="unloaded",m._sounds=[],m._endTimers={},m._queue=[],m._playLock=!1,m._onend=l.onend?[{fn:l.onend}]:[],m._onfade=l.onfade?[{fn:l.onfade}]:[],m._onload=l.onload?[{fn:l.onload}]:[],m._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],m._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],m._onpause=l.onpause?[{fn:l.onpause}]:[],m._onplay=l.onplay?[{fn:l.onplay}]:[],m._onstop=l.onstop?[{fn:l.onstop}]:[],m._onmute=l.onmute?[{fn:l.onmute}]:[],m._onvolume=l.onvolume?[{fn:l.onvolume}]:[],m._onrate=l.onrate?[{fn:l.onrate}]:[],m._onseek=l.onseek?[{fn:l.onseek}]:[],m._onunlock=l.onunlock?[{fn:l.onunlock}]:[],m._onresume=[],m._webAudio=e.usingWebAudio&&!m._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(m),m._autoplay&&m._queue.push({event:"play",action:function(){m.play()}}),m._preload&&m._preload!=="none"&&m.load(),m},load:function(){var l=this,m=null;if(e.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var y=0;y<l._src.length;y++){var w,M;if(l._format&&l._format[y])w=l._format[y];else{if(M=l._src[y],typeof M!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}w=/^data:audio\/([^;,]+);/i.exec(M),w||(w=/\.([^.]+)$/.exec(M.split("?",1)[0])),w&&(w=w[1].toLowerCase())}if(w||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),w&&e.codecs(w)){m=l._src[y];break}}if(!m){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=m,l._state="loading",window.location.protocol==="https:"&&m.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new i(l),l._webAudio&&o(l),l},play:function(l,m){var y=this,w=null;if(typeof l=="number")w=l,l=null;else{if(typeof l=="string"&&y._state==="loaded"&&!y._sprite[l])return null;if(typeof l>"u"&&(l="__default",!y._playLock)){for(var M=0,S=0;S<y._sounds.length;S++)y._sounds[S]._paused&&!y._sounds[S]._ended&&(M++,w=y._sounds[S]._id);M===1?l=null:w=null}}var A=w?y._soundById(w):y._inactiveSound();if(!A)return null;if(w&&!l&&(l=A._sprite||"__default"),y._state!=="loaded"){A._sprite=l,A._ended=!1;var C=A._id;return y._queue.push({event:"play",action:function(){y.play(C)}}),C}if(w&&!A._paused)return m||y._loadQueue("play"),A._id;y._webAudio&&e._autoResume();var I=Math.max(0,A._seek>0?A._seek:y._sprite[l][0]/1e3),O=Math.max(0,(y._sprite[l][0]+y._sprite[l][1])/1e3-I),$=O*1e3/Math.abs(A._rate),W=y._sprite[l][0]/1e3,G=(y._sprite[l][0]+y._sprite[l][1])/1e3;A._sprite=l,A._ended=!1;var lt=function(){A._paused=!1,A._seek=I,A._start=W,A._stop=G,A._loop=!!(A._loop||y._sprite[l][2])};if(I>=G){y._ended(A);return}var J=A._node;if(y._webAudio){var st=function(){y._playLock=!1,lt(),y._refreshBuffer(A);var vt=A._muted||y._muted?0:A._volume;J.gain.setValueAtTime(vt,e.ctx.currentTime),A._playStart=e.ctx.currentTime,typeof J.bufferSource.start>"u"?A._loop?J.bufferSource.noteGrainOn(0,I,86400):J.bufferSource.noteGrainOn(0,I,O):A._loop?J.bufferSource.start(0,I,86400):J.bufferSource.start(0,I,O),$!==1/0&&(y._endTimers[A._id]=setTimeout(y._ended.bind(y,A),$)),m||setTimeout(function(){y._emit("play",A._id),y._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?st():(y._playLock=!0,y.once("resume",st),y._clearTimer(A._id))}else{var tt=function(){J.currentTime=I,J.muted=A._muted||y._muted||e._muted||J.muted,J.volume=A._volume*e.volume(),J.playbackRate=A._rate;try{var vt=J.play();if(vt&&typeof Promise<"u"&&(vt instanceof Promise||typeof vt.then=="function")?(y._playLock=!0,lt(),vt.then(function(){y._playLock=!1,J._unlocked=!0,m?y._loadQueue():y._emit("play",A._id)}).catch(function(){y._playLock=!1,y._emit("playerror",A._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),A._ended=!0,A._paused=!0})):m||(y._playLock=!1,lt(),y._emit("play",A._id)),J.playbackRate=A._rate,J.paused){y._emit("playerror",A._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||A._loop?y._endTimers[A._id]=setTimeout(y._ended.bind(y,A),$):(y._endTimers[A._id]=function(){y._ended(A),J.removeEventListener("ended",y._endTimers[A._id],!1)},J.addEventListener("ended",y._endTimers[A._id],!1))}catch(ut){y._emit("playerror",A._id,ut)}};J.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(J.src=y._src,J.load());var P=window&&window.ejecta||!J.readyState&&e._navigator.isCocoonJS;if(J.readyState>=3||P)tt();else{y._playLock=!0,y._state="loading";var wt=function(){y._state="loaded",tt(),J.removeEventListener(e._canPlayEvent,wt,!1)};J.addEventListener(e._canPlayEvent,wt,!1),y._clearTimer(A._id)}}return A._id},pause:function(l){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"pause",action:function(){m.pause(l)}}),m;for(var y=m._getSoundIds(l),w=0;w<y.length;w++){m._clearTimer(y[w]);var M=m._soundById(y[w]);if(M&&!M._paused&&(M._seek=m.seek(y[w]),M._rateSeek=0,M._paused=!0,m._stopFade(y[w]),M._node))if(m._webAudio){if(!M._node.bufferSource)continue;typeof M._node.bufferSource.stop>"u"?M._node.bufferSource.noteOff(0):M._node.bufferSource.stop(0),m._cleanBuffer(M._node)}else(!isNaN(M._node.duration)||M._node.duration===1/0)&&M._node.pause();arguments[1]||m._emit("pause",M?M._id:null)}return m},stop:function(l,m){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"stop",action:function(){y.stop(l)}}),y;for(var w=y._getSoundIds(l),M=0;M<w.length;M++){y._clearTimer(w[M]);var S=y._soundById(w[M]);S&&(S._seek=S._start||0,S._rateSeek=0,S._paused=!0,S._ended=!0,y._stopFade(w[M]),S._node&&(y._webAudio?S._node.bufferSource&&(typeof S._node.bufferSource.stop>"u"?S._node.bufferSource.noteOff(0):S._node.bufferSource.stop(0),y._cleanBuffer(S._node)):(!isNaN(S._node.duration)||S._node.duration===1/0)&&(S._node.currentTime=S._start||0,S._node.pause(),S._node.duration===1/0&&y._clearSound(S._node))),m||y._emit("stop",S._id))}return y},mute:function(l,m){var y=this;if(y._state!=="loaded"||y._playLock)return y._queue.push({event:"mute",action:function(){y.mute(l,m)}}),y;if(typeof m>"u")if(typeof l=="boolean")y._muted=l;else return y._muted;for(var w=y._getSoundIds(m),M=0;M<w.length;M++){var S=y._soundById(w[M]);S&&(S._muted=l,S._interval&&y._stopFade(S._id),y._webAudio&&S._node?S._node.gain.setValueAtTime(l?0:S._volume,e.ctx.currentTime):S._node&&(S._node.muted=e._muted?!0:l),y._emit("mute",S._id))}return y},volume:function(){var l=this,m=arguments,y,w;if(m.length===0)return l._volume;if(m.length===1||m.length===2&&typeof m[1]>"u"){var M=l._getSoundIds(),S=M.indexOf(m[0]);S>=0?w=parseInt(m[0],10):y=parseFloat(m[0])}else m.length>=2&&(y=parseFloat(m[0]),w=parseInt(m[1],10));var A;if(typeof y<"u"&&y>=0&&y<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,m)}}),l;typeof w>"u"&&(l._volume=y),w=l._getSoundIds(w);for(var C=0;C<w.length;C++)A=l._soundById(w[C]),A&&(A._volume=y,m[2]||l._stopFade(w[C]),l._webAudio&&A._node&&!A._muted?A._node.gain.setValueAtTime(y,e.ctx.currentTime):A._node&&!A._muted&&(A._node.volume=y*e.volume()),l._emit("volume",A._id))}else return A=w?l._soundById(w):l._sounds[0],A?A._volume:0;return l},fade:function(l,m,y,w){var M=this;if(M._state!=="loaded"||M._playLock)return M._queue.push({event:"fade",action:function(){M.fade(l,m,y,w)}}),M;l=Math.min(Math.max(0,parseFloat(l)),1),m=Math.min(Math.max(0,parseFloat(m)),1),y=parseFloat(y),M.volume(l,w);for(var S=M._getSoundIds(w),A=0;A<S.length;A++){var C=M._soundById(S[A]);if(C){if(w||M._stopFade(S[A]),M._webAudio&&!C._muted){var I=e.ctx.currentTime,O=I+y/1e3;C._volume=l,C._node.gain.setValueAtTime(l,I),C._node.gain.linearRampToValueAtTime(m,O)}M._startFadeInterval(C,l,m,y,S[A],typeof w>"u")}}return M},_startFadeInterval:function(l,m,y,w,M,S){var A=this,C=m,I=y-m,O=Math.abs(I/.01),$=Math.max(4,O>0?w/O:w),W=Date.now();l._fadeTo=y,l._interval=setInterval(function(){var G=(Date.now()-W)/w;W=Date.now(),C+=I*G,C=Math.round(C*100)/100,I<0?C=Math.max(y,C):C=Math.min(y,C),A._webAudio?l._volume=C:A.volume(C,l._id,!0),S&&(A._volume=C),(y<m&&C<=y||y>m&&C>=y)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,A.volume(y,l._id),A._emit("fade",l._id))},$)},_stopFade:function(l){var m=this,y=m._soundById(l);return y&&y._interval&&(m._webAudio&&y._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(y._interval),y._interval=null,m.volume(y._fadeTo,l),y._fadeTo=null,m._emit("fade",l)),m},loop:function(){var l=this,m=arguments,y,w,M;if(m.length===0)return l._loop;if(m.length===1)if(typeof m[0]=="boolean")y=m[0],l._loop=y;else return M=l._soundById(parseInt(m[0],10)),M?M._loop:!1;else m.length===2&&(y=m[0],w=parseInt(m[1],10));for(var S=l._getSoundIds(w),A=0;A<S.length;A++)M=l._soundById(S[A]),M&&(M._loop=y,l._webAudio&&M._node&&M._node.bufferSource&&(M._node.bufferSource.loop=y,y&&(M._node.bufferSource.loopStart=M._start||0,M._node.bufferSource.loopEnd=M._stop,l.playing(S[A])&&(l.pause(S[A],!0),l.play(S[A],!0)))));return l},rate:function(){var l=this,m=arguments,y,w;if(m.length===0)w=l._sounds[0]._id;else if(m.length===1){var M=l._getSoundIds(),S=M.indexOf(m[0]);S>=0?w=parseInt(m[0],10):y=parseFloat(m[0])}else m.length===2&&(y=parseFloat(m[0]),w=parseInt(m[1],10));var A;if(typeof y=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,m)}}),l;typeof w>"u"&&(l._rate=y),w=l._getSoundIds(w);for(var C=0;C<w.length;C++)if(A=l._soundById(w[C]),A){l.playing(w[C])&&(A._rateSeek=l.seek(w[C]),A._playStart=l._webAudio?e.ctx.currentTime:A._playStart),A._rate=y,l._webAudio&&A._node&&A._node.bufferSource?A._node.bufferSource.playbackRate.setValueAtTime(y,e.ctx.currentTime):A._node&&(A._node.playbackRate=y);var I=l.seek(w[C]),O=(l._sprite[A._sprite][0]+l._sprite[A._sprite][1])/1e3-I,$=O*1e3/Math.abs(A._rate);(l._endTimers[w[C]]||!A._paused)&&(l._clearTimer(w[C]),l._endTimers[w[C]]=setTimeout(l._ended.bind(l,A),$)),l._emit("rate",A._id)}}else return A=l._soundById(w),A?A._rate:l._rate;return l},seek:function(){var l=this,m=arguments,y,w;if(m.length===0)l._sounds.length&&(w=l._sounds[0]._id);else if(m.length===1){var M=l._getSoundIds(),S=M.indexOf(m[0]);S>=0?w=parseInt(m[0],10):l._sounds.length&&(w=l._sounds[0]._id,y=parseFloat(m[0]))}else m.length===2&&(y=parseFloat(m[0]),w=parseInt(m[1],10));if(typeof w>"u")return 0;if(typeof y=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,m)}}),l;var A=l._soundById(w);if(A)if(typeof y=="number"&&y>=0){var C=l.playing(w);C&&l.pause(w,!0),A._seek=y,A._ended=!1,l._clearTimer(w),!l._webAudio&&A._node&&!isNaN(A._node.duration)&&(A._node.currentTime=y);var I=function(){C&&l.play(w,!0),l._emit("seek",w)};if(C&&!l._webAudio){var O=function(){l._playLock?setTimeout(O,0):I()};setTimeout(O,0)}else I()}else if(l._webAudio){var $=l.playing(w)?e.ctx.currentTime-A._playStart:0,W=A._rateSeek?A._rateSeek-A._seek:0;return A._seek+(W+$*Math.abs(A._rate))}else return A._node.currentTime;return l},playing:function(l){var m=this;if(typeof l=="number"){var y=m._soundById(l);return y?!y._paused:!1}for(var w=0;w<m._sounds.length;w++)if(!m._sounds[w]._paused)return!0;return!1},duration:function(l){var m=this,y=m._duration,w=m._soundById(l);return w&&(y=m._sprite[w._sprite][1]/1e3),y},state:function(){return this._state},unload:function(){for(var l=this,m=l._sounds,y=0;y<m.length;y++)m[y]._paused||l.stop(m[y]._id),l._webAudio||(l._clearSound(m[y]._node),m[y]._node.removeEventListener("error",m[y]._errorFn,!1),m[y]._node.removeEventListener(e._canPlayEvent,m[y]._loadFn,!1),m[y]._node.removeEventListener("ended",m[y]._endFn,!1),e._releaseHtml5Audio(m[y]._node)),delete m[y]._node,l._clearTimer(m[y]._id);var w=e._howls.indexOf(l);w>=0&&e._howls.splice(w,1);var M=!0;for(y=0;y<e._howls.length;y++)if(e._howls[y]._src===l._src||l._src.indexOf(e._howls[y]._src)>=0){M=!1;break}return r&&M&&delete r[l._src],e.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,m,y,w){var M=this,S=M["_on"+l];return typeof m=="function"&&S.push(w?{id:y,fn:m,once:w}:{id:y,fn:m}),M},off:function(l,m,y){var w=this,M=w["_on"+l],S=0;if(typeof m=="number"&&(y=m,m=null),m||y)for(S=0;S<M.length;S++){var A=y===M[S].id;if(m===M[S].fn&&A||!m&&A){M.splice(S,1);break}}else if(l)w["_on"+l]=[];else{var C=Object.keys(w);for(S=0;S<C.length;S++)C[S].indexOf("_on")===0&&Array.isArray(w[C[S]])&&(w[C[S]]=[])}return w},once:function(l,m,y){var w=this;return w.on(l,m,y,1),w},_emit:function(l,m,y){for(var w=this,M=w["_on"+l],S=M.length-1;S>=0;S--)(!M[S].id||M[S].id===m||l==="load")&&(setTimeout((function(A){A.call(this,m,y)}).bind(w,M[S].fn),0),M[S].once&&w.off(l,M[S].fn,M[S].id));return w._loadQueue(l),w},_loadQueue:function(l){var m=this;if(m._queue.length>0){var y=m._queue[0];y.event===l&&(m._queue.shift(),m._loadQueue()),l||y.action()}return m},_ended:function(l){var m=this,y=l._sprite;if(!m._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(m._ended.bind(m,l),100),m;var w=!!(l._loop||m._sprite[y][2]);if(m._emit("end",l._id),!m._webAudio&&w&&m.stop(l._id,!0).play(l._id),m._webAudio&&w){m._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=e.ctx.currentTime;var M=(l._stop-l._start)*1e3/Math.abs(l._rate);m._endTimers[l._id]=setTimeout(m._ended.bind(m,l),M)}return m._webAudio&&!w&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,m._clearTimer(l._id),m._cleanBuffer(l._node),e._autoSuspend()),!m._webAudio&&!w&&m.stop(l._id,!0),m},_clearTimer:function(l){var m=this;if(m._endTimers[l]){if(typeof m._endTimers[l]!="function")clearTimeout(m._endTimers[l]);else{var y=m._soundById(l);y&&y._node&&y._node.removeEventListener("ended",m._endTimers[l],!1)}delete m._endTimers[l]}return m},_soundById:function(l){for(var m=this,y=0;y<m._sounds.length;y++)if(l===m._sounds[y]._id)return m._sounds[y];return null},_inactiveSound:function(){var l=this;l._drain();for(var m=0;m<l._sounds.length;m++)if(l._sounds[m]._ended)return l._sounds[m].reset();return new i(l)},_drain:function(){var l=this,m=l._pool,y=0,w=0;if(!(l._sounds.length<m)){for(w=0;w<l._sounds.length;w++)l._sounds[w]._ended&&y++;for(w=l._sounds.length-1;w>=0;w--){if(y<=m)return;l._sounds[w]._ended&&(l._webAudio&&l._sounds[w]._node&&l._sounds[w]._node.disconnect(0),l._sounds.splice(w,1),y--)}}},_getSoundIds:function(l){var m=this;if(typeof l>"u"){for(var y=[],w=0;w<m._sounds.length;w++)y.push(m._sounds[w]._id);return y}else return[l]},_refreshBuffer:function(l){var m=this;return l._node.bufferSource=e.ctx.createBufferSource(),l._node.bufferSource.buffer=r[m._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,e.ctx.currentTime),m},_cleanBuffer:function(l){var m=this,y=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(!l.bufferSource)return m;if(e._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),y))try{l.bufferSource.buffer=e._scratchBuffer}catch{}return l.bufferSource=null,m},_clearSound:function(l){var m=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);m||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(l){this._parent=l,this.init()};i.prototype={init:function(){var l=this,m=l._parent;return l._muted=m._muted,l._loop=m._loop,l._volume=m._volume,l._rate=m._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,m._sounds.push(l),l.create(),l},create:function(){var l=this,m=l._parent,y=e._muted||l._muted||l._parent._muted?0:l._volume;return m._webAudio?(l._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),l._node.gain.setValueAtTime(y,e.ctx.currentTime),l._node.paused=!0,l._node.connect(e.masterGain)):e.noAudio||(l._node=e._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(e._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=m._src,l._node.preload=m._preload===!0?"auto":m._preload,l._node.volume=y*e.volume(),l._node.load()),l},reset:function(){var l=this,m=l._parent;return l._muted=m._muted,l._loop=m._loop,l._volume=m._volume,l._rate=m._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++e._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,m=l._parent;m._duration=Math.ceil(l._node.duration*10)/10,Object.keys(m._sprite).length===0&&(m._sprite={__default:[0,m._duration*1e3]}),m._state!=="loaded"&&(m._state="loaded",m._emit("load"),m._loadQueue()),l._node.removeEventListener(e._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,m=l._parent;m._duration===1/0&&(m._duration=Math.ceil(l._node.duration*10)/10,m._sprite.__default[1]===1/0&&(m._sprite.__default[1]=m._duration*1e3),m._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var r={},o=function(l){var m=l._src;if(r[m]){l._duration=r[m].duration,_(l);return}if(/^data:[^;]+;base64,/.test(m)){for(var y=atob(m.split(",")[1]),w=new Uint8Array(y.length),M=0;M<y.length;++M)w[M]=y.charCodeAt(M);d(w.buffer,l)}else{var S=new XMLHttpRequest;S.open(l._xhr.method,m,!0),S.withCredentials=l._xhr.withCredentials,S.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(A){S.setRequestHeader(A,l._xhr.headers[A])}),S.onload=function(){var A=(S.status+"")[0];if(A!=="0"&&A!=="2"&&A!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+S.status+".");return}d(S.response,l)},S.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete r[m],l.load())},h(S)}},h=function(l){try{l.send()}catch{l.onerror()}},d=function(l,m){var y=function(){m._emit("loaderror",null,"Decoding audio data failed.")},w=function(M){M&&m._sounds.length>0?(r[m._src]=M,_(m,M)):y()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(l).then(w).catch(y):e.ctx.decodeAudioData(l,w,y)},_=function(l,m){m&&!l._duration&&(l._duration=m.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},g=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),m=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),y=m?parseInt(m[1],10):null;if(l&&y&&y<9){var w=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!w&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};s.Howler=e,s.Howl=n,typeof Ja<"u"?(Ja.HowlerGlobal=t,Ja.Howler=e,Ja.Howl=n,Ja.Sound=i):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=n,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var i=n._howls.length-1;i>=0;i--)n._howls[i].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,i){var r=this;if(!r.ctx||!r.ctx.listener)return r;if(n=typeof n!="number"?r._pos[1]:n,i=typeof i!="number"?r._pos[2]:i,typeof e=="number")r._pos=[e,n,i],typeof r.ctx.listener.positionX<"u"?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]);else return r._pos;return r},HowlerGlobal.prototype.orientation=function(e,n,i,r,o,h){var d=this;if(!d.ctx||!d.ctx.listener)return d;var _=d._orientation;if(n=typeof n!="number"?_[1]:n,i=typeof i!="number"?_[2]:i,r=typeof r!="number"?_[3]:r,o=typeof o!="number"?_[4]:o,h=typeof h!="number"?_[5]:h,typeof e=="number")d._orientation=[e,n,i,r,o,h],typeof d.ctx.listener.forwardX<"u"?(d.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),d.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),d.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),d.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),d.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),d.ctx.listener.upZ.setTargetAtTime(h,Howler.ctx.currentTime,.1)):d.ctx.listener.setOrientation(e,n,i,r,o,h);else return _;return d},Howl.prototype.init=function(e){return function(n){var i=this;return i._orientation=n.orientation||[1,0,0],i._stereo=n.stereo||null,i._pos=n.pos||null,i._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},i._onstereo=n.onstereo?[{fn:n.onstereo}]:[],i._onpos=n.onpos?[{fn:n.onpos}]:[],i._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var r=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof e=="number")i._stereo=e,i._pos=[e,0,0];else return i._stereo;for(var o=i._getSoundIds(n),h=0;h<o.length;h++){var d=i._soundById(o[h]);if(d)if(typeof e=="number")d._stereo=e,d._pos=[e,0,0],d._node&&(d._pannerAttr.panningModel="equalpower",(!d._panner||!d._panner.pan)&&t(d,r),r==="spatial"?typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),d._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),d._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):d._panner.setPosition(e,0,0):d._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",d._id);else return d._stereo}return i},Howl.prototype.pos=function(e,n,i,r){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(e,n,i,r)}}),o;if(n=typeof n!="number"?0:n,i=typeof i!="number"?-.5:i,typeof r>"u")if(typeof e=="number")o._pos=[e,n,i];else return o._pos;for(var h=o._getSoundIds(r),d=0;d<h.length;d++){var _=o._soundById(h[d]);if(_)if(typeof e=="number")_._pos=[e,n,i],_._node&&((!_._panner||_._panner.pan)&&t(_,"spatial"),typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):_._panner.setPosition(e,n,i)),o._emit("pos",_._id);else return _._pos}return o},Howl.prototype.orientation=function(e,n,i,r){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(e,n,i,r)}}),o;if(n=typeof n!="number"?o._orientation[1]:n,i=typeof i!="number"?o._orientation[2]:i,typeof r>"u")if(typeof e=="number")o._orientation=[e,n,i];else return o._orientation;for(var h=o._getSoundIds(r),d=0;d<h.length;d++){var _=o._soundById(h[d]);if(_)if(typeof e=="number")_._orientation=[e,n,i],_._node&&(_._panner||(_._pos||(_._pos=o._pos||[0,0,-.5]),t(_,"spatial")),typeof _._panner.orientationX<"u"?(_._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),_._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),_._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):_._panner.setOrientation(e,n,i)),o._emit("orientation",_._id);else return _._orientation}return o},Howl.prototype.pannerAttr=function(){var e=this,n=arguments,i,r,o;if(!e._webAudio)return e;if(n.length===0)return e._pannerAttr;if(n.length===1)if(typeof n[0]=="object")i=n[0],typeof r>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),e._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:e._panningModel});else return o=e._soundById(parseInt(n[0],10)),o?o._pannerAttr:e._pannerAttr;else n.length===2&&(i=n[0],r=parseInt(n[1],10));for(var h=e._getSoundIds(r),d=0;d<h.length;d++)if(o=e._soundById(h[d]),o){var _=o._pannerAttr;_={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:_.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:_.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:_.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:_.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:_.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:_.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:_.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:_.panningModel};var g=o._panner;g||(o._pos||(o._pos=e._pos||[0,0,-.5]),t(o,"spatial"),g=o._panner),g.coneInnerAngle=_.coneInnerAngle,g.coneOuterAngle=_.coneOuterAngle,g.coneOuterGain=_.coneOuterGain,g.distanceModel=_.distanceModel,g.maxDistance=_.maxDistance,g.refDistance=_.refDistance,g.rolloffFactor=_.rolloffFactor,g.panningModel=_.panningModel}return e},Sound.prototype.init=function(e){return function(){var n=this,i=n._parent;n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,e.call(this),n._stereo?i.stereo(n._stereo):n._pos&&i.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,i=n._parent;return n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,n._stereo?i.stereo(n._stereo):n._pos?i.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,i._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var t=function(e,n){n=n||"spatial",n==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()})(_o);const Y_=.2,cC=.9;class hC{constructor(t={}){dn(this,"musicDuckTarget",1);dn(this,"musicDuckCurrent",1);dn(this,"musicDuckToken",0);dn(this,"inited",!1);dn(this,"sfxMuted",!1);dn(this,"musicMuted",!1);dn(this,"sfxVolume01",.8);dn(this,"musicVolume01",.6);dn(this,"sfx");dn(this,"music");dn(this,"musicBaseLayers",[]);dn(this,"baseIntensity01",0);dn(this,"baseLayersInited",!1);dn(this,"tickId",null);dn(this,"tickGain",2.3);dn(this,"tickOn",!1);dn(this,"tickLastRate",1);dn(this,"tickLastVol",0);dn(this,"fsIntroTractor");dn(this,"fsIntroTractorId",null);dn(this,"fsIntroTractorVolMul",.85);dn(this,"currentMusic",null);dn(this,"currentMusicKey",null);this.sfxMuted=!!t.sfxMuted,this.musicMuted=!!t.musicMuted,typeof t.sfxVolume01=="number"&&(this.sfxVolume01=al(t.sfxVolume01)),typeof t.musicVolume01=="number"&&(this.musicVolume01=al(t.musicVolume01)),this.sfx={infused:this.makeSfx("/assets/audio/infused.mp3"),ui_click:this.makeSfx("/assets/audio/ui_click.mp3"),confirm:this.makeSfx("/assets/audio/confirm.mp3"),ui_toggle:this.makeSfx("/assets/audio/ui_toggle.mp3"),spin_start:this.makeSfx("/assets/audio/spin_start.mp3"),reel_land:this.makeSfx("/assets/audio/reel_land.mp3"),cluster_pop:this.makeSfx("/assets/audio/cluster_pop.mp3"),fs_click:this.makeSfx("/assets/audio/fs_click.mp3"),explode:this.makeSfx("/assets/audio/explode.mp3"),car:this.makeSfx("/assets/audio/car.mp3"),bonus_trigger:this.makeSfx("/assets/audio/bonus_trigger.mp3"),fs_intro:this.makeSfx("/assets/audio/fs_intro.mp3"),fs_outro:this.makeSfx("/assets/audio/fs_outro.mp3"),fstrigger:this.makeSfx("/assets/audio/fstrigger.mp3"),bigwin_hit:this.makeSfx("/assets/audio/bigwin_hit.mp3"),bigwin_super:this.makeSfx("/assets/audio/bigwin_super.mp3"),bigwin_mega:this.makeSfx("/assets/audio/bigwin_mega.mp3"),bigwin_epic:this.makeSfx("/assets/audio/bigwin_epic.mp3"),bigwin_max:this.makeSfx("/assets/audio/bigwin_max.mp3"),final_amount:this.makeSfx("/assets/audio/final_amount.mp3"),final_fsoutro_amount:this.makeSfx("/assets/audio/final_fsoutro_amount.mp3"),bounce:this.makeSfx("/assets/audio/bounce.mp3"),boosted:this.makeSfx("/assets/audio/boosted.mp3"),tick:this.makeSfx("/assets/audio/tick.mp3"),multiplier:this.makeSfx("/assets/audio/multiplier.mp3")},this.fsIntroTractor=new _o.Howl({src:["/assets/audio/tractor.mp3"],preload:!0,html5:!1,volume:0,sprite:{loop:[Y_*1e3,(cC-Y_)*1e3,!0]}}),console.log("[AUDIO] explode howl exists?",!!this.sfx.explode),this.sfx.explode.on("load",()=>console.log("[AUDIO] explode LOADED ")),this.sfx.explode.on("loaderror",(e,n)=>console.warn("[AUDIO] explode LOAD ERROR ",n)),this.sfx.explode.on("playerror",(e,n)=>console.warn("[AUDIO] explode PLAY ERROR ",n)),this.music={music_base:this.makeMusic("/assets/audio/music_base.mp3"),music_fs:this.makeMusic("/assets/audio/music_free.mp3"),music_bigwin:this.makeMusic("/assets/audio/music_bigwin.mp3")},this.musicBaseLayers=[this.makeMusic("/assets/audio/music_base_drums.mp3"),this.makeMusic("/assets/audio/music_base_drums.mp3"),this.makeMusic("/assets/audio/mmusic_base_drums.mp3")];for(const e of this.musicBaseLayers)e.volume(0);this.apply()}getBaseMusicIntensity01(){return this.baseIntensity01}ensureBaseLayersPlaying(){if(!this.baseLayersInited){this.baseLayersInited=!0;for(const t of this.musicBaseLayers){try{t.stop()}catch{}t.volume(0),t.play()}}}stopBaseLayers(t=250){this.baseLayersInited=!1;for(const e of this.musicBaseLayers)if(e){if(e.playing()){const n=e.volume();e.fade(n,0,t),setTimeout(()=>e.stop(),t+20)}else try{e.stop()}catch{}e.volume(0)}}setBaseMusicIntensity(t,e=250){if(this.currentMusicKey!=="music_base")return;if(this.baseIntensity01=al(t),this.musicMuted){for(const d of this.musicBaseLayers)d.playing()&&d.volume(0);return}this.ensureBaseLayersPlaying();const n=this.baseIntensity01,i=this.musicVolume01*(.55+.45*n),r=this.musicVolume01*X_((n-.2)/.45),o=this.musicVolume01*X_((n-.55)/.35),h=[i,r,o];for(let d=0;d<this.musicBaseLayers.length;d++){const _=this.musicBaseLayers[d];if(!_)continue;const g=h[d]??0,l=_.volume();_.fade(l,g,e)}}duckMusic(t,e=300){this.musicDuckToken++;const n=this.musicDuckToken,i=this.musicDuckCurrent,r=Math.max(0,Math.min(1,t)),o=performance.now(),h=()=>{if(n!==this.musicDuckToken)return;const d=Math.min(1,(performance.now()-o)/e),_=d*d*(3-2*d);this.musicDuckCurrent=i+(r-i)*_,this.apply(),d<1&&requestAnimationFrame(h)};h()}getMusicDuck(){return this.musicDuckCurrent}initFromUserGesture(){var t,e;if(!this.inited){this.inited=!0,console.log("[AUDIO] usingWebAudio:",_o.Howler.usingWebAudio,"ctx:",_o.Howler.ctx);try{(e=(t=_o.Howler.ctx)==null?void 0:t.resume)==null||e.call(t)}catch{}this.apply()}}setSfxMuted(t){this.sfxMuted=!!t,this.apply()}setMusicMuted(t){this.musicMuted=!!t,this.apply()}setSfxVolume01(t){this.sfxVolume01=al(t),this.apply()}setMusicVolume01(t){this.musicVolume01=al(t),this.apply()}getSfxMuted(){return this.sfxMuted}getMusicMuted(){return this.musicMuted}getSfxVolume01(){return this.sfxVolume01}getMusicVolume01(){return this.musicVolume01}playSfx(t,e=1,n=1){if(this.initFromUserGesture(),this.sfxMuted)return;const i=this.sfx[t];if(!i)return;const r=this.sfxVolume01*Math.max(0,e),o=Math.max(.5,Math.min(2.5,n));i.rate(o),i.volume(r);const h=i.play();i.rate(o,h),i.volume(r,h)}playSfxThrottled(t,e,n=1,i=1){const r=performance.now(),o=`__thr_${t}`,h=this[o];e>0&&h!=null&&r-h<e||(this[o]=r,this.playSfx(t,n,i))}startFsIntroTractorLoop(t=300,e=.85){if(this.fsIntroTractorVolMul=Math.max(0,e),this.sfxMuted)return;const n=this.sfxVolume01*this.fsIntroTractorVolMul,i=this.fsIntroTractorId;if(i!=null&&this.fsIntroTractor.playing(i)){const o=this.fsIntroTractor.volume(i);this.fsIntroTractor.fade(o,n,t,i);return}this.fsIntroTractor.volume(0);const r=this.fsIntroTractor.play("loop");this.fsIntroTractorId=r,this.fsIntroTractor.fade(0,n,t,r)}stopFsIntroTractorLoop(t=250){if(this.fsIntroTractorId==null)return;const e=this.fsIntroTractorId;if(!this.fsIntroTractor.playing(e)){this.fsIntroTractorId=null;return}const n=this.fsIntroTractor.volume(e);this.fsIntroTractor.fade(n,0,t,e),setTimeout(()=>{if(this.fsIntroTractorId===e){try{this.fsIntroTractor.stop(e)}catch{}this.fsIntroTractorId=null}},t+30)}startTickLoop(t=120,e=.35,n=1){if(this.initFromUserGesture(),this.sfxMuted)return;const i=this.sfx.tick;if(console.log("[TICK] startTickLoop",{sfxMuted:this.sfxMuted,sfxVolume01:this.sfxVolume01,volMul:e,rate:n,tickId:this.tickId,playing:this.tickId!=null?i.playing(this.tickId):!1}),!i)return;this.tickOn=!0;const r=this.sfxVolume01*Math.max(0,e)*this.tickGain,o=Math.max(.5,Math.min(3.5,n));if(this.tickId==null||!i.playing(this.tickId)){i.loop(!0),i.volume(0),i.rate(o);const _=i.play();this.tickId=_}const h=this.tickId,d=i.volume(h);try{i.fade(d,r,t,h)}catch{i.volume(r,h)}this.tickLastRate=o,this.tickLastVol=r}setTickParams(t,e){if(!this.tickOn||this.sfxMuted)return;const n=this.sfx.tick;if(!n||this.tickId==null)return;const i=this.tickId,r=this.sfxVolume01*Math.max(0,t),o=Math.max(.5,Math.min(3.5,e));Math.abs(o-this.tickLastRate)>.01&&(n.rate(o,i),this.tickLastRate=o),Math.abs(r-this.tickLastVol)>.01&&(n.volume(r,i),this.tickLastVol=r)}stopTickLoop(t=140){const e=this.sfx.tick;if(!e||(this.tickOn=!1,this.tickId==null))return;const n=this.tickId;this.tickId=null;try{const i=e.volume(n);e.fade(i,0,t,n),setTimeout(()=>{try{e.stop(n)}catch{}},t+20)}catch{try{e.stop(n)}catch{}}}playMusic(t,e=300){if(this.currentMusicKey===t)return;const n=this.currentMusicKey;if(t==="music_base"){if(this.currentMusic){const o=this.currentMusic;o.fade(o.volume(),0,e),setTimeout(()=>o.stop(),e+20),this.currentMusic=null}this.currentMusicKey="music_base",this.ensureBaseLayersPlaying(),this.setBaseMusicIntensity(this.baseIntensity01,e);return}n==="music_base"&&this.stopBaseLayers(e);const i=this.music[t];if(!i)return;const r=this.currentMusic;if(this.currentMusic=i,this.currentMusicKey=t,i.volume(0),i.loop(!0),i.play(),i.fade(0,this.musicVolume01,e),r){const o=r.volume();r.fade(o,0,e),setTimeout(()=>r.stop(),e+20)}}stopMusic(t=250){if(!this.currentMusic)return;this.currentMusicKey==="music_base"&&this.stopBaseLayers(t);const e=this.currentMusic;if(this.currentMusic=null,this.currentMusicKey=null,!e.playing())return;const n=e.volume();e.fade(n,0,t),setTimeout(()=>e.stop(),t+20)}apply(){if(this.fsIntroTractorId!=null){const t=this.fsIntroTractorId;if(this.sfxMuted)this.fsIntroTractor.volume(0,t);else{const e=this.sfxVolume01*this.fsIntroTractorVolMul;this.fsIntroTractor.volume(e,t)}}this.sfxMuted&&this.stopTickLoop(0);for(const t of Object.keys(this.music)){const e=this.music[t];e&&(this.musicMuted?e.playing()&&e.volume(0):this.currentMusicKey===t?e.volume(this.musicVolume01):e.volume(0))}this.currentMusicKey==="music_base"&&this.setBaseMusicIntensity(this.baseIntensity01,60)}makeSfx(t){const e=new _o.Howl({src:[t],preload:!0,volume:this.sfxVolume01});return e.on("load",()=>console.log("[SFX load OK]",t)),e.on("loaderror",(n,i)=>console.warn("[SFX load ERROR]",t,i)),e.on("playerror",(n,i)=>console.warn("[SFX play ERROR]",t,i)),e}makeMusic(t){return new _o.Howl({src:[t],preload:!0,loop:!0,volume:this.musicVolume01})}}function X_(s){const t=Math.max(0,Math.min(1,s));return t*t*(3-2*t)}function al(s){return Math.max(0,Math.min(1,s))}let xr=null,ze=null,ne=null,hh=s=>{};async function uC(){var ym,xm,bm,wm,Sm,Mm,Am;const s=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||((xm=(ym=window.matchMedia)==null?void 0:ym.call(window,"(pointer: coarse)"))==null?void 0:xm.matches);if(window.__GAME_BOOTED__){console.warn("[BOOT] main() called twice  ignored");return}window.__GAME_BOOTED__=!0;function t(){["#hud","#topLeftHud","#debugHud",".hud",".top-left-hud",".debug-hud"].forEach(u=>{document.querySelectorAll(u).forEach(f=>f.remove())});const c=["Mode:","Mult:","Win:","FS:","SPIN"];document.querySelectorAll("body *").forEach(u=>{const f=u.innerText;if(f&&c.some(p=>f.includes(p))){const p=u.getBoundingClientRect();p.width<900&&p.height<120&&u.remove()}})}t();const e=new FontFace("pixeldown","url(/assets/fonts/pixeldown.ttf)"),n=new FontFace("Micro5","url(/assets/fonts/Micro5.ttf)");function i(a){a.style=new An({fontFamily:"pixeldown",fill:16777215,fontSize:35,fontWeight:"200",letterSpacing:1,align:"center",stroke:{color:0,width:4},dropShadow:!0,dropShadowAlpha:.9,dropShadowBlur:0,dropShadowDistance:4,dropShadowAngle:-Math.PI/4}),a.anchor.set(.5),a.eventMode="static",a.cursor="pointer",a.hitArea=new $t(-360,-60,720,120)}await Promise.all([e.load(),n.load()]),document.fonts.add(e),document.fonts.add(n);const r={overlay:{splash:!1,startup:!1,studio:!1,fsIntro:!1,fsOutro:!1,fsOutroPending:!1,bigWin:!1},mult:{value:1,index:0,maxIndex:0},win:{spinWin:0,totalWin:0,totalWinX:0},ui:{settingsOpen:!1,buyMenuOpen:!1,spinning:!1,auto:!1,turbo:!1,autoPendingRounds:-1,autoArmed:!1,autoRounds:-1,autoLeft:0},game:{mode:"BASE",returningFromFreeSpins:!1},fs:{remaining:0,total:0,ladderIndex:1,sessionTotalWin:0,totalCap:20},bank:{betLevels:[1,2,5,10,20,50,100,200],betIndex:0,balance:1e3,lastWin:0}},o=new hC({sfxMuted:!1,musicMuted:!1,sfxVolume01:.8,musicVolume01:.6});window.addEventListener("keydown",async a=>{var u,f,p,x;if(a.key.toLowerCase()!=="m")return;await((u=o==null?void 0:o.initFromUserGesture)==null?void 0:u.call(o));const c=((f=o==null?void 0:o.getMusicMuted)==null?void 0:f.call(o))??!1;(p=o==null?void 0:o.setMusicMuted)==null||p.call(o,!c),(x=o==null?void 0:o.apply)==null||x.call(o),console.log("[M TEST] musicMuted ->",!c)});function h(a=10,c=2){const u=tn.indexOf(c);r.fs.ladderIndex=u>=0?u:0;const f=tn[r.fs.ladderIndex];t0(f),Ac(f),r.game.mode="FREE_SPINS",Ya(),he&&(he.s.removeFromParent(),he=null),To(),jr=9999,Ul=!1;for(let p=Ds.length-1;p>=0;p--){const x=Ds[p];x.c.removeFromParent(),Fh.push(x)}Ds.length=0,$l=!1;for(let p=ws.length-1;p>=0;p--){const x=ws[p];x.c.removeFromParent(),Vl.push(x)}ws.length=0,Eo=0,Ki=!1,wa(),tr=0,Ta=!0,r.fs.remaining=Math.min(a,r.fs.totalCap),r.fs.total=r.fs.remaining,r.fs.sessionTotalWin=0,Bu("FREE_SPINS"),Gp(!0,.72,8,bb),nr.visible=!1,Fr.visible=!1,nr.alpha=0,Fr.alpha=0,console.log(" FORCED FREE SPINS",r.fs.remaining)}const d=6,_=5;let g=130;const l=4.1,m=0,y=d*_,w=1,M=6,S=1.2,A=0,C=1.18;function I(a){const c=a.texture.width||1,u=a.texture.height||1,f=g-M*2,p=g-M*2,x=Math.min(f/c,p/u)*w;return a.scale.set(x),x}function O(a,c){const u=I(a);return c==="S1"?a.scale.set(u*S):c==="W1"?a.scale.set(u*C):a.scale.set(u),u}function $(a){let c=0;for(const p in a)c+=a[p];const u=Math.random()*c;let f=0;for(const p in a)if(f+=a[p],u<=f)return p;return Object.keys(a)[0]}function W(a){return{x:a%d,y:Math.floor(a/d)}}function G(a,c){return c*d+a}function lt(a){return Array.from({length:y},()=>({id:$(a)}))}const J=document.getElementById("stage");if(!J)throw new Error("Missing #stage div. Check index.html.");const st=!1;let tt=!1;const P=new Xg,vt=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?1.25:2;await P.init({resizeTo:window,backgroundAlpha:0,resolution:Math.min(vt,window.devicePixelRatio||1),autoDensity:!0}),$2(P),J.appendChild(P.canvas);function ut(){const a=P.screen.width,c=P.screen.height,u=U0,f=X0(),p=z0(),x=c*(1-u)-p-f-40,v=(a-40)/d,T=x/_;return Math.floor(Math.max(72,Math.min(130,Math.min(v,T))))}let z=0;Je(()=>{const a=P.ticker.deltaMS;a>z&&(z=a,z>300&&console.log("[HITCH]",Math.round(z),"ms"))}),Je(()=>{if(!r.overlay.splash)return;const a=be.visible&&be.alpha>.02,c=we.visible&&we.alpha>.02;!a&&!c&&(console.warn("[SPLASH BLACK] background sprites both OFF",{bgBaseVisible:be.visible,bgBaseAlpha:be.alpha,bgFreeVisible:we.visible,bgFreeAlpha:we.alpha,cloudLive:ws.length,leafLive:Ds.length,smokeLive:Pr.length,bgChildren:qe.children.length}),qe.visible=!0,qe.alpha=1,be.visible=!0,be.alpha=.9,we.visible=!1,we.alpha=0)}),si()?(P.canvas.style.cursor="auto",document.body.style.cursor="auto",(wm=document.getElementById("stage"))!=null&&wm.style&&(document.getElementById("stage").style.cursor="auto")):(P.canvas.style.cursor="none",document.body.style.cursor="none",(bm=document.getElementById("stage"))!=null&&bm.style&&(document.getElementById("stage").style.cursor="none"));const B=new et,St=new ht;St.zIndex=999999,St.visible=!1,St.eventMode="static",St.cursor="default",B.addChild(St);const pt=new ft("PLEASE ROTATE YOUR DEVICE",{fontFamily:"Micro5",fontSize:36,fill:16777215,align:"center",letterSpacing:2,stroke:{color:0,width:4}});pt.anchor.set(.5),St.addChild(pt);function ae(){const a=P.screen.width,c=P.screen.height;St.clear(),St.rect(0,0,a,c).fill({color:0,alpha:.85}),pt.x=Math.round(a/2),pt.y=Math.round(c/2)}B.sortableChildren=!0;const Dt=new ht;Dt.clear(),Dt.rect(0,0,window.innerWidth,window.innerHeight).fill(0),Dt.zIndex=-999999,B.addChild(Dt),window.addEventListener("resize",()=>{Dt.clear(),Dt.rect(0,0,window.innerWidth,window.innerHeight).fill(0)});const Yt=new et;Yt.skew.set(0,.39),Yt.zIndex=5e3,Yt.visible=!1,Yt.eventMode="none",Yt.scale.set(1,1.1);const fn=new ft({text:"FREE SPINS",style:{fontFamily:"pixeldown",fill:16777215,fontSize:40,fontWeight:"100",align:"center",dropShadow:!0,dropShadowDistance:7}});fn.anchor.set(.5);const Ie=new ft({text:"0/0",style:{fontFamily:"pixeldown",fill:16765802,fontSize:50,fontWeight:"100",align:"center",dropShadow:!0,dropShadowDistance:7}});Ie.anchor.set(.5),fn.y=0,Ie.y=34,Yt.addChild(fn,Ie),Yt.scale.set(1,1.1),B.addChild(Yt);function Tn(){const a=P.renderer.width,c=P.renderer.height;if(Ce()){Yt.scale.set(.62,.62*1.1),Yt.position.set(Math.round(a*.5),Math.round(c*.06));return}if(De()){Yt.scale.set(.65,.75),Yt.position.set(Math.round(a*.78),Math.round(c*.5));return}Yt.scale.set(1,1.1),Yt.position.set(Math.round(a*.81),148)}function se(){const a=r.game.mode==="FREE_SPINS"||r.overlay.fsOutroPending;if(Yt.visible=a,!a)return;const c=r.fs.total>0?r.fs.total:r.fs.remaining;Ie.text=`${Math.max(0,r.fs.remaining)}/${Math.max(0,c)}`}function pn(a=5){if(r.game.mode!=="FREE_SPINS")return;const c=r.fs.remaining;r.fs.remaining=Math.min(r.fs.totalCap,r.fs.remaining+a);const u=r.fs.remaining-c;u<=0||(se(),Dp(u))}Tn(),Je(a=>{if(!r.overlay.splash||!Qs)return;fr+=a;const c=fr,u=Math.sin(c*Math.PI*2*yi)*zi,f=Math.cos(c*Math.PI*2*yi*.9)*Vi;It.x=Er+f*fs,It.y=da+u*fs,Lt.x=fa+f*fs,Lt.y=xi+u*fs}),Je(()=>{Tn(),se()}),P.stage.addChild(B);let _e=null;function mn(){_e!=null&&window.clearTimeout(_e),_e=window.setTimeout(()=>{_e=null,requestAnimationFrame(()=>{requestAnimationFrame(()=>{Uu(),B.sortChildren(),P.stage.hitArea=P.screen})})},120)}window.removeEventListener("resize",mn),window.removeEventListener("orientationchange",mn),window.addEventListener("resize",mn,{passive:!0}),window.addEventListener("orientationchange",mn,{passive:!0}),window.visualViewport&&(window.visualViewport.addEventListener("resize",mn,{passive:!0}),window.visualViewport.addEventListener("scroll",mn,{passive:!0}));let Ae=!1;function jn(){Ae||(Ae=!0,B.sortableChildren=!0,xt.sortableChildren=!0,qe.sortableChildren=!0,qe.parent||B.addChild(qe),xt.parent||B.addChild(xt),Qn.parent||B.addChild(Qn),B.sortChildren())}const Wt=new et;Wt.zIndex=999999,Wt.eventMode="static",Wt.cursor="default",B.addChild(Wt),B.sortChildren(),P.canvas.style.cursor="none";const Re=new et;Re.zIndex=1e6,Re.eventMode="none",B.addChild(Re),B.sortChildren();const Ln=!1;si()&&(Re.visible=!1),si()&&(P.renderer.events.cursorStyles.default="default",P.renderer.events.cursorStyles.pointer="default",P.stage.cursor="default");const ge=new ht;ge.blendMode="none";const ke=new et;ke.eventMode="none",ke.zIndex=2,Re.addChild(ke);const pe=new et;pe.eventMode="none",pe.zIndex=3,Re.addChild(pe);const de=new ht;de.blendMode="normal",Re.addChild(de);function Kt(){de.clear();const a=12;de.rect(-Math.floor(a/2),-Math.floor(a/2),a,a).fill(16777215),de.roundPixels=!0,de.x=Math.round(de.x),de.y=Math.round(de.y)}Kt();const Be=[],Fn=40;let _n=!0,Ts=P.screen.width/2,qn=P.screen.height/1.5,Cn=Ts,Ee=qn;function ve(a,c,u){return Math.max(c,Math.min(u,a))}const le=[],Ft=[];function te(a,c,u=!1){let f=le.pop();if(!f){const k=new ht;k.blendMode="add",f={g:k,vx:0,vy:0,vr:0,life:0,life0:0,s0:1}}const p=f.g;p.clear();const x=u?4+(Math.random()*3|0):3+(Math.random()*2|0),b=u?4+(Math.random()*4|0):2+(Math.random()*3|0),v=[2792948];for(let k=0;k<b;k++){const F=(-2+Math.random()*4)*x|0,R=(-2+Math.random()*4)*x|0;p.rect(F,R,x,x).fill({color:v[Math.random()*v.length|0],alpha:1})}p.x=a+(-6+Math.random()*12),p.y=c+(-6+Math.random()*12),p.rotation=Math.random()*Math.PI*2;const T=Math.random()*Math.PI*2,E=(u?240:140)+Math.random()*(u?340:220);f.vx=Math.cos(T)*E,f.vy=Math.sin(T)*E-(u?260+Math.random()*220:120+Math.random()*160),f.vr=(-1+Math.random()*2)*(u?10:7),f.life0=(u?.55:.35)+Math.random()*(u?.35:.22),f.life=f.life0,f.s0=.9+Math.random()*.9,p.scale.set(f.s0),p.alpha=u?1:.85,ke.addChild(p),Ft.push(f)}const _s=[],Ne=[];function js(a,c){vr(a,c);const u=30;for(let f=0;f<u;f++)te(a,c,!0)}function vr(a,c){let u=_s.pop();if(!u){const v=new ht;v.blendMode="add",u={g:v,life:0,life0:0,rot:0,s0:1}}const f=u.g;f.clear();const p=0,x=10,b=42;for(let v=0;v<p;v++){const T=v/p*Math.PI*2,E=Math.cos(T)*x,k=Math.sin(T)*x,F=Math.cos(T)*b,R=Math.sin(T)*b,L=v%2===0?16777215:16765802;f.moveTo(E,k),f.lineTo(F,R),f.stroke({width:3,color:L,alpha:.9})}f.circle(0,0,6).fill({color:16777215,alpha:1}),f.x=a,f.y=c,f.alpha=1,u.life0=.28+Math.random()*.1,u.life=u.life0,u.rot=(-1+Math.random()*2)*2.2,u.s0=.85+Math.random()*.25,f.scale.set(u.s0),pe.addChild(f),Ne.push(u)}function qs(a){if(ge.clear(),!(a.length<2))for(let c=0;c<2;c++){const u=c===1,f=u?5227519:13627391;for(let p=1;p<a.length;p++){const x=a[p-1],b=a[p],T=1-p/(a.length-1),E=(u?.38:.22)*(T*T);if(E<.01)continue;const k=(u?6:14)*T+(u?2.5:4);ge.moveTo(x.x,x.y),ge.lineTo(b.x,b.y),ge.stroke({width:k,color:f,alpha:E,cap:"round",join:"round"})}}}P.stage.eventMode="static",P.stage.hitArea=P.screen;function _i(){var u;const a=screen,c=(u=a==null?void 0:a.orientation)==null?void 0:u.lock;typeof c=="function"&&c.call(a.orientation,"portrait").catch(()=>{})}window.addEventListener("pointerdown",_i,{once:!0,passive:!0}),window.addEventListener("pointerdown",()=>o==null?void 0:o.initFromUserGesture(),{once:!0,passive:!0});const gi=-2,ur=-2,dr=8;function Yi(a,c){return Math.round(a/c)*c}P.stage.on("pointermove",a=>{if(si())return;const c=a.global;Ts=Yi(c.x+gi,dr),qn=Yi(c.y+ur,dr)}),P.stage.on("pointerdown",a=>{Wt.visible&&_n&&(a.global,js(Ts,qn))});function mt(){_n=!1,P.canvas.style.cursor="none";for(let a=Ft.length-1;a>=0;a--){const c=Ft[a];c.g.removeFromParent(),le.push(c),Ft.splice(a,1)}ge.clear(),Re.removeFromParent()}let Tt=0;Je(a=>{if(!_n||si())return;Cn=Ts,Ee=qn,de.position.set(Cn,Ee),de.x=Math.round(de.x),de.y=Math.round(de.y),Be.unshift({x:Cn,y:Ee}),Be.length>Fn&&Be.pop(),qs(Be);const c=performance.now()*.0032;if(de.scale.set(1+Math.sin(c)*.06),Wt.visible||Ln){Tt+=28*a;const p=Math.floor(Tt);p>0&&(Tt-=p);for(let x=0;x<p;x++){const b=Math.min(Be.length-1,6+(Math.random()*6|0)),v=Be[b]??Be[Be.length-1];te(v.x,v.y,!1)}}for(let f=Ft.length-1;f>=0;f--){const p=Ft[f],x=p.g;p.vy+=620*a,x.x+=p.vx*a,x.y+=p.vy*a,x.rotation+=p.vr*a,p.life-=a;const b=ve(p.life/p.life0,0,1);x.alpha=.95*b*b;const v=p.s0*(.85+.15*b);x.scale.set(v),p.life<=0&&(x.removeFromParent(),Ft.splice(f,1),le.push(p))}for(let f=Ne.length-1;f>=0;f--){const p=Ne[f],x=p.g;p.life-=a;const b=ve(p.life/p.life0,0,1);x.alpha=b*b,x.rotation+=p.rot*a;const v=p.s0*(.92+.08*b);x.scale.set(v),p.life<=0&&(x.removeFromParent(),Ne.splice(f,1),_s.push(p))}}),window.__stopLoaderMagicCursor=mt;const oe=new ht;Wt.addChild(oe);const ln=new ft({text:"LOADING SPELLS",style:{fontFamily:"Micro5",fill:16777215,fontSize:48,fontWeight:"900",letterSpacing:2,dropShadow:!0,dropShadowAlpha:.6,dropShadowDistance:3}});ln.anchor.set(.5),Wt.addChild(ln);const Ve=new ft({text:"0%",style:{fontFamily:"Micro5",fill:16765802,fontSize:28,fontWeight:"900",letterSpacing:1,dropShadow:!0,dropShadowAlpha:.5,dropShadowDistance:2}});Ve.anchor.set(.5),Wt.addChild(Ve);const $e=new ht,ds=new ht;Wt.addChild($e,ds);function Gn(){const a=P.screen.width,c=P.screen.height;oe.clear(),oe.rect(0,0,a,c).fill(0),oe.alpha=1;const u=a/2,f=c/2;ln.position.set(u,f-70),Ve.position.set(u,f-20);const p=Math.min(520,a*.7),x=18,b=u-p/2,v=f+30;$e.clear(),$e.rect(b,v,p,x).fill({color:0,alpha:.18}).stroke({width:2,color:16777215,alpha:.35}),$e.rect(b+rs,v+rs,p-rs*2,x-rs*2).fill({color:0,alpha:.2}),ds.clear()}function On(a){const c=Math.max(0,Math.min(1,a));Ve.text=`${Math.round(c*100)}%`;const u=P.screen.width,f=Math.min(520,u*.7),p=18,x=u/2,b=Math.round(x-f/2),v=Math.round(P.screen.height/2+30),T=b+rs,E=v+rs,k=f-rs*2,F=p-rs*2,R=Math.max(Xi,16),L=Math.min(Zs,F),N=Math.floor((k+Ks)/(R+Ks)),D=Math.round(c*N);ds.clear();for(let U=0;U<D;U++){const j=T+U*(R+Ks),V=E+Math.round((F-L)/2);ds.rect(j,V,R,L).fill({color:16765802,alpha:1}),ds.rect(j,V,R,2).fill({color:16777215,alpha:.18})}}async function gs(){const a=Wt.alpha;await me(260,c=>{const u=c*c*(3-2*c);Wt.alpha=a*(1-u)}),Wt.visible=!1,Wt.eventMode="none"}let En=!1;async function Hr(){if(!En){En=!0;try{On(1),Yu(),Yc(1,0),await gs(),gm(),await Rl()}catch(a){throw En=!1,a}}}const rs=3,Ks=3,Zs=18,Xi=14;Gn(),On(0),window.addEventListener("resize",()=>{Gn();const a=parseInt(Ve.text,10);Number.isNaN(a)||On(a/100)});let fr=0;const zi=10,Vi=4,yi=.18,Cs=420;let fs=0,Qs=!1;const Tr=1,Sn=new et;Sn.zIndex=1000002,Sn.visible=!1,Sn.alpha=0,Sn.eventMode="static",Sn.cursor="default",B.addChild(Sn),B.sortChildren();const Ur=new ht;Sn.addChild(Ur);const Tl=110,Cl=2,H=new ce(Xt.WHITE);H.anchor.set(.5),H.alpha=0,H.roundPixels=!0,Sn.addChild(H);const Y=new ce(Xt.WHITE);Y.anchor.set(.5),Y.alpha=0,Y.roundPixels=!0,Y.zIndex=10,Sn.addChild(Y),Sn.sortableChildren=!0;function gt(){const a=P.screen.width,c=P.screen.height;Ur.clear(),Ur.rect(0,0,a,c).fill(0),Ur.alpha=1;const u=Math.round(a*.5),f=Math.round(c*.5);H.position.set(u,f);const p=H.texture.width||1,x=H.texture.height||1,b=.42,v=.28,T=a*b,E=c*v,k=Math.min(T/p,E/x);H.scale.set(k);const F=Gl??null;F&&(Y.texture=F,Y.position.set(u,f),Y.scale.set(k),Y.scale.set(k*2))}window.addEventListener("resize",gt);const _t=new et;_t.zIndex=999998,_t.visible=!1,_t.eventMode="static",_t.cursor="pointer",B.addChild(_t),B.sortChildren();const Ot=new ht;_t.addChild(Ot);const ee=new ft({text:`8-BIT WIZARDRY
PRESENTS`,style:{fontFamily:"Micro5",fill:16777215,fontSize:35,align:"center",letterSpacing:1,dropShadow:!1,dropShadowColor:0,dropShadowAlpha:.6,dropShadowDistance:3,dropShadowAngle:-Math.PI/4}});ee.anchor.set(.5),_t.addChild(ee);let Bt=!1,Nt=[];const Zt=new et;Zt.eventMode="none",Zt.sortableChildren=!1,Sn.addChild(Zt);const Le=60,je=2.8,Rn=650,gn=90,Te=220;function We(){if(Bt)return;const a=ns.get(Vr);if(!a){console.warn("[STUDIO] Missing logo texture:",Vr);return}const c=a.source,u=Math.max(8,Math.floor(Le)),f=Math.floor((a.width||1)/u),p=Math.floor((a.height||1)/u);if(f<=0||p<=0){console.warn("[STUDIO] Logo too small for tiles.",{w:a.width,h:a.height,tile:u});return}const x=H.scale.x;Zt.scale.set(x),Zt.position.set(H.x,H.y),H.visible=!1,Nt=[];const b=f*u,v=p*u,T=-b/2,E=-v/2;for(let k=0;k<p;k++)for(let F=0;F<f;F++){const R=new $t(F*u,k*u,u,u),L=new Xt({source:c,frame:R}),N=new ce(L);N.anchor.set(.5),N.roundPixels=!0;const D=T+F*u+u/2,U=E+k*u+u/2;N.x=D,N.y=U,N.rotation=0,Zt.addChild(N),Nt.push({s:N,homeX:D,homeY:U,col:F,row:k})}Bt=!0}async function ys(){var F,R;const a=ns.get(Vr);if(a&&(H.texture=a),gt(),H.visible=!1,H.alpha=0,We(),!Bt)return;Sn.visible=!0,Sn.alpha=1,Sn.eventMode="static",Zt.alpha=1;const c=Math.max(...Nt.map(L=>L.col))+1,u=Math.max(...Nt.map(L=>L.row))+1,f=Array.from({length:c},()=>[]);for(const L of Nt)f[L.col].push(L);for(let L=0;L<c;L++)f[L].sort((N,D)=>N.row-D.row);const p=((R=(F=f[0])==null?void 0:F[0])==null?void 0:R.s.texture.frame.height)||Le,x=u*p,b=Array.from({length:c},(L,N)=>({offsetPx:Math.random()*x,stopping:!1,stopAt:performance.now()+Rn+N*gn,stopStart:0,stopFrom:0,stopTo:0}));function v(L,N){for(;L>=N+x;)L-=x;for(;L<N;)L+=x;return L}const T=performance.now(),E=()=>{const L=performance.now(),N=Math.min(.05,P.ticker.deltaMS/1e3),D=Math.min(1,(L-T)/Tl),U=D<1?D*D*(3-2*D)*Cl:1,j=je*x*U;for(let V=0;V<c;V++){const Q=f[V];if(!Q.length)continue;const q=Q[0].homeY,K=b[V];if(K.stopping){const Z=Math.min(1,(L-K.stopStart)/Te),at=1-Math.pow(1-Z,3);let yt=K.stopFrom,qt=K.stopTo-yt;qt>x*.5&&(qt-=x),qt<-x*.5&&(qt+=x),K.offsetPx=((yt+qt*at)%x+x)%x,Z>=1&&(K.offsetPx=0)}else if(K.offsetPx=(K.offsetPx+j*N)%x,L>=K.stopAt){K.stopping=!0,K.stopStart=L;const Z=K.offsetPx%p,at=Z>p*.5?p-Z:-Z;let yt=K.offsetPx+at;yt=(yt%x+x)%x,K.stopFrom=K.offsetPx,K.stopTo=yt}for(const Z of Q){let at=Z.homeY+K.offsetPx;at=v(at,q),Z.s.y=at}}};P.ticker.add(E);const k=Rn+(c-1)*gn+Te+60;await Wn(k),P.ticker.remove(E);for(const L of Nt)L.s.x=L.homeX,L.s.y=L.homeY,L.s.rotation=0;Y.alpha=0,await me(260,L=>{const N=L*L*(3-2*L);Y.alpha=N}),await Wn(1500),await me(260,L=>{const N=L*L*(3-2*L);Zt.alpha=1-N,Y.alpha=1-N}),Y.alpha=0,Zt.alpha=0,Sn.visible=!1,Sn.eventMode="none"}const is={fontFamily:"pixeldown",fill:16777215,fontSize:100,fontWeight:"200",letterSpacing:0,align:"center",stroke:{color:0,width:14},dropShadow:!0,dropShadowColor:0,dropShadowAngle:-Math.PI/5,dropShadowAlpha:.9,dropShadowDistance:20},It=new ft({text:"BLOCKY",style:is});It.anchor.set(.5),It.skew.set(0,.45);const Lt=new ft({text:"FARM",style:is});let Cr=1,bo=1,$i=1,wo=1,Er=0,da=0,fa=0,xi=0;Lt.anchor.set(.5),Lt.skew.set(0,.45);function El(a){const c=a.style.clone?a.style.clone():{...a.style},u=new ft({text:a.text,style:c});return u.style.fill=0,u.style.strokeThickness=0,u.style.dropShadow=!1,u.anchor.set(.5),u.skew.set(-.9,.37),u.filters=[new mo({strength:25})],u.alpha=.35,u.zIndex=5,u}const xs=El(It),Kn=El(Lt);xs.visible=!1,Kn.visible=!1,_t.sortableChildren=!0,It.zIndex=20,Lt.zIndex=20,_t.addChild(xs,Kn,It,Lt);const Pl=.35,Il=1.2,kl=22,bs=.24,Es=315,Js=190,Yr=1.35,pr=.69,pa=0,mr=new et;mr.zIndex=40,_t.addChild(mr);const Zn=[{title:"BONUS MODE",subtitle:`LAND 3 BONUS SYMBOLS
TO ENTER BONUS MODE`},{title:"+ MULTIPLIER",subtitle:`MULTIPLIER COMPOUNDS
ON EVERY CLUSTER WIN`},{title:"BOUNCING WILD",subtitle:"SECOND CHANCE WILDS"}],Pn=[];for(let a=0;a<Zn.length;a++){const c=new et,u=new ht;c.addChild(u);const f=new ft({text:Zn[a].title,style:{fontFamily:"pixeldown",fill:16765802,fontSize:50,align:"center",letterSpacing:1,stroke:{color:0,width:6},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.9,dropShadowDistance:4,dropShadowAngle:-Math.PI/4}});f.anchor.set(.5,0),c.addChild(f);const p=new ft({text:Zn[a].subtitle,style:{fontFamily:"Micro5",fill:16777215,fontSize:36,align:"center",letterSpacing:1,stroke:{color:0,width:4},dropShadow:!1,dropShadowColor:0,dropShadowAlpha:.6,dropShadowDistance:3,dropShadowAngle:-Math.PI/4}});p.anchor.set(.5,0),c.addChild(p);const x=new et;x.eventMode="none",c.addChild(x),c._splashBg=u,c._splashTitle=f,c._splashSubtitle=p,c._splashArt=x,c.alpha=0,mr.addChild(c),Pn.push(c)}const Ll=.96,ma=26,ji=90;function Xr(){return P.screen.height+ji}function qi(){return P.screen.height*Ll}function zr(){nn.x=P.screen.width/2}function bi(a,c=320){zr();const u=Xr(),f=qi();nn.visible=!0,nn.alpha=0,nn.y=u,ie(c,p=>{const x=Math.max(0,Math.min(1,p));nn.alpha=x,nn.y=u+(f-u)*x})}const nn=new ft({text:"CLICK TO CONTINUE",style:{}});i(nn),nn.style.dropShadowAngle=-Math.PI/4,nn.zIndex=999999,nn.visible=!1,nn.alpha=0,nn.y=Xr(),_t.addChild(nn);const Fl=-30,Ol=38,Ph=-50;function _a(){const a=Ce(),c=De(),u=P.screen.width,f=P.screen.height;Ot.clear(),Ot.rect(0,0,u,f).fill(0),Ot.alpha=.18,ee.position.set(u*.5,f*.08),ee.visible=!Ce();const p=Math.min(u*.8,1200),x=De()?.35:.6,b=.82,v=-15,T=It.getLocalBounds().width,E=Lt.getLocalBounds().width,k=T+v+E,F=p/Math.max(1,k),R=F*x*b,L=F*x;It.scale.set(R,L),Lt.scale.set(R,L),Cr=R,bo=L,$i=R,wo=L;const N=It.width,D=Lt.width,U=N+v+D,j=u*.5-U/2;It.x=j+N/2,Lt.x=It.x+N/2+v+D/2,!Ce()&&!De()&&(Lt.x+=Fl);let Q=.25,q=.15,K=34,Z=.1,at=10,yt,Vt;Ce()?(yt=Z,Vt=at):De()?(yt=q,Vt=K):(yt=Q,Vt=Ol);const qt=c?-28:0;It.y=f*yt,Lt.y=f*yt+Vt+qt;const Jt=46,Et=150,bt=.1;xs.x=It.x+Jt,xs.y=It.y+Et,xs.scale.set(It.scale.x*1.05,It.scale.y*bt),Kn.x=Lt.x+Jt,Kn.y=Lt.y+Et,Kn.scale.set(Lt.scale.x*1.05,Lt.scale.y*bt),Er=It.x,fa=Lt.x,da=It.y,xi=Lt.y,nn.x=u*.5,nn.visible||(nn.y=Xr());let X=f*(a?.58:pr)+pa;c&&(X-=Math.round(f*.08));const ot=De(),Xe=(a?.62:bs)*(a?1:ot?Tr:2.5),ts=ot?Math.round(Js*.85):Js,cs=Math.max(ts,Math.min(Es,u*Xe)),ps=Math.round(cs*(a?.6:Il)),Or=Math.round(cs*Yr*(ot?.92:1)),Gt=a?Math.round(ps*.1):0;for(let Pt=0;Pt<Pn.length;Pt++){const un=Pn[Pt],or=un._splashBg,ar=un._splashTitle,Xs=un._splashSubtitle,zs=un._splashArt;if(or.clear(),or.rect(-cs/2,-ps/2,cs,ps).fill({color:0,alpha:Pl}).stroke({width:2,color:11579568,alpha:.35}),a){un.x=Math.round(u*.5);const Qu=(Pn.length-1)/2;un.y=Math.round(X+(Pt-Qu)*(ps+Gt))}else un.x=Math.round(u/2+(Pt-1)*Or),un.y=Math.round(X);const Rr=-ps/2+kl;ar.y=Rr,Xs.y=Rr+ar.height+8;const Br=De();a?(ar.scale.set(.75),Xs.scale.set(.75),Xs.y=Rr+ar.height+6):Br?(ar.scale.set(.68),Xs.scale.set(.68),Xs.y=Rr+ar.height+6):(ar.scale.set(1),Xs.scale.set(1));const Za={bonus:1.2,multiplier:1.15,maxwin:1},vm={bonus:{x:0,y:0},multiplier:{x:0,y:-5},maxwin:{x:0,y:1}},LS=[{scale:.95,x:10,y:0},{scale:1.5,x:0,y:0},{scale:.95,x:-10,y:0}];if(Lh(),zs)if(a)zs.visible=!1,zs.removeChildren();else{zs.visible=!0;const Qu=16;zs.x=0,zs.y=Xs.y+Xs.height+Qu;const FS=18,OS=18,Tm=Math.max(10,cs-FS*2),RS=ps/2,Ju=Math.max(10,RS-zs.y-OS),Cm=(Nr,hi,qc,ao=1)=>{const qo=Nr.texture.width||1,Qa=Nr.texture.height||1,BS=Math.min(hi/qo,qc/Qa)*ao;Nr.scale.set(BS)},td=zs.children;if(Pt===0){const hi=Math.max(10,(Tm-28)/3),qc=Ju;for(let ao=0;ao<Math.min(3,td.length);ao++){const qo=td[ao],Qa=LS[ao]||{scale:1,x:0,y:0};qo.anchor.set(.5),Cm(qo,hi,qc,Za.bonus*(Qa.scale??1)),qo.x=-hi-14+ao*(hi+14)+(Qa.x??0),qo.y=Math.round(qc*.52)+(Qa.y??0)}}if(Pt===1||Pt===2){const Nr=td[0];if(Nr){Nr.anchor.set(.5);const hi=Pt===1?"multiplier":"maxwin";Cm(Nr,Tm,Ju,Za[hi]),Nr.x=vm[hi].x||0,Nr.y=Math.round(Ju*.55)+(vm[hi].y||0)}}}}if(a){const un=Math.round(f*Ll)-Math.round(nn.height*.5),ar=Pn[Pn.length-1].getBounds(),Xs=ar.y+ar.height,zs=un-ma,Rr=Math.max(0,Math.round(Xs-zs));if(Rr>0)for(const Br of Pn)Br.y=Math.round(Br.y-Rr)}}window.addEventListener("resize",_a);const Ih=.42,ga=18;async function Rl(){Yu(),r.overlay.splash=!0,mS(),he&&(he.s.removeFromParent(),he=null),ye&&(ye.s.removeFromParent(),ye=null),To(),Lh(),Ki=!1,wa(),tr=0,Qs=!1,nn.visible=!1,nn.alpha=0,nn.y=P.screen.height+90,Yc(1,0),_t.visible=!0,_t.alpha=1,_t.eventMode="static",_a(),B.sortChildren(),ax(420),Eo=0,Ma=0,$l=!0,Ul=!0,await oo("BASE",!1,!0);const a=Hn.strength;Hn.strength=Math.max(a,12),xt.alpha=0,xt.eventMode="none",Ha(0,0);const c=P.screen.width,u=P.screen.height,f=-Math.max(It.height,Lt.height)-140,p=De(),x=Ce(),b=p?u*Ih:u*.48,v=p?ga:x?10:38,T=700,E=60,k=1.25,F=1.28,R=-15;It.y=f,Lt.y=f,It.scale.set(Cr*k,bo*k),Lt.scale.set($i*F,wo*F);const L=It.width,N=Lt.width,D=L+R+N,U=c*.5-D/2;It.x=U+L/2,Lt.x=It.x+L/2+R+N/2,!Ce()&&!De()&&(Lt.x+=Ph);const V=820,Q=me(V,ct=>{xs.visible=!0;const nt=es(ct,.9);It.y=f+(b-f)*nt,xs.x=It.x+46,xs.y=It.y+150,xs.scale.set(It.scale.x*1.05,It.scale.y*.22)}),q=(async()=>{await Wn(T),Kn.visible=!0,Kn.alpha=0,await me(V,ct=>{const nt=es(ct,.9);Kn.alpha=.22*nt,Lt.y=f+(b+v-f)*nt,Kn.x=Lt.x+46,Kn.y=Lt.y+150,Kn.scale.set(Lt.scale.x*1.05,Lt.scale.y*.22)})})();await Promise.all([Q,q]),await Wn(220);const K=520,Z=It.y,at=Lt.y,yt=It.x,Vt=Lt.x,qt=It.scale.x,Jt=It.scale.y,Et=Lt.scale.x,bt=Lt.scale.y,X=me(K,ct=>{const nt=es(ct,1);It.y=Z+(da-Z)*nt,It.x=yt+(Er-yt)*nt,xs.x=It.x+46,xs.y=It.y+150,xs.scale.set(It.scale.x*1.05,It.scale.y*.22),It.scale.set(qt+(Cr-qt)*nt,Jt+(bo-Jt)*nt),It.x=It.x+(Er-It.x)*nt}),ot=(async()=>{await Wn(E),await me(K,ct=>{const nt=es(ct,1);Lt.y=at+(xi-at)*nt,Lt.x=Vt+(fa-Vt)*nt,Kn.x=Lt.x+46,Kn.y=Lt.y+150;const Xe=.22+Math.max(0,Math.min(1,(xi-Lt.y)/200))*.1;Kn.scale.set(Lt.scale.x*1.22,Lt.scale.y*Xe),Kn.scale.set(Lt.scale.x*1.05,Lt.scale.y*.22),Lt.scale.set(Et+($i-Et)*nt,bt+(wo-bt)*nt)})})();await Promise.all([X,ot]),Pn.forEach(ct=>{ct.alpha=0;const nt=ct.y;ie(320,Rt=>{const Xe=Rt*Rt*(3-2*Rt);ct.alpha=Xe,ct.y=nt-10*(1-Xe)})}),It.x=Er,It.y=da,Lt.x=fa,Lt.y=xi,Qs=!0,fr=0,fs=0,ie(Cs,ct=>{fs=Math.max(0,Math.min(1,ct))},()=>{fs=1}),It.scale.set(Cr,bo),Lt.scale.set($i,wo),bi(!0,320);const Mt=async()=>{if(fs=0,Qs=!1,Pn.forEach(nt=>nt.alpha=0),!r.overlay.splash)return;_t.off("pointertap",Mt);const ct=Hn.strength;await me(320,nt=>{const Rt=nt*nt*(3-2*nt);Hn.strength=ct*(1-Rt),_t.alpha=1-Rt}),_t.visible=!1,_t.eventMode="none",r.overlay.splash=!1,_S(),gm(),setTimeout(()=>{Se.visible=!1,n0()},cm+Xu+80)};_t.on("pointertap",Mt)}const Vr="/assets/ui/studio_logo.png",Ps="/assets/ui/studio_logo_house.webp",ya="/assets/backgrounds/bg_candy_landscape.webp",Bl="/assets/backgrounds/bg_candy_landscape_free.webp",Ws="/assets/ui/fs_outro_bg.webp";let Is=60,Nl=-80,Wl=60,Dl=-80,So=null,ks=null,$r=null,Mo=null,Ao=null,xa=null,Gl=null,kh=!1;function Lh(){if(!ks||!ks.textures||typeof ti>"u"||!ti||!ti.S1)return;if(Ce()){for(const p of Pn){const x=p==null?void 0:p._splashArt;x&&(x.removeChildren(),x.visible=!1)}kh=!0;return}if(kh)return;kh=!0;const a=Pn[0];if(!(a!=null&&a._splashArt))return;const c=Pn[1];if(c!=null&&c._splashArt){const p=c._splashArt;p.removeChildren();const x=Pn[2];if(x!=null&&x._splashArt){const v=x._splashArt;v.removeChildren();const T=new ce(za("splash_max_art.png"));T.anchor.set(.5),T.eventMode="none",T.roundPixels=!0,v.addChild(T)}const b=new ce(za("splash_multiplier_art.png"));b.anchor.set(.5),b.eventMode="none",b.roundPixels=!0,p.addChild(b)}const u=a._splashArt;u.removeChildren();const f=L0(ph.S1);for(let p=0;p<3;p++){const x=new ce(f);x.anchor.set(.5),x.eventMode="none",x.roundPixels=!0,u.addChild(x)}}const qe=new et,ba=new et;ba.zIndex=120,ba.eventMode="none",qe.addChild(ba);const vo=new et;vo.sortableChildren=!0,vo.zIndex=200,vo.eventMode="none",qe.addChild(vo);let Ki=!1,Ay=.9,vy=.3;const Ty=[{xN:.655,yN:.265,rate:6}],Hl=[],Pr=[];let tr=0,mf=!1;const Cy=70,Ey=15,_f=3,Py=6;function gf(){const a=new ht,c=_f+Math.random()*(Py-_f)|0,u=5+(Math.random()*9|0),f=[16777215,15921906,14277081,13158600];for(let p=0;p<u;p++){const x=(-2+Math.random()*4)*c|0,b=(-2+Math.random()*4)*c|0;Math.random()<.1||a.rect(x,b,c,c).fill({color:f[Math.random()*f.length|0],alpha:1})}return a.alpha=.22+Math.random()*.18,a.scale.set(.9+Math.random()*.7),a}function Iy(a,c){const u=P.renderer.width,f=P.renderer.height;let p=Hl.pop();p||(p={g:gf(),vx:0,vy:0,life:0,life0:0,spin:0,grow:0});const x=p.g;x.x=u*a+(-6+Math.random()*12),x.y=f*c+(-6+Math.random()*12),p.vx=-4+Math.random()*8,p.vy=-(12+Math.random()*18),p.spin=(-1+Math.random()*2)*.18,p.life0=2.6+Math.random()*1.6,p.life=p.life0,p.vy=-(10+Math.random()*16);const b=Math.max(0,p.life/p.life0);x.alpha=.02+.45*Math.pow(b,2.6),p.grow=.18+Math.random()*.22,x.rotation=Math.random()*Math.PI*2,x.alpha=.14+Math.random()*.1,x.scale.set(.75+Math.random()*.45),r.overlay.fsOutro?Jl.addChild(x):vo.addChild(x),Pr.push(p)}function ky(){const a=P.renderer.width,c=P.renderer.height;let u=Hl.pop();u||(u={g:gf(),vx:0,vy:0,life:0,life0:0,spin:0,grow:0});const f=u.g,p=a*Ay,x=c*vy;f.x=p+(-10+Math.random()*20),f.y=x+(-8+Math.random()*16),u.vx=18+Math.random()*26,u.vy=-(22+Math.random()*36),u.spin=(-1+Math.random()*2)*.35,u.life0=1.05+Math.random()*.75,u.life=u.life0,u.grow=.22+Math.random()*.26,f.rotation=Math.random()*Math.PI*2,f.alpha=.22+Math.random()*.18,f.scale.set(.75+Math.random()*.55),vo.addChild(f),Pr.push(u)}function Ly(){const a=P.ticker.deltaMS/1e3,c=P.renderer.width,u=P.renderer.height;if(r.overlay.fsOutro)for(const p of Ty){tr+=p.rate*a;let x=Math.floor(tr);x>0&&(tr-=x),x=Math.min(x,4);for(let b=0;b<x;b++)Iy(p.xN,p.yN)}for(let p=Pr.length-1;p>=0;p--){const x=Pr[p],b=x.g,v=Math.sin((b.y+p*17)*.02)*8;b.x+=(x.vx+v)*a,b.y+=x.vy*a,b.rotation+=x.spin*a;const T=b.scale.x+x.grow*a;b.scale.set(T),x.life-=a;const E=Math.max(0,x.life/x.life0);b.alpha=.02+.4*E*E,(x.life<=0||b.x<-220||b.x>c+220||b.y<-220||b.y>u+220)&&(b.removeFromParent(),Pr.splice(p,1),Hl.push(x))}if(!Ki)return;tr+=Ey*a;let f=Math.floor(tr);f>0&&(tr-=f);for(let p=0;p<f&&!(Pr.length>=Cy);p++)ky()}function Fy(){mf||(mf=!0,Je(()=>Ly()))}function wa(){for(let a=Pr.length-1;a>=0;a--){const c=Pr[a];c.g.removeFromParent(),Pr.splice(a,1),Hl.push(c)}tr=0}Fy();const Sa=new et;Sa.sortableChildren=!0,Sa.zIndex=400,Sa.eventMode="none",qe.sortableChildren=!0,qe.addChild(Sa),qe.sortChildren();const Fh=[],Ds=[];let Ma=0,yf=!1,Ul=!0;const Oy=26,Ry=3,xf=4,By=7,bf=.9,Ny=1.35;function Wy(){const a=new et,c=new ht,u=Math.floor(xf+Math.random()*(By-xf+1)),f=4+Math.floor(Math.random()*3),p=3+Math.floor(Math.random()*3),x=(f-1)/2,b=(p-1)/2,v=[7328874,4703338,3126122,9366122];for(let k=0;k<p;k++)for(let F=0;F<f;F++){const R=(F-x)/x,L=(k-b)/b,N=R*R+L*L;N>1.05||Math.random()<.2+N*.25||c.rect(F*u,k*u,u,u).fill({color:v[Math.random()*v.length|0],alpha:1})}const T=c.getLocalBounds();c.x=-T.width/2,c.y=-T.height/2,a.addChild(c),a.alpha=.85+Math.random()*.15;const E=bf+Math.random()*(Ny-bf);return a.scale.set(E),a}function Dy(){P.renderer.width;const a=P.renderer.height;let c=Fh.pop();c||(c={c:Wy(),vx:0,vy:0,vr:0,life:0}),c.c.x=-80,c.c.y=a*(.15+Math.random()*.65);const u=35+Math.random()*55;c.vx=1*u,c.vy=10+Math.random()*28,c.vr=(-1+Math.random()*2)*.35,c.life=6+Math.random()*4,c.c.rotation=Math.random()*Math.PI*2,Sa.addChild(c.c),Ds.push(c)}function Gy(){if(!Ul)return;const a=P.renderer.width,c=P.renderer.height,u=P.ticker.deltaMS/1e3;Ma+=Ry*u;const f=Math.floor(Ma);f>0&&(Ma-=f);for(let p=0;p<f&&!(Ds.length>=Oy);p++)Dy();for(let p=Ds.length-1;p>=0;p--){const x=Ds[p],b=x.c;b.x+=x.vx*u,b.y+=x.vy*u,b.rotation+=x.vr*u,b.y+=Math.sin((b.x+p*13)*.02)*.25,(b.x<-220||b.x>a+220||b.y<-220||b.y>c+220)&&(b.removeFromParent(),Ds.splice(p,1),Fh.push(x))}}function Hy(){yf||(yf=!0,Je(()=>Gy()))}Hy();const Aa=new et;Aa.zIndex=119,Aa.eventMode="none",Aa.blendMode="normal",qe.addChild(Aa);const Oh=[],wi=[];let Yl=0;const Uy=35,wf=.3,Yy=1,Sf=2,Xy=10,zy=140;function Vy(){return{g:new ht,vx:0,vy:0,life:0,life0:0,s0:1}}function $y(a,c,u,f,p){if(wi.length>=zy)return;let x=Oh.pop();x||(x=Vy());const b=x.g;b.clear(),b.blendMode="normal";const v=Sf+Math.random()*(Xy-Sf+1)|0,T=3+(Math.random()*6|0),E=[4868682,5921370,6974058,8026746];for(let V=0;V<T;V++){const Q=(-2+Math.random()*4)*v|0,q=(-2+Math.random()*4)*v|0;b.rect(Q,q,v,v).fill({color:E[Math.random()*E.length|0],alpha:1})}const k=-u,F=-f,R=-f,L=u,N=28,D=6;b.x=a+k*N+R*(D*(-1+Math.random()*2))+(-3+Math.random()*6),b.y=c+F*N+L*(D*(-1+Math.random()*2))+(-3+Math.random()*6);const U=Math.max(0,Math.min(1,(p-120)/260)),j=30+70*U;x.vx=k*j+R*(-12+Math.random()*24),x.vy=F*j-(35+55*U)+(-10+Math.random()*20),x.life0=wf+Math.random()*(Yy-wf),x.life=x.life0,x.s0=.65+Math.random()*.65,b.scale.set(x.s0),b.alpha=.22+Math.random()*.8,Aa.addChild(b),wi.push(x)}function jy(a){const c=P.renderer.width,u=P.renderer.height;for(let f=wi.length-1;f>=0;f--){const p=wi[f],x=p.g;p.vy-=10*a,x.x+=p.vx*a,x.y+=p.vy*a,p.life-=a;const b=Math.max(0,p.life/p.life0);x.alpha=.35*b*(.35+.65*b);const v=p.s0*(1+(1-b)*.55);x.scale.set(v),(p.life<=0||x.x<-260||x.x>c+260||x.y<-260||x.y>u+260)&&(x.removeFromParent(),wi.splice(f,1),Oh.push(p))}}function Rh(){he&&(he.s.removeFromParent(),he=null),ye&&(ye.s.removeFromParent(),ye=null),To(),jr=9999,Si=9999}function To(){for(let a=wi.length-1;a>=0;a--){const c=wi[a];c.g.removeFromParent(),wi.splice(a,1),Oh.push(c)}Yl=0}let he=null,jr=0;const Xl=18,Mf=35,qy=200;let ye=null,Si=0;const zl=10,Af=18,Ky=260,Zy=.78;function Qy(){const a=vf();return De()?a*Zy:a}function vf(){const a=P.screen.width,c=1920,u=.55,f=1.05,p=a/c;return Math.max(u,Math.min(f,p))}const Jy=.86,tx=-.08,ex=-.03,nx=.71,Bh=220,Tf=520,sx=.86,rx=-.08,ix=-.03,ox=.71,Nh=220,Cf=520,Co=new et;Co.sortableChildren=!0,Co.zIndex=300,Co.eventMode="none",qe.sortableChildren=!0,qe.addChild(Co),qe.sortChildren();const Vl=[],ws=[];function ax(a=420){const c=P.renderer.height,u=c*.25,f=c*.6,p=c*.22,x=c*.7,b=ws.map(k=>k.c.y),v=ws.map(()=>u+Math.random()*(f-u)),T=Ds.map(k=>k.c.y),E=Ds.map(()=>p+Math.random()*(x-p));ie(a,k=>{const F=k*k*(3-2*k);for(let R=0;R<ws.length;R++){const L=ws[R].c;L.y=b[R]+(v[R]-b[R])*F}for(let R=0;R<Ds.length;R++){const L=Ds[R].c;L.y=T[R]+(E[R]-T[R])*F}})}let Eo=0,Ef=!1,$l=!0;const Pf=10,lx=.35,If=4,cx=5;function kf(){const a=new et,c=new ht,u=Math.floor(If+Math.random()*(cx-If+1)),f=10+(Math.random()*10|0),p=4+(Math.random()*5|0),x=(f-1)/2,b=(p-1)/2,v=u,T=u*.55,E=u*.75;function k(D,U){const j=Math.max(0,Math.min(255,Math.round((D>>16&255)*U))),V=Math.max(0,Math.min(255,Math.round((D>>8&255)*U))),Q=Math.max(0,Math.min(255,Math.round((D&255)*U)));return j<<16|V<<8|Q}function F(D,U,j,V){const Q=k(j,1.08),q=k(j,.92),K=k(j,.84),Z=D,at=U-T,yt=D+v,Vt=U,qt=D,Jt=U+T,Et=D-v,bt=U,X=Z,ot=at+E,Mt=yt,ct=Vt+E,nt=Et,Rt=bt+E;c.moveTo(Z,at).lineTo(yt,Vt).lineTo(qt,Jt).lineTo(Et,bt).closePath().fill({color:Q,alpha:V}),c.moveTo(Et,bt).lineTo(Z,at).lineTo(X,ot).lineTo(nt,Rt).closePath().fill({color:q,alpha:V}),c.moveTo(Z,at).lineTo(yt,Vt).lineTo(Mt,ct).lineTo(X,ot).closePath().fill({color:K,alpha:V})}const R=[16777215,16252415,16776178,15921906];for(let D=0;D<p;D++)for(let U=0;U<f;U++){const j=(U-x)/x,V=(D-b)/b,Q=j*j+V*V;if(Q>1.1||Math.random()<.18+Q*.3)continue;const q=R[Math.random()*R.length|0],K=.65,Z=(U-D)*v,at=(U+D)*T;F(Z,at,q,K)}const L=c.getLocalBounds();c.x=-L.width/2-L.x,c.y=-L.height/2-L.y,a.addChild(c),a.alpha=.16+Math.random()*.3;const N=1+Math.random()*1.7;return a.scale.set(N),a}function Wh(){var N,D,U;if(Oc()||r.overlay.splash||r.overlay.fsOutroPending||ye||r.game.mode!=="FREE_SPINS"||r.overlay.fsIntro||r.overlay.fsOutro)return;const a=new ce(kc("bg_car_night.png"));a.anchor.set(.5),a.scale.set(vf()),a.alpha=1,a.rotation=0;const c=P.renderer.width,u=P.renderer.height,f=Math.round(c*Jy),p=Math.round(u*tx),x=Math.round(c*ex),b=Math.round(u*nx);let v=x-f,T=b-p;const E=Math.hypot(v,T)||1,k=v/E,F=T/E,R=x+k*Tf,L=b+F*Tf;a.x=f-k*Bh,a.y=p-F*Bh,a.rotation=0,(D=(N=a.skew)==null?void 0:N.set)==null||D.call(N,0,0),ba.addChild(a),(U=o==null?void 0:o.playSfx)==null||U.call(o,"car",.5,1.2),ye={s:a,vx:Ky*2.2+Math.random()*60,nx:k,ny:F,startX:f,startY:p,endX:R,endY:L,t:0}}function Dh(a=!1){var D,U,j;if(Oc()||r.game.mode==="FREE_SPINS")return;if(r.overlay.fsIntro){ye&&(ye.s.removeFromParent(),ye=null);return}if(r.overlay.fsIntro||r.overlay.fsOutro||r.game.mode!=="BASE"||he||he||!a&&r.game.mode!=="BASE"||!a&&r.overlay.fsIntro||!a&&r.overlay.fsOutro)return;const c=new ce(kc("bg_red_car.png"));c.anchor.set(.5),c.scale.set(Qy()),c.alpha=1,c.rotation=0,(U=(D=c.skew)==null?void 0:D.set)==null||U.call(D,0,0);const u=P.renderer.width,f=P.renderer.height,p=Math.round(u*sx),x=Math.round(f*rx),b=Math.round(u*ix),v=Math.round(f*ox);let T=b-p,E=v-x;const k=Math.hypot(T,E)||1,F=T/k,R=E/k,L=b+F*Cf,N=v+R*Cf;c.x=p-F*Nh,c.y=x-R*Nh,ba.addChild(c),(j=o==null?void 0:o.playSfx)==null||j.call(o,"car",.5,1.2),he={s:c,vx:qy*2.2+Math.random()*60,nx:F,ny:R,startX:p,startY:x,endX:L,endY:N,t:0},console.log("[BG CAR] spawnBgCar OK",{force:a,mode:r.game.mode})}let jl=!1,ql=null,Lf=!1;function Ff(a){return a.code==="Space"||a.key===" "||a.key==="Enter"}function Gh(a){var c,u,f;(c=a.preventDefault)==null||c.call(a),(u=a.stopImmediatePropagation)==null||u.call(a),(f=a.stopPropagation)==null||f.call(a)}function hx(){return(Wt==null?void 0:Wt.visible)||r.overlay.startup}function ux(){return r.overlay.bigWin||r.overlay.fsIntro||r.overlay.fsOutro}function dx(a){if(a.code==="Space"&&a.preventDefault(),!hx()){if(r.overlay.splash&&Ff(a)){Gh(a),_t.emit("pointertap",{});return}if(ux()){Ff(a)?(Gh(a),Qt.emit("pointertap",{stopPropagation(){}})):Gh(a);return}if(a.key.toLowerCase()==="i"){console.log("[DEBUG] INFUSED popup"),Du();return}{if(a.key.toLowerCase()==="i"){console.log("[DEBUG] INFUSED popup"),Du();return}if(a.key==="1"||a.key==="2"||a.key==="3"||a.key==="4"||a.key==="5"){let c=null;if(a.key==="1"&&(c=rp),a.key==="2"&&(c=ip),a.key==="3"&&(c=op),a.key==="4"&&(c=ap),a.key==="5"&&(c=lp),c!=null){const u=r.bank.betLevels[r.bank.betIndex],f=c*u;Bp(f,c)}return}if(a.key.toLowerCase()==="a"){tt=!tt,console.log("FORCE_ANTICIPATION =",tt);return}if(a.key.toLowerCase()==="x"){const c=_r.toLocal({x:P.renderer.width*.5,y:P.renderer.height*.5});Hp(c.x,c.y,16765802);return}if(a.key.toLowerCase()==="c"){const c=a.shiftKey,u=a.altKey,f=c?"BASE":u?"FREE_SPINS":r.game.mode;he&&(he.s.removeFromParent(),he=null),typeof ye<"u"&&ye&&(ye.s.removeFromParent(),ye=null),f==="BASE"?(jr=999,Dh(!0),console.log("[BG CAR] Forced spawn (BASE)")):typeof Wh=="function"?(Si=999,Wh(),console.log("[BG CAR] Forced spawn (FREE_SPINS)")):console.log("[BG CAR] FS car not wired yet (spawnFsCar missing)");return}if(a.key.toLowerCase()==="o"){a.preventDefault(),a.shiftKey?hh(2500):a.altKey?hh(25):hh(233);return}if(a.key.toLowerCase()==="r"){pn(5);return}if(a.key.toLowerCase()==="f"){r.game.mode!=="FREE_SPINS"&&h(10,1);return}if(a.key.toLowerCase()==="b"){r.game.mode!=="FREE_SPINS"&&h(10,2);return}}if(a.code==="Space"){if(Ua()||a.repeat||r.ui.settingsOpen||r.ui.buyMenuOpen||r.ui.spinning||a.repeat||r.ui.settingsOpen||r.ui.buyMenuOpen||r.ui.spinning||jl)return;jl=!0,Lf=r.ui.auto,r.ui.spinning||Di(),ql=setTimeout(()=>{var c;jl&&(r.ui.settingsOpen||r.ui.buyMenuOpen||(r.ui.auto||(r.ui.auto=!0,(c=it==null?void 0:it.setOn)==null||c.call(it,!0)),r.ui.spinning||Di()))},350);return}}}function fx(a){var c;a.code==="Space"&&(a.preventDefault(),jl=!1,ql&&(clearTimeout(ql),ql=null),!Lf&&r.ui.auto&&(r.ui.auto=!1,(c=it==null?void 0:it.setOn)==null||c.call(it,!1)))}window.addEventListener("keydown",dx,!0),window.addEventListener("keyup",fx,!0);function px(){P.renderer.width;const a=P.renderer.height;let c=Vl.pop();c||(c={c:kf(),vx:0,vy:0,vr:0}),c.c.x=-220,c.c.y=a*(.05+Math.random()*.2);const u=12+Math.random()*22;c.vx=u,c.vy=-1+Math.random()*2,c.vr=(-1+Math.random()*2)*.03;const f=-.12,p=.1;c.c.rotation=f+(-p+Math.random()*p*2),Co.addChild(c.c),ws.push(c)}function mx(){var F,R;if(r.overlay.fsOutro||!he)return;const a=P.ticker.deltaMS/1e3,c=he.s;c.rotation=0,(R=(F=c.skew)==null?void 0:F.set)==null||R.call(F,0,0),c.x+=he.nx*he.vx*a,c.y+=he.ny*he.vx*a;const u=performance.now(),f=Math.sin(u*.006)*.1,p=Math.sin(u*.045)*.4+Math.sin(u*.073)*.5+Math.sin(u*.112)*.4,x=Math.max(0,Math.min(1,(he.vx-80)/220)),b=.25+.55*x;c.y+=f+p*b,c.x+=Math.sin(u*.091)*(.1+.18*x);const v=c.x-he.endX,T=c.y-he.endY;if(v*he.nx+T*he.ny>Nh){c.removeFromParent(),he=null,To(),jr=Xl+Math.random()*(Mf-Xl),Si=zl+Math.random()*(Af-zl);return}Yl+=Uy*a;let k=Math.floor(Yl);k>0&&(Yl-=k),k=Math.min(k,6);for(let L=0;L<k;L++)$y(c.x,c.y,he.nx,he.ny,he.vx);jy(a)}function _x(){var k,F;if(r.overlay.fsOutro||!ye)return;const a=P.ticker.deltaMS/1e3,c=ye.s;c.rotation=0,(F=(k=c.skew)==null?void 0:k.set)==null||F.call(k,0,0),c.x+=ye.nx*ye.vx*a,c.y+=ye.ny*ye.vx*a;const u=performance.now(),f=Math.sin(u*.006)*.1,p=Math.sin(u*.045)*.4+Math.sin(u*.073)*.5+Math.sin(u*.112)*.4,x=Math.max(0,Math.min(1,(ye.vx-80)/220)),b=.25+.55*x;c.y+=f+p*b,c.x+=Math.sin(u*.091)*(.1+.18*x);const v=c.x-ye.endX,T=c.y-ye.endY;v*ye.nx+T*ye.ny>Bh&&(c.removeFromParent(),ye=null,Si=zl+Math.random()*(Af-zl))}function gx(){if(!$l)return;const a=P.renderer.width,c=P.renderer.height,u=P.ticker.deltaMS/1e3;Eo+=lx*u;const f=Math.floor(Eo);f>0&&(Eo-=f);for(let p=0;p<f&&!(ws.length>=Pf);p++)px();for(let p=ws.length-1;p>=0;p--){const x=ws[p],b=x.c;b.x+=x.vx*u,b.y+=x.vy*u,b.rotation+=x.vr*u,b.y+=Math.sin((b.x+p*37)*.004)*.18,(b.x>a+260||b.y<-220||b.y>c+220)&&(b.removeFromParent(),ws.splice(p,1),Vl.push(x))}}function Of(a=5){const c=P.renderer.width,u=P.renderer.height;for(let f=0;f<a&&!(ws.length>=Pf);f++){let p=Vl.pop();p||(p={c:kf(),vx:0,vy:0,vr:0}),p.c.x=Math.random()*(c+260)-130,p.c.y=r.overlay.splash?u*(.25+Math.random()*.35):u*(.05+Math.random()*.2);const x=12+Math.random()*22;p.vx=x,p.vy=-2+Math.random()*1.2,p.vr=(-1+Math.random()*2)*.03,p.c.rotation=-.1+Math.random()*.2,Co.addChild(p.c),ws.push(p)}}function yx(){Ef||(Ef=!0,Je(()=>gx()))}Of(6),yx(),jr=Xl+Math.random()*(Mf-Xl),Je(a=>{if(Oc()){Rh();return}if(r.overlay.splash||r.overlay.fsOutro||r.overlay.fsOutroPending){Rh();return}if(r.game.mode==="BASE"){he||(jr-=a,jr<=0&&Dh()),mx();return}if(r.game.mode==="FREE_SPINS"){if(r.overlay.fsIntro)return;ye||(Si-=a,Si<=0&&Wh()),_x();return}});const Po=new et;Po.sortableChildren=!0,Po.zIndex=1200,Po.eventMode="none",B.addChild(Po),B.sortChildren();const Hh=[],Mi=[];let va=0,Rf=!1,Ta=!1;const xx=140,bx=10,Bf=2,wx=4,Nf=.9,Sx=1.6;function Mx(){const a=new ht,c=Math.floor(Bf+Math.random()*(wx-Bf+1)),u=2+(Math.random()*5|0),f=[16777215,16777215,16252415,16776178];for(let x=0;x<u;x++){const b=(-1+Math.random()*2)*c*1.2|0,v=(-1+Math.random()*2)*c*1.2|0;a.rect(b,v,c,c).fill({color:f[Math.random()*f.length|0],alpha:1})}a.alpha=.75+Math.random()*.25;const p=Nf+Math.random()*(Sx-Nf);return a.scale.set(p),a}function Ax(){const a=P.renderer.width;P.renderer.height;let c=Hh.pop();if(!c){const f=Mx(),p=new ht;p.rect(-1,-10,2,20).fill({color:16777215,alpha:1}),p.rect(-10,-1,20,2).fill({color:16777215,alpha:1}),p.alpha=0,p.visible=!1,p.blendMode=1,c={g:f,gl:p,vx:0,vy:0,vr:0,spin:0,baseA:1,baseS:1,tw:0,twSpeed:0,prevTw01:0,glintT:0,glintArmed:!0}}const u=c.g;u.x=-40+Math.random()*(a+80),u.y=-80-Math.random()*220,c.vy=55+Math.random()*130,c.vx=-25+Math.random()*50,c.spin=.6+Math.random()*1.2,c.vr=(-1+Math.random()*2)*.25,u.rotation=Math.random()*Math.PI*2,c.baseA=u.alpha,c.baseS=u.scale.x,c.tw=Math.random()*Math.PI*2,c.twSpeed=2.2+Math.random()*3.8,c.prevTw01=0,c.glintT=0,c.glintArmed=!0,Po.addChild(u),Po.addChild(c.gl),Mi.push(c)}function vx(){for(let a=Mi.length-1;a>=0;a--){const c=Mi[a];c.g.removeFromParent(),c.gl.removeFromParent(),c.gl.visible=!1,c.gl.alpha=0,c.glintT=0,c.glintArmed=!0,Hh.push(c)}Mi.length=0,va=0}function Tx(){const a=P.renderer.width,c=P.renderer.height,u=P.ticker.deltaMS/1e3;if(Ta){va+=bx*u;const f=Math.floor(va);f>0&&(va-=f);for(let p=0;p<f&&!(Mi.length>=xx);p++)Ax()}for(let f=Mi.length-1;f>=0;f--){const p=Mi[f],x=p.g,b=Math.sin(x.y*.012+f*.7)*(12*u);x.x+=p.vx*u+b,x.y+=p.vy*u,x.rotation+=p.vr*u,p.gl.x=x.x,p.gl.y=x.y,p.gl.rotation=x.rotation,p.tw+=p.twSpeed*u;const v=.5+.5*Math.sin(p.tw),T=v>.985;T||(p.glintArmed=!0),T&&p.glintArmed&&(p.glintArmed=!1,Math.random()<1/70&&(p.glintT=.1+Math.random()*.06));let E=p.baseA*(.78+v*.28),k=p.baseS*(.92+v*.1);if(p.glintT>0){p.glintT-=u;const R=Math.max(0,p.glintT)/.16,L=1+R*.55;E*=1.1*L,k*=L,p.gl.visible=!0,p.gl.alpha=Math.min(1,.15+R*.85);const N=.65+R*.85;p.gl.scale.set(N)}else p.gl.visible=!1,p.gl.alpha=0;x.alpha=Math.min(1,E),x.scale.set(k),(x.y>c+140||x.x<-220||x.x>a+220)&&(x.removeFromParent(),p.gl.removeFromParent(),Mi.splice(f,1),Hh.push(p))}Ta||(va=0)}function Cx(){Rf||(Rf=!0,Je(()=>Tx()))}Cx();const Hn=new mo({strength:12});qe.filters=[Hn];let Ct=null;const Gs=new et;Gs.zIndex=9451,Gs.visible=!1,Gs.eventMode="none",B.addChild(Gs),B.sortChildren();let Uh=0,Ai=0;function Yh(){if(Ct)return;const a=kc("tractor_0.png"),c=kc("tractor_1.png"),u=new Al([a,c]);u.anchor.set(.5),u.loop=!0,u.animationSpeed=.1,u.autoUpdate=!0,u.play(),u.roundPixels=!0,Ct=u,Gs.addChild(u),Wf();const f=new et;f.eventMode="none",f.visible=!1,u._banner=f;const p=Ke.style,x=p!=null&&p.clone?p.clone():{...p||{}},b=Ir.style,v=b!=null&&b.clone?b.clone():{...b||{}},T=new ft({text:"10",style:new An({...x,fontSize:300,align:"center"})});T.anchor.set(.5);const E=new ft({text:"FREE",style:new An({...v,fontSize:300,align:"center"})});E.anchor.set(.5);const k=new ft({text:"SPINS",style:new An({...v,fontSize:95,align:"center"})});k.anchor.set(.5);const F=105,R=92;T.position.set(0,0),E.position.set(0,F),k.position.set(0,F+R),f.addChild(T,E,k),Gs.addChild(f);const L=-290,N=De()?-160:-275;f.position.set(L,N),u._bannerOffX=L,u._bannerOffY=N;const D=1.4,U=1.4,j=1;u._bannerScale=De()?j:Ce()?U:D,f.position.set(L,N),f.scale.set(u._bannerScale),u._banner10=T,u._banner=f}Je(a=>{if(!Ct)return;const c=Ct._banner;if(!c)return;if(!Gs.visible){c.visible=!1;return}const u=Ct._bannerOffX??-290,f=Ct._bannerOffY??-140;c.x=Math.round(Ct.x+u),c.y=Math.round(Ct.y+f);const p=Ct._bannerScale??1.6;c.scale.set(p)});function Wf(){if(!Ct)return;const a=P.screen.width,c=P.screen.height,f=Math.round(a*.6),p=Ct.texture.width||1,x=f/p;Ct.scale.set(x);const b=Math.round(c*.62);Gs.visible||(Ct.x=Math.round(a*.5),Ct.y=b)}window.addEventListener("resize",Wf);function Ex(){return P.screen.width,-((Ct==null?void 0:Ct.width)||400)*.6}function Px(){const a=P.screen.width,c=(Ct==null?void 0:Ct.width)||400;let u=a+c*.8;if(De()){const f=Ct==null?void 0:Ct._banner,p=(Ct==null?void 0:Ct._bannerOffX)??-290,x=f&&f.getBounds().width||0;u=a+c*1.6+Math.abs(p)+x*1.2+80}return u}const Ix=293;function Df(){return Math.round(P.screen.width*.5+Ix)}function Gf(){return Math.round(P.screen.height*.62)}function kx(a=550){if(Yh(),!Ct)return;Uh++;const c=Uh;Gs.visible=!0;const u=Ct._banner,f=Ct._banner10;u&&(u.visible=!0),f&&(f.text=String(r.fs.remaining));const p=Ex(),x=Df(),b=Gf();Ql=b,Df(),Ct.x=p,Ct.y=b,Ct.alpha=1,ie(a,v=>{if(c!==Uh)return;const T=Math.max(0,Math.min(1,v)),E=V2(T,.12);Ct.x=p+(x-p)*E,Ct.y=b})}function Lx(a=520){if(Yh(),!Ct)return Promise.resolve();Ai++;const c=Ai,u=Ct.x,f=Px(),p=Gf();return Ql=p,Ct.x,new Promise(x=>{ie(a,b=>{if(c!==Ai)return;const v=Qo(Math.max(0,Math.min(1,b)));Ct.x=u+(f-u)*v,Ct.y=p},()=>{if(c!==Ai)return x();Gs.visible=!1,Yf();const b=Ct==null?void 0:Ct._banner;b&&(b.visible=!1),x()})})}function Fx(a=620){if(Yh(),!Ct)return Promise.resolve();Ai++;const c=Ai,u=Ct._banner;u&&(u.visible=!0);const f=P.screen.width,p=Ct.x,x=Ct.width||400,b=Ct._bannerOffX??-290,v=u&&u.getBounds().width||0,T=f+x*1.6+Math.abs(b)+v*1.2+80,E=Ct.y;return Ql=E,new Promise(k=>{ie(a,F=>{if(c!==Ai)return;const R=Math.max(0,Math.min(1,F)),L=Qo(R);Ct.x=p+(T-p)*L,Ct.y=E,u&&(u.alpha=1-L*L*.35)},()=>{if(c!==Ai)return k();Gs.visible=!1,Yf(),u&&(u.visible=!1,u.alpha=1),k()})})}const Kl=new et;Kl.zIndex=9450,Kl.eventMode="none",B.addChild(Kl),B.sortChildren();const Xh=[],vi=[];let Zl=0;const Ox=26,Hf=.35,Rx=2,Uf=6,Bx=10,Nx=120,Wx=.37,Dx=-.08;function Gx(){return{g:new ht,vx:0,vy:0,life:0,life0:0,s0:1}}function Hx(a,c){if(vi.length>=Nx)return;let u=Xh.pop();u||(u=Gx());const f=u.g;f.clear(),f.blendMode="normal";const p=Uf+Math.random()*(Bx-Uf+1)|0,x=3+(Math.random()*6|0),b=[4868682,5921370,6974058,8026746];for(let v=0;v<x;v++){const T=(-2+Math.random()*4)*p|0,E=(-2+Math.random()*4)*p|0;f.rect(T,E,p,p).fill({color:b[Math.random()*b.length|0],alpha:1})}f.x=a+(-3+Math.random()*6),f.y=c+(-3+Math.random()*6),u.vx=-(22+Math.random()*34),u.vy=-(28+Math.random()*44),u.life0=Hf+Math.random()*(Rx-Hf),u.life=u.life0,u.s0=.65+Math.random()*.65,f.scale.set(u.s0),f.alpha=.22+Math.random()*.45,Kl.addChild(f),vi.push(u)}function Ux(a){const c=P.renderer.width,u=P.renderer.height;for(let f=vi.length-1;f>=0;f--){const p=vi[f],x=p.g;x.x+=p.vx*a,x.y+=p.vy*a,p.life-=a;const b=Math.max(0,p.life/p.life0);x.alpha=.35*b*(.35+.65*b);const v=p.s0*(1+(1-b)*.55);x.scale.set(v),(p.life<=0||x.x<-260||x.x>c+260||x.y<-260||x.y>u+260)&&(x.removeFromParent(),vi.splice(f,1),Xh.push(p))}}function Yf(){for(let a=vi.length-1;a>=0;a--){const c=vi[a];c.g.removeFromParent(),vi.splice(a,1),Xh.push(c)}Zl=0}Je(a=>{if(a=Math.min(.05,a),Ux(a),!r.overlay.fsIntro||!Gs.visible||!Ct)return;const c=Ct.getBounds(),u=c.x+c.width*(.5+Wx),f=c.y+c.height*(.5+Dx);Zl+=Ox*a;let p=Math.floor(Zl);p>0&&(Zl-=p),p=Math.min(p,6);for(let x=0;x<p;x++)Hx(u,f)});let Ql=0;const Yx=1.6,Xx=.9,zx=.5,Vx=.006,zh=.045;Je(()=>{if(!Gs.visible||!Ct)return;const a=performance.now(),c=Math.sin(a*Vx)*Yx,u=(Math.sin(a*zh)*.4+Math.sin(a*(zh*1.62))*.5+Math.sin(a*(zh*2.48))*.4)*Xx,f=Math.sin(a*.091)*zx;Ct.y=Math.round(Ql+c+u),Ct.x=Math.round(Ct.x+f*.25)});const $x=300,Qt=new ht;Qt.zIndex=9400,Qt.visible=!1,Qt.alpha=0,Qt.eventMode="static",Qt.cursor="default",B.addChild(Qt);const Hs=new ht;Hs.zIndex=9410,Hs.visible=!1,Hs.alpha=0,Hs.eventMode="static",Hs.cursor="default",B.addChild(Hs);const Un=new ft({text:"",style:{fontFamily:"pixeldown",fill:16765802,fontSize:120,fontWeight:"100",align:"center",dropShadow:!0,dropShadowAlpha:.75,dropShadowBlur:14,dropShadowDistance:3}});Un.anchor.set(.5),Un.skew.set(0,.39),Un.scale.set(1,1.15),Un.zIndex=9411,Un.visible=!1,Un.alpha=0,B.addChild(Un);const Yn=new ft({text:"FREE SPINS ADDED",style:{fontFamily:"pixeldown",fill:16777215,fontSize:40,fontWeight:"100",align:"center",letterSpacing:1.5,dropShadow:!0,dropShadowAlpha:.65,dropShadowBlur:10,dropShadowDistance:3}});Yn.anchor.set(.5),Yn.skew.set(0,.39),Yn.scale.set(1,1.15),Yn.zIndex=9411,Yn.visible=!1,Yn.alpha=0,B.addChild(Yn);function Xf(){const a=P.renderer.width,c=P.renderer.height;Hs.clear(),Hs.rect(0,0,a,c).fill(0),De()?(Un.position.set(Math.round(a*.5),Math.round(c*.4)),Yn.position.set(Math.round(a*.5),Math.round(c*.52))):(Un.position.set(Math.round(a*.5),Math.round(c*.43)),Yn.position.set(Math.round(a*.5),Math.round(c*.52)))}const Bn=new et;Bn.zIndex=9460,Bn.visible=!1,Bn.alpha=0,Bn.eventMode="none",B.addChild(Bn);const qr=new ce(Xt.WHITE);qr.anchor.set(.5),Bn.addChild(qr);const Jl=new et;Jl.zIndex=.6,Jl.eventMode="none",Bn.addChild(Jl),Bn.sortableChildren=!0;const tc=new et;tc.zIndex=.5,tc.eventMode="none",Bn.addChild(tc),Bn.sortableChildren=!0;let ec=!0,jx=.19,qx=.65;const Kx=10,Zx=60,zf=1.3,Qx=3.2,Vf=25,Jx=160,$f=14,t1=26,e1=-6,jf=2,n1=4,qf=.08,s1=.95,Vh=[],Ti=[];let nc=0,Kf=!1;function r1(a){const c=new ht,u=[16777215,16773811,16765802],f=2+(Math.random()*3|0);for(let p=0;p<f;p++){const x=(-1+Math.random()*2)*a*1.1|0,b=(-1+Math.random()*2)*a*1.1|0;c.rect(x,b,a,a).fill({color:u[Math.random()*u.length|0],alpha:1})}return c.roundPixels=!0,c}function Zf(){const a=P.renderer.width,c=P.renderer.height;return{x:a*jx,y:c*qx}}function i1(){if(!ec||Ti.length>=Zx)return;let a=Vh.pop();const c=jf+Math.random()*(n1-jf)|0;if(!a)a={g:r1(c),vx:0,vy:0,life:0,life0:0,tw:0,twSpeed:0,baseA:0,vox:c};else{a.g.clear();const b=[16777215,16773811,16765802],v=2+(Math.random()*3|0);for(let T=0;T<v;T++){const E=(-1+Math.random()*2)*c*1.1|0,k=(-1+Math.random()*2)*c*1.1|0;a.g.rect(E,k,c,c).fill({color:b[Math.random()*b.length|0],alpha:1})}a.g.roundPixels=!0,a.vox=c}const u=a.g,f=Zf(),p=Math.random()*Math.PI*2,x=Vf+Math.random()*(Jx-Vf);u.x=f.x+Math.cos(p)*x+(-8+Math.random()*16),u.y=f.y+Math.sin(p)*x+(-8+Math.random()*16),a.vx=(-1+Math.random()*2)*$f,a.vy=(-1+Math.random()*2)*$f+e1,a.life0=zf+Math.random()*(Qx-zf),a.life=a.life0,a.tw=Math.random()*Math.PI*2,a.twSpeed=2+Math.random()*4,a.baseA=.15+Math.random()*.2,u.alpha=0,u.scale.set(1),tc.addChild(u),Ti.push(a)}function Qf(){for(let a=Ti.length-1;a>=0;a--){const c=Ti[a];c.g.removeFromParent(),Ti.splice(a,1),Vh.push(c)}nc=0}function o1(){if(!r.overlay.fsOutro||!ec)return;const a=Math.min(.05,P.ticker.deltaMS/1e3);nc+=Kx*a;let c=Math.floor(nc);c>0&&(nc-=c),c=Math.min(c,5);for(let f=0;f<c;f++)i1();const u=Zf();for(let f=Ti.length-1;f>=0;f--){const p=Ti[f],x=p.g,b=u.x-x.x,v=u.y-x.y,T=Math.hypot(b,v)||1,E=t1/Math.max(60,T);p.vx+=b/T*E,p.vy+=v/T*E;const k=Math.sin((x.x+f*17)*.02+p.tw)*6;x.x+=(p.vx+k)*a,x.y+=p.vy*a,p.tw+=p.twSpeed*a;const F=.5+.5*Math.sin(p.tw),R=qf+(s1-qf)*(F*F);x.alpha=Math.min(1,p.baseA+R);const L=.95+F*.2;x.scale.set(L),p.life-=a;const N=1-p.life/p.life0,D=Math.min(1,N/.18),U=Math.min(1,Math.max(0,(N-.72)/.28));x.alpha*=D*(1-U),p.life<=0&&(x.removeFromParent(),Ti.splice(f,1),Vh.push(p))}}function a1(){Kf||(Kf=!0,Je(()=>o1()))}a1();const Ir=new ft({text:"TOTAL WIN",style:{fontFamily:"pixeldown",fill:16777215,fontSize:110,fontWeight:"100",align:"center",stroke:{color:0,width:12},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.6,dropShadowBlur:0,dropShadowDistance:12,dropShadowAngle:-Math.PI/4}});Ir.anchor.set(.5),Ir.skew.set(0,0),Bn.addChild(Ir);const Ke=new ft({text:"0.00",style:{fontFamily:"pixeldown",fill:16765802,fontSize:150,fontWeight:"100",align:"center",stroke:{color:0,width:12},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.6,dropShadowBlur:0,dropShadowDistance:14,dropShadowAngle:-Math.PI/4}});Ke.anchor.set(.5),Ke.skew.set(0,0),Bn.addChild(Ke);const l1=!0,er=new ft({text:"CLICK TO CONTINUE",style:{}});i(er),er.style.dropShadowAngle=-Math.PI/4,er.anchor.set(.5),er.visible=l1,er.alpha=1,er.zIndex=1,Bn.addChild(er),er.eventMode="static",er.cursor="pointer",er.hitArea=new $t(-340,-60,680,120),er.on("pointertap",a=>{var c;(c=a.stopPropagation)==null||c.call(a),Qt.emit("pointertap",{})});function c1(a){if(!Ce())return 1;const c=P.screen.width,u=Math.round(c*.1),f=Math.max(1,c-u*2);Ir.scale.set(1,1),Ke.scale.set(1,1);const p=Ke.text;Ke.text=zn(a);const x=Math.max(Ir.getBounds().width,Ke.getBounds().width);if(Ke.text=p,x<=f)return 1;const b=f/x;return Math.max(.58,Math.min(1,b))}const h1=.44,u1=.59,d1=.38,f1=.7;function sc(){const a=P.screen.width,c=P.screen.height;qr.x=Math.round(a*.5),qr.y=Math.round(c*.5);const u=qr.texture.width||1,f=qr.texture.height||1,p=Math.max(a/u,c/f);qr.scale.set(p);const x=De(),b=x?d1:h1,v=x?f1:u1;Ir.position.set(Math.round(a*.5),Math.round(c*b)),Ke.position.set(Math.round(a*.5),Math.round(c*v)),er.position.set(Math.round(a*.5),Math.round(c*.92)),Ce()&&ic?(Ir.scale.set(rc),Ke.scale.set(rc)):Ce()||(Ir.scale.set(1,1),Ke.scale.set(1,1))}window.addEventListener("resize",sc);let Io=0,ko=!0,Jf=0,rc=1,ic=!1,$h=!1,Zi=0;function tp(){Zi++;const a=Zi,c=Ke.scale.x,u=c*1.08,f=260,p=320,x=220;async function b(){for(;a===Zi&&r.overlay.fsOutro;)await me(f,v=>{if(a!==Zi)return;const T=As(v),E=c+(u-c)*T;Ke.scale.set(E,E)}),await me(p,v=>{if(a!==Zi)return;const T=v*v*(3-2*v),E=u+(c-u)*T;Ke.scale.set(E,E)}),Ke.scale.set(c,c),await Wn(x);Ke.scale.set(c,c)}b()}function ep(){re.scale.set(1,1),ie(140,a=>{const u=1+.06*es(a,1.05);re.scale.set(u,u)},()=>{ie(220,a=>{const c=a*a*(3-2*a);re.scale.set(1.06+(1-1.06)*c)})})}function p1(){const a=Ke.scale.x||1;Ke.scale.set(a,a),ie(140,c=>{const u=es(c,1.05),f=a*(1+.06*u);Ke.scale.set(f,f)},()=>{ie(220,c=>{const u=c*c*(3-2*c),f=a*(1.06+(1-1.06)*u);Ke.scale.set(f,f)})})}function np(){$h||($h=!0,setTimeout(()=>{ib(1.7,1.9)},60),setTimeout(()=>{Ba(.9),setTimeout(()=>ou(!0),900)},80),p1())}function m1(){var a,c;Io++,(a=o==null?void 0:o.stopTickLoop)==null||a.call(o,80),Ke.text=zn(Jf),ko=!0,qh(350),(c=o==null?void 0:o.playSfx)==null||c.call(o,"final_fsoutro_amount",1.15),np(),tp()}function _1(a,c=1400){var E;Io++;const f=Io;Jf=a,ko=!1,$h=!1,(E=o==null?void 0:o.startTickLoop)==null||E.call(o,120,.38,1);const p=performance.now(),x=0;let b=p,v=0;function T(k){var qt,Jt,Et;const F=Math.min(.05,Math.max(.001,(k-b)/1e3));if(b=k,f!==Io)return;const R=(k-p)/c,L=Math.min(1,R),N=.75,D=14;let U;if(L<=N){const bt=L/N;U=.78*(1-Math.pow(1-bt,3))}else{const bt=Math.min(1,(L-N)/(1-N));U=.78+(1-.78)*(1-Math.pow(1-bt,D))}const j=U-v,V=.3*F,Q=Math.sign(j)*Math.min(Math.abs(j),V),q=Math.min(1,v+Q);v=q;const K=x+(a-x)*q;Ke.text=zn(K);const Z=Math.max(0,Math.min(1,q)),at=.98+.5*Math.pow(Z,1.4),yt=1+.2*(at-1),Vt=(.22+.4*Math.pow(Z,1.2))*yt;(qt=o==null?void 0:o.setTickParams)==null||qt.call(o,Vt,at),Math.abs(a-K)>.01?requestAnimationFrame(T):((Jt=o==null?void 0:o.stopTickLoop)==null||Jt.call(o,120),Ke.text=zn(a),ko=!0,qh(350),(Et=o==null?void 0:o.playSfx)==null||Et.call(o,"final_fsoutro_amount",1.15),np(),setTimeout(()=>{r.overlay.fsOutro&&tp()},420))}Ke.text=zn(0),requestAnimationFrame(T)}function g1(a,c,u=420){return new Promise(f=>{jh(a,c,u),setTimeout(f,u+30)})}hh=a=>{var c,u;console.log("[DEBUG] Force FS OUTRO",a),(c=o==null?void 0:o.initFromUserGesture)==null||c.call(o),r.overlay.bigWin=!1,r.overlay.fsIntro=!1,r.overlay.fsOutroPending=!1,Io++,ko=!0,(u=o==null?void 0:o.stopTickLoop)==null||u.call(o,0),Ni(!1),jh(!0,a,420)};function jh(a,c,u=420){var p;const f=ns.get(Ws);if(f&&(qr.texture=f),qr.visible=!0,sc(),B.sortChildren(),a){r.overlay.fsOutro=!0,(p=o==null?void 0:o.playSfx)==null||p.call(o,"fs_outro",1),ic=!1,rc=c1(c),ic=!0,sc(),Qf(),ec=!0,r.ui.auto=!1,xt.alpha=0,xt.eventMode="none",dc(),Qt.visible=!0,Qt.eventMode="static",_1(c,1e3),Bn.visible=!0,Bn.alpha=0,hu(1.6);const x=Qt.alpha,b=Hn.strength;ie(u,v=>{const T=Math.max(0,Math.min(1,v));Qt.alpha=x+(.55-x)*T,Hn.strength=b+(6-b)*T,Bn.alpha=T})}else{ic=!1,rc=1;const x=Qt.alpha,b=Hn.strength,v=Bn.alpha;ie(u,T=>{const E=Math.max(0,Math.min(1,T));Qt.alpha=x*(1-E),Hn.strength=b*(1-E),Bn.alpha=v*(1-E)},()=>{var T;Qt.alpha=0,Hn.strength=0,Qt.visible=!1,Qt.eventMode="none",Bn.alpha=0,Bn.visible=!1,Op(!0),ou(!0),Io++,ko=!0,(T=o==null?void 0:o.stopTickLoop)==null||T.call(o,0),r.overlay.fsOutro=!1,qh(250),ec=!1,Qf(),Zi++,u0()})}}let Lo=null;const y1=.35;let Fo=null;const x1=.2;function sp(a,c=250){var p;const u=((p=o==null?void 0:o.getMusicVolume01)==null?void 0:p.call(o))??.6,f=Math.max(0,Math.min(1,a));!(o!=null&&o.setMusicVolume01)||!(o!=null&&o.apply)||me(c,x=>{const b=x*x*(3-2*x);o.setMusicVolume01(u+(f-u)*b),o.apply()})}function b1(a=250){var c;Fo==null&&(Fo=((c=o==null?void 0:o.getMusicVolume01)==null?void 0:c.call(o))??.6),sp(Fo*x1,a)}function qh(a=250){Fo!=null&&(sp(Fo,a),Fo=null)}let oc=1,ac=!1,Ca=null,lc=0,Ea=!0,Kh=0,Kr="BIG";const rp=10,ip=20,op=35,ap=60,lp=100;function cp(a){return a>=lp?"MAX":a>=ap?"EPIC":a>=op?"MEGA":a>=ip?"SUPER":"BIG"}let Pa=!1,Zh=0,Ia=null;function w1(){return new An({fontFamily:"pixeldown",fill:16777215,fontSize:110,fontWeight:"100",letterSpacing:2,align:"center",stroke:{color:0,width:14},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.75,dropShadowBlur:0,dropShadowDistance:14,dropShadowAngle:-Math.PI/4})}function S1(){return new An({fontFamily:"pixeldown",fill:16765802,fontSize:170,fontWeight:"100",letterSpacing:1,align:"center",stroke:{color:0,width:16},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.75,dropShadowBlur:0,dropShadowDistance:16,dropShadowAngle:-Math.PI/4})}function M1(){return new An({fontFamily:"pixeldown",fill:16777215,fontSize:42,fontWeight:"100",letterSpacing:1,align:"center",stroke:{color:0,width:6},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.7,dropShadowBlur:0,dropShadowDistance:8,dropShadowAngle:-Math.PI/4})}const Qh={BIG:16777215,SUPER:10482687,MEGA:16769126,EPIC:16751164,MAX:16727100},Jh=16765802,zt=new ft({text:"BIG WIN",style:w1()});zt.anchor.set(.5),zt.zIndex=9470,zt.visible=!1,zt.alpha=0,B.addChild(zt);const re=new ft({text:"0.00",style:S1()});re.anchor.set(.5),re.zIndex=9470,re.visible=!1,re.alpha=0,B.addChild(re);let Oo=0;function hp(){Oo++;const a=Oo,c=re.scale.x,u=c*1.08,f=240,p=320,x=220;async function b(){for(;a===Oo&&r.overlay.bigWin;)await me(f,v=>{if(a!==Oo)return;const T=As(v),E=c+(u-c)*T;re.scale.set(E,E)}),await me(p,v=>{if(a!==Oo)return;const T=v*v*(3-2*v),E=u+(c-u)*T;re.scale.set(E,E)}),re.scale.set(c,c),await Wn(x);re.scale.set(c,c)}b()}function up(){Oo++,re.scale.set(1,1)}const ue=new ft({text:"CLICK TO CONTINUE",style:M1()});ue.anchor.set(.5),ue.zIndex=9470,ue.visible=!1,ue.alpha=0,B.addChild(ue);const Xn=new ht;Xn.zIndex=9464,Xn.visible=!1,Xn.alpha=0,Xn.eventMode="none",Xn.blendMode="add",Xn.filters=[new mo({strength:40})],B.addChild(Xn),B.sortChildren();let A1=8191851,dp=.42,v1=300,T1=900,C1=1400,E1=14,P1=1.8,I1=.06,k1=-40;function fp(){const a=P.screen.width;P.screen.height;const c=Math.round(a*.5),u=k1,f=Math.round(u+C1),p=v1,x=T1;Xn.clear();const b=Math.max(3,E1|0),v=Math.max(.5,P1),T=Math.max(0,Math.min(1,I1));for(let F=0;F<b;F++){const R=F/b,L=(F+1)/b,N=u+(f-u)*R,D=u+(f-u)*L,U=p+(x-p)*R,j=p+(x-p)*L,V=Math.pow(1-R,v),Q=T+(1-T)*V;Xn.moveTo(c-U*.5,N).lineTo(c+U*.5,N).lineTo(c+j*.5,D).lineTo(c-j*.5,D).closePath().fill({color:A1,alpha:Q})}const E=p*.4,k=x*.5;for(let F=0;F<b;F++){const R=F/b,L=(F+1)/b,N=u+(f-u)*R,D=u+(f-u)*L,U=E+(k-E)*R,j=E+(k-E)*L,V=Math.pow(1-R,v*1.25),Q=T*.35+(1-T*.35)*V;Xn.moveTo(c-U*.5,N).lineTo(c+U*.5,N).lineTo(c+j*.5,D).lineTo(c-j*.5,D).closePath().fill({color:15269840,alpha:Q})}}window.addEventListener("resize",()=>{Xn.visible&&fp()}),zt.roundPixels=!0,re.roundPixels=!0,ue.roundPixels=!0;const pp=.39;zt.skew.set(0,pp),re.skew.set(0,pp),ue.skew.set(0,0),ue.eventMode="static",ue.cursor="pointer";function L1(a){if(!Ce())return 1;const c=P.screen.width,u=Math.round(c*.1),f=Math.max(1,c-u*2);zt.scale.set(1,1),re.scale.set(1,1);const p=zt.text,x=re.text;zt.text="EPIC WIN",re.text=zn(a);const b=Math.max(zt.getBounds().width,re.getBounds().width);if(zt.text=p,re.text=x,b<=f)return 1;const v=f/b;return Math.max(.58,Math.min(1,v))}function Ro(){const a=P.screen.width/2,c=P.screen.height/2;if(De()){P.screen.height*.5,Math.round(P.screen.height*.5),zt.scale.set(tu),re.scale.set(tu),ue.scale.set(tu);const T=Math.round(c-P.screen.height*.2),E=Math.round(c+P.screen.height*.1),k=Math.round(P.screen.height*.92);zt.position.set(a,T),re.position.set(a,E),ue.position.set(a,k);const F=ue.getLocalBounds();ue.hitArea=new $t(F.x-60,F.y-24,F.width+120,F.height+48);return}const u=-100,f=70,p=Math.round(c+u);Pa?zt.x=a:zt.position.set(a,p),re.position.set(a,Math.round(c+f)),ue.position.set(a,Math.round(P.screen.height*.92));const x=ue.getLocalBounds(),b=60,v=24;if(ue.hitArea=new $t(x.x-b,x.y-v,x.width+b*2,x.height+v*2),Ce()){const T=P.screen.width,E=Math.round(T*.1),k=Math.max(1,T-E*2);zt.scale.set(1,1),re.scale.set(1,1);const F=zt.getBounds().width,R=re.getBounds().width,L=Math.max(F,R);if(L>k){const N=k/L,D=Math.max(.58,Math.min(1,N));zt.scale.set(D,D),re.scale.set(D,D)}}else zt.scale.set(1,1),re.scale.set(1,1);Ce()&&ac?(zt.scale.set(oc),re.scale.set(oc)):Ce()||(zt.scale.set(1,1),re.scale.set(1,1))}const tu=.6,F1=180,eu=520,nu=360;function ka(){return-Math.max(1,zt.height||zt.getBounds().height||1)/2-F1}function mp(a=eu,c){Pa=!0,Ro();const u=typeof c=="number"?c:zt.y;zt.y=ka(),ie(a,f=>{const p=Math.max(0,Math.min(1,f)),x=es(p,.85);zt.y=ka()+(u-ka())*x},()=>{zt.y=u,Pa=!1})}function _p(a=nu,c){Pa=!0;const u=zt.y,f=ka();ie(a,p=>{const x=Math.max(0,Math.min(1,p)),b=Qo(x);zt.y=u+(f-u)*b},()=>{zt.y=f,Pa=!1,c==null||c()})}function O1(a){Zh++;const c=Zh;Ro();const u=zt.y;Ia!==a&&(Ia=a,_p(nu,()=>{if(c!==Zh)return;zt.alpha=0,zt.y=ka(),zt.text=`${a} WIN`;const f=Qh[a];zt.style.fill=f,re.style.fill=Jh,zt.alpha=1,mp(eu,u)}))}window.addEventListener("resize",Ro);const R1="apple_big_win.png",B1="pear_big_win.png",N1="grapes_big_win.png",su="rake_super_win.png",gp="sheep_super_win.png",yp="wateringcan_super_win.png",xp="cow_mega_win.png",bp="spade_mega_win.png",wp="wheelbarrow_mega_win.png",Sp="tractor_epic_win.png",Mp="axe_epic_win.png",Ap="watermelon_epic_win.png",W1=[{frame:R1,weight:.55},{frame:B1,weight:.3},{frame:N1,weight:.2}],D1=[{frame:yp,weight:.2},{frame:su,weight:.2},{frame:gp,weight:.55}],G1=[{frame:xp,weight:.2},{frame:bp,weight:.2},{frame:wp,weight:.1}],vp=[{frame:Sp,weight:.45},{frame:Mp,weight:.35},{frame:Ap,weight:.2}],H1={[yp]:.75,[su]:1.8,[gp]:1.3},Tp={[xp]:1,[bp]:1.3,[wp]:2},Cp={[Sp]:1.85,[Mp]:1.45,[Ap]:1.2};function La(a){let c=0;for(const p of a)c+=p.weight;let u=Math.random()*c;for(const p of a)if(u-=p.weight,u<=0)return{tex:F0(p.frame),frame:p.frame};const f=a[0];return{tex:F0(f.frame),frame:f.frame}}function U1(a){return La(a==="BIG"?W1:a==="SUPER"?D1:a==="MEGA"?G1:vp)}let kr=null,Fa=!1,Bo="BIG",Zr=!1,Ep=!1,cc=0;const Pp=[],Qi=[],Y1=16,X1=2,z1=2,V1=2,$1=1.75,j1=1.9,q1=1.9;function K1(){kr||(kr=new et,kr.sortableChildren=!0,kr.zIndex=9465,B.addChild(kr),B.sortChildren())}function hc(){if(!kr)return;const a=U1(Bo);if(!a)return;const c=a.tex,u=a.frame;if(Qi.length>=Y1)return;let f=Pp.pop();if(f)f.s.texture=c;else{const U=new ce(c);U.anchor.set(.5),U.roundPixels=!0,f={s:U,vx:0,vy:0,vr:0,life:0}}f.s.__itemFrame=u;const p=f.s,x=P.renderer.width,b=P.renderer.height,v=.1,T=v+Math.random()*(1-v*2);p.x=Math.round(x*T),p.y=b+60+Math.random()*160;const E=.18+Math.random()*.22;let k=z1;switch(Bo){case"SUPER":k=V1;break;case"MEGA":k=$1;break;case"EPIC":k=j1;break;case"MAX":k=q1;break}const F=p.__itemFrame,R=F?H1[F]??1:1,L=F?Tp[F]??1:1,N=F?Cp[F]??1:1;let D=R;if(F&&F in Tp&&(D=L),F&&F in Cp&&(D=N),F===su){const U=P.renderer.height*.55,j=Math.max(1,p.texture.height),V=U/j;p.scale.set(V*k)}else p.scale.set(E*k*D);p.scale.set(E*k*D),p.alpha=1,p.rotation=-.2+Math.random()*.4,f.vx=(-1+Math.random()*2)*(6+Math.random()*10),f.vy=-(95+Math.random()*300),f.vr=(-1+Math.random()*2)*.6,kr.addChild(p),Qi.push(f)}function Z1(){if(!kr)return;const a=Math.min(.05,P.ticker.deltaMS/1e3),c=P.renderer.width,u=P.renderer.height;if(Fa&&!Zr){cc+=X1*a;let f=Math.floor(cc);f>0&&(cc-=f),f=Math.min(f,4);for(let p=0;p<f;p++)hc()}for(let f=Qi.length-1;f>=0;f--){const p=Qi[f],x=p.s;Zr&&(p.vy-=800*a,p.vx*=1-.6*a);const b=2,v=c*.5-x.x;p.vx+=v/Math.max(1,c*.5)*b*a,x.x+=p.vx*a,x.y+=p.vy*a,x.rotation+=p.vr*a,(x.y<-220||x.y>u+260||x.x<-220||x.x>c+220)&&(x.removeFromParent(),Qi.splice(f,1),Pp.push(p))}Zr&&Qi.length===0&&(Zr=!1)}function Q1(){if(K1(),!!kr){Fa=!0,Zr=!1,cc=0;for(let a=0;a<8;a++)hc();Ep||(Ep=!0,Je(()=>Z1()))}}function J1(){kr&&(Fa=!1,Zr=!0,Qi.length===0&&(Zr=!1))}let Ss=null,Oa=!1,Ip=!1,Ra=0;const ru=[],Ci=[];function tb(){Ss||(Ss=new et,Ss.eventMode="none",Ss.zIndex=9466,B.addChild(Ss),B.sortChildren())}function iu(a,c){const u=Math.max(0,Math.min(255,Math.round((a>>16&255)*c))),f=Math.max(0,Math.min(255,Math.round((a>>8&255)*c))),p=Math.max(0,Math.min(255,Math.round((a&255)*c)));return u<<16|f<<8|p}const kp=[16727100,16747068,16769126,5635962,5227519,7028694,16740270];function eb(a,c,u){a.clear();const f=c,p=c*.55,x=c*.75,b=iu(u,1.1),v=iu(u,.92),T=iu(u,.82);a.moveTo(0,-p).lineTo(f,0).lineTo(0,p).lineTo(-f,0).closePath().fill({color:b,alpha:1}),a.moveTo(-f,0).lineTo(0,p).lineTo(0,p+x).lineTo(-f,x).closePath().fill({color:v,alpha:1}),a.moveTo(f,0).lineTo(0,p).lineTo(0,p+x).lineTo(f,x).closePath().fill({color:T,alpha:1})}function Lp(){if(!Ss)return;let a=ru.pop();a||(a={g:new ht,vx:0,vy:0,vr:0,life:0,life0:0,s0:1});const c=a.g,u=P.renderer.width;P.renderer.height;const f=-60+Math.random()*(u+120),p=-120-Math.random()*180,x=4+(Math.random()*5|0),b=kp[Math.random()*kp.length|0];eb(c,x,b),c.x=f,c.y=p,c.alpha=.95,c.rotation=Math.random()*Math.PI*2,a.vy=160+Math.random()*360,a.vx=(-1+Math.random()*2)*90,a.vr=(-1+Math.random()*2)*3.2,a.life0=2.2+Math.random()*1.6,a.life=a.life0,a.s0=.85+Math.random()*.9,c.scale.set(a.s0),Ss.addChild(c),Ci.push(a)}function Ba(a=1){if(tb(),!Ss)return;Ss&&(Ss.visible=!0),Oa=!0,Ra=0;const c=Math.floor(60+a*40);for(let u=0;u<c;u++)Lp();Ba._intensity=a,Ip||(Ip=!0,Je(()=>nb())),Ss&&(Ss.visible=!0)}function ou(a=!0){if(Oa=!1,Ra=0,a){Oa=!1;return}for(let c=Ci.length-1;c>=0;c--){const u=Ci[c];u.g.removeFromParent(),Ci.splice(c,1),ru.push(u)}}function nb(){if(!Ss)return;const a=Math.min(.05,P.ticker.deltaMS/1e3),c=P.renderer.width,u=P.renderer.height;if(Oa){const p=90+(Ba._intensity??1)*70;Ra+=p*a;const x=Math.floor(Ra);Ra-=x;const b=Math.min(x,12);for(let v=0;v<b;v++)Lp()}for(let f=Ci.length-1;f>=0;f--){const p=Ci[f],x=p.g;p.vy+=520*a,x.x+=p.vx*a,x.y+=p.vy*a,x.rotation+=p.vr*a,p.life-=a,x.alpha=1,(x.y>u+220||x.x<-260||x.x>c+260)&&(x.removeFromParent(),Ci.splice(f,1),ru.push(p))}!Oa&&Ci.length===0&&Ss&&(Ss.visible=!1)}let Lr=null,au=!1,Fp=!1,Na=0;const lu=[],Ei=[];function sb(){return I0()}function rb(){Lr||(Lr=new et,Lr.sortableChildren=!0,Lr.zIndex=9005,B.addChild(Lr),Lr.zIndex=9601,B.sortChildren())}function cu(a=1){if(!Lr)return;const c=sb();if(!c.length)return;const u=P.renderer.width;P.renderer.height;let f=lu.pop();if(f)f.s.textures=c,f.s.animationSpeed=.28+Math.random()*.25,f.s.gotoAndPlay(0);else{const E=new Al(c);E.anchor.set(.5),E.loop=!0,E.animationSpeed=.28+Math.random()*.25,E.play(),E.autoUpdate=!0,E.roundPixels=!0,f={s:E,vx:0,vy:0,vr:0,life:0}}const p=f.s;p.x=Math.random()*u,p.y=-40-Math.random()*160;const x=.12,v=x+Math.random()*(.75-x),T=1+Math.min(.28,(a-1)*.12);p.scale.set(v*T),p.alpha=.95,p.rotation=Math.random()*Math.PI*2,f.vx=(-1+Math.random()*2)*(1.1+a*.85),f.vy=(2.3+Math.random()*4.6)*(1+a*.75),f.vr=(-1+Math.random()*2)*.06,f.life=3.2+Math.random()*2.2,Lr.addChild(p),Ei.push(f)}function hu(a=1){if(rb(),!!Lr){au=!0,Na=0;for(let c=0;c<.1+Math.floor(a*1);c++)cu(a);Fp||(Fp=!0,Je(()=>ob())),hu._intensity=a}}function ib(a,c=1){const u=Math.floor((12+a*10)*c);for(let f=0;f<u;f++)cu(a)}function Op(a=!0){var c,u;if(au=!1,Na=0,a){for(const f of Ei)f.life=9999;return}for(const f of Ei)(u=(c=f.s).stop)==null||u.call(c),f.s.removeFromParent(),lu.push(f);Ei.length=0}function ob(){if(!Lr)return;const a=P.renderer.width,c=P.renderer.height,u=P.ticker.deltaMS/1e3;if(au){const p=hu._intensity??1,x=4+p*3;Na+=x*u;const b=Math.floor(Na);Na-=b;const T=Math.max(0,140-Ei.length),E=Math.min(b,T);for(let k=0;k<E;k++)cu(p)}const f=18;for(let p=Ei.length-1;p>=0;p--){const x=Ei[p],b=x.s;x.vy+=f*u,b.x+=x.vx*60*u,b.y+=x.vy*60*u,b.rotation+=x.vr*60*u,x.life-=u,(b.y>c+120||b.x<-120||b.x>a+120||x.life<=0)&&(x.s.stop(),b.removeFromParent(),Ei.splice(p,1),lu.push(x))}}function ab(a){var c,u,f,p;a==="SUPER"?(c=o==null?void 0:o.playSfx)==null||c.call(o,"bigwin_super",1):a==="MEGA"?(u=o==null?void 0:o.playSfx)==null||u.call(o,"bigwin_mega",1):a==="EPIC"?(f=o==null?void 0:o.playSfx)==null||f.call(o,"bigwin_epic",1):a==="MAX"&&((p=o==null?void 0:o.playSfx)==null||p.call(o,"bigwin_max",1))}function lb(a){var u;const c=a==="SUPER"?1.08:a==="MEGA"?1.16:a==="EPIC"?1.24:a==="MAX"?1.34:1;if(a==="SUPER"||a==="MEGA"||a==="EPIC"||a==="MAX"){const f=Number.isFinite(c)?Math.max(.5,Math.min(4,c)):1;(u=o==null?void 0:o.playSfx)==null||u.call(o,"bigwin_hit",1,f)}}function uu(a,c,u,f=520){var p,x,b,v;if(Ro(),a){let T=function(Q){var Mt,ct,nt,Rt;if(D!==lc)return;const q=Math.min(1,(Q-U)/N),Z=Math.min(1,R*q/200),at=1-Math.pow(Z,2.8)*.65,yt=Math.min(1,q*at+q*(1-at)),Vt=F*yt,qt=Vt/k;re.text=zn(Vt);const Jt=Math.max(0,Math.min(1,q)),Et=.98+.65*Math.pow(Jt,1.45),bt=1+.25*(Et-1),X=(.22+.45*Math.pow(Jt,1.2))*bt;(Mt=o==null?void 0:o.setTickParams)==null||Mt.call(o,X,Et);const ot=cp(qt);if(ot!==j&&(j=ot,O1(ot),lb(ot),ab(ot),Bo=ot,Bo=ot,ot==="MAX"&&Ba(1.35),Fa&&!Zr)){const Xe=ot==="SUPER"?6:ot==="MEGA"?8:ot==="EPIC"?10:12;for(let ts=0;ts<Xe;ts++)hc()}q<1?((ct=o==null?void 0:o.startTickLoop)==null||ct.call(o,120,.22,1),requestAnimationFrame(T)):(re.text=zn(F),ep(),(nt=o==null?void 0:o.stopTickLoop)==null||nt.call(o,0),(Rt=o==null?void 0:o.playSfx)==null||Rt.call(o,"final_amount",1.15,1),uc(!0,360),Ea=!0,hp())};r.overlay.bigWin=!0,(p=o==null?void 0:o.playSfx)==null||p.call(o,"bigwin_hit",1),Lo==null&&(Lo=((x=o==null?void 0:o.getMusicVolume01)==null?void 0:x.call(o))??.6);const E=Math.max(0,Math.min(1,Lo*y1));(b=o==null?void 0:o.setMusicVolume01)==null||b.call(o,E),(v=o==null?void 0:o.apply)==null||v.call(o),r0(!0),Bo="BIG",Q1(),r.ui.auto=!1,xt.eventMode="none",dc(),Qt.visible=!0,Qt.eventMode="static";{fp(),Xn.visible=!0,Xn.alpha=0;const Q=Xn.alpha;ie(f,q=>{const K=Math.max(0,Math.min(1,q));Xn.alpha=Q+(dp-Q)*K})}uc(!1,0),Ia=null,Ro(),zt.text="BIG WIN",zt.style.fill=Qh.BIG,re.style.fill=Jh,mp(eu),Ia="BIG";const k=r.bank.betLevels[r.bank.betIndex],F=c,R=u;Kh=F,Kr=cp(R),ac=!1,oc=L1(Kh),ac=!0,Ro(),Ea=!1;const N=Math.min(6500,1400+R*45);lc++;const D=lc,U=performance.now();let j=null;j="BIG",requestAnimationFrame(T),[zt,re,ue].forEach(Q=>{Q.visible=!0,Q.alpha=0});const V=Qt.alpha;Hn.strength,ie(f,Q=>{const q=Math.max(0,Math.min(1,Q));Qt.alpha=V+(.8-V)*q,zt.alpha=q,re.alpha=q,ue.alpha=q})}else{ac=!1,oc=1,up(),J1(),ou(!0);const T=Qt.alpha,E=Hn.strength;uc(!1,f),_p(nu),ie(f,k=>{const F=Math.max(0,Math.min(1,k));Qt.alpha=T*(1-F),Hn.strength=E*(1-F),zt.alpha=1-F,re.alpha=1-F,ue.alpha=1-F,Xn.visible&&(Xn.alpha=dp*(1-F))},()=>{var k,F,R,L;[zt,re,ue].forEach(N=>{N.visible=!1,N.alpha=0}),Qt.alpha=0,Hn.strength=0,Qt.visible=!1,Qt.eventMode="static",Xn.visible=!1,Xn.alpha=0,xt.alpha=1,xt.eventMode="auto",r0(!1),(k=o==null?void 0:o.stopTickLoop)==null||k.call(o,0),r.overlay.bigWin=!1,Lo!=null&&((F=o==null?void 0:o.setMusicVolume01)==null||F.call(o,Lo),(R=o==null?void 0:o.apply)==null||R.call(o),Lo=null),(L=o==null?void 0:o.playMusic)==null||L.call(o,r.game.mode==="FREE_SPINS"?"music_fs":"music_base",350),Ca==null||Ca(),Ca=null})}}function Rp(){var c;if(lc++,re.text=zn(Kh),(c=o==null?void 0:o.playSfx)==null||c.call(o,"final_amount",1.15,1),setTimeout(()=>{var u;(u=o==null?void 0:o.stopTickLoop)==null||u.call(o,120)},80),ep(),Ia=Kr,zt.text=`${Kr} WIN`,Bo=Kr,Kr==="MAX"&&Ba(1.35),Fa&&!Zr){const u=Kr==="SUPER"?8:Kr==="MEGA"?10:Kr==="EPIC"?12:14;for(let f=0;f<u;f++)hc()}const a=Qh[Kr];zt.style.fill=a,re.style.fill=Jh,Ea=!0,uc(!0,180),hp()}function Bp(a,c){return new Promise(u=>{var f;Ca=u,uu(!0,a,c,520),(f=ue.removeAllListeners)==null||f.call(ue,"pointertap"),ue.on("pointertap",p=>{var x,b;if((x=p.stopPropagation)==null||x.call(p),!!r.overlay.bigWin){if(!Ea){Rp();return}(b=o==null?void 0:o.playSfx)==null||b.call(o,"fs_click",1.15),up(),uu(!1,0,0,260)}})})}Qt.on("pointertap",()=>{var a,c,u,f,p;if(r.overlay.bigWin){if((a=o==null?void 0:o.initFromUserGesture)==null||a.call(o),!Ea){Rp();return}(c=o==null?void 0:o.playSfx)==null||c.call(o,"fs_click",1.15),uu(!1,0,0,260);return}if(r.overlay.fsOutro){if(Zi++,!ko){m1();return}(u=o==null?void 0:o.playSfx)==null||u.call(o,"fs_click",1.15),(async()=>(await g1(!1,0,260),await Ni(!1),bn.alpha=0,bn.visible=!1,wc(),u0(),B.sortChildren(),xn.visible=!0))(),wa(),Bu("BASE"),oo("BASE",!0),(f=o==null?void 0:o.playMusic)==null||f.call(o,"music_base",450),Ta=!1,vx(),Ul=!0,$l=!0,Of(6),Eo=0,Ki=!0,Ma=0,tr=0,r.game.returningFromFreeSpins=!0,Ac(tn[Qe]??1),(async()=>(await e0(),r.game.returningFromFreeSpins=!1))(),n0(),xt.alpha=1,xt.eventMode="auto",Op(!0),r.overlay.bigWin=!1;return}r.overlay.fsIntro&&((p=o==null?void 0:o.playSfx)==null||p.call(o,"fs_click",1),r.overlay.fsIntro=!1,he&&(he.s.removeFromParent(),he=null),To(),jr=999,Qt.eventMode="none",du(!1,180),(async()=>{var x;Ce()?await Fx(3e3):await Lx(3e3),await oo("FREE_SPINS",!0),be.visible=!1,be.alpha=0,we.visible=!0,we.alpha=1,Gp(!1,.72,8,wb),await Wn($x),i0(120,360,.9),(x=o==null?void 0:o.playMusic)==null||x.call(o,"music_fs",450),Si=.6,await Wn(220),Di()})())});const cb=900,yn=new ft({text:"CLICK TO CONTINUE",style:{}});yn.anchor.set(.5),yn.zIndex=9450,yn.visible=!1,yn.alpha=0,B.addChild(yn),i(yn);const nr=new ft({text:"0",style:{}});nr.anchor.set(.5),nr.visible=!1,nr.alpha=0,nr.zIndex=9452,B.addChild(nr);function hb(a=2e3){const c=Ke.style,u=c!=null&&c.clone?c.clone():{...c||{}};nr.style=new An({...u,fontSize:a})}hb();const Fr=new ft({text:"FREE SPINS",style:Ir.style});Fr.anchor.set(.5),Fr.visible=!1,Fr.alpha=0,Fr.zIndex=9452,B.addChild(Fr);function Np(){const a=P.screen.width,c=P.screen.height,u=Math.round(a*.5),f=c*.52,p=250;nr.position.set(u,Math.round(f-p/2)),Fr.position.set(u,Math.round(f+p/2))}window.addEventListener("resize",Np),yn.eventMode="static",yn.cursor="pointer",yn.hitArea=new $t(-340,-60,680,120),yn.on("pointertap",a=>{var c;(c=a.stopPropagation)==null||c.call(a),Qt.emit("pointertap",{})});const ub=.95,db=90;function fb(){return P.screen.height+db}function pb(){return P.screen.height*ub}function Wp(){yn.x=P.screen.width/2}const mb=.95,_b=90;function gb(){return P.screen.height+_b}function yb(){return P.screen.height*mb}function xb(){ue.x=P.screen.width/2}function uc(a,c=320){xb();const u=gb(),f=yb();if(a)ue.visible=!0,ue.alpha=0,ue.y=u,ie(c,p=>{const x=Math.max(0,Math.min(1,p));ue.alpha=x,ue.y=u+(f-u)*x});else{const p=ue.y,x=ue.alpha;ie(c,b=>{const v=Math.max(0,Math.min(1,b));ue.alpha=x*(1-v),ue.y=p+(u-p)*v},()=>{ue.alpha=0,ue.y=u,ue.visible=!1})}}function du(a,c=320){Wp();const u=fb(),f=pb();if(a)yn.visible=!0,yn.alpha=0,yn.y=u,ie(c,p=>{const x=Math.max(0,Math.min(1,p));yn.alpha=x,yn.y=u+(f-u)*x});else{const p=yn.y,x=yn.alpha;ie(c,b=>{const v=Math.max(0,Math.min(1,b));yn.alpha=x*(1-v),yn.y=p+(u-p)*v},()=>{yn.alpha=0,yn.y=u,yn.visible=!1})}}function dc(){const a=P.screen.width,c=P.screen.height;Qt.clear(),Qt.rect(0,0,a,c).fill(0)}Xf();const bb=550,wb=260,Sb=.75,Mb=.75;async function Dp(a){var F;Xf(),(F=o==null?void 0:o.playSfxThrottled)==null||F.call(o,"fstrigger",200,1,1),Un.text=`+${a}`,Un.visible=!0,Yn.visible=!0,Un.alpha=0,Yn.alpha=0;const c=De()?Sb:.85,u=De()?Mb:.95;Un.scale.set(c,c*1.15),Yn.scale.set(u,u*1.15);const f=.55,p=160,x=1200,b=220,v=(R,L)=>new Promise(N=>ie(R,L,N));Hs.visible=!0,await v(p,R=>{Hs.alpha=f*R,Un.alpha=R,Yn.alpha=R;const L=.92+.08*R;Un.scale.set(c*L,c*1.15*L),Yn.scale.set(u*L,u*1.15*L),Yn.scale.set(.95*L,1.15*L)}),await Vc(x);const T=Hs.alpha,E=Un.alpha,k=Yn.alpha;await v(b,R=>{const L=1-R;Hs.alpha=T*L,Un.alpha=E*L,Yn.alpha=k*L;const N=.98+.02*L;Un.scale.set(.85*N,1.15*N),Yn.scale.set(.95*N,1.15*N)}),Hs.visible=!1,Un.visible=!1,Yn.visible=!1}function Gp(a,c=.72,u=8,f=300){var p,x,b,v,T,E,k;if(a){(p=o==null?void 0:o.initFromUserGesture)==null||p.call(o),(x=o==null?void 0:o.playSfx)==null||x.call(o,"confirm",.9),(b=o==null?void 0:o.setBaseMusicIntensity)==null||b.call(o,.15,250),(v=o==null?void 0:o.startFsIntroTractorLoop)==null||v.call(o,420,.85),r.overlay.fsIntro=!0,xt.alpha=0,xt.eventMode="none",xn.visible=!1,ye&&(ye.s.removeFromParent(),ye=null),Si=9999,dc(),Qt.hitArea=new $t(0,0,P.screen.width,P.screen.height),Qt.visible=!0,B.sortChildren(),Qt.eventMode="static",Qt.cursor="pointer",Ha(0,f),Ub(0,.92,f),Mc(1.06,f+200),du(!0,f),kx(f+5500),nr.text=String(r.fs.remaining);const F=Qt.alpha,R=Hn.strength;ie(f,L=>{Qt.alpha=F+(c-F)*L,Hn.strength=R+(u-R)*L})}else{(T=o==null?void 0:o.stopFsIntroTractorLoop)==null||T.call(o,350),(k=o==null?void 0:o.setBaseMusicIntensity)==null||k.call(o,((E=o==null?void 0:o.getBaseMusicIntensity01)==null?void 0:E.call(o))??1,350),Mc(1,f),du(!1,f);const F=Qt.alpha,R=Hn.strength;ie(f,L=>{Qt.alpha=F*(1-L),Hn.strength=R*(1-L)},()=>{Qt.alpha=0,Hn.strength=0,Qt.visible=!1,Ha(1,f),Qt.eventMode="none",r.overlay.fsIntro=!1,wc(),nr.visible=!1,Fr.visible=!1,nr.alpha=0,Fr.alpha=0})}}const Ls=new et,Nn=new et;Nn.sortableChildren=!0,B.sortableChildren=!0;const os=new et;os.zIndex=999,Nn.zIndex=2e3,qe.zIndex=0,Ls.zIndex=1e3,os.zIndex=2100;const Ab=7,vb=2200,fu=.35,fc=[];Je(a=>{a=Math.min(.033,a);for(let c=fc.length-1;c>=0;c--){const u=fc[c],f=u.g,p=u.sh;u.vy+=vb*a,f.x+=u.vx*a,f.y+=u.vy*a,f.rotation+=u.rotV*a,p.x=f.x,p.y=f.y+Ab*.85,u.life-=a;const x=1-u.life/u.life0;let b=1;if(x>=fu){const v=(x-fu)/(1-fu);b=1-v*v*(3-2*v)}f.alpha=b,p.alpha=.22*Math.max(0,1-x*3),u.life<=0&&(f.removeFromParent(),p.removeFromParent(),f.destroy(),p.destroy(),fc.splice(c,1))}});let pu=1;Je(()=>{const a=P.ticker.FPS??1e3/Math.max(1,P.ticker.deltaMS),c=a>=55?1:a>=48?.8:a>=42?.65:a>=36?.5:.35;pu+=(c-pu)*.08});const _r=new et;_r.zIndex=99999,_r.eventMode="none",B.addChild(_r),_r.zIndex=9600,B.sortChildren(),B.sortChildren();const Tb={L1:14248474,L2:4926627,L3:5221962,L4:14169140,H1:8376319,H2:9132587,H3:16740270,H4:7330938,H5:16761095,W1:16777215,S1:1981695},Cb=16762954;function mu(a,c){const u=Math.max(0,Math.min(255,(a>>16&255)*c)),f=Math.max(0,Math.min(255,(a>>8&255)*c)),p=Math.max(0,Math.min(255,(a&255)*c));return(u|0)<<16|(f|0)<<8|(p|0)}function Hp(a,c,u,f,p,x=.7){_r.parent||(B.addChild(_r),_r.zIndex=2062,B.sortChildren());const b=7,T=Math.max(10,Math.floor(28*pu*1.1)),E=900,k=420,F=720,R=1,L=.65;let N=0,D=0;if(f){const j=Math.hypot(f.x,f.y)||1;N=f.x/j,D=f.y/j}const U=[14248474,7028694,10214479,14169140,9132587];for(let j=0;j<T;j++){const V=new ht,Q=typeof p=="number";let q=u;u===16777215?q=U[Math.random()*U.length|0]:Q&&(q=Math.random()<x?u:p);const K=b*(.65+Math.random()*.55),Z=b,at=b*.55;let yt,Vt,qt;u===16777215?(yt=U[Math.random()*U.length|0],Vt=U[Math.random()*U.length|0],qt=U[Math.random()*U.length|0]):(yt=mu(q,1.15+Math.random()*.06),Vt=mu(q,.95+Math.random()*.06),qt=mu(q,.8+Math.random()*.06)),V.moveTo(0,-at).lineTo(Z,0).lineTo(0,at).lineTo(-Z,0).closePath().fill({color:yt,alpha:1}),V.moveTo(-Z,0).lineTo(0,at).lineTo(0,at+K).lineTo(-Z,K).closePath().fill({color:Vt,alpha:1}),V.moveTo(Z,0).lineTo(0,at).lineTo(0,at+K).lineTo(Z,K).closePath().fill({color:qt,alpha:1});const Jt=new ht;Jt.ellipse(0,0,b*.9,b*.45).fill({color:0,alpha:1}),Jt.alpha=.18,Jt.scale.y=.6;const Et=-22+Math.random()*24,bt=-22+Math.random()*24;V.x=a+Et,V.y=c+bt,Jt.x=V.x,Jt.y=V.y+b*.85;const X=Math.random()*Math.PI*2,ot=k+Math.random()*(F-k);let Mt=Math.cos(X)*ot,ct=Math.sin(X)*ot-(300+Math.random()*200);f&&(Mt=Mt*(1-L)+N*ot*L,ct=ct*(1-L)+D*ot*L);const nt=(-1+Math.random()*2)*7.5;V.alpha=R,_r.addChild(Jt),_r.addChild(V),performance.now(),fc.push({g:V,sh:Jt,vx:Mt,vy:ct,rotV:nt,life:E/1e3,life0:E/1e3})}}const _u=[];let Up=!1;function Eb(){const a=P.ticker.deltaMS/1e3;for(let c=_u.length-1;c>=0;c--){const u=_u[c],f=u.g;u.vy+=u.grav*a,f.x+=u.vx*a,f.y+=u.vy*a,f.rotation+=u.vr*a,u.life-=a;const p=Math.max(0,u.life/u.life0);f.alpha=p;const x=.9+.1*p;f.scale.set(x),u.life<=0&&(f.removeFromParent(),_u.splice(c,1))}}function Pb(){Up||(Up=!0,Je(()=>Eb()))}Pb();const xt=new et;xt.sortableChildren=!0,xt.zIndex=1500,B.addChild(xt),xt.addChild(Ls),xt.addChild(Nn),Ls.zIndex=1e3,Nn.zIndex=2e3,xt.sortChildren(),xt.sortChildren(),xt.alpha=0,xt.eventMode="none",xt.addChild(Yt);const Qr=new ft({text:`8-BIT
WIZARDRY`,style:{fontFamily:"Micro5",fill:16777215,fontSize:34,align:"center",letterSpacing:2}});Qr.anchor.set(.5),Qr.zIndex=1600,Qr.eventMode="none",xt.addChild(Qr);function Ib(){Qr.anchor.set(0,0),Qr.x=24,Qr.y=20,Qr.alpha=.85,Qr.scale.set(.95)}let pc=1,mc=!1;const Se=new ce(Xt.WHITE);Se.anchor.set(0,.5),Se.zIndex=1200,Se.eventMode="none",Se.anchor.set(0,.5),Se.zIndex=1200,xt.addChild(Se),xt.sortableChildren=!0,xt.zIndex=1500,Se.visible=!1;const Yp=.43;function Xp(){const a=P.screen.width/2,c=P.screen.height/2;if(xt.pivot.set(a,c),xt.position.set(a,c),Se&&!mc){const u=1/xt.scale.x,f=De()?Yp:1;pc=u*f,Se.scale.set(pc)}}window.addEventListener("resize",Xp);let Ji=0;function _c(){if(!Se)return;const a=De()?Yp:1,c=1/Math.max(1e-4,xt.scale.x);if(mc){Se.scale.set(pc);return}Se.scale.set(c*a)}function zp(a=520,c=1.04,u=1.03){var x;if(r.overlay.fsIntro||r.overlay.fsOutro)return;(x=o==null?void 0:o.setBaseMusicIntensity)==null||x.call(o,.85,250),Ji++;const f=Ji,p=xt.scale.x||1;ie(a,b=>{if(f!==Ji)return;const v=b*b*(3-2*b),T=p+(c-p)*v;xt.scale.set(T),_c()}),Mc(u,a+80)}function Vp(a=260,c=1,u=1){var x;if(r.overlay.fsIntro||r.overlay.fsOutro)return;(x=o==null?void 0:o.setBaseMusicIntensity)==null||x.call(o,.25,400),Ji++;const f=Ji,p=xt.scale.x||1;ie(a,b=>{if(f!==Ji)return;const v=b*b*(3-2*b),T=p+(c-p)*v;xt.scale.set(T)},()=>{f===Ji&&xt.scale.set(c),_c()}),Mc(u,a)}let No=0;function $p(a,c=520){var v,T;No++;const u=No,f=[];for(let E=0;E<y;E++){if(((v=a[E])==null?void 0:v.id)!=="S1")continue;const k=(T=Oe[E])==null?void 0:T.sprite;if(!k||!k.parent)continue;const F=k.parent,R=F.getChildIndex(k),L=k.zIndex??0,N=k.getGlobalPosition();F.removeChild(k),Yo.addChild(k),k.position.copyFrom(Yo.toLocal(N)),k.zIndex=10,Wu.push({s:k,fromParent:F,fromIndex:R,fromZ:L}),f.push({s:k,base:k.scale.x})}if(!f.length)return;const p=1.12,x=Math.max(90,Math.floor(c*.45));(async()=>{for(;u===No;)await me(x,E=>{if(u!==No)return;const k=E*E*(3-2*E);for(const F of f)F.s.scale.set(F.base*(1+(p-1)*k))}),await me(x,E=>{if(u!==No)return;const k=E*E*(3-2*E);for(const F of f)F.s.scale.set(F.base*(p-(p-1)*k))});for(const E of f)E.s.scale.set(E.base)})()}function jp(){No++;for(const a of Wu){const{s:c,fromParent:u,fromIndex:f,fromZ:p}=a;if(!c)continue;const x=c.getGlobalPosition();c.parent&&c.parent.removeChild(c);const b=Math.min(f,u.children.length);u.addChildAt(c,b),c.position.copyFrom(u.toLocal(x)),c.zIndex=p}Wu.length=0}const Pi=new ht;Pi.zIndex=2600,Pi.alpha=0,Pi.visible=!0,Pi.blendMode="add",B.addChild(Pi);function qp(){const a=Ye.getBounds(),c=Ce(),u=18,f=14,p=18;if(Pi.clear(),c){const b=P.screen.width,v=Math.round(f),T=Math.round(b-f*2),E=Math.round(a.y-u),k=Math.round(a.height+u*2);Pi.rect(v,E,T,k).fill(16777215);return}const x=p;Pi.rect(Math.round(a.x-x),Math.round(a.y-x),Math.round(a.width+x*2),Math.round(a.height+x*2)).fill(16777215)}Nn.sortableChildren=!0;const gc=new et;gc.sortableChildren=!0,gc.zIndex=2e4,gc.visible=!0,gc.eventMode="none";const xn=new et;xn.zIndex=1400,B.addChild(xn),B.sortChildren(),Je(()=>{(r.overlay.fsIntro||r.overlay.fsOutro)&&(xn.visible=!1)});const to=new et;xn.addChild(to);const Ze=[],Wo=108,Kp=Wo,Jr=88,gu=0,Ii=Jr+gu,yu=new et;to.addChild(yu);const Zp=new ht().rect(0,0,Wo,Ii*4-gu).fill(16777215);yu.mask=Zp,to.addChild(Zp);const ki={top:.75,mid:.85,active:1,max:.75};function kb(){const a=new et,c=new ht;c.rect(0,0,Wo,Jr).fill(16777215),c.alpha=.25;const u=new ht,f=2,p=f/2;u.rect(p,p,Wo-f,Jr-f).stroke({width:f,color:0,alpha:1}),u.visible=!0,u.alpha=0;const x=new ft({text:"1x",style:{fontFamily:"pixeldown",fill:16777215,fontSize:55,fontWeight:"1",letterSpacing:0,stroke:{color:0,width:6},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.75,dropShadowBlur:0,dropShadowDistance:7,dropShadowAngle:-Math.PI/5}});return x.anchor.set(.5),x.x=Wo/2,x.y=Jr/2+4,x.skew.set(0,.39),x.scale.x=.98,a.addChild(c,u,x),yu.addChild(a),{row:a,bg:c,outline:u,label:x}}for(let a=0;a<4;a++){const c=kb();c.row.pivot.set(Wo,Jr/2),c.row.x=Kp,c.row.y=a*Ii+Jr/2,Ze.push(c)}const Wa=new ft({text:"",style:{fill:16777215,fontSize:25,fontWeight:"900",stroke:{color:0,width:5},dropShadow:!1}});Wa.anchor.set(.5),Wa.x=Kp+4,Wa.y=2*Ii+Jr/2,Wa.alpha=.9,to.addChild(Wa);function xu(a){return(Math.abs(a-Math.round(a))<1e-6?String(Math.round(a)):a.toFixed(2))+"x"}let Qe=0,yc=!1,Li=null;function Lb(){return new Promise(a=>{const c=()=>{if(!yc&&Li==null)return a();requestAnimationFrame(c)};requestAnimationFrame(c)})}function eo(a){const c=tn.length-1,u=tn[Math.min(a,c)]??1,f=tn[Math.min(a+1,c)]??u,p=tn[Math.min(a+2,c)]??f,x=a>0?tn[a-1]??u:tn[c]??u,b=[p,f,u,x];a===c?(b[0]=null,b[1]=null):a===c-1&&(b[0]=null),tn[tn.length-1];for(let v=0;v<4;v++){const T=Ze[v],E=b[v],k=E==null||bu(v,a);if(T.row.visible=!k,k)continue;T.label.text=xu(E);const F=tn[tn.length-1];T.label.style.fill=E===F?16765802:16777215,xc(v,T)}}function Fb(a){return tn[a]}function bu(a,c){const u=tn.length-1;return c>=u?a===0||a===1:c===u-1?a===0:!1}function Da(a){for(let c=0;c<4;c++){const u=Ze[c],f=bu(c,a);u.row.visible=!f}}function Ob(a){const c=tn.length-1;return a<=0?tn[c]??1:tn[a-1]??1}function xc(a,c){c.outline.visible=!0,c.outline.alpha=a===2?1:0;const u=[.65,.8,1,.7],f=[2,1,0,1];c.row.alpha=u[a]??1;const p=f[a]??0,x=c._blurAmount??0;if(Math.abs(x-p)>.01){if(p>.01){const v=c._blurFilter??(c._blurFilter=new mo({strength:0}));v.strength=p,c.row.filters=p>.01?[v]:null,c.row.filters=[v]}else c.row.filters=null;c._blurAmount=p}const b=[.18,.28,.55,.22];c.bg.alpha=b[a]??.25,c.label.alpha=a===2?1:.75,a===2?c.row.scale.set(ki.active):a===1?c.row.scale.set(ki.mid):a===0?c.row.scale.set(ki.top):c.row.scale.set(ki.max)}function Do(){for(let a=0;a<4;a++){const c=Ze[a],u=bu(a,Qe);c.row.visible=!u,!u&&xc(a,c)}}function Qp(a,c,u=260,f=p=>es(p,2)){var qt,Jt,Et,bt;if(Qe>=tn.length-1&&a===1){c();return}const p=X=>X*Ii+Jr/2,x=a===1?+Ii:-Ii,b=Qe+a;if(a===1){const X=Ze[3];X.row.y=p(0)-Ii;const ot=tn.length-1,ct=Qe+1+2;ct>ot?(X.row.visible=!1,X.row.alpha=0,X.bg.alpha=0,X.label.alpha=0,X.outline.alpha=0,X.label.text="",X._forceHidden=!0):(X.row.visible=!0,X.row.alpha=1,X._forceHidden=!1,X.label.text=xu(Fb(ct)),xc(0,X))}else{const X=Ze[0];X.row.y=p(3)+Ii,X.label.text=xu(Ob(b)),xc(3,X)}const v=Ze.map(X=>X.row.y),T=Ze.map(X=>X.row.scale.x),E=Ze.map(X=>X.bg.alpha),k=Ze.map(X=>X.label.alpha),F=[.65,.8,1,.7],R=[0,0,1,0],L=[ki.top,ki.mid,ki.active,ki.max],N=[.18,.28,.55,.22],D=[.75,.75,1,.75],U=(X,ot)=>(X%ot+ot)%ot,j=(X,ot,Mt)=>X+(ot-X)*Mt,V=x>0?1:-1,Q=Ze.map(X=>X.row.alpha),q=Ze.map(X=>X.outline.alpha),K=Ze.map((X,ot)=>L[U(ot+V,4)]),Z=Ze.map((X,ot)=>N[U(ot+V,4)]),at=Ze.map((X,ot)=>D[U(ot+V,4)]),yt=Ze.map((X,ot)=>F[U(ot+V,4)]),Vt=Ze.map((X,ot)=>R[U(ot+V,4)]);if(to.alpha,to.alpha=1,a===1){const X=((qt=o==null?void 0:o.getSfxMuted)==null?void 0:qt.call(o))??!1,ot=((Jt=o==null?void 0:o.getSfxVolume01)==null?void 0:Jt.call(o))??1;if(console.log("[SFX] multiplier step",{muted:X,vol:ot}),!X&&ot>.001){const Mt=(Et=o==null?void 0:o.playSfxThrottled)==null?void 0:Et.bind(o);Mt?Mt("multiplier",60,.95,1):(bt=o==null?void 0:o.playSfx)==null||bt.call(o,"multiplier",.95,1)}}ie(u,X=>{const ot=X,Mt=Math.max(0,Math.min(1,X));for(let ct=0;ct<Ze.length;ct++){const nt=Ze[ct];if(nt.row.y=v[ct]+x*ot,nt._forceHidden){nt.row.visible=!1,nt.row.alpha=0,nt.bg.alpha=0,nt.label.alpha=0,nt.outline.alpha=0;continue}const Rt=j(T[ct],K[ct],Mt);nt.row.scale.set(Rt),nt.bg.alpha=j(E[ct],Z[ct],Mt),nt.label.alpha=j(k[ct],at[ct],Mt),nt.row.alpha=j(Q[ct],yt[ct],Mt),nt.outline.visible=!0,nt.outline.alpha=j(q[ct],Vt[ct],Mt)}},()=>{a===1?Ze.unshift(Ze.pop()):Ze.push(Ze.shift());for(let X=0;X<Ze.length;X++)Ze[X].row.y=p(X);to.alpha=1,c()},f)}function Jp(a){if(a===Qe)return;yc=!0;const c=a>Qe?1:-1,u=()=>new Promise(f=>{Qp(c,()=>{Qe+=c,eo(Qe),Do(),Da(Qe),f()})});(async()=>{for(;Qe!==a;)await u();if(yc=!1,Li!==null&&Li!==Qe){const f=Li;Li=null,Jp(f)}else Li=null})()}function t0(a){let c=tn.findIndex(u=>Math.abs(u-a)<1e-6);if(c<0&&(c=0),yc){Li=c;return}if(c===Qe){eo(Qe);return}Jp(c)}function Rb(a,c=260,u=f=>es(f,2)){return new Promise(f=>Qp(a,f,c,u))}async function e0(){Li=null;for(const c of Ze)c._forceHidden=!1,c.row.visible=!0;const a=120;for(;Qe>0;)await Rb(-1,a,As),Qe-=1,eo(Qe),Do(),Da(Qe),Ac(tn[Qe]??1)}eo(0),Do();let Bb=1200,Nb=140,bc=!1,wu=0,Su=0,Mu=0;const Wb=10,Db=4,Au=.18,Gb=.012;let no=0;const Hb=520;let Ga=0;function n0(a=Bb){mc=!0,_c(),Se.scale.set(pc);const c=++Ga;wc(),Ib();const u=Se.x,f=Se.y,p=-Se.height-Nb;bc=!0,no=0,Se.rotation=0,Se.visible=!0,Se.alpha=1,Se.x=u,Se.y=p,ie(a,x=>{if(c!==Ga)return;const b=Math.max(0,Math.min(1,x)),v=es(b,1.25);Se.y=p+(f-p)*v},()=>{c===Ga&&(bc=!1,Se.x=u,Se.y=f,wu=u,Su=f,Mu=0,no=0,ie(Hb,x=>{c===Ga&&(no=Math.max(0,Math.min(1,x)))},()=>{c===Ga&&(no=1)}))}),mc=!1,_c()}function wc(){if(Wt!=null&&Wt.visible||r.overlay.splash||r.overlay.startup){xn.visible=!1;return}if(r.overlay.fsIntro||r.overlay.fsOutro){xn.visible=!1;return}if(r.ui.settingsOpen||r.ui.buyMenuOpen){xn.visible=!1;return}const a=!Ce()&&!De(),c=a?Wl:Is,u=a?Dl:Nl;Se.x=Math.round(Ri+ri+c);const f=Math.round(Bi+ii*.5+u);if(wu=Se.x,Su=f,bc||(Se.y=f),Ce()){xn.visible=!0;const T=P.screen.width,E=z0(),k=0,F=70,R=-27;xn.scale.set(.6),xn.getBounds(),xn.x=Math.round(T-k-F),xn.y=Math.round(E+R),eo(Qe),Do(),Da(Qe);return}if(De()){xn.visible=!0;const T=Ye.getBounds(),E=0,k=.12;xn.scale.set(.7);const R=xn.getBounds();xn.x=Math.round(T.x-E-R.width),xn.y=Math.round(T.y+T.height*k),eo(Qe),Do(),Da(Qe);return}xn.visible=!0,xn.x=Math.round(Ri+ri-980),xn.y=Math.round(Bi+ii*.08-15);const p=g*4.1,x=Jr*4+gu*3,b=Math.max(.6,Math.min(1.3,p/x)),v=Math.round(b*1e3)/1e3;xn.scale.set(v),eo(Qe),Do(),Da(Qe)}const Qn=new et;Qn.zIndex=8e3,B.addChild(Qn),jn(),Qn.alpha=0,Qn.eventMode="none";const Jn=new et;Qn.addChild(Jn);function sn(a,c){const u=a.btnHeight?a.btnHeight():a.height;if(u<=0)return;const f=c/u;a.scale.set(f)}function Ha(a,c=250){const u=Qn.alpha;a===0&&(Qn.eventMode="none"),ie(c,f=>{Qn.alpha=u+(a-u)*f},()=>{Qn.alpha=a,Qn.eventMode=a>0?"auto":"none"})}function Ub(a,c,u=300){const f=xt.alpha,p=xt.scale.x;xt.eventMode="none",ie(u,x=>{xt.alpha=f+(a-f)*x;const b=p+(c-p)*x;xt.scale.set(b)},()=>{xt.alpha=a,xt.scale.set(c),xt.eventMode="none"})}let Ht=null,Ut=null;function s0(a){var c,u,f,p,x,b,v;Qn.eventMode=a?"auto":"none",Qn.cursor="default",Qn.alpha=1,(c=rt==null?void 0:rt.setEnabled)==null||c.call(rt,a&&(!r.ui.spinning||r.ui.auto)),(u=xe==null?void 0:xe.setEnabled)==null||u.call(xe,a),(f=dt==null?void 0:dt.setEnabled)==null||f.call(dt,a),(p=it==null?void 0:it.setEnabled)==null||p.call(it,a),(x=Fe==null?void 0:Fe.setEnabled)==null||x.call(Fe,a),(b=Ut==null?void 0:Ut.setEnabled)==null||b.call(Ut,a),(v=Ht==null?void 0:Ht.setEnabled)==null||v.call(Ht,a)}function r0(a){a?(s0(!1),xt.eventMode="none"):(s0(!0),xt.eventMode="auto")}function i0(a=300,c=300,u=.92){xt.alpha=0,xt.scale.set(u),xt.eventMode="none",setTimeout(()=>{const f=xt.alpha,p=xt.scale.x;ie(c,x=>{xt.alpha=f+(1-f)*x;const b=p+(1-p)*x;xt.scale.set(b)},()=>{xt.alpha=1,xt.scale.set(1),xt.eventMode="auto"})},a)}function vu(){const a=P.screen.width/2,c=P.screen.height/2;qe.pivot.set(a,c),qe.position.set(a,c)}vu(),window.addEventListener("resize",()=>{vu()});let Sc=0;function Mc(a,c=500){if(r.overlay.splash)return;vu();const u=qe,f=u.scale.x,p=++Sc;ie(c,x=>{if(p!==Sc)return;const b=Math.max(0,Math.min(1,x)),v=f+(a-f)*b;u.scale.set(v)},()=>{p===Sc&&u.scale.set(a)})}function Ms(a){const c=a.getLocalBounds();a.pivot.set(c.x+c.width/2,c.y+c.height/2)}function Go(a,c,u,f,p){a.x=Math.round(f*c),a.y=Math.round(p*u)}function o0(a,c,u){const f=a.getLocalBounds();a.hitArea=new $t(f.x-c,f.y-u,f.width+c*2,f.height+u*2)}const Yb=new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",minimumFractionDigits:2});function zn(a){return Yb.format(a)}const Tu={fontFamily:"Micro5",fill:16765802,fontSize:32,fontWeight:"200",letterSpacing:2},Cu={fontFamily:"Micro5",fill:16777215,fontSize:40,fontWeight:"200",letterSpacing:1,stroke:{color:0,width:4}},Fs=new ft({text:zn(r.bank.balance),style:Cu}),gr=new ft({text:"BALANCE",style:Tu});gr.anchor.set(.5),Jn.addChild(gr),Jn.addChild(Fs);const a0=new ft({text:"MULT",style:{fill:16765802,fontSize:17,fontWeight:"600",letterSpacing:2}});a0.anchor.set(.5);const Eu=new ft({text:"x1",style:{fill:16777215,fontSize:30,fontWeight:"700"}});Eu.anchor.set(.5),new et().addChild(a0,Eu);function Ac(a){const c=Math.abs(a-Math.round(a))<1e-6;Eu.text="x"+(c?String(Math.round(a)):a.toFixed(2))}const sr=new ft({text:"WIN",style:Tu});sr.anchor.set(.5),sr.anchor.set(.5);const Us=new ft({text:zn(0),style:Cu});Us.anchor.set(.5);const cn=new et;cn.addChild(sr,Us),Jn.addChild(cn);function l0(a){r.bank.lastWin=a,Us.text=zn(a)}const Xb=Cu,Ho=new ht;Ho.rect(0,0,120,44).fill(0),Ho.alpha=.35;const Fi=new ft({text:zn(r.bank.betLevels[r.bank.betIndex]),style:Xb});Fi.anchor.set(.5);const Os=new ft({text:"BET",style:Tu});Os.anchor.set(.5);const In=new et;In.addChild(Ho,Fi);const rn=new et;rn.eventMode="none",Jn.addChild(rn),rn.addChild(gr,Fs);const Rs=new et;Rs.eventMode="passive",Jn.addChild(Rs);const hn=new et,Ue=new et;hn.eventMode="none",Ue.eventMode="passive",Jn.addChild(hn),Jn.addChild(Ue);function c0(){const a=r.bank.betLevels[r.bank.betIndex],u=r.fs.remaining>0||r.bank.balance>=a;Mw(!u)}function so(){var u;const a=r.bank.betLevels[r.bank.betIndex],c=r.fs.remaining>0||r.bank.balance>=a;(u=rt==null?void 0:rt.setEnabled)==null||u.call(rt,c&&(!r.ui.spinning||r.ui.auto)&&!r.ui.settingsOpen&&!r.ui.buyMenuOpen),c0()}function h0(a){var c,u,f,p,x,b;(c=xe==null?void 0:xe.setEnabled)==null||c.call(xe,a),(u=dt==null?void 0:dt.setEnabled)==null||u.call(dt,a),(f=it==null?void 0:it.setEnabled)==null||f.call(it,a),(p=Fe==null?void 0:Fe.setEnabled)==null||p.call(Fe,a),(x=Ut==null?void 0:Ut.setEnabled)==null||x.call(Ut,a),(b=Ht==null?void 0:Ht.setEnabled)==null||b.call(Ht,a),so()}function Ua(){return r.game.mode==="FREE_SPINS"||r.fs.remaining>0||r.overlay.fsOutroPending}function Ya(){var b,v,T,E,k,F,R,L,N,D,U,j,V,Q,q,K,Z;const a=(Wt==null?void 0:Wt.visible)||r.overlay.splash||r.overlay.startup||r.overlay.fsIntro||r.overlay.fsOutro||r.overlay.bigWin,c=r.ui.settingsOpen||r.ui.buyMenuOpen||(((b=ne==null?void 0:ne.isOpen)==null?void 0:b.call(ne))??!1),u=Ua(),f=!a&&!Ua(),p=!a;if((v=xe==null?void 0:xe.setEnabled)==null||v.call(xe,f),(T=Fe==null?void 0:Fe.setEnabled)==null||T.call(Fe,p),a){(E=rt==null?void 0:rt.setEnabled)==null||E.call(rt,!1),(k=dt==null?void 0:dt.setEnabled)==null||k.call(dt,!1),(F=it==null?void 0:it.setEnabled)==null||F.call(it,!1),(R=Ht==null?void 0:Ht.setEnabled)==null||R.call(Ht,!1),(L=Ut==null?void 0:Ut.setEnabled)==null||L.call(Ut,!1);return}if(u){(N=rt==null?void 0:rt.setEnabled)==null||N.call(rt,!1),(D=dt==null?void 0:dt.setEnabled)==null||D.call(dt,!1),(U=it==null?void 0:it.setEnabled)==null||U.call(it,!1),(j=Ht==null?void 0:Ht.setEnabled)==null||j.call(Ht,!1),(V=Ut==null?void 0:Ut.setEnabled)==null||V.call(Ut,!1),ni("free spins lock"),Ys==null||Ys();return}so();const x=!c&&!r.ui.spinning;(Q=dt==null?void 0:dt.setEnabled)==null||Q.call(dt,x),(q=it==null?void 0:it.setEnabled)==null||q.call(it,x),(K=Ht==null?void 0:Ht.setEnabled)==null||K.call(Ht,!c&&!r.ui.spinning),(Z=Ut==null?void 0:Ut.setEnabled)==null||Z.call(Ut,!c&&!r.ui.spinning)}function u0(){var a,c;Qn.eventMode="auto",Qn.alpha=1,(a=rt==null?void 0:rt.resetVisual)==null||a.call(rt),(c=dt==null?void 0:dt.resetVisual)==null||c.call(dt),Ys(),Ya()}function vc(){Fi.text=zn(r.bank.betLevels[r.bank.betIndex]);const a=16,c=!Ce(),u=c?14:28,f=Math.max(90,Fi.width+u);let p=Math.max(40,Fi.height+a);p=Math.round(p*(c?.75:1.1)),Ho.clear(),Ho.rect(-f/2,-p/2,f,p).fill(0),Ho.alpha=.35,Fi.anchor.set(.5),Fi.x=0,Fi.y=-6}vc();function zb(a,c,u,f){var Vt,qt,Jt;const p=new et;let x=!1;const b=new ce(kn(a));b.anchor.set(.5);const v=36,T=((Vt=b.texture)==null?void 0:Vt.height)||((Jt=(qt=b.texture)==null?void 0:qt.orig)==null?void 0:Jt.height)||1,E=v/Math.max(1,T);b.scale.set(E),b.roundPixels=!0;const k=64,F=64,R=new ht;R.rect(-k/2,-F/2,k,F).fill({color:16777215,alpha:.001}),R.eventMode="static",R.cursor="pointer",p.addChild(R),p.addChild(b),p.setMuted=Et=>{x=Et,b.texture=kn(x?c:a)},b.anchor.set(.5);const L=new ht,N=new ht,D=new ht,U=new ht,j=new ht,V=new ht;p.addChild(b,N,L,D,U,j,V);let Q=Math.max(0,Math.min(1,u)),q=!1,K=!1;const Z=new Set;Z.add(b),Z.add(R),Z.add(N),Z.add(L),Z.add(V),p.isFromSlider=Et=>Z.has(Et),p.isDragging=()=>q,p.bindIconTap=Et=>{p._iconTapFn=Et;const bt=X=>{var ot;X.eventMode="static",X.cursor="pointer",(ot=X.removeAllListeners)==null||ot.call(X,"pointertap"),X.on("pointertap",Mt=>{var ct;(ct=Mt.stopPropagation)==null||ct.call(Mt),Et()})};bt(b),bt(R)};const at=60;function yt(Et){const bt=Math.round(Et*Q);N.clear(),N.moveTo(0,0).lineTo(Et,0).stroke({width:6,color:16777215,alpha:.25}),L.clear(),bt>0&&(L.moveTo(0,0).lineTo(bt,0).stroke({width:6,color:16777215,alpha:.95}),D.clear(),D.moveTo(0,0).lineTo(Et,0).stroke({width:32,color:16777215,alpha:.001})),U.visible=!1,j.visible=!1,U.clear(),U.circle(0,0,4).fill({color:16777215,alpha:.95}),j.clear(),j.circle(Et,0,4).fill({color:16777215,alpha:.95}),V.clear(),V.circle(0,0,14).fill({color:16777215,alpha:1}),V.x=at+bt,V.y=0}return p.layout=(Et,bt,X)=>{var Rt,Xe,ts,cs,ps,Or;p.x=Et,p.y=bt,b.x=0,b.y=0,N.roundPixels=!0,L.roundPixels=!0,U.roundPixels=!0,j.roundPixels=!0,V.roundPixels=!0,N.x=at,N.y=0,L.x=at,L.y=0,D.x=at,D.y=0,U.x=at,U.y=0,j.x=at,j.y=0,yt(X),V.eventMode="static",V.cursor="pointer",(Rt=V.removeAllListeners)==null||Rt.call(V),(Xe=N.removeAllListeners)==null||Xe.call(N),(ts=L.removeAllListeners)==null||ts.call(L),(cs=D.removeAllListeners)==null||cs.call(D),(ps=b.removeAllListeners)==null||ps.call(b,"pointertap"),(Or=R.removeAllListeners)==null||Or.call(R,"pointertap");const ot=p._iconTapFn;ot&&p.bindIconTap(ot),V.on("pointerdown",Gt=>{var Pt;q=!0,(Pt=Gt.stopPropagation)==null||Pt.call(Gt)}),V.on("pointertap",Gt=>{var Pt;return(Pt=Gt.stopPropagation)==null?void 0:Pt.call(Gt)});const Mt=Gt=>{Gt.eventMode="static",Gt.cursor="pointer",Gt.on("pointerdown",Pt=>{var un;return(un=Pt.stopPropagation)==null?void 0:un.call(Pt)}),Gt.on("pointertap",Pt=>{var un;return(un=Pt.stopPropagation)==null?void 0:un.call(Pt)}),Gt.on("pointertap",Pt=>{var or;(or=Pt.stopPropagation)==null||or.call(Pt);const un=Gt.toLocal(Pt.global);Q=Math.max(0,Math.min(1,un.x/X)),yt(X),f==null||f(Q)})};Mt(N),Mt(L);const ct=Gt=>{const Pt=N.toLocal({x:Gt,y:0});return Q=Math.max(0,Math.min(X,Pt.x))/X,yt(X),Q};if(V.on("pointerdown",Gt=>{var Pt;q=!0,(Pt=Gt.stopPropagation)==null||Pt.call(Gt)}),!K){K=!0,P.stage.on("pointermove",Pt=>{q&&(ct(Pt.global.x),f==null||f(Q))});const Gt=()=>{q=!1};P.stage.on("pointerup",Gt),P.stage.on("pointerupoutside",Gt)}const nt=Gt=>{var Pt;return(Pt=Gt.stopPropagation)==null||Pt.call(Gt),q=!0,ct(Gt.global.x),f==null||f(Q),Q};N.eventMode="static",N.cursor="pointer",N.on("pointerdown",nt),N.on("pointertap",Gt=>{var Pt;return(Pt=Gt.stopPropagation)==null?void 0:Pt.call(Gt)}),L.eventMode="static",L.cursor="pointer",L.on("pointerdown",nt),L.on("pointertap",Gt=>{var Pt;return(Pt=Gt.stopPropagation)==null?void 0:Pt.call(Gt)}),D.eventMode="static",D.cursor="pointer",D.on("pointerdown",nt),D.on("pointertap",Gt=>{var Pt;return(Pt=Gt.stopPropagation)==null?void 0:Pt.call(Gt)})},p.getValue=()=>Q,p.setValue=Et=>{Q=Math.max(0,Math.min(1,Et))},p}function Uo(a,c,u,f,p){const x=new et,b=new ce(kn(a)),v=new ce(kn(c)),T=new ce(kn(u));b.anchor.set(.5),v.anchor.set(.5),T.anchor.set(.5),v.visible=!1,T.visible=!1,x.addChild(b,v,T),x.eventMode="static",si()||Ou(x,"pointer"),x.on("pointerover",()=>{b.visible=!1,v.visible=!0,T.visible=!1}),x.on("pointerout",()=>{b.visible=!0,v.visible=!1,T.visible=!1}),x.on("pointerdown",()=>{b.visible=!1,v.visible=!1,T.visible=!0}),x.on("pointerup",()=>{b.visible=!1,v.visible=!0,T.visible=!1}),x.on("pointertap",()=>{var L,N;(L=o==null?void 0:o.initFromUserGesture)==null||L.call(o);const R=p&&"clickSfx"in p?p.clickSfx??null:"ui_click";R&&((N=o==null?void 0:o.playSfx)==null||N.call(o,R,(p==null?void 0:p.clickVol)??.9)),f()}),x.setEnabled=R=>{x.eventMode=R?"static":"none",x.alpha=R?1:.5,x.cursor=R?"pointer":"default",R||(b.visible=!0,v.visible=!1,T.visible=!1)},x.resetVisual=()=>{b.visible=!0,v.visible=!1,T.visible=!1};const E=s?40:4,k=s?34:4,F=x.getLocalBounds();return x.hitArea=new $t(F.x-E,F.y-k,F.width+E*2,F.height+k*2),x.btnWidth=()=>b.width,x.btnHeight=()=>b.height,x}function Tc(a,c,u,f,p,x,b,v){const T=new et,E=new ce(kn(a)),k=new ce(kn(c)),F=new ce(kn(u)),R=new ce(kn(f)),L=new ce(kn(p)),N=new ce(kn(x)),D=[E,k,F,R,L,N];D.forEach(q=>{q.anchor.set(.5),T.addChild(q)});const U=E.width,j=E.height;D.forEach(q=>{q.width=U,q.height=j});let V=b;function Q(q){D.forEach(yt=>yt.visible=!1);const K=V?R:E,Z=V?L:k,at=V?N:F;q==="up"&&(K.visible=!0),q==="hover"&&(Z.visible=!0),q==="down"&&(at.visible=!0)}return Q("up"),T.eventMode="static",si()||Ou(T,"pointer"),T.on("pointerover",()=>Q("hover")),T.on("pointerout",()=>Q("up")),T.on("pointerdown",()=>Q("down")),T.on("pointerup",()=>Q("hover")),T.on("pointertap",()=>{var q;V=!V,(q=o==null?void 0:o.playSfx)==null||q.call(o,"ui_toggle",.9),Q("hover"),v(V)}),T.setOn=q=>{V=q,Q("up")},T.getOn=()=>V,T.setEnabled=q=>{T.eventMode=q?"static":"none",T.alpha=q?1:.5,T.cursor=q?"pointer":"default"},T.btnWidth=()=>E.width,T.btnHeight=()=>E.height,T.setTapHandler=q=>{var K;(K=T.removeAllListeners)==null||K.call(T,"pointertap"),T.on("pointertap",Z=>{var at,yt;(at=Z==null?void 0:Z.stopPropagation)==null||at.call(Z),(yt=o==null?void 0:o.playSfx)==null||yt.call(o,"ui_toggle",.9),q(Z)})},T}function d0(a,c,u,f){const p=a.children,x=p[0],b=p[1],v=p[2];x.texture=kn(c),b.texture=kn(u),v.texture=kn(f),x.visible=!0,b.visible=!1,v.visible=!1,a.btnWidth=()=>x.width,a.btnHeight=()=>x.height}function Vb(a,c,u,f){const p=new et,x=new ht().roundRect(0,0,c,u,12).fill(1710618).stroke({width:10,color:6710886}),b=new ft({text:a,style:{fill:16777215,fontSize:18}});return b.anchor.set(.5),b.x=c/2,b.y=u/2,p.addChild(x,b),p.eventMode="static",si()||Ou(p,"pointer"),p.on("pointertap",f),p.on("pointerover",()=>{x.alpha=.9}),p.on("pointerout",()=>{x.alpha=1}),p.setEnabled=v=>{p.eventMode=v?"static":"none",p.alpha=v?1:.5,p.cursor=v?"pointer":"default"},p.setLabel=v=>{b.text=v},p}const $b="icon_info.png",Cc="btn_spin_up.png",Ec="btn_spin_hover.png",Pc="btn_spin_down.png",f0="btn_spin_spinning.png",jb="icon_sfx_on.png",qb="icon_sfx_off.png",Kb="icon_music_on.png",Zb="icon_music_off.png",Qb="btn_settings_off_up.png",Jb="btn_settings_off_up.png",tw="btn_settings_off_down.png",ew="btn_settings_on_up.png",nw="btn_settings_on_up.png",sw="btn_settings_on_down.png",rw="btn_auto_off_up.png",iw="btn_auto_hover.png",ow="btn_auto_down.png",aw="btn_auto_on_up.png",lw="btn_auto_on_up.png",cw="btn_auto_on_up.png",hw="btn_turbo_off_up.png",uw="btn_turbo_hover.png",dw="btn_turbo_down.png",fw="btn_turbo_on_up.png",pw="btn_turbo_on_up.png",mw="btn_turbo_on_up.png",p0="btn_bet_down_up.png",m0="btn_bet_down_hover.png",_0="btn_bet_down_down.png",g0="btn_bet_up_up.png",y0="btn_bet_up_hover.png",x0="btn_bet_up_down.png",b0="btn_settings_on_up.png",w0="btn_settings_on_up.png",S0="btn_settings_on_down.png",_w="btn_buy_up.png",gw="btn_buy_hover.png",yw="btn_buy_down.png",M0="/assets/atlases/bigwin_items.json",A0="/assets/atlases/ui.json",v0="/assets/atlases/ui_extra.json",T0="/assets/atlases/vehicles.json",C0="/assets/atlases/reelhouse.json",E0="/assets/atlases/symbols.json",P0="/assets/atlases/auto_menu_ui.json",Xa="/assets/particles/coins.json";let Oi=null;function I0(){if(Oi)return Oi;const a=ns.get(Xa),c=a==null?void 0:a.textures;if(!c)return console.warn("[COINS] Sheet not ready or missing textures:",Xa,a),Oi=[],Oi;const u=Object.keys(c).sort((f,p)=>{const x=parseInt(f,10),b=parseInt(p,10);return!Number.isNaN(x)&&!Number.isNaN(b)?x-b:f.localeCompare(p)});return Oi=u.map(f=>c[f]).filter(Boolean),Oi.length?console.log("[COINS] Frames:",Oi.length,"from",Xa):console.warn("[COINS] No frames found in sheet:",Xa,u),Oi}await ns.load([P0,Vr,Ps]),Gl=ns.get(Ps)||null,await ys(),await ns.load([ya,Bl,Vr,Ps,A0,M0,Xa,v0,T0,C0,E0,Ws],a=>On(.5+a*.5)),So=ns.get(A0),ks=ns.get(v0);const k0=ns.get(P0);for(const a of Object.values(k0.textures||{}))a.source.scaleMode="nearest";function Ic(a){var u;const c=(u=k0.textures)==null?void 0:u[a];if(!c)throw new Error(`[AUTO_MENU_UI] Missing frame: ${a}`);return c}$r=ns.get(E0),console.log("[SYMBOLS] frames:",Object.keys($r.textures||{}));for(const a of Object.values($r.textures))a.source.scaleMode="nearest";function L0(a){var u;const c=(u=$r.textures)==null?void 0:u[a];if(!c)throw new Error(`[SYMBOLS_ATLAS] Missing frame: ${a}`);return c}const ti=Object.fromEntries(Object.keys(ph).map(a=>[a,L0(ph[a])]));Lh(),_a(),Mo=ns.get(C0),console.log("[REELHOUSE] frames:",Object.keys(Mo.textures||{}));for(const a of Object.values(Mo.textures))a.source.scaleMode="nearest";function Pu(a){var u;const c=(u=Mo.textures)==null?void 0:u[a];if(!c)throw new Error(`[REELHOUSE_ATLAS] Missing frame: ${a}`);return c}Ao=ns.get(T0),console.log("[VEHICLES] frames:",Object.keys(Ao.textures||{}));for(const a of Object.values(Ao.textures))a.source.scaleMode="nearest";function kc(a){var u;const c=(u=Ao.textures)==null?void 0:u[a];if(!c)throw new Error(`[VEHICLES_ATLAS] Missing frame: ${a}`);return c}console.log("[UI_EXTRA] frames:",Object.keys(ks.textures||{}));for(const a of Object.values(ks.textures))a.source.scaleMode="nearest";function za(a){var u;if(!(ks!=null&&ks.textures))return Xt.WHITE;const c=(u=ks.textures)==null?void 0:u[a];if(!c)throw new Error(`[UI_EXTRA_ATLAS] Missing frame: ${a}`);return c}Se.texture=za("game_title.png");for(const a of Object.values(So.textures))a.source.scaleMode="nearest";function kn(a){var u;const c=(u=So.textures)==null?void 0:u[a];if(!c)throw new Error(`[UI_ATLAS] Missing frame: ${a}`);return c}xa=ns.get(M0);for(const a of Object.values(xa.textures))a.source.scaleMode="nearest";function F0(a){var u;const c=(u=xa.textures)==null?void 0:u[a];if(!c)throw new Error(`[BIGWIN_ITEMS] Missing frame: ${a}`);return c}I0();const Va=new ht;Va.zIndex=-999,Va.eventMode="none",Jn.addChildAt(Va,0);const ei=new ht;ei.visible=!1,ei.alpha=.65,ei.eventMode="static",ei.cursor="default",Jn.addChild(ei);const rt=Uo(Cc,Ec,Pc,()=>{var u,f,p;if(r.ui.auto){ni("spin button (stop auto)"),Ys();return}if(r.ui.autoArmed){const x=r.ui.autoPendingRounds??-1;r.ui.auto=!0,r.ui.autoRounds=x,r.ui.autoLeft=x===-1?0:x,r.ui.autoArmed=!1,r.ui.autoPendingRounds=-1,(u=it==null?void 0:it.setOn)==null||u.call(it,!0),(f=ne==null?void 0:ne.close)==null||f.call(ne),h0(!0),Ys(),Di();return}const a=r.bank.betLevels[r.bank.betIndex];if(!(r.fs.remaining>0)&&r.bank.balance<a){(p=ze==null?void 0:ze.showInsufficientToast)==null||p.call(ze),c0();return}Di()},{clickSfx:null}),O0=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||((Mm=(Sm=window.matchMedia)==null?void 0:Sm.call(window,"(pointer: coarse)"))==null?void 0:Mm.matches),R0=O0?40:6,B0=O0?34:6,Lc=rt.getLocalBounds();rt.hitArea=new $t(Lc.x-R0,Lc.y-B0,Lc.width+R0*2,Lc.height+B0*2),Jn.addChild(rt);const rr=new ft({text:"",style:{fontFamily:"pixeldown",fill:16777215,fontSize:60,align:"center",stroke:{color:0,width:8},dropShadow:!0,dropShadowAlpha:.85,dropShadowBlur:0,dropShadowDistance:6,dropShadowAngle:-Math.PI/4}});rr.anchor.set(.5),rr.roundPixels=!0,rr.eventMode="none",rr.visible=!1,rt.addChild(rr);function Iu(){let a=0,c=0;if(Lu==="STOP"){const u=Ic("btn_spinstop_auto.png"),f=bw(u);a=f.x,c=f.y+xw}rr.x=Math.round(a),rr.y=Math.round(c)}const xw=-8;function bw(a){const c=a.orig,u=a.trim,f=a.frame;if(!c||!u||!f)return{x:0,y:0};const p=u.x+f.width*.5,x=u.y+f.height*.5;return{x:p-c.width*.5,y:x-c.height*.5}}const N0=kn(Cc),ww=N0.width||1,Sw=N0.height||1;function ku(a,c,u){const f=rt.children,p=f[0],x=f[1],b=f[2];p.texture=a,x.texture=c,b.texture=u;for(const k of[p,x,b])k.width=ww,k.height=Sw;p.visible=!0,x.visible=!1,b.visible=!1,rt.btnWidth=()=>p.width,rt.btnHeight=()=>p.height;const v=rt.getLocalBounds(),T=s?40:6,E=s?34:6;rt.hitArea=new $t(v.x-T,v.y-E,v.width+T*2,v.height+E*2),Iu()}let Lu="NORMAL";function Fu(a){if(Lu!==a){if(Lu=a,a==="NORMAL"){ku(kn(Cc),kn(Ec),kn(Pc)),rr.visible=!1;return}if(a==="PLAY"){const c=Ic("btn_spinplay_auto.png");ku(c,c,c),rr.visible=!1;return}{const c=Ic("btn_spinstop_auto.png");ku(c,c,c),rr.visible=!0,Iu()}}}function Ys(){const a=!!r.ui.auto,c=!!r.ui.autoArmed;if(a){Fu("STOP");const u=r.ui.autoRounds??-1,f=r.ui.autoLeft??0;rr.text=u===-1?"":String(Math.max(0,f)),rr.visible=!0;return}if(c){Fu("PLAY");return}Fu("NORMAL")}window.addEventListener("resize",()=>{Iu(),Ys()}),Je(()=>{rt.visible&&Ys()});let W0=!1;function Mw(a){W0!==a&&(W0=a,a?d0(rt,f0,Ec,Pc):d0(rt,Cc,Ec,Pc))}const Vn=new ce(kn(f0));Vn.anchor.set(.5),Vn.visible=!1,Vn.eventMode="none",Jn.addChild(Vn),so();const xe=Tc(Qb,Jb,tw,ew,nw,sw,!1,a=>{var u,f;r.ui.settingsOpen=a;const c=-2;xe.x+=a?c:-c,ei.visible=r.ui.settingsOpen,r.ui.settingsOpen?(u=xr==null?void 0:xr.open)==null||u.call(xr):(f=xr==null?void 0:xr.close)==null||f.call(xr),rt.setEnabled(!r.ui.settingsOpen&&!r.ui.spinning),rt.visible=!r.ui.spinning,Vn.visible=r.ui.spinning,dt.setEnabled(!r.ui.settingsOpen),it.setEnabled(!r.ui.settingsOpen),Fe.setEnabled(!r.ui.settingsOpen),Ut.setEnabled(!r.ui.settingsOpen),Ht.setEnabled(!r.ui.settingsOpen),xe.setEnabled(!0),r.ui.settingsOpen&&(r.ui.auto=!1,it.setOn(!1))});Jn.addChild(xe),xr=oC({app:P,root:B,state:r,uiDimmer:ei,settingsBtnPixi:xe,onClosed:()=>{rt.setEnabled(!r.ui.spinning),dt.setEnabled(!0),it.setEnabled(!0),Fe.setEnabled(!0),Ut.setEnabled(!0),Ht.setEnabled(!0)},texUI:kn,setScaleToHeight:sn,makePngButton:Uo,ICON_INFO:$b,ICON_SFX_ON:jb,ICON_SFX_OFF:qb,ICON_MUSIC_ON:Kb,ICON_MUSIC_OFF:Zb,CLOSE_UP:b0,CLOSE_HOVER:w0,CLOSE_DOWN:S0,getSfxMuted:()=>{var a;return((a=o==null?void 0:o.getSfxMuted)==null?void 0:a.call(o))??!1},setSfxMuted:a=>{var c;return(c=o==null?void 0:o.setSfxMuted)==null?void 0:c.call(o,a)},getMusicMuted:()=>{var a;return((a=o==null?void 0:o.getMusicMuted)==null?void 0:a.call(o))??!1},setMusicMuted:a=>{var c;return(c=o==null?void 0:o.setMusicMuted)==null?void 0:c.call(o,a)},applyAudioUI:()=>{var a;(a=o==null?void 0:o.apply)==null||a.call(o)},makeSlider:zb,getSfxValue01:()=>{var a;return((a=o==null?void 0:o.getSfxVolume01)==null?void 0:a.call(o))??.8},getMusicValue01:()=>{var a;return((a=o==null?void 0:o.getMusicVolume01)==null?void 0:a.call(o))??.6},setSfxValue01:a=>{var c;return(c=o==null?void 0:o.setSfxVolume01)==null?void 0:c.call(o,a)},setMusicValue01:a=>{var c;return(c=o==null?void 0:o.setMusicVolume01)==null?void 0:c.call(o,a)}});const dt=Uo(_w,gw,yw,()=>{var a;r.ui.spinning||(ni("buy button"),console.log("[BUY BTN] clicked"),r.ui.settingsOpen&&ni("settings opened"),(a=ze==null?void 0:ze.openBuy)==null||a.call(ze))}),D0=s?36:6,G0=s?30:6,Fc=dt.getLocalBounds();dt.hitArea=new $t(Fc.x-D0,Fc.y-G0,Fc.width+D0*2,Fc.height+G0*2),Jn.addChild(dt);const it=Tc(rw,iw,ow,aw,lw,cw,r.ui.auto,a=>{var c;if(a){const u=r.bank.betLevels[r.bank.betIndex];if(!(r.fs.remaining>0)&&r.bank.balance<u){r.ui.auto=!1,it.setOn(!1),(c=ze==null?void 0:ze.showInsufficientToast)==null||c.call(ze);return}}r.ui.auto=a,r.ui.auto&&!r.ui.spinning&&!r.overlay.fsIntro&&!r.overlay.fsOutro&&Di()});Jn.addChild(it);function ni(a=""){var c,u,f;!r.ui.auto&&(r.ui.autoRounds??-1)===-1&&(r.ui.autoPendingRounds??-1)===-1||(console.log("[AUTO] stop",a),r.ui.auto=!1,r.ui.autoArmed=!1,r.ui.autoPendingRounds=-1,r.ui.autoRounds=-1,r.ui.autoLeft=0,(c=it==null?void 0:it.setOn)==null||c.call(it,!1),(u=ne==null?void 0:ne.isOpen)!=null&&u.call(ne)&&((f=ne==null?void 0:ne.close)==null||f.call(ne)),Ys())}ne=lC({app:P,root:B,texAutoMenu:Ic,audio:o,initialSelectedRounds:-1,onPick:a=>{r.ui.autoPendingRounds=a,r.ui.autoArmed=!0,Ys()},onClosed:()=>{r.ui.auto||(r.ui.autoArmed=!1,r.ui.autoPendingRounds=-1),h0(!0),Ys()}}),(Am=it.setTapHandler)==null||Am.call(it,()=>{var a;if(!r.ui.spinning&&!(r.ui.settingsOpen||r.ui.buyMenuOpen)){if(r.ui.auto){ni("auto button");return}(a=ne==null?void 0:ne.open)==null||a.call(ne)}});const Fe=Tc(hw,uw,dw,fw,pw,mw,r.ui.turbo,a=>{r.ui.turbo=a});Jn.addChild(Fe),Ut=Uo(p0,m0,_0,()=>{var a;Ua()||(ni("bet down"),r.bank.betIndex>0&&(r.bank.betIndex--,vc(),so(),r.ui.buyMenuOpen&&((a=ze==null?void 0:ze.layoutBuy)==null||a.call(ze))))}),Ht=Uo(g0,y0,x0,()=>{var a;Ua()||(ni("bet up"),r.bank.betIndex<r.bank.betLevels.length-1&&(r.bank.betIndex++,vc(),so(),r.ui.buyMenuOpen&&((a=ze==null?void 0:ze.layoutBuy)==null||a.call(ze))))}),Ue.addChild(Ht,Ut),ze=aC({app:P,root:B,uiLayer:Qn,state:r,audio:o,texUI:kn,texExtra:za,setScaleToHeight:sn,makePngButton:Uo,makePngToggleButton:Tc,fmtMoney:zn,updateBetUI:vc,refreshSpinAffordability:so,onBalanceUpdated:()=>{Fs.text=zn(r.bank.balance)},spinBtnPixi:rt,spinningBtnPixi:Vn,settingsBtnPixi:xe,buyBtnPixi:dt,autoBtnPixi:it,turboBtnPixi:Fe,betDownBtnPixi:Ut,betUpBtnPixi:Ht,enterFreeSpins:h,CLOSE_UP:b0,CLOSE_HOVER:w0,CLOSE_DOWN:S0,BET_DOWN_UP:p0,BET_DOWN_HOVER:m0,BET_DOWN_DOWN:_0,BET_UP_UP:g0,BET_UP_HOVER:y0,BET_UP_DOWN:x0,waitMs:Wn,animateMs:me,tween:ie,easeOutCubic:As,easeOutBack:es,easeInCubic:Qo});const H0=Vb(`BET: ${r.bank.betLevels[r.bank.betIndex]}`,160,56,()=>{r.bank.betIndex=(r.bank.betIndex+1)%r.bank.betLevels.length,H0.setLabel(`BET: ${r.bank.betLevels[r.bank.betIndex]}`)}),U0=.1;let Y0=0;function X0(){const a=getComputedStyle(document.documentElement).getPropertyValue("env(safe-area-inset-bottom)"),c=parseFloat(a);return Number.isFinite(c)?c:0}function z0(){const a=getComputedStyle(document.documentElement).getPropertyValue("env(safe-area-inset-top)"),c=parseFloat(a);return Number.isFinite(c)?c:0}function Ce(){if(Bs())return!0;const a=P.screen.width,c=P.screen.height,u=a/c;return(a<820||u<.9)&&c>=a}const Aw=.5,vw=.48;function Oc(){return Ce()}function Bs(){const a=P.screen.width,c=P.screen.height,u=a/c;return!!s||a<820||u<.9}function De(){return Bs()?!1:Bs()&&P.screen.width>P.screen.height}function V0(){return Bs()?.72:1}function si(){return Bs()}function Ou(a,c){si()||(a.cursor=c)}function Tw(){if(!Ht||!Ut||!In||!Os)return;Ce()?(Os.parent!==Rs&&Rs.addChild(Os),In.parent!==Rs&&Rs.addChild(In),Ht.parent!==Rs&&Rs.addChild(Ht),Ut.parent!==Rs&&Rs.addChild(Ut),Rs.visible=!0,hn.visible=!1,Ue.visible=!1):(Os.parent!==hn&&hn.addChild(Os),In.parent!==hn&&hn.addChild(In),Ht.parent!==Ue&&Ue.addChild(Ht),Ut.parent!==Ue&&Ue.addChild(Ut),Rs.visible=!1,hn.visible=!0,Ue.visible=!0)}function Cw(){const a=P.screen.width,c=Math.round(P.screen.height*U0);Y0=c,Jn.x=0;const u=X0();Jn.y=Math.round(P.screen.height-c-u),Va.clear(),Va.rect(0,0,a,c).fill({color:0,alpha:.38}).stroke({width:2,color:13092807,alpha:.35}),ei.clear(),ei.rect(0,0,a,c).fill(0),Tw(),Ce()?Pw(a,c):De()?Iw(a,c):Ew(a,c),Vn.x=rt.x,Vn.y=rt.y,Vn.scale.set(rt.scale.x,rt.scale.y),Vn.pivot.set(rt.pivot.x,rt.pivot.y)}function $a(a,c){const u=a.getLocalBounds();a.y=Math.round(c-u.y)}function Ew(a,c){const f=De()?.85:1,p=Math.round(c*0);rn.visible=!0;const x=310,b=cn.getBounds();rn.x=Math.round(b.x+b.width+x),$a(rn,p),$a(rn,p),rn.scale.set(1,1),Fs.anchor.set(.5),gr.anchor.set(.5),Fs.position.set(0,0),gr.position.set(0,-35),Fs.roundPixels=!0,gr.roundPixels=!0,rn.scale.set(1,1);const v=Math.max(1,rn.getLocalBounds().height),E=c*.73/v;rn.scale.set(E),cn.visible=!0,cn.scale.set(1,1);const k=Math.max(1,cn.getLocalBounds().height),R=c*.73/k;cn.scale.set(R);const L=a*.5;cn.x=Math.round(L),$a(cn,p);const N=Math.round(c*.35);sr.position.set(0,-N),Us.position.set(0,3),Go(rt,.86,.1,a,c),sn(rt,c*1.7*f),Go(it,.78,.5,a,c),sn(it,c*.78*f),Go(Fe,.935,.5,a,c),sn(Fe,c*.9*f),Go(dt,.14,.23,a,c),sn(dt,c*1.4*f),Go(xe,.07,.54,a,c),sn(xe,c*.4*f);const D=De()?.24:.3;sn(Ht,c*D),sn(Ut,c*D),In.scale.set(.85),Os.position.set(0,Math.round(-In.getLocalBounds().height*.85)),dt.x+dt.width/2;const j=In.getBounds().width,V=320;hn.x=Math.round(b.x-V-hn.getBounds().width/2),hn.pivot.set(0,0),Ue.pivot.set(0,0),In.position.set(0,0),Os.anchor.set(.5),Os.position.set(0,Math.round(-In.getLocalBounds().height*.85));const Q=Math.round(c*.18);Ht.position.set(0,-Q),Ut.position.set(0,+Q);const q=50,K=hn.x-j*.5,Z=Ue.getLocalBounds(),at=Z.x+Z.width;Ue.x=Math.round(K-q-at),Ue.x+=30,$a(hn,p),$a(Ue,p);const yt=10;Ue.y+=yt}function Pw(a,c){var Mt,ct;cn.visible=!1,sr.visible=!1,Us.visible=!1;const u=a,f=c,p=f*1.6,x=f*1.2,b=f*.72;Go(cn,.5,.4,u,f),sn(cn,f*.55);const v=Math.round(f*.3);sr.x=0,sr.y=-v,Us.x=0,Us.y=4;const T=-.7,E=-f*.12;rt.x=Math.round(u*.5),rt.y=Math.round(f*T+E),sn(rt,p);const k=.34,F=T;dt.x=Math.round(u*.5-u*k),dt.y=Math.round(f*F),sn(dt,x);const R=.32,L=.33,N=Math.round(u*.5),D=Math.round(f*T);it.x=Math.round(N+u*R),it.y=Math.round(D-f*L),sn(it,b),Fe.x=Math.round(N+u*R),Fe.y=Math.round(D+f*L),sn(Fe,b),cn.visible=!1,sr.visible=!1,Us.visible=!1,sn(xe,b*.75),Ms(xe);const U=Math.round(u*.04),j=Math.round(f*.1);{const nt=xe.getLocalBounds();xe.hitArea=new $t(nt.x-U,nt.y-j,nt.width+U*2,nt.height+j*2)}sn(In,f*.36),Ms(In);const V=-In.height*.75,Q=-In.width*.95,q=In.height*.3,K=-In.height*.24;In.position.set(0,0),Os.anchor.set(.5),Os.position.set(0,Math.round(V)),sn(Ht,f*.32),sn(Ut,f*.32);const Z=Math.round(u*.03),at=Math.round(f*.12);function yt(nt){const Rt=nt.getLocalBounds();nt.hitArea=new $t(Rt.x-Z,Rt.y-at,Rt.width+Z*2,Rt.height+at*2)}yt(Ht),yt(Ut),Ht.position.set(Math.round(Q),Math.round(-q+K)),Ut.position.set(Math.round(Q),Math.round(+q+K)),Ms(Rs),Fs.anchor.set(.5),gr.anchor.set(.5);const Vt=-f*.09;Fs.position.set(0,0),gr.position.set(0,-33),Ms(rn);const qt=Math.round(f*.55),Jt=Math.round(u*.06),Et=[xe,Rs,rn],X=Et.map(nt=>nt.getLocalBounds().width).reduce((nt,Rt)=>nt+Rt,0)+Jt*(Et.length-1);let ot=Math.round(u*.5-X/2);for(let nt=0;nt<Et.length;nt++){const Rt=Et[nt],Xe=Rt.getLocalBounds().width;Rt.x=Math.round(ot+Xe/2),Rt.y=qt,ot+=Xe+Jt}rn.y=Math.round(rn.y+Vt),(Mt=rt.resetVisual)==null||Mt.call(rt),(ct=dt.resetVisual)==null||ct.call(dt)}function Iw(a,c){const u=a,f=c;Ms(dt),Ms(rt),Ms(xe),Ms(it),Ms(Fe),Ms(hn),Ms(Ue),Ms(cn),Ms(rn);const p=f*2.4,x=f*2.4,b=f*1.5,v=f*.6;if(sn(dt,p),sn(rt,x),sn(xe,b*.6),sn(it,b),sn(Fe,b),sn(Ht,v),sn(Ut,v),De()){const Br=s?14:4,Za=s?14:4;o0(Ht,Br,Za),o0(Ut,Br,Za)}cn.visible=!0,sr.visible=!0,Us.visible=!0,rn.visible=!0,hn.visible=!0,Ue.visible=!0;const T=Math.round(f*.72),E=Math.round(f*-.2),R=f*.58*1.9,L=Math.round(f*-.3),N=18;xe.x=Math.round(N+xe.getLocalBounds().width*.5),xe.y=T+L;const D=Math.round(xe.x+xe.width*.75+dt.width*.5+12);dt.x=D,dt.y=T;const U=Math.round(dt.x+dt.width*.62+Ue.getLocalBounds().width*.5+16);Ue.x=U,Ue.y=T+E;const j=Math.round(f*.36),V=-10;Ue.y=T+E+V,Ht.x=0,Ut.x=0,Ht.y=-j,Ut.y=+j,In.x=0,In.y=0,Os.anchor.set(.5);const Q=Math.round(R*.18);Os.position.set(0,Math.round(-(In.getLocalBounds().height*.5+Q))),Math.round(Ue.x+Ue.getLocalBounds().width*.55+hn.getLocalBounds().width*.5+16),hn.y=T+E,hn.scale.set(1,1);const q=Math.max(1,hn.getLocalBounds().height);hn.scale.set(R/q);const K=Math.round(f*.01);Os.y-=Math.round(K/Math.max(1e-4,hn.scale.y)),sr.anchor.set(.5),Us.anchor.set(.5);const Z=sr.getLocalBounds(),at=Us.getLocalBounds(),yt=Z.height+at.height;sr.position.set(0,Math.round(-yt*.5+Z.height*.5)),Us.position.set(0,Math.round(+yt*.5-at.height*.5)),Ms(cn),cn.scale.set(1,1);const Vt=Math.max(1,cn.getLocalBounds().height);cn.scale.set(R/Vt);const qt=Math.round(f*-.1);Us.y+=Math.round(qt/Math.max(1e-4,cn.scale.y)),cn.x=Math.round(u*.5),cn.y=T+E,gr.anchor.set(.5),Fs.anchor.set(.5);const Jt=gr.getLocalBounds(),Et=Fs.getLocalBounds(),bt=Jt.height+Et.height;gr.position.set(0,Math.round(-bt*.5+Jt.height*.5)),Fs.position.set(0,Math.round(+bt*.5-Et.height*.5)),Ms(rn),rn.scale.set(1,1);const X=Math.max(1,rn.getLocalBounds().height);rn.scale.set(R/X);const ot=Math.round(f*-.1);Fs.y+=Math.round(ot/Math.max(1e-4,rn.scale.y));const Mt=Math.round(u*.5);cn.x=Mt;const ct=Math.round(f*2.8),nt=Br=>Br.getLocalBounds().width*(Br.scale.x||1),Rt=nt(hn),Xe=nt(cn),ts=nt(rn);hn.x=Math.round(Mt-Xe*.5-ct-Rt*.5),rn.x=Math.round(Mt+Xe*.5+ct+ts*.5),rn.y=T+E;const cs=Math.round(f*.25);Ue.scale.set(1,1);const ps=Ue.getLocalBounds().width*(Ue.scale.x||1);Ue.x=Math.round(hn.x-Rt*.5-cs-ps*.5);const Or=-5,Gt=-50,Pt=Math.round(f*.6),un=rt.getLocalBounds().width;rt.getLocalBounds().height;const or=it.getLocalBounds().width,ar=Fe.getLocalBounds().width,Xs=Math.round(f*-1);rt.x=Math.round(u-Or-un*.5),rt.y=T+Xs,dt.y=rt.y,Vn.x=rt.x,Vn.y=rt.y,Vn.scale.set(rt.scale.x,rt.scale.y);const zs=Math.round(rt.x-un*.5-Gt-Math.max(or,ar)*.5),Rr=T+Xs;it.x=zs,it.y=Rr-Pt,Fe.x=zs,Fe.y=Rr+Pt}const Rc={left:110,top:310,right:110,bottom:310};let Ri=0,Bi=0,ri=0,ii=0;const Ye=new ce(Pu("reel_house.png"));Ye.anchor.set(.5),Ls.addChild(Ye);const Me=new et;Me.zIndex=4e3,Me.visible=!1,Me.alpha=0,Me.eventMode="none",B.addChild(Me),B.sortChildren();const Ru=new ht;Me.addChild(Ru);const oi=new ft({text:"TUMBLE WIN",style:{fontFamily:"pixeldown",fill:16777215,fontSize:64,letterSpacing:1,stroke:{color:0,width:8},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.75,dropShadowBlur:0,dropShadowDistance:8,dropShadowAngle:-Math.PI/4}});oi.anchor.set(1,.5),Me.addChild(oi);const ai=new ft({text:"",style:{fontFamily:"pixeldown",fill:16765802,fontSize:64,letterSpacing:1,stroke:{color:0,width:8},dropShadow:!0,dropShadowColor:0,dropShadowAlpha:.75,dropShadowBlur:0,dropShadowDistance:8,dropShadowAngle:-Math.PI/4}});ai.anchor.set(0,.5),Me.addChild(ai);const kw=28,Lw=5,Fw=.8,Ow=.35,Rw=25,Bw=.47,Nw=20;let li=0;function ja(){let a=Fw;return Ce()&&(a=Bw),De()&&(a*=vw),a}function Bc(){const a=Ye.getBounds();Me.x=Math.round(a.x+a.width*.5),Me.x=Math.round(a.x+a.width*.5);const c=Ce(),u=Math.round(a.y+Rw);Me.y=c?Math.round(u-Nw):u,Me.scale.set(ja());const f=6;oi.anchor.set(1,.5),ai.anchor.set(0,.5);const p=85;oi.x=-f/2+p,ai.x=+f/2+p;const x=oi.getLocalBounds(),b=ai.getLocalBounds();oi.y=-(x.y+x.height*.5),ai.y=-(b.y+b.height*.5);const v=oi.width+f+ai.width,T=Math.max(oi.height,ai.height),E=Math.round(v+kw*2),k=Math.round(T+Lw*2);Ru.clear(),Ru.rect(-E/2,-k/2,E,k).fill({color:0,alpha:Ow}).stroke({width:2,color:11579568,alpha:.35})}window.addEventListener("resize",Bc);function Ww(a){oi.text="TUMBLE WIN",ai.text=zn(a),Bc()}let Nc=!1;async function Dw(a){li++;const c=li;if(Ww(a),Bc(),Nc&&Me.visible){const f=ja();Me.visible=!0,Me.alpha=1,Me.scale.set(f*1.05);return}Nc=!0;const u=ja();Me.visible=!0,Me.alpha=0,Me.scale.set(u*.92),await me(160,f=>{if(c!==li)return;const p=es(f,1.12);Me.alpha=f;const x=u*.92+(u*1.05-u*.92)*p;Me.scale.set(x)}),c===li&&(Me.alpha=1,Me.scale.set(u*1.05))}async function Gw(a=180){if(!Nc||!Me.visible)return;li++;const c=li,u=Me.alpha,f=Me.scale.x;await me(a,p=>{if(c!==li)return;const x=Qo(p);Me.alpha=u*(1-x);const b=ja()*.92,v=f+(b-f)*x;Me.scale.set(v)}),c===li&&(Me.visible=!1,Me.alpha=0,Me.scale.set(ja()),Nc=!1)}function $0(){li++,Me.visible=!1,Me.alpha=0}function Bu(a){Ye.texture=Pu(a==="FREE_SPINS"?"reel_house_free.png":"reel_house.png")}const Wc=0,Dc=0,j0=0,q0=0,$n=new ht;$n.clear(),$n.rect(Ri+Wc,Bi+Dc,ri-Wc-j0,ii-Dc-q0).fill(16777215),B.addChild($n),$n.zIndex=2055,B.sortChildren(),qp(),Nn.mask=$n,os.mask=$n;const bn=new ht;bn.zIndex=2050,bn.visible=!1,bn.alpha=0,bn.eventMode="none";const ir=new ht;ir.zIndex=2065,ir.visible=!0,ir.alpha=0,ir.eventMode="none",ir.filters=[new mo({strength:6})],B.addChild(ir);function Hw(){ir.clear();const a=Ye.getBounds();if(!Number.isFinite(a.x)||!Number.isFinite(a.y)||a.width<=0||a.height<=0)return;const c=Ce(),u=c?-17:-27,f=c?-90:-132,p=0,x=4,b=c?34:24,v=c?28:20,T=a.width+u,E=a.height+f,k=a.x+(a.width-T)/2+p,F=a.y+(a.height-E)/2+x;T<=0||E<=0||ir.roundRect(k,F,T,E,b).stroke({width:v,color:16777215,alpha:1})}function Uw(){return Hw(),ir.alpha=0,new Promise(a=>{ie(140,c=>{ir.alpha=Math.min(1,c)*.9},()=>{ie(220,c=>{ir.alpha=.9*(1-Math.min(1,c))},()=>{ir.alpha=0,a()})})})}B.addChild(bn),os.zIndex=2060,os.sortableChildren=!0,B.addChild(os),B.sortChildren();const Yo=new et;Yo.zIndex=2070,Yo.eventMode="none",Yo.mask=null,B.addChild(Yo),B.sortChildren();const ci=new et;ci.zIndex=2060,ci.sortableChildren=!0,ci.mask=$n,B.addChild(ci);const Nu=[];function Yw(a){var c;K0();for(const u of a){const f=Oe[u],p=f==null?void 0:f.sprite;if(!p||!p.parent||p.parent===ci)continue;const x=p.parent,b=x.getChildIndex(p),v=p.zIndex??0,T=p.getGlobalPosition();x.removeChild(p),ci.addChild(p),p.position.copyFrom(ci.toLocal(T)),p.zIndex=500;const E=(c=f==null?void 0:f.eyes)==null?void 0:c.root;let k=null,F=null,R=-1,L=0;if(E&&E.parent){k=E,F=E.parent,R=F.getChildIndex(E),L=E.zIndex??0;const N=E.getGlobalPosition();F.removeChild(E),ci.addChild(E),E.position.copyFrom(ci.toLocal(N)),E.zIndex=p.zIndex+1}Nu.push({s:p,fromParent:x,fromIndex:b,fromZ:v,eyesRoot:k,eyesFromParent:F,eyesFromIndex:R,eyesFromZ:L})}}function K0(){for(const a of Nu){const{s:c,fromParent:u,fromIndex:f,fromZ:p,eyesRoot:x,eyesFromParent:b,eyesFromIndex:v,eyesFromZ:T}=a;if(c){const E=c.getGlobalPosition();c.parent&&c.parent.removeChild(c);const k=Math.min(f,u.children.length);u.addChildAt(c,k),c.position.copyFrom(u.toLocal(E)),c.zIndex=p}if(x&&b){const E=x.getGlobalPosition();x.parent&&x.parent.removeChild(x);const k=Math.min(v,b.children.length);b.addChildAt(x,k),x.position.copyFrom(b.toLocal(E)),x.zIndex=T}}Nu.length=0}const Wu=[],Xw=.65,Z0=160,zw=90,Q0=Ce(),J0=Q0?-22:Bs()?-14:-37,tm=Q0?-78:Bs()?-60:-102,as=new ft({text:"BOOSTED",style:{fontFamily:"pixeldown",fill:16765802,fontSize:88,letterSpacing:2,align:"center",stroke:{color:0,width:12},dropShadow:!0,dropShadowAlpha:.85,dropShadowBlur:0,dropShadowDistance:10,dropShadowAngle:-Math.PI/4}});as.anchor.set(.5),as.zIndex=22e3,as.visible=!1,as.alpha=0,B.addChild(as),B.sortChildren();let Xo=0;async function em(a=160,c=420,u=220){var v;Xo++;const f=Xo,p=P.screen.width,x=P.screen.height;if(as.x=Math.round(p*.5),as.y=Math.round(x*.45),(v=o==null?void 0:o.playSfxThrottled)==null||v.call(o,"boosted",120,1,1),as.visible=!0,as.alpha=0,as.scale.set(.85),await me(a,T=>{if(f!==Xo)return;const E=es(T,1.1);as.alpha=T;const k=.85+(1.12-.85)*E;as.scale.set(k)}),f!==Xo)return;await Wn(c);const b=as.y;await me(u,T=>{if(f!==Xo)return;const E=As(T);as.alpha=1-E,as.y=b-26*E}),f===Xo&&(as.visible=!1,as.alpha=0)}const ls=new ft({text:"INFUSED",style:{fontFamily:"pixeldown",fill:16765802,fontSize:88,letterSpacing:2,align:"center",stroke:{color:0,width:12},dropShadow:!0,dropShadowAlpha:.85,dropShadowBlur:0,dropShadowDistance:10,dropShadowAngle:-Math.PI/4}});ls.anchor.set(.5),ls.zIndex=22e3,ls.visible=!1,ls.alpha=0,B.addChild(ls),B.sortChildren();let zo=0;async function Du(a=160,c=420,u=220){var v;zo++;const f=zo,p=P.screen.width,x=P.screen.height;if(ls.x=Math.round(p*.5),ls.y=Math.round(x*.45),(v=o==null?void 0:o.playSfxThrottled)==null||v.call(o,"infused",120,.85,1),ls.visible=!0,ls.alpha=0,ls.scale.set(.85),await me(a,T=>{if(f!==zo)return;const E=es(T,1.1);ls.alpha=T;const k=.85+(1.12-.85)*E;ls.scale.set(k)}),f!==zo)return;await Wn(c);const b=ls.y;await me(u,T=>{if(f!==zo)return;const E=As(T);ls.alpha=1-E,ls.y=b-26*E}),f===zo&&(ls.visible=!1,ls.alpha=0)}const Gc=new et;Gc.zIndex=2080,Gc.eventMode="none",B.addChild(Gc),B.sortChildren();function nm(){if(Bs()){bn.clear(),bn.visible=!1,bn.alpha=0;return}bn.clear();const a=Ye.getBounds();bn.rect(a.x-J0,a.y-tm,a.width+J0*2,a.height+tm*2).fill(0)}function Vw(a,c=5){const u=[];for(let p=0;p<y;p++)p!==a&&u.push(p);for(let p=u.length-1;p>0;p--){const x=Math.random()*(p+1)|0,b=u[p];u[p]=u[x],u[x]=b}const f=u.slice(0,Math.max(2,Math.min(c,u.length)));return f.push(a),f}async function $w(a,c,u){var R;const{cx:f,cy:p}=zc(c),x=a.x,b=a.y,v=f,T=p,E=u.ms,k=u.arc,F=u.baseS;(R=o==null?void 0:o.playSfxThrottled)==null||R.call(o,"bounce",70,1,.98+Math.random()*.06),await me(E,L=>{const N=As(L);a.x=x+(v-x)*N,a.y=b+(T-b)*N;const D=Math.sin(Math.PI*N);a.y-=D*k;const U=F*(1+.16*D),j=F*(1-.12*D);a.scale.set(U,j)}),a.x=Math.round(v),a.y=Math.round(T),a.scale.set(F,F)}async function jw(a){jo(a.grid);const c=a.aftershockWildIndex??-1;if(c<0)return;await Ni(!0);const u=new ce(ti.W1);u.anchor.set(.5),u.eventMode="none",u.roundPixels=!0,O(u,"W1");const f=u.scale.x*1.18;u.scale.set(f);const p=cS();u.x=Math.round(p.cx),u.y=Math.round(p.cy),Gc.addChild(u);const x=Vw(c,4+(Math.random()*3|0));await Wn(120);for(let b=0;b<x.length;b++){const v=b===x.length-1;await $w(u,x[b],{ms:v?300:200,arc:v?86:42,baseS:f}),v||await Wn(40)}jo(a.nextGrid),u.removeFromParent(),u.destroy(),await Wn(120),await Ni(!1)}async function Ni(a){if(Bs()){bn.clear(),bn.visible=!1,bn.alpha=0;return}if(a){nm(),bn.visible=!0;const c=bn.alpha;await me(Ge(Z0),u=>{const f=As(u);bn.alpha=c+(Xw-c)*f})}else{if(!bn.visible)return;const c=bn.alpha;await me(Ge(Z0),u=>{const f=As(u);bn.alpha=c*(1-f)}),bn.alpha=0,bn.visible=!1}}const qw=6,Vo=[],Kw=()=>za("win_frame.png");function Zw(){if(!Vo.length)for(let a=0;a<y;a++){const c=new ce(Kw());c.anchor.set(.5),c.visible=!1;const u=g-qw*2,f=u/c.texture.width,p=u/c.texture.height,x=Math.min(f,p);c.scale.set(x),c.zIndex=9999,os.addChild(c),Vo.push({s:c})}}function sm(){for(const a of Vo)a.s.visible=!1,a.s.alpha=1}async function Qw(a=80){const c=Vo.filter(f=>f.s.visible&&f.s.alpha>0);if(!c.length){sm();return}const u=c.map(f=>f.s.alpha);await me(a,f=>{const p=As(f);for(let x=0;x<c.length;x++)c[x].s.alpha=u[x]*(1-p)});for(const f of c)f.s.alpha=0,f.s.visible=!1}const Wi=new et;Wi.zIndex=2e4,Wi.sortableChildren=!0,Wi.eventMode="none",Wi.eventMode="none",Wi.mask=null,B.addChild(Wi),B.sortChildren();let Gu=[];function rm(){for(const a of Gu)a.destroy({children:!0});Gu=[]}function Jw(a,c){var T;let u=1/0,f=1/0,p=-1/0,x=-1/0;for(const E of a.positions){const k=(T=Oe[E])==null?void 0:T.sprite;if(!k)continue;const F=k.getBounds();u=Math.min(u,F.x),f=Math.min(f,F.y),p=Math.max(p,F.x+F.width),x=Math.max(x,F.y+F.height)}if(!isFinite(u))return null;const b=c.toLocal({x:u,y:f}),v=c.toLocal({x:p,y:x});return{x:b.x,y:b.y,w:v.x-b.x,h:v.y-b.y}}function tS(a,c){const u=new et,f=new ft({text:"0.00",style:{fontFamily:"pixeldown",fill:16777215,fontSize:55,fontWeight:"1",stroke:{color:0,width:6},dropShadow:!0,dropShadowAlpha:.35,dropShadowBlur:6,dropShadowDistance:2}}),p=new ft({text:"x",style:{fontFamily:"pixeldown",fill:16777215,fontSize:44,fontWeight:"1",stroke:{color:0,width:5}}}),x=new ft({text:String(c),style:{fontFamily:"pixeldown",fill:16777215,fontSize:55,fontWeight:"1",stroke:{color:0,width:6},dropShadow:!0,dropShadowAlpha:.35,dropShadowBlur:6,dropShadowDistance:2}});f.anchor.set(1,.5),p.anchor.set(.5),x.anchor.set(0,.5);const b=Math.abs(c-1)>1e-6;p.visible=b,x.visible=b;const v=6,T=6;b?(f.anchor.set(1,.5),p.anchor.set(.5,.5),x.anchor.set(0,.5),p.x=0,f.x=-p.width/2-v,x.x=p.width/2+T):(f.anchor.set(.5,.5),f.x=0),f.y=0,p.y=2,x.y=0,f.y=0,p.y=2,x.y=0,f.skew.set(0,.39),p.skew.set(0,.39),x.skew.set(0,.39),f.scale.x=.98,x.scale.x=.98,u.addChild(f,p,x),Math.abs(c-Math.round(c))<1e-6?String(Math.round(c)):c.toFixed(2);const k=performance.now(),R=Math.min(1100,500+a*18);function L(N){const D=Math.min(1,(N-k)/R),U=D*D*(3-2*D),j=a*U;f.text=j.toFixed(2),D<1&&requestAnimationFrame(L)}return requestAnimationFrame(L),u}async function eS(a,c,u,f=520){if(rm(),!a||a.length===0)return;const p=a.map((x,b)=>{const v=Jw(x,Wi);if(!v)return Promise.resolve();const T=x.payoutX*u,E=tS(T,c),k=v.x+v.w*.5,F=v.y+120;E.position.set(k,F);const R=1.5,L=V0();E.scale.set(R*L),E.alpha=0,Wi.addChild(E),Gu.push(E);const N=b*60;return new Promise(D=>{setTimeout(()=>{ie(140,U=>{const j=Math.max(0,Math.min(1,U));E.alpha=j;const V=V0(),Q=(1.1+(1.5-1.1)*j)*V;E.scale.set(Q)},async()=>{await Wn(f);const U=E.y;ie(220,j=>{const V=Math.max(0,Math.min(1,j));E.alpha=1-V,E.y=U-18*V},()=>{E.destroy({children:!0}),D()})},U=>es(U,1.18))},N)})});await Promise.all(p)}const nS=50,im=1.14,sS=90,om=nS,rS=80,Hu=Array(y).fill(null);function am(a){const c=new Set;for(const f of a)for(const p of f.positions)c.add(p);const u=Array.from(c);return u.sort((f,p)=>{const x=f%d,b=Math.floor(f/d),v=p%d,T=Math.floor(p/d);return x!==v?x-v:b-T}),u}function lm(a,c){const u=Oe[a];if(!u)return;if(!c){const p=Hu[a];p&&(p.visible=!1,p.alpha=0);return}let f=Hu[a];f||(f=new ce(u.sprite.texture),f.anchor.set(.5),f.zIndex=50,f.filters=[new mo({strength:15})],f.alpha=0,f.visible=!1,Nn.addChild(f),Hu[a]=f),f.texture=u.sprite.texture,f.x=u.sprite.x,f.y=u.sprite.y,f.scale.set(u.sprite.scale.x*1.18,u.sprite.scale.y*1.18),f.visible=!0,f.alpha=.55}async function iS(a){const c=Oe[a];if(!c)return;const u=c.sprite;lm(a,!0);const f=u.scale.x,p=u.scale.y;await MS(u,Ge(sS),f,p,f*im,p*im)}async function oS(a){const u=am(a).map((f,p)=>Vc(om*p).then(()=>iS(f)));await Promise.all(u)}const aS=new Set(["W1","S1"]);async function lS(a,c){if(Zw(),sm(),!a||a.length===0)return;const f=am(a).filter(v=>!aS.has(c[v].id)),{x:p,y:x}=hm(),b=f.map((v,T)=>Vc(om*T).then(()=>{const{x:E,y:k}=W(v),F=p+E*(g+m),R=x+k*(g+m),L=Vo[v];L.s.x=F+g/2,L.s.y=R+g/2,L.s.visible=!0,L.s.alpha=0,me(Ge(rS),N=>{L.s.alpha=Math.min(1,N)})}));await Promise.all(b)}function cS(){return{ox:Ri,oy:Bi,totalW:ri,totalH:ii,cx:Ri+ri/2,cy:Bi+ii/2}}const hS=P.screen.height-Y0;Ye.y=Math.min(Ye.y,hS/2);const be=new ce(Xt.from(ya));be.anchor.set(.5),be.alpha=.9;const we=new ce(Xt.from(Bl));we.anchor.set(.5),we.alpha=.9,qe.addChild(be),qe.addChild(we);let ro=0,io=0,Hc=0,$o=0;const uS=10,dS=18,fS=.12;P.stage.eventMode="static",P.stage.hitArea=P.screen,P.stage.on("pointermove",a=>{if(Bs())return;Hc=(a.global.y/P.screen.height-.5)*2,Hc=Math.max(-1,Math.min(1,Hc))}),Je(()=>{if(!r.overlay.startup&&!r.overlay.splash){if(Bs()){$o=0,be.y=ro,we.y=io;return}$o+=(Hc-$o)*fS,be.y=ro+$o*uS,we.y=io+$o*dS}}),Je(a=>{if(!Se.visible||bc)return;Mu+=a;const c=Mu,u=Math.sin(c*Math.PI*2*Au)*Wb,f=Math.cos(c*Math.PI*2*(Au*.9))*Db;Se.x=wu+f*no,Se.y=Su+u*no,Se.rotation=Math.sin(c*Math.PI*2*(Au*.7))*Gb*no});function pS(){return Ce()?1.08:1}function Uu(){var N,D,U;const a=P.screen.width,c=P.screen.height,u=/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||((D=(N=window.matchMedia)==null?void 0:N.call(window,"(pointer: coarse)"))==null?void 0:D.matches);if(u)St.visible=!1;else{const j=P.screen.width>P.screen.height;if(u&&j){St.visible=!0,ae();return}St.visible=!1}Uc(),dc(),Wp(),Xp(),sc(),Np();const f=a/2,p=c/2,x=Ce(),b=Math.round(c*.055);Ye.x=f,Ye.y=x?Math.round(p-b):p;const v=Bs();if(!v){g=ut();const j=d*g+(d-1)*l,V=_*g+(_-1)*l,Q=60,q=60,K=j+Q,Z=V+q,at=Ye.texture.width||1,yt=Ye.texture.height||1,Vt=Math.max(K/at,Z/yt);Ye.scale.set(Vt)}if(v){const V=Math.max(1,a-28),Q=Ye.texture.width||1,q=V/Q,K=Ce()?1.08:1,Z=De()?Aw:1;Ye.scale.set(q*K*Z)}const T=Ye.scale.x,E=Ye.scale.y,k=Ye.x-Ye.width/2+Rc.left*T,F=Ye.y-Ye.height/2+Rc.top*E,R=Ye.x+Ye.width/2-Rc.right*T,L=Ye.y+Ye.height/2-Rc.bottom*E;if(Ri=Math.round(k),Bi=Math.round(F),ri=Math.round(R-k),ii=Math.round(L-F),v&&(pS(),v)){const j=(ri-(d-1)*m)/d,V=(ii-(_-1)*m)/_;g=Math.floor(Math.min(j,V))}$n.clear(),$n.rect(Ri+Wc,Bi+Dc,ri-Wc-j0,ii-Dc-q0).fill(16777215),nm(),Bc(),wc(),Cw(),(U=ne==null?void 0:ne.layout)==null||U.call(ne),qp()}Uu(),B.sortChildren(),requestAnimationFrame(()=>{(async()=>{try{On(1);const a=0;await new Promise(c=>setTimeout(c,a)),Yu(),Yc(1,0),await Hr()}catch(a){console.error("[BOOT] failed after loading:",a),Ve.text="BOOT ERROR"}})()});function Uc(){if(r.overlay.splash)return;const a=P.screen.width/2,c=P.screen.height/2,u=[be,we];for(const f of u){f.x=a,f.y=c,ro=be.y,io=we.y;const p=f.texture.width,x=f.texture.height,b=Math.max(P.screen.width/p,P.screen.height/x);f.scale.set(b)}}function mS(){Sc++,$o=0,Yc(1,0),be.visible=!0,we.visible=!1,be.alpha=.9,we.alpha=0,Ka="BASE",ro=be.y,io=we.y}function Yc(a,c=0){const u=P.screen.height;function f(p){const x=p.height*.5,b=u-p.height*.5;return Math.round(x+(b-x)*a+c)}be.y=f(be),we.y=f(we),ro=be.y,io=we.y}Uc();function Yu(){be.y=Math.round(be.height*.5),we.y=Math.round(we.height*.5),ro=be.y,io=we.y}wa(),Ki=!1,tr=0;const cm=2e3,Xu=10;function _S(){r.overlay.startup=!0,Ki=!1,wa(),tr=0,xt.alpha=0,xt.scale.set(1),xt.eventMode="none",Ha(0,0),Uc();const a=P.screen.height,c=Math.round(a-be.height*.5),u=Math.round(a-we.height*.5),f=0;be.y=c+f,we.y=u+f,setTimeout(()=>{ie(cm,x=>{const b=x*x*(3-2*x);be.y=c+(ro-c)*b,we.y=u+(io-u)*b},()=>{var x;r.overlay.startup=!1,i0(Xu,420,.92),Ha(1,320),(x=o==null?void 0:o.playMusic)==null||x.call(o,"music_base",600),Oc()||(jr=999,Dh(!0)),setTimeout(()=>{Ki=!0},150),setTimeout(()=>{},Xu+0)})},40)}window.addEventListener("resize",Uc);function Xc(a){const c=Oe[a];if(!c)return;const u=c.sprite,f=c.eyes;if(!f)return;f.root.position.set(u.x,u.y),f.root.rotation=u.rotation,f.root.alpha=u.alpha,f.root.visible=f.active;let p=u.scale.x,x=u.scale.y;const b=u.__sid??f.lastId??null,v=Vu[b];v?(p*=v.scaleX??1,x*=v.scaleY??1):f.root.skew.set(0,0),f.root.scale.set(p,x)}function hm(){const a=d*g+(d-1)*m,c=_*g+(_-1)*m,u=Math.round(Ri+(ri-a)/2),f=Math.round(Bi+(ii-c)/2);return{x:u,y:f}}function zc(a){const{x:c,y:u}=W(a),{x:f,y:p}=hm();return{cx:f+c*(g+m)+g/2,cy:p+u*(g+m)+g/2}}function zu(a,c){return c+(a==="S1"?A:0)}const um={H1:{min:.1,max:.6},H2:{min:.3,max:1.1},H3:{min:.3,max:1.1},H4:{min:.3,max:1.1},H5:{min:.3,max:1.1}},gS={min:.9,max:2.8};function dm(a,c){const u=c&&um[c]?um[c]:gS;a.nextBlink=u.min+Math.random()*(u.max-u.min)}let Oe=[];Je(a=>{a=Math.min(.05,a);for(let c=0;c<Oe.length;c++){const u=Oe[c].eyes;if(!(!u||!u.active||!u.root.visible)&&u.eyeG.length){if(u.nextBlink-=a,!u.blinking&&u.nextBlink<=0){u.blinking=!0,u.blinkT=0;const f=Oe[c].sprite.__sid??u.lastId??null;dm(u,f)}if(u.blinking){u.blinkT+=a;const p=Math.min(1,u.blinkT/.12),x=p<.5?1-p/.5:(p-.5)/.5,b=Math.max(0,Math.min(1,x));for(const v of u.eyeG)v.scale.y=b;if(p>=1){u.blinking=!1;for(const v of u.eyeG)v.scale.y=1}}}}});const Vu={H1:{eyes:[{xN:.2,yN:.1}],wN:.1,hN:.13,skewX:0,skewY:-.35,scaleX:.48,scaleY:.5},H2:{eyes:[{xN:.03,yN:.39},{xN:.2,yN:.39}],wN:.1,hN:.14,skewY:.37,scaleX:.5,scaleY:.4},H3:{eyes:[{xN:.01,yN:.7},{xN:.18,yN:.7}],wN:.1,hN:.14,skewY:.42,scaleX:.5,scaleY:.4},H4:{eyes:[{xN:0,yN:.24},{xN:.2,yN:.25}],wN:.1,hN:.14,skewY:.47,scaleX:.35,scaleY:.35},H5:{eyes:[{xN:0,yN:.38},{xN:.2,yN:.38}],wN:.1,hN:.14,skewY:.47,scaleX:.35,scaleY:.35}};function yS(){if(!Oe.length)for(let a=0;a<y;a++){const c=new ce(ti.L1);c.zIndex=100,c.anchor.set(.5),Nn.addChild(c);const u=new et;u.eventMode="none",u.visible=!1,u.zIndex=101,Nn.addChild(u);const f={root:u,eyeG:[],nextBlink:.6+Math.random()*2.2,blinkT:0,blinking:!1,active:!1,lastId:null};Oe.push({sprite:c,eyes:f})}}Je(()=>{if(Oe.length)for(let a=0;a<Oe.length;a++){const c=Oe[a],u=c.eyes;if(!u)continue;const f=c.sprite,p=f.__sid??u.lastId,x=p?Vu[p]:void 0;u.active=!!x,u.root.visible=!!x&&f.visible,u.root.position.set(f.x,f.y),u.root.rotation=f.rotation,u.root.alpha=f.alpha;let b=f.scale.x,v=f.scale.y;x?(b*=x.scaleX??1,v*=x.scaleY??1,u.root.skew.set(x.skewX??0,x.skewY??0)):u.root.skew.set(0,0),u.root.scale.set(b,v)}});function xS(a,c,u,f){a.clear(),a.rect(-c/2,-u/2,c,u).fill({color:f,alpha:1}),a.roundPixels=!0}function bS(a){for(let c=0;c<y;c++)qa(c,a[c].id)}function qa(a,c){const u=Oe[a];if(!u)return;const f=Vu[c],p=u.eyes;if(!f){p.root.visible=!1,p.active=!1;return}if(p.lastId!==c||!p.eyeG.length||p.root.children.length===0){p.root.removeChildren(),p.eyeG.length=0;const b=f.color??0,v=u.sprite.texture.width||1,T=u.sprite.texture.height||1,E=Math.max(1,Math.round(v*f.wN)),k=Math.max(1,Math.round(T*f.hN));for(const F of f.eyes){const R=new ht;xS(R,E,k,b),R.x=Math.round((F.xN-.5)*v),R.y=Math.round((F.yN-.5)*T),p.root.addChild(R),p.eyeG.push(R)}p.blinking=!1,p.blinkT=0,dm(p,c),p.lastId=c}p.root.visible=!0,p.active=!0;for(const b of p.eyeG)b.scale.y=1;p.root.visible=!0,p.active=!0;for(const b of p.eyeG)b.scale.y=1}function $u(a){yS();for(let c=0;c<y;c++){const u=Oe[c].sprite,f=a[c].id;u.__sid=f,u.texture=ti[f],O(u,f);const{cx:p,cy:x}=zc(c);u.x=p,u.y=zu(f,x),u.alpha=1;const b=Oe[c].eyes;b.root.position.set(u.x,u.y),b.root.rotation=u.rotation,qa(c,f),Xc(c)}}function wS(a,c){const u=Oe[a];if(!u)return;u.sprite.texture,ti.S1}const SS=a=>new Promise(c=>setTimeout(c,a)),fm=()=>r.ui.turbo?.5:1,Vc=a=>SS(Math.round(a*fm())),Ge=a=>Math.round(a*fm());function MS(a,c,u,f,p,x){return me(c,b=>{const v=As(b),T=u+(p-u)*v,E=f+(x-f)*v;a.scale.set(T,E)})}async function pm(a,c,u=450,f=.9){a.visible=!0,c.visible=!0,a.alpha=f,c.alpha=0,await me(u,p=>{const x=As(p);a.alpha=f*(1-x),c.alpha=f*x}),a.visible=!1,a.alpha=0,c.visible=!0,c.alpha=f}let ju=0;function mm(a=250){ju++;const c=ju;setTimeout(()=>{c===ju&&r.game.mode==="FREE_SPINS"&&(r.fs.remaining<=0||r.overlay.splash||r.overlay.startup||r.overlay.fsIntro||r.overlay.fsOutro||r.overlay.fsOutroPending||r.overlay.bigWin||r.ui.settingsOpen||r.ui.buyMenuOpen||r.ui.spinning||Di())},a)}async function Di(){var b,v,T,E,k,F,R,L,N,D;if(r.overlay.splash||r.overlay.startup||r.overlay.fsIntro||r.overlay.fsOutro||typeof r.ui.settingsOpen<"u"&&r.ui.settingsOpen||typeof r.ui.buyMenuOpen<"u"&&r.ui.buyMenuOpen||r.overlay.fsIntro||r.overlay.fsOutro||r.ui.settingsOpen||r.ui.spinning)return;r.ui.spinning=!0,Ya(),(b=o==null?void 0:o.playSfx)==null||b.call(o,"spin_start",1),Ya(),r.ui.auto?(Vn.visible=!1,rt.visible=!0,rt.eventMode="static",rt.cursor="pointer",rt.alpha=1):(rt.visible=!1,Vn.visible=!0,rt.setEnabled(!1)),Ut.setEnabled(!1),Ht.setEnabled(!1),(v=dt==null?void 0:dt.setEnabled)==null||v.call(dt,!1),(T=it==null?void 0:it.setEnabled)==null||T.call(it,!1);const a=r.bank.betLevels[r.bank.betIndex],c=r.game.mode==="FREE_SPINS"||r.fs.remaining>0?"FREE_SPINS":"BASE",u=c==="BASE"?a:0;if(u>0&&r.bank.balance<u){ze.showInsufficientToast(),r.ui.spinning=!1,Vn.visible=!1,rt.visible=!0,rt.setEnabled(!r.ui.settingsOpen&&!r.ui.buyMenuOpen),Ys(),rt.setEnabled(!0),Ut.setEnabled(!0),Ht.setEnabled(!0);const U=!r.ui.settingsOpen&&!r.ui.buyMenuOpen&&!(((E=ne==null?void 0:ne.isOpen)==null?void 0:E.call(ne))??!1);(k=dt==null?void 0:dt.setEnabled)==null||k.call(dt,U),(F=it==null?void 0:it.setEnabled)==null||F.call(it,U);return}if(u>0&&r.bank.balance<u){r.ui.auto=!1,(R=it==null?void 0:it.setOn)==null||R.call(it,!1),r.ui.spinning=!1,Vn.visible=!1,rt.visible=!0,rt.setEnabled(!0),Ut.setEnabled(!0),Ht.setEnabled(!0);return}u>0&&(r.bank.balance=Math.max(0,r.bank.balance-u),Fs.text=zn(r.bank.balance),so());let f=null;c==="BASE"&&Qe>0&&(f=(async()=>{await Lb(),await e0()})()),await vS(),f&&await f,r.fs.remaining;let p=!1,x=null;try{await oo(c,!0);const U=iC({COLS:d,ROWS:_,fsTotalCap:r.fs.totalCap});x=nC(U,c,r.fs.remaining,r.fs.ladderIndex,void 0),r.fs.ladderIndex=x.ladderIndexAfter,r.fs.remaining=x.fsRemainingAfter,se(),c==="FREE_SPINS"&&x.fsAwarded>0&&(r.fs.total=Math.min(r.fs.totalCap,r.fs.total+x.fsAwarded)),await kS(x),(L=o==null?void 0:o.setBaseMusicIntensity)==null||L.call(o,.15,300);const j=x.totalWinX*a;c==="FREE_SPINS"&&(r.fs.sessionTotalWin+=j),j>0?l0(r.bank.lastWin+j):l0(0);const V=x.totalWinX;V>=rp&&await Bp(j,V),r.bank.balance+=j,Fs.text=zn(r.bank.balance),c==="BASE"&&x.fsAwarded>0&&(h(x.fsAwarded),p=!0)}finally{if(r.ui.spinning=!1,Vn.visible=!1,rt.visible=!0,Vn.visible=!1,rt.visible=!0,Ya(),(N=dt==null?void 0:dt.resetVisual)==null||N.call(dt),H0.setEnabled(!0),p)return;if(r.game.mode==="FREE_SPINS"&&r.fs.remaining===0){r.overlay.fsOutroPending=!0,b1(350),Bu("FREE_SPINS"),Ta=!0,oo("FREE_SPINS",!1),be.visible=!1,be.alpha=0,we.visible=!0,we.alpha=.9,Ka="FREE_SPINS",he&&(he.s.removeFromParent(),he=null),ye&&(ye.s.removeFromParent(),ye=null),To();const U=r.fs.sessionTotalWin;r.fs.sessionTotalWin=0,(async()=>(await Ni(!0),await Wn(cb),r.overlay.fsOutroPending=!1,r.game.mode="BASE",jh(!0,U,520),Rh()))();return}if(r.fs.remaining>0)mm(250);else if(r.ui.auto){if(r.ui.settingsOpen||r.ui.buyMenuOpen||(D=ne==null?void 0:ne.isOpen)!=null&&D.call(ne)){ni("ui opened during auto");return}if((r.ui.autoRounds??-1)!==-1&&(r.ui.autoLeft=Math.max(0,(r.ui.autoLeft??0)-1),Ys(),r.ui.autoLeft<=0)){ni("auto rounds finished");return}setTimeout(()=>{Di()},250)}}}const $c=new ft({text:"MODE: BASE",style:{fill:16777215,fontSize:16}}),qu=new ft({text:"MULT: x1",style:{fill:16777215,fontSize:16}}),jc=new ft({text:"WIN: 0",style:{fill:16777215,fontSize:16}}),Ku=new ft({text:"FS: 0",style:{fill:16777215,fontSize:16}});[$c,qu,jc,Ku].forEach(a=>{a.visible=st,a.alpha=0}),$c.visible=!1,qu.visible=!1,jc.visible=!1,Ku.visible=!1;function Zu(a){let c=0;for(let u=0;u<a.length;u++)a[u].id==="S1"&&c++;return c}async function AS(a,c,u,f){var Vt,qt,Jt,Et;for(const bt of c)lm(bt,!1);let p=0,x=0,b=0;for(const bt of c){const X=(Vt=Oe[bt])==null?void 0:Vt.sprite;if(!X)continue;const ot=X.getGlobalPosition();p+=ot.x,x+=ot.y,b++}b>0&&(p/=b,x/=b);{const Mt=Math.min(1.45,1+f*.07);(qt=o==null?void 0:o.playSfxThrottled)==null||qt.call(o,"explode",80,1.2,Mt)}await Promise.all(c.map(bt=>{var Pt;const X=Oe[bt];if(!X)return Promise.resolve();const ot=(Pt=a[bt])==null?void 0:Pt.id,Mt=Tb[ot]??16777215;let ct,nt=.7;ot==="L1"&&(ct=6274906,nt=.9),ot==="L2"&&(ct=6274906,nt=.9),ot==="L3"&&(ct=Cb,nt=.5),ot==="L4"&&(ct=6274906,nt=.8);const Rt=X.sprite.getGlobalPosition(),Xe=B.toLocal(Rt),ts=_r.toLocal(Xe),cs={x:Rt.x-p,y:Rt.y-x};if(Hp(ts.x,ts.y,Mt,cs,ct,nt),!X)return Promise.resolve();const ps=X.sprite.alpha,Or=X.sprite.scale.x,Gt=X.sprite.scale.y;return me(Ge(160),un=>{const or=As(un);X.sprite.alpha=ps*(1-or),X.sprite.scale.set(Or*(1-.7*or),Gt*(1-.7*or))})}));const v=new Set(c),T=Oe.map(bt=>({x:bt.sprite.x,y:bt.sprite.y})),E=g+m;for(let bt=0;bt<d;bt++){const X=[];for(let Mt=_-1;Mt>=0;Mt--){const ct=G(bt,Mt);v.has(ct)||X.push(ct)}const ot=_-X.length;for(let Mt=0;Mt<_;Mt++){const ct=_-1-Mt,nt=G(bt,ct),Rt=Oe[nt].sprite,Xe=u[nt].id;if(Rt.__sid=Xe,Rt.texture=ti[Xe],O(Rt,Xe),Rt.visible=!0,Rt.alpha=1,Rt.x=T[nt].x,Mt<X.length){const ts=X[Mt];Rt.y=T[ts].y,qa(nt,Xe),Xc(nt)}else{const ts=Mt-X.length,cs=G(bt,0);Rt.y=T[cs].y-E*(ot-ts),qa(nt,Xe),Xc(nt)}}}bS(u);const k=Ge(90),F=Ge(14),R=Ge(190),L=Ge(300),N=Ge(520),D=Zu(a),U=Zu(u),j=D<2&&U>=2,V=D<3&&U>=3,Q=tt||j||V;Q&&(zp(520,1.04),(Jt=o==null?void 0:o.setBaseMusicIntensity)==null||Jt.call(o,.85,250));let q=null;if(Q){let bt=-1;for(let X=0;X<y;X++)if(u[X].id==="S1"){const ot=X%d;ot>bt&&(bt=ot)}q=Math.min(d,bt+1)}const K=q!==null?q-1:-1;let Z=!1;const at=Ge(220),yt=Array.from({length:d},(bt,X)=>new Promise(ot=>{let Mt=X*k;q!==null&&X>=q&&(Mt=q*k+N+(X-q)*R),setTimeout(async()=>{const ct=[];for(let Rt=_-1;Rt>=0;Rt--)ct.push(Rt*d+X);const nt=q!==null&&X>=q?L:F;await Promise.all(ct.map((Rt,Xe)=>new Promise(ts=>{setTimeout(()=>{const cs=Oe[Rt].sprite,ps=cs.y,Or=T[Rt].y;me(at,Gt=>{const Pt=es(Gt,.7);cs.y=ps+(Or-ps)*Pt}).then(ts)},Xe*nt)}))),Q&&!Z&&X===K&&(Z=!0,$p(u,N+260)),ot()},Mt)}));await Promise.all(yt),Q&&Vp(260,1),(Et=o==null?void 0:o.setBaseMusicIntensity)==null||Et.call(o,.25,400),Q&&jp(),jo(u)}function jo(a){for(let c=0;c<y;c++){const u=a[c].id,f=Oe[c].sprite;f.texture=ti[u],qa(c,u),Xc(c),f.visible=!0,f.alpha=1,O(f,u);const{cx:p,cy:x}=zc(c);f.x=p,f.y=zu(u,x),f.__sid=u}}async function vS(){if(!Oe.length)return;const a=g*(_+1),c=Ge(45),u=Ge(320),f=Array.from({length:d},(p,x)=>{const b=Array.from({length:y},(v,T)=>T).filter(v=>v%d===x);return new Promise(v=>{setTimeout(()=>{Promise.all(b.map(T=>{const E=Oe[T].sprite,k=E.y,F=k+a;return me(u,R=>{const L=Qo(R);E.y=k+(F-k)*L,E.alpha=1-L})})).then(()=>v())},x*c)})});await Promise.all(f),Nn.removeChildren(),Oe=[]}async function TS(a){$u(a);const c=g*(_+1),u=Array.from({length:y},(K,Z)=>{const at=a[Z].id,{cx:yt,cy:Vt}=zc(Z);return{x:yt,y:zu(at,Vt)}});for(let K=0;K<y;K++){const Z=Oe[K].sprite;Z.x=u[K].x,Z.y=u[K].y-c,Z.alpha=0,O(Z,a[K].id)}const f=Ge(60),p=Ge(0),x=Ge(420),b=Ge(200),v=Ge(60);for(let K=0;K<d;K++){const Z=K*v+x-b;setTimeout(()=>{var at;(at=o==null?void 0:o.playSfx)==null||at.call(o,"reel_land",.8)},Math.max(0,Z))}const T=Ge(420),E=Ge(520),k=Ge(300),F=Ge(300),R=Ge(400),L=Ge(500),N=Array.from({length:d},(K,Z)=>{let at=0;for(let yt=0;yt<_;yt++)a[yt*d+Z].id==="S1"&&at++;return at});let D=null,U=null,j=0;for(let K=0;K<d;K++)j+=N[K],D===null&&j>=2&&(D=K),U===null&&j>=3&&(U=K);function V(K){let Z=K*f;if(D!==null&&K>=D+1&&(Z=(D+1)*f+T+(K-(D+1))*k),U!==null&&K>=U+1){const at=D!==null?D+1:0,yt=Math.max(0,U+1-at);Z=at*f+(D!==null?T:0)+yt*(D!==null?k:f)+E+(K-(U+1))*F}return Z}if(tt||D!==null||U!==null){let K=function(Jt){let Et=p;return U!==null&&Jt>=U+1?Et=L:D!==null&&Jt>=D+1&&(Et=R),Et};const at=V(D??0)+x,yt=320,Vt=Math.max(...Array.from({length:d},(Jt,Et)=>{const bt=K(Et),X=(_-1)*bt;return V(Et)+X+x})),qt=Math.max(900,(Vt-at-yt)*1.6);setTimeout(()=>{zp(qt,1.05,1.03),$p(a,700)},Math.max(0,at)),setTimeout(()=>{Vp(320,1),jp()},Math.max(0,Vt))}const q=Array.from({length:d},(K,Z)=>new Promise(at=>{setTimeout(async()=>{const yt=[];for(let qt=0;qt<_;qt++)yt.push(qt*d+Z);let Vt=p;U!==null&&Z>=U+1?Vt=L:D!==null&&Z>=D+1&&(Vt=R),await Promise.all(yt.map((qt,Jt)=>new Promise(Et=>{setTimeout(()=>{const bt=Oe[qt].sprite,X=u[qt].y,ot=X-c;me(x,Mt=>{const ct=es(Mt,.6);bt.y=ot+(X-ot)*ct,bt.alpha=Math.min(1,Mt*1.2)}).then(Et)},Jt*Vt)}))),at()},V(Z))}));await Promise.all(q),jo(a)}async function CS(){const a={rhX:Ls.x,rhY:Ls.y,rhSX:Ls.scale.x,rhSY:Ls.scale.y,gX:Nn.x,gY:Nn.y,gSX:Nn.scale.x,gSY:Nn.scale.y,pfX:os.x,pfY:os.y,pfSX:os.scale.x,pfSY:os.scale.y,mX:$n.x,mY:$n.y,mSX:$n.scale.x,mSY:$n.scale.y},c=10,u=Ge(90),f=Ge(160);await me(u,p=>{const x=As(p),b=c*x;Ls.scale.set(a.rhSX,a.rhSY),Nn.scale.set(a.gSX,a.gSY),os.scale.set(a.pfSX,a.pfSY),$n.scale.set(a.mSX,a.mSY),Ls.position.set(a.rhX,a.rhY+b),Nn.position.set(a.gX,a.gY+b),os.position.set(a.pfX,a.pfY+b),$n.position.set(a.mX,a.mY+b)}),await me(f,p=>{const x=es(p,1.25),b=c+(0-c)*x;Ls.scale.set(a.rhSX,a.rhSY),Nn.scale.set(a.gSX,a.gSY),os.scale.set(a.pfSX,a.pfSY),$n.scale.set(a.mSX,a.mSY),Ls.position.set(a.rhX,a.rhY+b),Nn.position.set(a.gX,a.gY+b),os.position.set(a.pfX,a.pfY+b),$n.position.set(a.mX,a.mY+b)}),Ls.scale.set(a.rhSX,a.rhSY),Ls.position.set(a.rhX,a.rhY),Nn.scale.set(a.gSX,a.gSY),Nn.position.set(a.gX,a.gY),os.scale.set(a.pfSX,a.pfSY),os.position.set(a.pfX,a.pfY),$n.scale.set(a.mSX,a.mSY),$n.position.set(a.mX,a.mY)}function ES(a){var x;const p=Math.min(1,.15+a*.18);(x=o==null?void 0:o.setBaseMusicIntensity)==null||x.call(o,p,180)}function PS(a,c){const u=(c==null?void 0:c.baseDelayMs)??0,f=c==null?void 0:c.staggerMs,p=c==null?void 0:c.vol,x=.98,b=.015;for(let v=0;v<a.length;v++){const T=x+v*b;setTimeout(()=>{var E;(E=o==null?void 0:o.playSfx)==null||E.call(o,"reel_land",p,T)},u+v*f)}}function IS(a,c){const u=new Set;for(const f of a)u.add(f%c);return Array.from(u).sort((f,p)=>f-p)}async function kS(a){var u;$0(),oo(a.mode,!1),$c.text=`MODE: ${a.mode}`,jc.text="WIN: 0",$0();let c=0;await TS(a.initialGrid),a.mode==="FREE_SPINS"&&a.fsAwarded>0&&(await Dp(a.fsAwarded),se()),a.mode==="FREE_SPINS"&&a.fsAwarded>0&&r.fs.remaining>0&&mm(250),await Ni(!1);for(let f=0;f<a.steps.length;f++){const p=a.steps[f];if(a.mode==="BASE"&&ES(f),p.aftershockWildSpawned){jo(p.grid),await jw(p);continue}$u(p.grid);const x=new Set;p.clusters.forEach(Q=>Q.positions.forEach(q=>x.add(q)));const b=Array.from(x);if(b.length>0&&(await Wn(zw),p.clusters.length>0)){const at=Math.min(3,1+f*.15);(u=o==null?void 0:o.playSfxThrottled)==null||u.call(o,"cluster_pop",80,.9,at)}const v=Bs()?Promise.resolve():Ni(!0),T=Uw();Yw(b);const E=CS();await Promise.all([v,E,T]),(p.enchantedClusters??0)>0&&em(),x.forEach(Q=>wS(Q));const k=500,F=p.stepWinX*r.bank.betLevels[r.bank.betIndex];c+=F,F>1e-6&&Dw(c),console.log("[STEP FLAGS]",{i:f,infusedScatters:p.infusedScatters,enchantedClusters:p.enchantedClusters,scattersInGrid:Zu(p.grid)}),(p.enchantedClusters??0)>0&&(em(),await Wn(120)),(p.infusedScatters??0)>0&&(Du(),await Wn(120)),await Promise.all([lS(p.clusters,p.grid),oS(p.clusters),eS(p.clusters,p.multiplier,r.bank.betLevels[r.bank.betIndex],520)]),_m(!0),await Vc(k),_m(!1);const R=Qw(Ge(80)),L=Bs()?Promise.resolve():Ni(!1),N=p.explodePositions&&p.explodePositions.length>0?p.explodePositions:Array.from(new Set(p.clusters.flatMap(Q=>Q.positions))),D=IS(N,d);D.length>0&&PS(D,{baseDelayMs:Ge(220)+90,staggerMs:70,vol:.5});const U=a.steps[f+1],j=U&&U.aftershockWildSpawned?U.grid:p.nextGrid,V=AS(p.grid,N,j,f);if(await Promise.all([R,L,V]),K0(),p.clusters.length>0){let Q=tn.findIndex(Z=>Math.abs(Z-p.multiplier)<1e-6);Q<0&&(Q=0);const q=Math.min(Q+1,tn.length-1),K=tn[q];t0(K),Ac(K)}rm()}await Gw(200)}function _m(a){for(const c of Vo)c.s.visible&&(c.s.alpha=a?.85:1)}let Ka="INIT";oo("BASE",!1);async function oo(a,c=!0,u=!1){if(!(!u&&a===Ka)){if(!c){qe.visible=!0,qe.alpha=1,be.visible=a==="BASE",we.visible=a==="FREE_SPINS",be.alpha=.9,we.alpha=.9,Ka=a;return}a==="FREE_SPINS"?await pm(be,we,450,.9):await pm(we,be,450,.9),qe.visible=!0,qe.alpha=1,be.visible=a==="BASE",we.visible=a==="FREE_SPINS",Ka=a}}function gm(){const a=lt(pf);$c.text="MODE: BASE",qu.text="MULT: x1",jc.text="WIN: 0",Ku.text=`FS: ${r.fs.remaining}`,$u(a),jo(a)}Uu()}uC().catch(s=>{console.error("Fatal error in main():",s)});export{ra as $,Gg as A,Ns as B,et as C,en as D,kt as E,Lg as F,ca as G,wr as H,oa as I,Um as J,ce as K,JM as L,fe as M,hA as N,vl as O,ms as P,vn as Q,gl as R,lA as S,Gi as T,_h as U,$t as V,EA as W,Xm as X,cd as Y,zm as Z,LM as _,Sr as a,Dn as a0,IM as a1,og as a2,Hg as a3,jt as a4,Pe as a5,FA as a6,ov as a7,JA as a8,vv as a9,Cv as aa,Lv as ab,Ov as ac,Rv as ad,ny as ae,i_ as af,s_ as ag,k_ as ah,Gr as ai,BT as aj,on as ak,ht as al,JS as am,An as an,H_ as ao,iy as ap,KA as b,wl as c,dh as d,us as e,r_ as f,$A as g,sf as h,Ng as i,_g as j,Mr as k,Pg as l,Ml as m,Av as n,Tv as o,Iv as p,Fv as q,fM as r,vh as s,Xt as t,QS as u,Ah as v,an as w,Bv as x,hr as y,sg as z};
